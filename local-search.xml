<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ç¥ç»ç½‘ç»œé‡åŒ–ä¸å‹ç¼©ç»¼è¿°</title>
    <link href="/2020/09/22/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E9%87%8F%E5%8C%96%E4%B8%8E%E5%8E%8B%E7%BC%A9%E7%BB%BC%E8%BF%B0/"/>
    <url>/2020/09/22/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E9%87%8F%E5%8C%96%E4%B8%8E%E5%8E%8B%E7%BC%A9%E7%BB%BC%E8%BF%B0/</url>
    
    <content type="html"><![CDATA[<h4 id="1-å¸¸è§çš„æ•°æ®é›†"><a href="#1-å¸¸è§çš„æ•°æ®é›†" class="headerlink" title="1. å¸¸è§çš„æ•°æ®é›†"></a>1. å¸¸è§çš„æ•°æ®é›†</h4><p><strong>åˆ†ç±»ä»»åŠ¡(ç›®å‰ä¸»æµ</strong>)ï¼šMNISTã€CIFAR10ã€CIFAR100å’Œ ImageNetç­‰ã€‚</p><p><strong>æ£€æµ‹ä»»åŠ¡</strong>: PASCAL VOCã€MS COCO</p><h4 id="2-æµ‹è¯•ç½‘ç»œ"><a href="#2-æµ‹è¯•ç½‘ç»œ" class="headerlink" title="2. æµ‹è¯•ç½‘ç»œ"></a>2. æµ‹è¯•ç½‘ç»œ</h4><p><strong>åˆ†ç±»</strong>:  VGG: -&gt; è¯¥ç½‘ç»œå†—ä½™åº¦è¾ƒé«˜ï¼Œ å‹ç¼©æ¯”ä¾‹è¾ƒå¤§</p><p>â€‹      ResNet34ã€ResNet50ã€DenseNetã€SeNet:</p><p>æ£€æµ‹: YOLOV3ã€Faster RCNNã€RetinaNet</p><h4 id="3-è¯„ä»·æŒ‡æ ‡"><a href="#3-è¯„ä»·æŒ‡æ ‡" class="headerlink" title="3. è¯„ä»·æŒ‡æ ‡"></a>3. è¯„ä»·æŒ‡æ ‡</h4><p>å¯¹äºæ¨¡å‹åŠ é€Ÿæ–¹æ¡ˆ: é€šå¸¸æœ‰å¦‚ä¸‹çš„è¯„ä»·æŒ‡æ ‡:</p><p>(1) è®¡ç®—é‡(Flops)</p><p>(2) æ¨¡å‹å¤§å°(Model size)</p><p>(3) æ¨æ–­æ—¶é—´(Inference)</p><p>ç²¾åº¦è¯¯å·®: åˆ†ç±»: Top1 accã€Top5 acc     æ£€æµ‹: mAP_50</p><h4 id="4-è§£å†³æ–¹æ¡ˆ"><a href="#4-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="4. è§£å†³æ–¹æ¡ˆ"></a>4. è§£å†³æ–¹æ¡ˆ</h4><p><img src="/2020/09/22/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E9%87%8F%E5%8C%96%E4%B8%8E%E5%8E%8B%E7%BC%A9%E7%BB%BC%E8%BF%B0/1.png" alt></p><h5 id="4-1-ç®—æ³•"><a href="#4-1-ç®—æ³•" class="headerlink" title="4.1 ç®—æ³•"></a>4.1 ç®—æ³•</h5><h6 id="ï¼ˆ1ï¼‰è½»é‡çº§ç½‘ç»œè®¾è®¡"><a href="#ï¼ˆ1ï¼‰è½»é‡çº§ç½‘ç»œè®¾è®¡" class="headerlink" title="ï¼ˆ1ï¼‰è½»é‡çº§ç½‘ç»œè®¾è®¡"></a>ï¼ˆ1ï¼‰è½»é‡çº§ç½‘ç»œè®¾è®¡</h6><p>ğŸŒŸ [SqueezeNet] SqueezeNet: AlexNet-level accuracy with 50x fewer parameters and &lt;0.5MB model size.</p><p>ğŸŒŸ [Mobilenet V1] MobileNets: Efficient Convolutional Neural Networks for Mobile Vision Applications</p><p>ğŸŒŸ [Mobilenet V2] MobileNetV2: Inverted Residuals and Linear Bottlenecks</p><p>ğŸŒŸ [Mobilenet V3] Searching for MobileNetV3(nas for efficient conv neural network) </p><p>ğŸŒŸ [ShufflenetV1] ShuffleNet: An Extremely Efficient Convolutional Neural Network for Mobile Devices</p><p>ğŸŒŸ [ShufflenetV2] ShuffleNet V2: Practical Guidelines for Ecient CNN Architecture Design </p><p>ğŸŒŸ [Xception] Xception: Deep Learning with Depthwise Separable Convolutions</p><p>-â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p><p>ğŸŒŸ Mobilenets: Efficient convolutional neural networks for mobile vision applications</p><p>ğŸŒŸ Pelee: A Real-Time Object Detection System on Mobile Devices</p><p>ğŸŒŸ Tiny-dsod: Lightweight object detection for resource-restricted usages.</p><p>ğŸŒŸ Lighthead r-cnn: In defense of two-stage object detector</p><p>ğŸŒŸ ThunderNet: Towards Real-time Generic Object Detection</p><h6 id="ï¼ˆ2ï¼‰å‰ªæï¼ˆç¨€ç–åŒ–ï¼‰"><a href="#ï¼ˆ2ï¼‰å‰ªæï¼ˆç¨€ç–åŒ–ï¼‰" class="headerlink" title="ï¼ˆ2ï¼‰å‰ªæï¼ˆç¨€ç–åŒ–ï¼‰"></a>ï¼ˆ2ï¼‰å‰ªæï¼ˆç¨€ç–åŒ–ï¼‰</h6><p><strong>åŸºæœ¬æ€æƒ³:</strong> é€šè¿‡å¯¹å·²æœ‰çš„è®­ç»ƒå¥½çš„ç¥ç»ç½‘ç»œæ¨¡å‹ç§»é™¤å†—ä½™çš„ã€ä¿¡æ¯é‡å°‘çš„æƒå€¼ï¼Œä»è€Œå‡å°‘ç½‘ç»œæ¨¡å‹çš„å‚æ•°ï¼Œè¿›è€ŒåŠ é€Ÿæ¨¡å‹çš„è®¡ç®—å’Œå‹ç¼©æ¨¡å‹çš„å­˜å‚¨ç©ºé—´</p><p><strong>A. åŸå§‹è®ºæ–‡</strong></p><p>ğŸŒŸ OBD(optimal brain damage) &amp; OBS(optimal brain surgeon)</p><p>ğŸŒŸ <a href="https://arxiv.org/abs/1510.00149">Deep Compression: Compressing Deep Neural Networks with Pruning, Trained Quantization and Huffman Coding</a></p><p>   é’ˆå¯¹ç½‘ç»œå‹ç¼©æå‡ºäº†ä¸€ä¸ªæ¯”è¾ƒå®Œæ•´çš„æ–¹æ¡ˆ  ICLRâ€™16 best paper Song Han</p><p><strong>B. éç»“æ„åŒ–å‰ªæ</strong></p><p>ğŸŒŸ <a href="https://arxiv.org/abs/1506.02626">Learning both Weights and Connections for Efficient Neural Networks</a> [NIPSâ€™15]</p><p>   A. Metric: L1 norm   B.train -&gt; pruning -&gt; retrain ä¸‰é˜¶æ®µè®­ç»ƒæ–¹æ³•  C. iteratively pruning</p><p><strong>C. ç»“æ„åŒ–å‰ªæ</strong></p><p>ğŸŒŸ Learning Structured Sparsity in Deep Neural Networks [NIPS 2016] <a href="https://github.com/wenwei202/caffe/tree/scnn">Code</a>  ä½¿ç”¨ group Lasso ç»™æŸå¤±å‡½æ•°åŠ å…¥ç›¸åº”çš„æƒ©ç½šï¼Œè¿›è¡Œç»“æ„åŒ–ç¨€ç–</p><p><strong>D. æ»¤æ³¢å™¨æˆ–è€…é€šé“çš„å‰ªæ</strong>:ä¸»è¦çš„ä¸åŒç‚¹æ˜¯è¯„ä»·å·ç§¯æ ¸æˆ–è€…feature mapçš„é‡è¦æ€§</p><p>ğŸŒŸ [Weight sum]<a href="https://arxiv.org/abs/1608.08710">Pruning Filters for Efficient ConvNets</a> [ICLRâ€™17]   </p><p>â€‹    è¡¡é‡æ ‡å‡†: Filterçš„L1 norm</p><p>ğŸŒŸ [APoZ(Average Percentage of Zeros)] Network trimming: A data-driven neuron pruning approach towards efficient deep architectures.   </p><p>â€‹    è¡¡é‡æ ‡å‡†: æ¿€æ´»å±‚è¾“å‡ºçš„feature mapçš„çš„ç¨€ç–ç¨‹åº¦</p><p>ğŸŒŸ <strong>Learning Efficient Convolutional Networks through Network Slimming</strong> </p><p>â€‹    è¡¡é‡æ ‡å‡†: BNå±‚çš„Î³å‚æ•°</p><p>ğŸŒŸ Pruning Convolutional Neural Networks for Resource Efficient Inference [ICLR 2017]  </p><p>â€‹    è¡¡é‡æ ‡å‡†: ä¿®å‰ªç½‘ç»œå‚æ•°å¼•èµ·çš„æŸå¤±å‡½æ•°çš„å˜åŒ–</p><p>ğŸŒŸ  ThiNetï¼š A Filter Level Pruning Method for Deep Neural Network Compression [ICCV 2017] </p><p>â€‹    è¡¡é‡æ ‡å‡†: ç”¨è¾“å…¥å­é›†ä»£æ›¿åŸæ¥çš„è¾“å…¥å¾—åˆ°è¾“å‡ºçš„ç›¸ä¼¼åº¦</p><p>ğŸŒŸ  Channel Pruning for Accelerating Very Deep Neural Networks [ICCV 2017]</p><p>â€‹    è¡¡é‡æ ‡å‡†: é€šè¿‡æœ€å°åŒ–è£å‰ªåç‰¹å¾å›¾å’Œè£å‰ªå‰ç‰¹å¾å›¾ä¹‹é—´çš„è¯¯å·®</p><p><strong>E. å…¶ä»–æ”¹è¿›</strong></p><p> ğŸŒŸ <a href="https://arxiv.org/abs/1710.01878">To prune, or not to prune: exploring the efficacy of pruning for model compression</a> [ICLRâ€™18]  </p><p> ğŸŒŸ Data-Driven Sparse Structure Selection for Deep Neural Networks</p><p> ğŸŒŸ Channel Pruning for Accelerating Very Deep Neural Networks   [ICCV 2017]</p><p> ğŸŒŸ Soft Filter Pruning for Accelerating Deep Convolutional Neural Networks    [IJCAI 2018]</p><p><strong>F. ç†è®ºåˆ†æå’Œè®¨è®º</strong></p><p>ğŸŒŸ <strong>Rethink the value of network pruning</strong> ICLR_2019</p><p>â€‹    è¿™ç¯‡è®ºæ–‡çš„ä½œè€…å®éªŒè¿‡ç¨‹ä¸­å‘ç°äº†æ¨¡å‹ä¿®å‰ªè¿‡åï¼Œå¾®è°ƒå¾—åˆ°çš„æ•ˆæœå’Œé‡æ–°ä»å¤´è®­ç»ƒå‡ ä¹ç›¸åŒï¼Œäºæ˜¯ä¾¿åšäº†å¤šç»„å®éªŒè¯æ˜è¿™ä¸€ç»“è®ºï¼Œæ¨ç¿»äº†åŒ…æ‹¬è‡ªå·±çš„æ–¹æ³•åœ¨å†…çš„å¾ˆå¤šæ–¹æ³•ï¼Œæå‡ºå¯¹å‚æ•°ä¿®å‰ªçš„ä¸€ä¸ªæ–°çš„è®¤è¯†ï¼šå‚æ•°ä¿®å‰ªçš„å®é™…ä½œç”¨åœ¨äºå¾—åˆ°æ¶æ„è€Œéæƒå€¼</p><p>ğŸŒŸ <strong>The Lottery Ticket Hypothesis: Finding Sparse, Trainable Neural Networks</strong>  [ICLR 2019 best paper]</p><h6 id="3-é‡åŒ–-8bitã€äºŒå€¼ã€ä¸‰å€¼"><a href="#3-é‡åŒ–-8bitã€äºŒå€¼ã€ä¸‰å€¼" class="headerlink" title="(3) é‡åŒ–(8bitã€äºŒå€¼ã€ä¸‰å€¼)"></a>(3) é‡åŒ–(8bitã€äºŒå€¼ã€ä¸‰å€¼)</h6><p>æ ¸å¿ƒæ€æƒ³: æ¨¡å‹é‡åŒ–æ˜¯æŒ‡æƒé‡æˆ–æ¿€æ´»è¾“å‡ºå¯ä»¥è¢«èšç±»åˆ°ä¸€äº›ç¦»æ•£ã€ä½ç²¾åº¦(reduced precision) çš„æ•°å€¼ç‚¹ä¸Šï¼Œè¿™é€šå¸¸ä¾èµ–äºç‰¹å®šç®—æ³•åº“æˆ–ç¡¬ä»¶å¹³å°çš„æ”¯æŒï¼š</p><p><strong>äºŒå€¼ç½‘ç»œ</strong></p><p><strong>Binary Weight</strong> (åªå¯¹æƒé‡è¿›è¡ŒäºŒå€¼åŒ–)</p><p>ğŸŒŸ [BinaryConnect] BinaryConnect: Training Deep Neural Networks with binary weights during propagations</p><p>ğŸŒŸ [BWN]  Binary-Weights-Networks</p><p><strong>Binary Weight &amp; activation</strong> (å¯¹æƒé‡å’Œæ¿€æ´»éƒ½è¿›è¡ŒäºŒå€¼åŒ–)</p><p>ğŸŒŸ [BNN] <a href="https://arxiv.org/pdf/1602.02830.pdf">Binarized Neural Networks: Training Neural Networks with Weights and Activations Constrained to +1 or âˆ’1</a></p><p>ğŸŒŸ [XNOR Net] <a href="https://arxiv.org/pdf/1603.05279.pdf">XNOR-Net: ImageNet Classification Using Binary Convolutional Neural Networks</a></p><p>-&gt; [ABCNet] Towards Accurate Binary Convolutional Neural Network by Xiaofan Lin, Cong Zhao, and Wei Pan.</p><p>-&gt; [Bi-Real Net] Enhancing the Performance of 1bit CNNs with Improved Representational Capacity and Advanced Training Algorithm</p><p>-&gt; [HORQ]Performance Guaranteed Network Acceleration via High-Order Residual Quantization</p><p><strong>ä¸‰å€¼åŒ–ç½‘ç»œ</strong></p><p>ğŸŒŸ [TWN] <a href="https://arxiv.org/pdf/1605.04711.pdf">Ternary weight networks</a></p><p>[TNN] Ternary Neural Networks for Resource-Efficient AI Applications </p><p>[TTQ] Trained Ternary Quantization </p><p><strong>2bit - 8bit</strong></p><p>ğŸŒŸ [DOREFA-NET] DoReFa-Net: Training Low Bitwidth Convolutional Neural Networks with Low Bitwidth Gradients</p><p><strong>int8 é‡åŒ–</strong></p><p>ğŸŒŸ <strong>8-bit Inference with TensorRT  [Nvidia]</strong></p><p>ğŸŒŸ Quantizing deep convolutional networks for efficient inference: A whitepaper [Google]</p><p><strong>å…¶ä»–</strong></p><p>ğŸŒŸ [INQ] Incremental Network Quantization: Towards Lossless CNNs with Low-precision Weights</p><p>[CNNPack] Packing Convolutional Neural Networks in the Frequency Domain</p><p>[HWGQ]  Deep Learning with Low Precision by Half-wave Gaussian Quantization</p><p>[FFN] Fixed-point Factorized Networks</p><p>[QNN] Quantized Neural Networks: Training Neural Networks with Low Precision Weights and Activations </p><p><strong>å°ç»“</strong></p><p><img src="/2020/09/22/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E9%87%8F%E5%8C%96%E4%B8%8E%E5%8E%8B%E7%BC%A9%E7%BB%BC%E8%BF%B0/2.png" alt></p><p>è‹¥æ¨¡å‹å‹ç¼©ä¹‹åï¼Œæ¨ç†ç²¾åº¦å­˜åœ¨è¾ƒå¤§æŸå¤±ï¼Œå¯ä»¥é€šè¿‡fine-tuningäºˆä»¥æ¢å¤ï¼Œå¹¶åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ç»“åˆé€‚å½“çš„Tricksï¼Œä¾‹å¦‚ Label Smoothingã€Mix-upã€Knowledge Distillationã€Focal Lossç­‰ã€‚ æ­¤å¤–ï¼Œæ¨¡å‹å‹ç¼©ã€ä¼˜åŒ–åŠ é€Ÿç­–ç•¥å¯ä»¥è”åˆä½¿ç”¨ï¼Œè¿›è€Œå¯è·å¾—æ›´ä¸ºæè‡´çš„å‹ç¼©æ¯”ä¸åŠ é€Ÿæ¯”ã€‚</p><h6 id="4-çŸ¥è¯†è’¸é¦"><a href="#4-çŸ¥è¯†è’¸é¦" class="headerlink" title="(4) çŸ¥è¯†è’¸é¦"></a>(4) çŸ¥è¯†è’¸é¦</h6><p>åŸºæœ¬æ€æƒ³: è’¸é¦æ¨¡å‹é‡‡ç”¨çš„æ˜¯è¿ç§»å­¦ä¹ ï¼Œ é€šè¿‡é‡‡ç”¨é¢„å…ˆè®­ç»ƒå¥½çš„æ•™å¸ˆæ¨¡å‹(teacher model) çš„è¾“å‡ºä½œä¸ºç›‘ç£ä¿¡å·å»è®­ç»ƒå¦å¤–ä¸€ä¸ªè½»é‡åŒ–çš„ç½‘ç»œ(student model)</p><p>ğŸŒŸ Distilling the knowledge in a neural network?</p><p>ğŸŒŸ Cross Model Distillation for Supervision Transfer</p><p>ğŸŒŸ FitNets: Hints for Thin Deep Nets</p><h6 id="5-ç®—å­çš„å®ç°-å­˜å‚¨"><a href="#5-ç®—å­çš„å®ç°-å­˜å‚¨" class="headerlink" title="(5) ç®—å­çš„å®ç°/å­˜å‚¨"></a>(5) ç®—å­çš„å®ç°/å­˜å‚¨</h6><p><strong>A. op-level çš„å®ç°</strong></p><p><strong>conv:</strong></p><p>   im2col + gemm</p><p>   FFT Conv2d (7x7, 9x9)</p><p>   <strong>Winograd Conv2d (3x3, 5x5)</strong> </p><p><strong>B. Layer-level</strong>çš„å¿«é€Ÿç®—æ³•</p><p>   Sparse-block net</p><p>C. å­˜å‚¨</p><p>   CSR</p><h6 id="6-å›¾ä¼˜åŒ–"><a href="#6-å›¾ä¼˜åŒ–" class="headerlink" title="(6) å›¾ä¼˜åŒ–"></a>(6) å›¾ä¼˜åŒ–</h6><p>   conv å’Œ bnå±‚çš„èåˆ</p><h5 id="4-2-ç¡¬ä»¶å¹³å°"><a href="#4-2-ç¡¬ä»¶å¹³å°" class="headerlink" title="4.2 ç¡¬ä»¶å¹³å°"></a>4.2 ç¡¬ä»¶å¹³å°</h5><p><strong>CPUã€GPUã€FPGAã€DSPã€åŠ é€Ÿå™¨</strong></p><h5 id="4-3-å¸¸è§çš„éƒ¨ç½²æ–¹æ¡ˆ"><a href="#4-3-å¸¸è§çš„éƒ¨ç½²æ–¹æ¡ˆ" class="headerlink" title="4.3 å¸¸è§çš„éƒ¨ç½²æ–¹æ¡ˆ"></a>4.3 å¸¸è§çš„éƒ¨ç½²æ–¹æ¡ˆ</h5><p><strong>(1)Server:</strong></p><p>â€‹       <strong>TensorRT</strong></p><p>   <strong>Apex</strong>   Paper: Mixed Precision Training   github: <a href="https://github.com/NVIDIA/apex">https://github.com/NVIDIA/apex</a></p><p><strong>(2) Mobile:</strong> </p><p>â€‹    <strong>Tensorflow:</strong> Tensorflow-lite: <a href="https://www.tensorflow.org/lite/performance/post_training_quantization">https://www.tensorflow.org/lite/performance/post_training_quantization</a></p><p>â€‹    Pytorch: <strong>Distiller</strong> (Intel)</p><p>â€‹             <strong>QNNpack</strong>: <a href="https://github.com/pytorch/QNNPACK">https://github.com/pytorch/QNNPACK</a></p><p>â€‹    <strong>paddle-lite</strong> (Baidu) <a href="https://github.com/PaddlePaddle/Paddle-Lite">https://github.com/PaddlePaddle/Paddle-Lite</a></p><p>â€‹    <strong>ncnn</strong> (Tencent) <a href="https://github.com/Tencent/ncnn">https://github.com/Tencent/ncnn</a></p><p> mace(Xiaomi)  <a href="https://github.com/XiaoMi/mace">https://github.com/XiaoMi/mace</a></p><p> mnn(Alibaba)   <a href="https://github.com/alibaba/MNN">https://github.com/alibaba/MNN</a></p><p>â€‹    OpenVINO(opencv) <a href="https://software.intel.com/en-us/openvino-toolkit">https://software.intel.com/en-us/openvino-toolkit</a></p><p><strong>(3) Others:</strong></p><p>TVM: <a href="https://github.com/dmlc/tvm">https://github.com/dmlc/tvm</a></p><p>TC: TensorComprehensions</p><p>onnx: <a href="https://github.com/onnx/onnx">https://github.com/onnx/onnx</a></p><p>â€‹    <strong>DABNN</strong></p><p>â€‹    Paper ï¼š<a href="https://arxiv.org/abs/1908.05858">https://arxiv.org/abs/1908.05858</a></p><p>â€‹    Projectï¼š<a href="https://github.com/JDAI-CV/dabnn">https://github.com/JDAI-CV/dabnn</a></p><p>â€‹    Demoï¼š<a href="https://github.com/JDAI-CV/dabnn-example">https://github.com/JDAI-CV/dabnn-example</a></p><h4 id="5-å‚è€ƒé“¾æ¥"><a href="#5-å‚è€ƒé“¾æ¥" class="headerlink" title="5. å‚è€ƒé“¾æ¥"></a>5. å‚è€ƒé“¾æ¥</h4><p><a href="https://jackwish.net/2019/neural-network-quantization-resources.html">https://jackwish.net/2019/neural-network-quantization-resources.html</a></p><h4 id="6-idea"><a href="#6-idea" class="headerlink" title="6. idea"></a>6. idea</h4><p>> Attention for distillation</p><p>> knowledge distillation -&gt;(zero shot)</p><p>> GNN -&gt; compression and accleration </p><p>> model compression -&gt; å¯¹æŠ—æ”»å‡»!</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ncnnå‰å‘è®¡ç®—æµç¨‹æµ…æ</title>
    <link href="/2020/09/21/ncnn%E5%89%8D%E5%90%91%E8%AE%A1%E7%AE%97%E6%B5%81%E7%A8%8B%E6%B5%85%E6%9E%90/"/>
    <url>/2020/09/21/ncnn%E5%89%8D%E5%90%91%E8%AE%A1%E7%AE%97%E6%B5%81%E7%A8%8B%E6%B5%85%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<p><strong>1. å‰å‘è®¡ç®—</strong></p><p>â€‹    ä½¿ç”¨ncnnè¿›è¡Œå‰å‘è®¡ç®—çš„æ­¥éª¤å¾ˆç®€å•ï¼Œå°±å¦‚ä¸‹åå‡ è¡Œä»£ç å³å¯å®Œæˆã€‚</p><pre><code class="hljs groovy"><span class="hljs-comment">/* Step 1.1 : åŠ è½½.parma æ–‡ä»¶ */</span>NSString *paramPath = [[NSBundle mainBundle] <span class="hljs-attr">pathForResource:</span>@<span class="hljs-string">&quot;squeezenet_v1.1&quot;</span> <span class="hljs-attr">ofType:</span>@<span class="hljs-string">&quot;param&quot;</span>];ncnn_net.load_param(paramPath.UTF8String);<span class="hljs-comment">/* Step 1.2 : åŠ è½½.bin æ–‡ä»¶ */</span>NSString *binPath = [[NSBundle mainBundle] <span class="hljs-attr">pathForResource:</span>@<span class="hljs-string">&quot;squeezenet_v1.1&quot;</span> <span class="hljs-attr">ofType:</span>@<span class="hljs-string">&quot;bin&quot;</span>];ncnn_net.load_model(binPath.UTF8String);<span class="hljs-comment">/* Step 2.1 : æ„å»ºå¹¶é…ç½® æå–å™¨ */</span><span class="hljs-attr">ncnn:</span>:Extractor extractor = ncnn_net.create_extractor();extractor.set_light_mode(<span class="hljs-literal">true</span>);<span class="hljs-comment">/* Step 2.2 : è®¾ç½®è¾“å…¥ï¼ˆå°†å›¾ç‰‡è½¬æ¢æˆncnn::Matç»“æ„ä½œä¸ºè¾“å…¥ï¼‰ */</span>UIImage *srcImage = [UIImage <span class="hljs-attr">imageNamed:</span>@<span class="hljs-string">&quot;mouth&quot;</span>];<span class="hljs-attr">ncnn:</span>:Mat mat_src;ts_image2mat(mat_src, srcImage);extractor.input(<span class="hljs-string">&quot;data&quot;</span>, mat_src);<span class="hljs-comment">/* Step 2.3 : æå–è¾“å‡º */</span><span class="hljs-attr">ncnn:</span>:Mat mat_dst;extractor.extract(<span class="hljs-string">&quot;prob&quot;</span>, mat_dst);</code></pre><p>â€‹    å¦‚æœä½ ä»…ä»…æƒ³ä½¿ç”¨ncnnï¼Œä¸Šé¢çš„å‚è€ƒè¶³å¤Ÿäº†ï¼›ä½†è‹¥ä½ æƒ³è¦äº†è§£ï¼Œç”šè‡³å»æ›´æ”¹ä¸€äº›å…¶ä¸­çš„æºä»£ç ï¼Œå¯ä»¥è·Ÿæˆ‘ä¸€èµ·çœ‹çœ‹ä¸Šé¢è¿™åå¤šè¡Œä»£ç çš„åº•å±‚è¿ä½œåŸç†ã€‚</p><p><strong>2 ä»£ç åˆ†æ</strong></p><p>æˆ‘å§‘ä¸”å°†å…¶åˆ†ä¸ºï¼š<strong>åŠ è½½æ¨¡å‹</strong>ã€å‰å‘æ£€æµ‹ã€è¾“å‡ºå¤„ç†(åŠåˆ’æ°´)ã€æ¨¡å‹å°è£…(å…¨åˆ’æ°´) å››ä¸ªéƒ¨åˆ†æ¥åŠ ä»¥åˆ†æã€‚</p><p><strong>2.1 åŠ è½½æ¨¡å‹</strong></p><p>ncnn åœ¨ iOS ç«¯ä½¿ç”¨ <strong>.param</strong> å’Œ <strong>.bin</strong> ä¸¤ä¸ªæ–‡ä»¶æ¥æè¿°ä¸€ä¸ªç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œ</p><p>å…¶ä¸­ï¼š</p><p><strong>.param</strong>ï¼šæè¿°ç¥ç»ç½‘ç»œçš„ç»“æ„ï¼ŒåŒ…æ‹¬å±‚åç§°ï¼Œå±‚è¾“å…¥è¾“å‡ºä¿¡æ¯ï¼Œå±‚å‚æ•°ä¿¡æ¯ï¼ˆå¦‚å·ç§¯å±‚çš„kernalå¤§å°ç­‰ï¼‰ç­‰ã€‚</p><p><strong>.bin</strong> æ–‡ä»¶åˆ™è®°å½•ç¥ç»ç½‘ç»œè¿ç®—æ‰€éœ€è¦çš„æ•°æ®ä¿¡æ¯ï¼ˆæ¯”å¦‚å·ç§¯å±‚çš„æƒé‡ã€åç½®ä¿¡æ¯ç­‰ï¼‰</p><p><img src="/2020/09/21/ncnn%E5%89%8D%E5%90%91%E8%AE%A1%E7%AE%97%E6%B5%81%E7%A8%8B%E6%B5%85%E6%9E%90/1.png" alt="x" style="zoom:50%;"></p><p><strong>2.1.1 load_param åŠ è½½ç¥ç»ç½‘ç»œé…ç½®ä¿¡æ¯</strong></p><pre><code class="hljs objective-c">&#x2F;* Step1.1 : åŠ è½½.parma æ–‡ä»¶ *&#x2F;NSString *paramPath &#x3D; [[NSBundle mainBundle] pathForResource:@&quot;squeezenet_v1.1&quot; ofType:@&quot;param&quot;];ncnn_net.load_param(paramPath.UTF8String);</code></pre><p>load_param çš„æ ¹æœ¬ç›®çš„æ˜¯å°†.paramæ–‡ä»¶çš„ä¿¡æ¯åŠ è½½åˆ°ç›®æ ‡ç¥ç»ç½‘ç»œï¼ˆä¸€ä¸ªncnn::Netç»“æ„ï¼‰ä¸­</p><p><strong>2.1.1.1 .paramæ–‡ä»¶çš„ç»“æ„</strong></p><p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹ .param æ–‡ä»¶çš„å†…å®¹æ ¼å¼</p><p><img src="/2020/09/21/ncnn%E5%89%8D%E5%90%91%E8%AE%A1%E7%AE%97%E6%B5%81%E7%A8%8B%E6%B5%85%E6%9E%90/2.png" style="zoom:50%;"></p><p><strong>ä¸€ä¸ª.paramæ–‡ä»¶ç”±ä»¥ä¸‹å‡ éƒ¨åˆ†ç»„æˆï¼š</strong></p><p><strong>1ï¼‰MagicNum</strong></p><p>å›ºå®šä½7767517ï¼Œä¸ºä»€ä¹ˆè¿™ä¸ªæ•°å­—ï¼Œä¸çŸ¥é“é—®å€ªç¥å»å§</p><p>2ï¼‰layerã€blobä¸ªæ•°</p><p>ä¸Šå›¾ç¤ºä¾‹çš„æ–‡ä»¶ä¸¤ä¸ªæ•°å­—åˆ†åˆ«ä¸ºï¼š75ã€83</p><p><strong>layerï¼šæˆ‘ä»¬çŸ¥é“ç¥ç»ç½‘ç»œæ˜¯ä¸€å±‚ä¸€å±‚å‘å‰æ¨è¿›è®¡ç®—çš„ï¼Œæ¯ä¸€å±‚æˆ‘ä»¬ç”¨ä¸€ä¸ªlayerè¡¨ç¤ºï¼›</strong></p><p><strong>blobï¼šæ¯ä¸€ä¸ªlayeréƒ½å¯èƒ½ä¼šæœ‰è¾“å…¥ã€è¾“å‡ºï¼Œåœ¨ncnnä¸­ï¼Œå®ƒä»¬ç»Ÿä¸€ç”¨ä¸€ä¸ªå¤šç»´ï¼ˆ3ç»´ï¼‰å‘é‡è¡¨ç¤ºï¼Œæˆ‘ä»¬ç§°æ¯ä¸€ä¸ªè¾“å…¥ã€è¾“å‡ºçš„åŸå­ä¸ºä¸€ä¸ªblobï¼Œå¹¶ä¸ºå®ƒèµ·å</strong></p><p>2.1.1.2 layerçš„æè¿°</p><p>layer åœ¨ .param ä¸­æ˜¯ä¸€ä¸ªç›¸å¯¹å¤æ‚çš„å…ƒç´ ï¼ˆä»ç¬¬3è¡Œèµ·çš„æ¯ä¸€è¡Œæè¿°ä¸€ä¸ªlayerï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠå®ƒå•ç‹¬æŠ½å‡ºæ¥ä¸€å°èŠ‚è¿›è¡Œè¯´æ˜ã€‚</p><p><img src="/2020/09/21/ncnn%E5%89%8D%E5%90%91%E8%AE%A1%E7%AE%97%E6%B5%81%E7%A8%8B%E6%B5%85%E6%9E%90/3.png" alt></p><p>å¦‚å›¾ï¼Œ<strong>æ¯ä¸€è¡Œå±‚æè¿°çš„å†…å®¹åŒ…æ‹¬ä»¥ä¸‹å‡ éƒ¨åˆ†</strong>ï¼š</p><p><strong>1ï¼‰å±‚ç±»å‹</strong>     æ¯”å¦‚<strong>Inputã€Convolutionã€ReLU</strong></p><p><strong>2ï¼‰å±‚å</strong>       æ¨¡å‹è®­ç»ƒè€…ä¸ºè¯¥å±‚èµ·å¾—åå­—ï¼ˆæ¯•ç«Ÿç›¸åŒç±»å‹çš„å±‚å¯èƒ½å¤šæ¬¡ä½¿ç”¨ï¼Œæˆ‘ä»¬è¦åŒºåˆ†å®ƒä»¬ï¼‰</p><p><strong>3ï¼‰å±‚è¾“å…¥è¾“å‡º  åŒ…å«ï¼šå±‚è¾“å…¥blobæ•°é‡ï¼Œå±‚è¾“å‡ºblobæ•°é‡ï¼Œå±‚è¾“å…¥ã€è¾“å‡ºblobçš„åç§°</strong></p><p><strong>4ï¼‰å±‚é…ç½®å‚æ•°</strong></p><p>æ¯”å¦‚ <strong>å·ç§¯å±‚ï¼ˆConvolution Layerï¼‰çš„ å·ç§¯æ ¸å¤§å°ã€æ­¥é•¿ä¿¡æ¯</strong> ç­‰</p><p>åœ¨ å…·ä½“å±‚é‡Œé¢éƒ½æœ‰ä¸€ä¸ªå‡½æ•°: load_param, ä»é‡Œé¢å¯ä»¥æŸ¥è¯¢åˆ°ç›¸å…³ä¿¡æ¯ã€‚</p><p><strong>dataå±‚ï¼š 0=é•¿ 1=å®½ 3=é€šé“</strong></p><p><strong>Convolutionå±‚ 0=è¾“å‡ºå•å…ƒ 1=å·ç§¯æ ¸å¤§å°  2=æ ¸è†¨èƒ€[è§è†¨èƒ€å·ç§¯]    3=stride</strong>    </p><p>â€‹                                 <strong>4=padding    5=æ˜¯å¦å­˜åœ¨åç½®    6=æƒé‡æ•°é‡</strong></p><p><strong>pooling å±‚    0=æ± åŒ–ç±»å‹   1=å·ç§¯æ ¸å¤§å°   2=æ­¥é•¿stride   3=padding   4=å…¨å±€æ± åŒ–  5=paddingç±»å‹</strong></p><p><strong>ReLU å±‚ 0=0.000000 æ— å‚æ•°</strong></p><p><strong>softmax å±‚ 0=0 æ— å‚æ•°</strong></p><p><strong>Concat Split Dropout æ— å‚æ•°</strong></p><p><strong>ConvolutionDepthWise    7=group æ•°ç›®</strong></p><p><strong>2.1.1.3 ncnnçš„åŠ è½½çš„æ•ˆæœ</strong></p><p>â€‹    å…¶å®äº†è§£äº†paramæ–‡ä»¶çš„æ•°æ®ç»“æ„åï¼Œæˆ‘ä»¬å°±å¤§è‡´çŸ¥é“ncnnåšäº†å“ªäº›äº‹æƒ…äº†ã€‚æ— éæ˜¯ <strong>è¯»å–æ–‡ä»¶</strong>â€”&gt;<strong>è§£æç¥ç»ç½‘ç»œä¿¡æ¯</strong> â€”&gt; <strong>ç¼“å­˜ç¥ç»ç½‘ç»œä¿¡æ¯</strong>ï¼Œé‚£ä¹ˆï¼Œä¿¡æ¯ç¼“å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p><pre><code class="hljs cpp"><span class="hljs-comment">/* in net.h */</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Net</span></span><span class="hljs-class">&#123;</span>...<span class="hljs-keyword">protected</span>:    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Blob&gt; blobs;    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Layer*&gt; layers;...&#125;;</code></pre><p>â€‹    åŸæ¥ï¼Œncnn::Net ç»“æ„ä¸­æœ‰ <strong>blobs</strong> å’Œ <strong>layers</strong> ä¸¤ä¸ª vectorï¼Œå®ƒä»¬ä¿å­˜äº† .paramæ–‡ä»¶ ä¸­åŠ è½½çš„ä¿¡æ¯ã€‚å…³äº Blobã€Layer çš„æ•°æ®ç»“æ„ï¼Œåœ¨æ­¤æš‚ä¸èµ˜è¿°ã€‚</p><p><strong>2.1.2 load_model åŠ è½½æ¨¡å‹è®­ç»ƒæ•°æ®</strong></p><pre><code class="hljs objective-c">&#x2F;* Step1.2 : åŠ è½½.bin æ–‡ä»¶ *&#x2F;NSString *binPath &#x3D; [[NSBundle mainBundle] pathForResource:@&quot;squeezenet_v1.1&quot; ofType:@&quot;bin&quot;];ncnn_net.load_model(binPath.UTF8String);</code></pre><p>â€‹    load_modelçš„æ ¹æœ¬ç›®çš„æ˜¯å°† .binæ–‡ä»¶ çš„ä¿¡æ¯åŠ è½½åˆ° ç›®æ ‡ç¥ç»ç½‘ç»œï¼ˆä¸€ä¸ªncnn::Netç»“æ„ï¼‰ä¸­ã€‚</p><p><strong>2.1.2.1 .binæ–‡ä»¶çš„å†…å®¹</strong></p><p><strong>.bin æ–‡ä»¶å­˜å‚¨äº†å¯¹åº”æ¨¡å‹ä¸­éƒ¨åˆ†å±‚çš„è®¡ç®—éœ€æ±‚å‚æ•°ã€‚</strong>æ¯”å¦‚2.1.1.1èŠ‚ä¸­çš„ç¬¬å››è¡Œçš„Convolutionå±‚</p><p><img src="/2020/09/21/ncnn%E5%89%8D%E5%90%91%E8%AE%A1%E7%AE%97%E6%B5%81%E7%A8%8B%E6%B5%85%E6%9E%90/4.png" alt></p><p>â€‹    <strong>.bin æ–‡ä»¶ä¸­å°±å­˜å‚¨äº†å…¶ 1728(3 * 3 * 3 * 64) ä¸ªfloatç±»å‹çš„ æƒé‡æ•°æ®(weight_data) å’Œ 64ä¸ªfloatç±»å‹çš„ åç½®æ•°æ®(bias_data)ã€‚</strong></p><p>2.1.2.2 .binæ–‡ä»¶çš„ç»“æ„</p><p>â€‹    <strong>.bin æ–‡ä»¶ä¸­å°±å­˜å‚¨äº†å…¶ 1728(3 * 3 * 3 * 64) ä¸ªfloatç±»å‹çš„ æƒé‡æ•°æ®(weight_data) å’Œ 64ä¸ªfloatç±»å‹çš„ åç½®æ•°æ®(bias_data)ã€‚</strong></p><p>2.1.2.2 .binæ–‡ä»¶çš„ç»“æ„</p><p><img src="/2020/09/21/ncnn%E5%89%8D%E5%90%91%E8%AE%A1%E7%AE%97%E6%B5%81%E7%A8%8B%E6%B5%85%E6%9E%90/5.png" alt></p><p>bin = binaryï¼Œ.bin æ–‡ä»¶çš„åŸºæœ¬ç»“æ„å°±æ˜¯ [äºŒè¿›åˆ¶]ã€‚ä½†è¿™ å¹¶ä¸ä»£è¡¨æˆ‘ä»¬å¤±å»äº† [æ‰‹åŠ¨ä¿®æ”¹å®ƒ] çš„æƒåˆ©ï¼</p><p>æƒŠä¸æƒŠå–œï¼Œæ„ä¸æ„å¤–ï¼Ÿä¸‹èŠ‚å³æ­æ™“ï¼</p><p><strong>2.1.2.3 æ‰‹æ’•äºŒè¿›åˆ¶</strong></p><p>1ï¼‰binæ–‡ä»¶ä¿¡æ¯å­˜å‚¨è¯´æ˜</p><p>å‡è®¾ bin æ–‡ä»¶å­˜å‚¨ 0.3342, 0.4853, 0.2843, 0.1231 å››ä¸ªæ•°å­—ï¼Œè¿™å››ä¸ªæ•°å­—ä½¿ç”¨float32çš„æ•°æ®ç»“æ„æ¥æè¿°ï¼Œåˆ†åˆ«ä¸ºï¼š3eab1c43ã€3ef8793eã€3e918fc5ã€3dfc1bdaï¼Œé‚£ä¹ˆbinæ–‡ä»¶ä¸­çš„å†…å®¹å°±æ˜¯ 3eab1c433ef8793e3e918fc53dfc1bdaï¼Œæˆ‘ä»¬è¿›è¡Œè¯»å–çš„æ—¶å€™ä½¿ç”¨ä¸€ä¸ªfloatçš„æ•°ç»„å»æ‰¿è½½è¿™äº›äºŒè¿›åˆ¶æ•°æ®å³å¯ã€‚</p><p>2ï¼‰æ‰‹æ’•</p><p>ä½ å½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±å†™ä¸€æ®µbinæ–‡ä»¶æ•°æ®çš„è¯»å–æ–¹æ³•ï¼Œæ¯”å¦‚è¿™ä¹ˆä¸€æ®µ</p><pre><code class="hljs lsl">const void * __log_binInfo_conv1(const void *dataOffset) &#123;    printf(<span class="hljs-string">&quot;<span class="hljs-subst">\n</span> conv1 å±‚ç±»å‹ä¸º Convolution(å·ç§¯å±‚)<span class="hljs-subst">\n</span>&quot;</span>)     printf(<span class="hljs-string">&quot;<span class="hljs-subst">\n</span> åŠ è½½weight_dataæ•°æ®ç±»å‹æ ‡å¿—ï¼ˆå›ºå®šä¸ºè‡ªåŠ¨ç±»å‹ï¼‰<span class="hljs-subst">\n</span>&quot;</span>);    unsigned char *p_load1_1 = (unsigned char *)dataOffset;    for (int i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;        printf(<span class="hljs-string">&quot;Flag %d : %d<span class="hljs-subst">\n</span>&quot;</span>, i, p_load1_1[i]);    &#125;    p_load1_1 += <span class="hljs-number">4</span>;        printf(<span class="hljs-string">&quot;<span class="hljs-subst">\n</span> Load1_2: åŠ è½½weight_dataæ•°æ®ï¼ˆ1728é¡¹ï¼Œè‡ªåŠ¨ä¸ºfloat32ç±»å‹ï¼‰<span class="hljs-subst">\n</span>&quot;</span>);    <span class="hljs-type">float</span> *p_load1_2 = (<span class="hljs-type">float</span> *)p_load1_1;    for (int i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1728</span>; i++) &#123;        if (i &lt; <span class="hljs-number">10</span> || i &gt; <span class="hljs-number">1720</span>) &#123;            printf(<span class="hljs-string">&quot;Weight %d : %.9f<span class="hljs-subst">\n</span>&quot;</span>, i, p_load1_2[i]);        &#125;    &#125;    p_load1_2 += <span class="hljs-number">1728</span>;        printf(<span class="hljs-string">&quot;<span class="hljs-subst">\n</span> Load3: åŠ è½½biasåç½®æ•°æ®ï¼ˆ64é¡¹ï¼Œå›ºå®šä¸ºfloat32ç±»å‹ï¼‰<span class="hljs-subst">\n</span>&quot;</span>);    <span class="hljs-type">float</span> *p_load2 = (<span class="hljs-type">float</span> *)p_load1_2;    for (int i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">64</span>; i++) &#123;        if (i &lt; <span class="hljs-number">5</span> || i &gt; <span class="hljs-number">60</span>) &#123;            printf(<span class="hljs-string">&quot;Bias %d : %.9f<span class="hljs-subst">\n</span>&quot;</span>, i, p_load2[i]);        &#125;    &#125;    p_load2 += <span class="hljs-number">64</span>;        return p_load2;&#125;</code></pre><p><strong>Demoï¼š</strong></p><p><a href="https://github.com/chrisYooh/ncnnSrcDemo">https://github.com/chrisYooh/ncnnSrcDemo</a></p><p>1ï¼‰æ‰“å¼€å…¶ä¸‹çš„ NcnnSrcDemo å·¥ç¨‹</p><p>2ï¼‰è¿›å…¥ ViewControllerï¼Œè§£é™¤ è‡ªå®šä¹‰binæ–‡ä»¶åŠ è½½æµ‹è¯•çš„ æ³¨é‡Š</p><p>/<em> è‡ªå®šä¹‰ bin æ–‡ä»¶åŠ è½½æµ‹è¯• </em>/</p><p>[self loadModel_myAnalysis];</p><p>3ï¼‰è¿è¡Œçœ‹çœ‹ç»“æœå§ï¼Œä¹Ÿå¯ä»¥ç”¨ ncnnçš„loadModel å»è·‘ï¼Œç„¶åæ‰“æ–­ç‚¹çœ‹çœ‹è§£è¯»çš„ .bin æ–‡ä»¶æ•°æ®ä¸€è‡´ä¸ã€‚</p><p><img src="/2020/09/21/ncnn%E5%89%8D%E5%90%91%E8%AE%A1%E7%AE%97%E6%B5%81%E7%A8%8B%E6%B5%85%E6%9E%90/6.png" alt></p><p>â€‹    äº†è§£äº†binæ–‡ä»¶çš„ä¿¡æ¯å­˜å‚¨å½¢å¼ï¼Œæˆ‘ä»¬å½“ç„¶å°±å¯ä»¥è¿›è¡Œä¿¡æ¯ä¿®æ”¹å’¯ï¼ä¸åŒçš„æ¡†æ¶æ¨¡å‹è¿›è¡Œè½¬åŒ–æ—¶ï¼Œå°±è¦åšè¿™æ ·çš„äº‹æƒ…ã€‚å“‡ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ è‡ªå·±å†™è½¬æ¨¡å‹çš„å·¥å…·å•¦ï¼ä»æŠ€æœ¯ä¸Šè¯´ï¼Œå®Œå…¨æ²¡é”™ï¼</p><p><strong>2.2 Detect æ£€æµ‹</strong></p><p>   å®Œæˆäº† ç½‘ç»œåˆå§‹åŒ– <strong>load_param()</strong>ã€ <strong>load_bin()</strong>ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å¡«å†™ä¸€ä¸ªè¾“å…¥å¹¶ä½¿ç”¨ ç½‘ç»œæå–å™¨Extractor è®¡ç®—è¾“å‡ºäº†ã€‚</p><p><strong>2.2.1 åˆ›å»ºæå–å™¨ Extractor</strong></p><pre><code class="hljs reasonml"><span class="hljs-comment">/* Step2.1 : æ„å»ºå¹¶é…ç½® æå–å™¨ */</span>ncnn::Extractor extractor = ncnn_net.create<span class="hljs-constructor">_extractor()</span>;extractor.set<span class="hljs-constructor">_light_mode(<span class="hljs-params">true</span>)</span>;</code></pre><p>   æå–å™¨ extractor ä½¿ç”¨ ç›®æ ‡ç½‘ç»œ é€šè¿‡ å‹å…ƒå‡½æ•° åˆ›å»ºå®ä¾‹ï¼Œå› ä¸ºå®ƒéœ€è¦è·å–å¯¹åº”ç¥ç»ç½‘ç»œçš„ä¿¡æ¯ï¼›åŒæ—¶ï¼Œextractor è¿˜å¯ä»¥è‡ªå®šä¹‰éƒ¨åˆ†é…ç½®ä¿¡æ¯ã€‚</p><p>Extractorå«3ä¸ªå…³é”®ç±»å˜é‡</p><p>1ï¼‰<strong>netï¼š æŒ‡å‘å¯¹åº”ç½‘ç»œçš„æŒ‡é’ˆ</strong></p><p>2ï¼‰<strong>blob_matsï¼š è®¡ç®—çš„è¿‡ç¨‹ä¸­å­˜å‚¨è¾“å…¥ã€è¾“å‡ºçš„ä¸´æ—¶æ•°æ®</strong></p><p>3ï¼‰<strong>optï¼š é…ç½®å‚æ•°</strong></p><p><strong>2.2.2 extractor.input é…ç½®è¾“å…¥</strong></p><pre><code class="hljs cpp"><span class="hljs-comment">/* Step2.2 : è®¾ç½®è¾“å…¥ï¼ˆå°†å›¾ç‰‡è½¬æ¢æˆncnn::Matç»“æ„ä½œä¸ºè¾“å…¥ï¼‰ */</span>UIImage *srcImage = [UIImage imageNamed:@<span class="hljs-string">&quot;mouth&quot;</span>];ncnn::Mat mat_src;ts_image2mat(mat_src, srcImage);extractor.input(<span class="hljs-string">&quot;data&quot;</span>, mat_src);</code></pre><p>1ï¼‰æˆ‘ä»¬è¦ æ„é€ ä¸€ä¸ªncnn::Matçš„ç»“æ„ï¼Œå°†æˆ‘ä»¬çš„è¾“å…¥å¡«å…¥å…¶ä¸­</p><p>2ï¼‰åˆ©ç”¨ Extractorçš„input()å‡½æ•° å°†è¾“å…¥matå¡«å…¥å¯¹åº”çš„ä½ç½®ã€‚</p><p>æ³¨æ„ï¼šinput() å‡½æ•°ä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°è¾“å…¥çš„æ˜¯blobçš„åç§° è€Œä¸æ˜¯layerçš„åç§° å“¦ï¼</p><p><strong>2.2.3 extractor.extract æå–è¾“å‡º</strong></p><pre><code class="hljs less"><span class="hljs-comment">/* Step2.3 : æå–è¾“å‡º */</span><span class="hljs-attribute">ncnn</span>::Mat mat_dst;<span class="hljs-selector-tag">extractor</span><span class="hljs-selector-class">.extract</span>(<span class="hljs-string">&quot;prob&quot;</span>, mat_dst);</code></pre><p>1ï¼‰æˆ‘ä»¬è¦ æ„é€ ä¸€ä¸ªncnn::Matçš„ç»“æ„ï¼Œç”¨ä»¥æ‰¿è½½è¾“å‡ºï¼›</p><p>2ï¼‰åˆ©ç”¨ Extractorçš„extract()å‡½æ•° å°†è®¡ç®—ç»“æœå¡«å†™åˆ°æˆ‘ä»¬æ„é€ çš„è¾“å‡ºmatä¸­ã€‚</p><p>æ³¨æ„ï¼šextract()å‡½æ•°ä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°è¾“å…¥çš„æ˜¯ blobçš„åç§° è€Œä¸æ˜¯ layerçš„åç§° å“¦ï¼</p><p><strong>2.2.3.1 extract() çš„é€’å½’æµç¨‹å›¾</strong></p><p>ncnn åœ¨è¿›è¡Œ extract() çš„æ—¶å€™ï¼Œä½¿ç”¨äº†é€’å½’çš„æ–¹å¼ï¼Œè¿™è¾¹å°†å…¶ å®è§‚é€»è¾‘è¿›è¡ŒæŠ½è±¡ã€‚ï¼ˆæç»˜æ‰€æœ‰çš„ä»£ç ç»†èŠ‚ä¼šä½¿å›¾è¿‡äºå¤æ‚ï¼Œä¸æ˜“é˜…è¯»ï¼‰</p><p>é€’å½’å®ç°.png</p><p><strong>2.2.3.2 extract() æœ€ç®€é€’å½’å±•å¼€æµç¨‹</strong></p><p>ä¹‹æ‰€ä»¥è¯´æœ€ç®€ï¼Œå› ä¸ºæˆ‘ä»¬å‡è®¾ï¼š</p><p>1 ç›®æ ‡ç½‘ç»œçš„æ¯å±‚éƒ½åªæœ‰ ä¸€ä¸ªè¾“å…¥(blob) å’Œ ä¸€ä¸ªè¾“å‡º(blob)ï¼Œ</p><p>2 ä½¿ç”¨çš„extractæ˜¯æ–°åˆ›å»ºçš„ï¼ˆå³ æ— ç¼“å­˜æ•°æ®ï¼‰</p><p><img src="/2020/09/21/ncnn%E5%89%8D%E5%90%91%E8%AE%A1%E7%AE%97%E6%B5%81%E7%A8%8B%E6%B5%85%E6%9E%90/7.png" alt></p><p>å¦‚å›¾ï¼š</p><p>1ï¼‰æ¯ä¸€å±‚è¿›è¡Œforward()çš„æ—¶å€™ï¼Œéœ€è¦ä¸€äº›è¾“å…¥å‚æ•°ï¼Œè¿™äº›è¾“å…¥å‚æ•°æ˜¯ ç”±ä¸Šé¢çš„å±‚çš„forward()è¿ç®—è¾“å‡ºçš„ã€‚</p><p>2ï¼‰åªæœ‰ è¾“å…¥å±‚çš„è¾“å…¥å‚æ•°æ˜¯æˆ‘ä»¬å¡«å†™çš„ï¼ˆ2.2.2 èŠ‚ï¼‰ï¼Œä¹Ÿæ­£æ˜¯å› ä¸ºå®ƒçš„å­˜åœ¨ï¼Œé€’å½’å¾—ä»¥æœ‰äº†ç»ˆç»“ã€‚</p><p>2.3 è¾“å‡ºå¤„ç†</p>  <pre><code class="hljs reasonml"><span class="hljs-comment">/* Step3.1 : ç»“æœå¤„ç†(è·å–æ£€æµ‹æ¦‚ç‡æœ€é«˜çš„5ç§ç‰©å“ï¼Œè®¤ä¸ºå­˜åœ¨) */</span>   NSArray *rstArray = ts<span class="hljs-constructor">_mat2array(<span class="hljs-params">mat_dst</span>)</span>;   NSArray *top5Array = ts<span class="hljs-constructor">_topN(<span class="hljs-params">rstArray</span>, 5)</span>;      <span class="hljs-comment">/* Step3.2 : æ‰“å°è¾“å‡º */</span>   <span class="hljs-constructor">NSLog(@<span class="hljs-string">&quot;%@&quot;</span>, <span class="hljs-params">top5Array</span>)</span>;      <span class="hljs-comment">/* è¯´æ˜ï¼šè¯¥Demoä¸­å‘ç°è¾“å‡ºçš„ç¬¬ä¸€é¡¹æ˜¯ index ä¸º 673 çš„é¡¹ç›®ï¼Œ</span><span class="hljs-comment">    * åœ¨result_info.jsonä¸­æŸ¥æ‰¾ä¸‹ &quot;index&quot; : &quot;673&quot; å‘ç°å¯¹åº”çš„æè¿°æ˜¯ é¼ æ ‡</span><span class="hljs-comment">    * ä¹Ÿå¯ä»¥æ¢å…¶ä»–å›¾ç‰‡è¿›è¡Œæ£€æµ‹ï¼Œä½†è¦å°†å›¾ç‰‡è§„æ ¼åŒ–æˆ 227 * 227 çš„å¤§å°æ‰å¯ä»¥ä¿è¯ç»“æœçš„å‡†ç¡®æ€§</span><span class="hljs-comment">    */</span></code></pre><p>â€‹    è¾“å‡ºå¤„ç†æ˜¯æ ¹æ®éœ€æ±‚å…·ä½“æ¨¡å‹éœ€æ±‚ï¼Œå¾ˆçµæ´»çš„ã€‚æ¯”å¦‚æˆ‘ç»™äºˆè¾“å‡ºç»“æœçš„æ¯ä¸ªæ•°å­—ä»¥ æ¦‚å¿µï¼ˆè¯†åˆ«åˆ°æŸç§ç‰©å“çš„æ¦‚ç‡ï¼‰ ï¼Œå¹¶å¯¹è¾“å‡ºç»“æœè¿›è¡Œæ’åºåå–å…¶ æ¦‚ç‡æœ€é«˜çš„ äº”ä¸ªå€¼ã€‚</p><p><strong>2.4 å°è£…</strong></p><p>â€‹    ç©ä¸€ç©çš„è¯ï¼Œ12è¡Œä»£ç è¶³å¤Ÿäº†ï¼›ä½†è‹¥çœŸçš„è¦å·¥ç¨‹åŒ–çš„è¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦å°† é¢å‘è¿‡ç¨‹ çš„æ€è·¯ å‘ é¢å‘å¯¹è±¡é æ‹¢çš„ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ncnnæºç åˆ†æ_6</title>
    <link href="/2020/09/21/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-6/"/>
    <url>/2020/09/21/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-6/</url>
    
    <content type="html"><![CDATA[<p>åˆ†æäº†å‡ ä¸ªæ¯”è¾ƒå¸¸è§çš„ç®—å­ forward è¿‡ç¨‹ï¼Œ æ¯”å¦‚ absï¼Œ biasï¼Œargmaxï¼Œ convï¼Œpoolï¼Œ bn </p><a id="more"></a><h4 id="1-abs"><a href="#1-abs" class="headerlink" title="1. abs"></a>1. abs</h4><pre><code class="hljs c"><span class="hljs-comment">// ç»å¯¹å€¼å±‚ç‰¹æ€§: å•è¾“å…¥ï¼Œå•è¾“å‡ºï¼Œå¯ç›´æ¥å¯¹è¾“å…¥è¿›è¡Œä¿®æ”¹</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">AbsVal::forward_inplace</span><span class="hljs-params">(Mat&amp; bottom_top_blob, <span class="hljs-keyword">const</span> Option&amp; opt)</span> <span class="hljs-keyword">const</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">int</span> w = bottom_top_blob.w;    <span class="hljs-keyword">int</span> h = bottom_top_blob.h;    <span class="hljs-keyword">int</span> channels = bottom_top_blob.c;    <span class="hljs-keyword">int</span> size = w * h;    <span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> omp parallel for num_threads(opt.num_threads)  <span class="hljs-comment">// openmp </span></span>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> q=<span class="hljs-number">0</span>; q&lt;channels; q++)    &#123;        <span class="hljs-keyword">float</span>* ptr = bottom_top_blob.channel(q);<span class="hljs-comment">// å½“å‰é€šé“æ•°æ®çš„èµ·å§‹æŒ‡é’ˆ</span>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;size; i++)        &#123;            <span class="hljs-keyword">if</span> (ptr[i] &lt; <span class="hljs-number">0</span>)                ptr[i] = - ptr[i]; <span class="hljs-comment">// å°äºé›¶å–ç›¸åæ•°ï¼Œå¤§äºé›¶ä¿æŒåŸæ ·</span>        &#125;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><h4 id="2-bias"><a href="#2-bias" class="headerlink" title="2. bias"></a>2. bias</h4><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Bias::forward_inplace</span><span class="hljs-params">(Mat&amp; bottom_top_blob, <span class="hljs-keyword">const</span> Option&amp; opt)</span> <span class="hljs-keyword">const</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">int</span> w = bottom_top_blob.w;    <span class="hljs-keyword">int</span> h = bottom_top_blob.h;    <span class="hljs-keyword">int</span> channels = bottom_top_blob.c;    <span class="hljs-keyword">int</span> size = w * h;    <span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> omp parallel for num_threads(opt.num_threads)</span>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> q=<span class="hljs-number">0</span>; q&lt;channels; q++)    &#123;        <span class="hljs-keyword">float</span>* ptr = bottom_top_blob.channel(q);  <span class="hljs-comment">// æ¯ä¸ªé€šé“æ•°æ®èµ·å§‹æŒ‡é’ˆ</span>        <span class="hljs-keyword">float</span> bias = bias_data[q];   <span class="hljs-comment">// éœ€è¦æ·»åŠ çš„åç½®æ•°æ® å‰é¢ä»æ¨¡å‹ä¸­è½½å…¥çš„å‚æ•° æ¯é€šé“åç½®å‚æ•°ä¸€æ ·</span>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;size; i++)        &#123;            ptr[i] += bias;<span class="hljs-comment">// åŠ ä¸Šåç½®</span>        &#125;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><h4 id="2-argmax"><a href="#2-argmax" class="headerlink" title="2.  argmax"></a>2.  argmax</h4><pre><code class="hljs c"><span class="hljs-comment">// å±‚å‚æ•°åŒ…å«ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ˜¯å¦éœ€è¦åŒ…å«å€¼å¯¹åº”åœ¨æºblobä¸­çš„ä½ç½®ï¼Œç¬¬äºŒä¸ªæ˜¯éœ€è¦å‰å¤šå°‘ä¸ªæœ€å¤§çš„æ•°</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">ArgMax::load_param</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ParamDict&amp; pd)</span></span><span class="hljs-function"></span>&#123;    out_max_val = pd.get(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<span class="hljs-comment">// æ˜¯å¦ éœ€è¦å­˜å‚¨ä½ç½®</span>    topk = pd.get(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);       <span class="hljs-comment">// åœ¨å‰topkä¸ªæœ€å¤§çš„æ•°</span>       <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">ArgMax::forward</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Mat&amp; bottom_blob, Mat&amp; top_blob, <span class="hljs-keyword">const</span> Option&amp; opt)</span> <span class="hljs-keyword">const</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">int</span> size = bottom_blob.total(); <span class="hljs-comment">// è¾“å…¥blobå‚æ•°æ€»æ•°é‡</span>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„è¾“å‡º blob </span>    <span class="hljs-keyword">if</span> (out_max_val)        top_blob.create(topk, <span class="hljs-number">2</span>, <span class="hljs-number">4u</span>, opt.blob_allocator); <span class="hljs-comment">// topkä¸ªå€¼ + topkä¸ªå€¼å¯¹åº”çš„ä½ç½®</span>    <span class="hljs-keyword">else</span>        top_blob.create(topk, <span class="hljs-number">1</span>, <span class="hljs-number">4u</span>, opt.blob_allocator); <span class="hljs-comment">// åªå­˜  topkä¸ªå€¼ï¼Œä¸å­˜ä½ç½®</span>    <span class="hljs-keyword">if</span> (top_blob.empty())        <span class="hljs-keyword">return</span> <span class="hljs-number">-100</span>;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span>* ptr = bottom_blob;        <span class="hljs-comment">// partial sort topk with index, optional value</span>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">pair</span>&lt;<span class="hljs-keyword">float</span>, <span class="hljs-keyword">int</span>&gt; &gt; vec;    vec.resize(size);    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;size; i++)    &#123;        vec[i] = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">make_pair</span>(ptr[i], i);<span class="hljs-comment">// æº è¾“å…¥blob çš„å‚æ•°çš„ å€¼ï¼šä½ç½®id é”®å€¼å¯¹</span>    &#125;    <span class="hljs-built_in">std</span>::partial_sort(vec.begin(), vec.begin() + topk, vec.end(),                      <span class="hljs-built_in">std</span>::greater&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">pair</span>&lt;<span class="hljs-keyword">float</span>, <span class="hljs-keyword">int</span>&gt; &gt;());<span class="hljs-comment">// æŒ‰ç¬¬ä¸€åˆ—æ’åºï¼Œè·å–å‰ topkä¸ª</span>    <span class="hljs-comment">// ä¿å­˜å‰é¢æœ€å¤§çš„ topk ä¸ªå‚æ•°</span>    <span class="hljs-keyword">float</span>* outptr = top_blob;    <span class="hljs-keyword">if</span> (out_max_val)    &#123;        <span class="hljs-keyword">float</span>* valptr = outptr + topk; <span class="hljs-comment">// å‰é¢topkçš„ä½ç½®å­˜å€¼ï¼Œåé¢å­˜å¯¹åº”å€¼åœ¨æºè¾“å…¥ blob ä¸­çš„ä½ç½®ID</span>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;topk; i++)        &#123;            outptr[i] = vec[i].first; <span class="hljs-comment">// å­˜å€¼</span>            valptr[i] = vec[i].second;<span class="hljs-comment">// å­˜ä½ç½®</span>        &#125;    &#125;    <span class="hljs-keyword">else</span>    &#123;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;topk; i++)        &#123;            outptr[i] = vec[i].second;<span class="hljs-comment">// åªå­˜å€¼</span>        &#125;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><h4 id="3-concat"><a href="#3-concat" class="headerlink" title="3.concat"></a>3.concat</h4><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Concat::forward</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Mat&gt;&amp; bottom_blobs, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Mat&gt;&amp; top_blobs, <span class="hljs-keyword">const</span> Option&amp; opt)</span> <span class="hljs-keyword">const</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">int</span> dims = bottom_blobs[<span class="hljs-number">0</span>].dims;    <span class="hljs-keyword">size_t</span> elemsize = bottom_blobs[<span class="hljs-number">0</span>].elemsize;    <span class="hljs-keyword">if</span> (dims == <span class="hljs-number">1</span>) <span class="hljs-comment">// axis == 0</span>    &#123;        <span class="hljs-keyword">int</span> top_w = <span class="hljs-number">0</span>; <span class="hljs-comment">// è¾“å‡ºé•¿åº¦</span>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> b = <span class="hljs-number">0</span>; b &lt; bottom_blobs.size(); b++)        &#123;            <span class="hljs-keyword">const</span> Mat&amp; bottom_blob = bottom_blobs[b];            top_w += bottom_blob.w;        &#125;        <span class="hljs-comment">// åˆ›å»ºè¾“å‡º blob</span>        Mat&amp; top_blob = top_blobs[<span class="hljs-number">0</span>];        top_blob.create(top_w, elemsize, opt.blob_allocator);        <span class="hljs-keyword">if</span> (top_blob.empty())            <span class="hljs-keyword">return</span> <span class="hljs-number">-100</span>;        <span class="hljs-comment">// å°†ä¸åŒçš„è¾“å…¥å¤åˆ¶åˆ°è¾“å‡º</span>        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>* outptr = top_blob;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> b = <span class="hljs-number">0</span>; b &lt; bottom_blobs.size(); b++)        &#123;            <span class="hljs-keyword">const</span> Mat&amp; bottom_blob = bottom_blobs[b];            <span class="hljs-keyword">int</span> w = bottom_blob.w;            <span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>* ptr = bottom_blob;            <span class="hljs-built_in">memcpy</span>(outptr, ptr, w * elemsize);            outptr += w * elemsize;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    &#125;    <span class="hljs-keyword">if</span> (dims == <span class="hljs-number">2</span> &amp;&amp; axis == <span class="hljs-number">0</span>)&#123;        <span class="hljs-comment">// ...</span>    &#125;    <span class="hljs-keyword">if</span> (dims == <span class="hljs-number">2</span> &amp;&amp; axis == <span class="hljs-number">1</span>)&#123;        <span class="hljs-comment">// ...</span>    &#125;    <span class="hljs-keyword">if</span> (dims == <span class="hljs-number">3</span> &amp;&amp; axis == <span class="hljs-number">0</span>)&#123;        <span class="hljs-comment">//  ...</span>    &#125;    <span class="hljs-keyword">if</span> (dims == <span class="hljs-number">3</span> &amp;&amp; axis == <span class="hljs-number">1</span>)&#123;      <span class="hljs-comment">// ...</span>    &#125;    <span class="hljs-keyword">if</span> (dims == <span class="hljs-number">3</span> &amp;&amp; axis == <span class="hljs-number">2</span>)&#123;       <span class="hljs-comment">// ...</span>    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><h4 id="4-å·ç§¯å±‚"><a href="#4-å·ç§¯å±‚" class="headerlink" title="4. å·ç§¯å±‚"></a>4. å·ç§¯å±‚</h4><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Convolution::forward</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Mat&amp; bottom_blob, Mat&amp; top_blob, <span class="hljs-keyword">const</span> Option&amp; opt)</span> <span class="hljs-keyword">const</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-comment">// convolv with NxN kernel</span>    <span class="hljs-comment">// value = value + bias</span>    <span class="hljs-keyword">if</span> (opt.use_int8_inference &amp;&amp; weight_data.elemsize == (<span class="hljs-keyword">size_t</span>)<span class="hljs-number">1u</span>)    &#123;        <span class="hljs-keyword">return</span> forward_int8(bottom_blob, top_blob, opt);    &#125;    <span class="hljs-comment">// flattened blob, implement as InnerProduct</span>    <span class="hljs-comment">//...</span>    <span class="hljs-keyword">int</span> w = bottom_blob.w;    <span class="hljs-keyword">int</span> h = bottom_blob.h;    <span class="hljs-keyword">int</span> channels = bottom_blob.c;    <span class="hljs-keyword">size_t</span> elemsize = bottom_blob.elemsize;    <span class="hljs-comment">// NCNN_LOGE(&quot;Convolution input %d x %d  pad = %d %d  ksize=%d %d  stride=%d %d&quot;, w, h, pad_w, pad_h, kernel_w, kernel_h, stride_w, stride_h);</span>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> kernel_extent_w = dilation_w * (kernel_w - <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> kernel_extent_h = dilation_h * (kernel_h - <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>;    Mat bottom_blob_bordered;    make_padding(bottom_blob, bottom_blob_bordered, opt);    <span class="hljs-keyword">if</span> (bottom_blob_bordered.empty())        <span class="hljs-keyword">return</span> <span class="hljs-number">-100</span>;    w = bottom_blob_bordered.w;    h = bottom_blob_bordered.h;    <span class="hljs-keyword">int</span> outw = (w - kernel_extent_w) / stride_w + <span class="hljs-number">1</span>;    <span class="hljs-keyword">int</span> outh = (h - kernel_extent_h) / stride_h + <span class="hljs-number">1</span>;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> maxk = kernel_w * kernel_h;    <span class="hljs-comment">// kernel offsets</span>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; _space_ofs(maxk);    <span class="hljs-keyword">int</span>* space_ofs = &amp;_space_ofs[<span class="hljs-number">0</span>];    &#123;        <span class="hljs-keyword">int</span> p1 = <span class="hljs-number">0</span>;        <span class="hljs-keyword">int</span> p2 = <span class="hljs-number">0</span>;        <span class="hljs-keyword">int</span> gap = w * dilation_h - kernel_w * dilation_w;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; kernel_h; i++)        &#123;            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; kernel_w; j++)            &#123;                space_ofs[p1] = p2;                p1++;                p2 += dilation_w;            &#125;            p2 += gap;        &#125;    &#125;    <span class="hljs-comment">// ç”³è¯·è¾“å‡º</span>    top_blob.create(outw, outh, num_output, elemsize, opt.blob_allocator);    <span class="hljs-keyword">if</span> (top_blob.empty())        <span class="hljs-keyword">return</span> <span class="hljs-number">-100</span>;    <span class="hljs-comment">// num_output</span>    <span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> omp parallel for num_threads(opt.num_threads)</span>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> p = <span class="hljs-number">0</span>; p &lt; num_output; p++) <span class="hljs-comment">// é€è¾“å‡ºé€šé“</span>    &#123;        <span class="hljs-keyword">float</span>* outptr = top_blob.channel(p);        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; outh; i++) <span class="hljs-comment">// è¾“å‡ºé«˜åº¦</span>        &#123;            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; outw; j++) <span class="hljs-comment">// è¾“å‡ºå®½åº¦</span>            &#123;                <span class="hljs-keyword">float</span> sum = <span class="hljs-number">0.f</span>;                <span class="hljs-keyword">if</span> (bias_term)                    sum = bias_data[p];                <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span>* kptr = (<span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span>*)weight_data + maxk * channels * p; <span class="hljs-comment">// å·ç§¯å•å…ƒå¯¹åº”çš„èµ·å§‹ä½ç½®</span>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> q = <span class="hljs-number">0</span>; q &lt; channels; q++) <span class="hljs-comment">// è¾“å…¥</span>                &#123;                    <span class="hljs-keyword">const</span> Mat m = bottom_blob_bordered.channel(q);                    <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span>* sptr = m.row(i * stride_h) + j * stride_w;                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; maxk; k++) <span class="hljs-comment">// 29.23</span>                    &#123;                        <span class="hljs-keyword">float</span> val = sptr[space_ofs[k]]; <span class="hljs-comment">// 20.72</span>                        <span class="hljs-keyword">float</span> w = kptr[k];                        sum += val * w; <span class="hljs-comment">// 41.45</span>                    &#125;                    kptr += maxk;                &#125;                                <span class="hljs-comment">// æ¿€æ´»å‡½æ•°</span>                <span class="hljs-comment">// ......</span>                outptr[j] = sum;            &#125;            outptr += outw;        &#125;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><h4 id="5-pooling"><a href="#5-pooling" class="headerlink" title="5. pooling"></a>5. pooling</h4><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Pooling::forward</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Mat&amp; bottom_blob, Mat&amp; top_blob, <span class="hljs-keyword">const</span> Option&amp; opt)</span> <span class="hljs-keyword">const</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-comment">// max value in NxN window</span>    <span class="hljs-keyword">int</span> w = bottom_blob.w;    <span class="hljs-keyword">int</span> h = bottom_blob.h;    <span class="hljs-keyword">int</span> channels = bottom_blob.c;    <span class="hljs-keyword">size_t</span> elemsize = bottom_blob.elemsize;    <span class="hljs-keyword">if</span> (global_pooling)    &#123;        <span class="hljs-comment">// ...</span>    &#125;    Mat bottom_blob_bordered;    make_padding(bottom_blob, bottom_blob_bordered, opt);    <span class="hljs-keyword">if</span> (bottom_blob_bordered.empty())        <span class="hljs-keyword">return</span> <span class="hljs-number">-100</span>;    w = bottom_blob_bordered.w;    h = bottom_blob_bordered.h;    <span class="hljs-keyword">int</span> outw = (w - kernel_w) / stride_w + <span class="hljs-number">1</span>;    <span class="hljs-keyword">int</span> outh = (h - kernel_h) / stride_h + <span class="hljs-number">1</span>;ã€        <span class="hljs-comment">// ç”³è¯·è¾“å‡º blob</span>    top_blob.create(outw, outh, channels, elemsize, opt.blob_allocator);    <span class="hljs-keyword">if</span> (top_blob.empty())        <span class="hljs-keyword">return</span> <span class="hljs-number">-100</span>;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> maxk = kernel_w * kernel_h;    <span class="hljs-comment">// kernel offsets</span>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; _space_ofs(maxk); <span class="hljs-comment">// </span>    <span class="hljs-keyword">int</span>* space_ofs = &amp;_space_ofs[<span class="hljs-number">0</span>];    &#123;        <span class="hljs-keyword">int</span> p1 = <span class="hljs-number">0</span>;        <span class="hljs-keyword">int</span> p2 = <span class="hljs-number">0</span>;        <span class="hljs-keyword">int</span> gap = w - kernel_w;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; kernel_h; i++)        &#123;            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; kernel_w; j++)            &#123;                space_ofs[p1] = p2;                p1++;                p2++;            &#125;            p2 += gap;        &#125;    &#125;    <span class="hljs-keyword">if</span> (pooling_type == PoolMethod_MAX)    &#123;        <span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> omp parallel for num_threads(opt.num_threads)</span>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> q = <span class="hljs-number">0</span>; q &lt; channels; q++) <span class="hljs-comment">// é€šé“</span>        &#123;            <span class="hljs-keyword">const</span> Mat m = bottom_blob_bordered.channel(q);            <span class="hljs-keyword">float</span>* outptr = top_blob.channel(q);            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; outh; i++) <span class="hljs-comment">// è¾“å‡ºå±‚é«˜åº¦</span>            &#123;                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; outw; j++) <span class="hljs-comment">// è¾“å‡ºå±‚å®½åº¦</span>                &#123;                    <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span>* sptr = m.row(i * stride_h) + j * stride_w; <span class="hljs-comment">// æ± åŒ–å•å…ƒå¯¹åº”çš„èµ·å§‹ä½ç½®</span>                    <span class="hljs-keyword">float</span> max = sptr[<span class="hljs-number">0</span>];                    <span class="hljs-comment">// æ±‚æ¯ä¸ªæ± åŒ–å•å…ƒå¯¹åº”çš„æœ€å¤§å€¼</span>                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; maxk; k++)                    &#123;                        <span class="hljs-keyword">float</span> val = sptr[space_ofs[k]];                        max = <span class="hljs-built_in">std</span>::max(max, val);                    &#125;                    outptr[j] = max;                &#125;                outptr += outw;            &#125;        &#125;    &#125;    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pooling_type == PoolMethod_AVE)    &#123;        <span class="hljs-comment">// ...</span>    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><h4 id="6-Batchnorm"><a href="#6-Batchnorm" class="headerlink" title="6. Batchnorm"></a>6. Batchnorm</h4><pre><code class="hljs c"><span class="hljs-comment">// å¯ä»¥çœ‹å‡ºæ¥ï¼Œ è¿™é‡Œçš„å…¶å®å°±æ˜¯ value = b * value + a, å®Œå…¨å¯ä»¥å’Œ conv è¿›è¡Œåˆå¹¶</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">BatchNorm::forward_inplace</span><span class="hljs-params">(Mat&amp; bottom_top_blob, <span class="hljs-keyword">const</span> Option&amp; opt)</span> <span class="hljs-keyword">const</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-comment">// a = bias - slope * mean / sqrt(var)</span>    <span class="hljs-comment">// b = slope / sqrt(var)</span>    <span class="hljs-comment">// value = b * value + a</span>    <span class="hljs-keyword">int</span> dims = bottom_top_blob.dims;        <span class="hljs-keyword">if</span> (dims == <span class="hljs-number">1</span>) <span class="hljs-comment">// 1ç»´åº¦====================</span>    &#123;        <span class="hljs-comment">// ...</span>    &#125;    <span class="hljs-keyword">if</span> (dims == <span class="hljs-number">2</span>) <span class="hljs-comment">// 2ç»´åº¦======================</span>    &#123;        <span class="hljs-comment">// ...</span>    &#125;    <span class="hljs-keyword">if</span> (dims == <span class="hljs-number">3</span>) <span class="hljs-comment">// 3ç»´åº¦================================</span>    &#123;        <span class="hljs-keyword">int</span> w = bottom_top_blob.w;        <span class="hljs-keyword">int</span> h = bottom_top_blob.h;        <span class="hljs-keyword">int</span> size = w * h;        <span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> omp parallel for num_threads(opt.num_threads)</span>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> q=<span class="hljs-number">0</span>; q&lt;channels; q++)        &#123;            <span class="hljs-keyword">float</span>* ptr = bottom_top_blob.channel(q);            <span class="hljs-keyword">float</span> a = a_data[q];            <span class="hljs-keyword">float</span> b = b_data[q];            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;size; i++)            &#123;                ptr[i] = b * ptr[i] + a;            &#125;        &#125;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>DL_Deploy</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ncnnæºç åˆ†æ_5</title>
    <link href="/2020/09/21/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-5/"/>
    <url>/2020/09/21/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-5/</url>
    
    <content type="html"><![CDATA[<a id="more"></a><p>ncnn æä¾›äº†ä¸¤ç§è§£æç½‘ç»œ layer çš„æ–¹æ³•ï¼š</p><h4 id="æ–¹æ³•ä¸€-åœ¨æ¨ç†ä¸­è¿›è¡Œè§£æ"><a href="#æ–¹æ³•ä¸€-åœ¨æ¨ç†ä¸­è¿›è¡Œè§£æ" class="headerlink" title="æ–¹æ³•ä¸€: åœ¨æ¨ç†ä¸­è¿›è¡Œè§£æ"></a>æ–¹æ³•ä¸€: åœ¨æ¨ç†ä¸­è¿›è¡Œè§£æ</h4><p>æ¨¡å‹è½¬æ¢ä¹‹åï¼ŒæŸäº› layer æ²¡æœ‰è½¬æ¢æˆåŠŸï¼š(åœ¨è½¬æ¢çš„è¿‡ç¨‹ä¸­)ã€‚ å¦‚ shufflenetv2 ä¸­ï¼Œparam æ–‡ä»¶åªè½¬æ¢åˆ°äº† fc è¿™ä¸€ä¸ª layerã€‚è¿™æ—¶éœ€è¦æ·»åŠ ä¸€å±‚softmaxï¼Œå¯ä»¥å…ˆå¯¹paramæ–‡ä»¶ä¸­è½¬æ¢æˆåŠŸçš„layeråšæ¨ç†ï¼Œç„¶åæ‰‹åŠ¨æ·»åŠ ä¸€ä¸ªsoftmaxå±‚ï¼š</p><pre><code class="hljs cpp">ncnn::Extractor ex = shufflenetv2.create_extractor();ex.input(<span class="hljs-string">&quot;data&quot;</span>, in);ncnn::Mat out;ex.extract(<span class="hljs-string">&quot;fc&quot;</span>, out);<span class="hljs-comment">// manually call softmax on the fc output</span><span class="hljs-comment">// convert result into probability</span><span class="hljs-comment">// skip if your model already has softmax operation</span>&#123;    ncnn::Layer* softmax = ncnn::create_layer(<span class="hljs-string">&quot;Softmax&quot;</span>);    ncnn::ParamDict pd;    softmax-&gt;load_param(pd);    softmax-&gt;forward_inplace(out, shufflenetv2.opt);    <span class="hljs-keyword">delete</span> softmax;&#125;out = out.reshape(out.w * out.h * out.c);</code></pre><h4 id="æ–¹æ³•äºŒ-è‡ªå®šä¹‰å±‚"><a href="#æ–¹æ³•äºŒ-è‡ªå®šä¹‰å±‚" class="headerlink" title="æ–¹æ³•äºŒ: è‡ªå®šä¹‰å±‚"></a>æ–¹æ³•äºŒ: è‡ªå®šä¹‰å±‚</h4><h5 id="1-æ–°å»ºç©ºçš„ç±»"><a href="#1-æ–°å»ºç©ºçš„ç±»" class="headerlink" title="1. æ–°å»ºç©ºçš„ç±»"></a>1. æ–°å»ºç©ºçš„ç±»</h5><pre><code class="hljs c"><span class="hljs-comment">// åœ¨ ncnn/src/layer/ ä¸‹æ–°å»ºä¸¤ä¸ªæ–‡ä»¶ mylayer.h mylayer.cpp</span><span class="hljs-comment">// 1.mylayer.h</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;layer.h&quot;</span></span><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> ncnn;      <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyLayer</span> :</span> <span class="hljs-keyword">public</span> Layer&#123;&#125;;<span class="hljs-comment">// 2. mylayer.cpp</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;mylayer.h&quot;</span></span>DEFINE_LAYER_CREATOR(MyLayer)   <span class="hljs-comment">// æ³¨å†Œæ–°å®šä¹‰çš„å±‚</span></code></pre><h5 id="2-å®šä¹‰å±‚å‚æ•°-parameters-å’Œ-æƒé‡-weights-å¹¶å®ç°è½½å…¥å‡½æ•°"><a href="#2-å®šä¹‰å±‚å‚æ•°-parameters-å’Œ-æƒé‡-weights-å¹¶å®ç°è½½å…¥å‡½æ•°" class="headerlink" title="2. å®šä¹‰å±‚å‚æ•° parameters å’Œ æƒé‡ weights, å¹¶å®ç°è½½å…¥å‡½æ•°"></a>2. å®šä¹‰å±‚å‚æ•° parameters å’Œ æƒé‡ weights, å¹¶å®ç°è½½å…¥å‡½æ•°</h5><pre><code class="hljs c"><span class="hljs-comment">// mylayer.h</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;layer.h&quot;</span></span><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> ncnn;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyLayer</span> :</span> <span class="hljs-keyword">public</span> Layer&#123;<span class="hljs-keyword">public</span>:  <span class="hljs-comment">// å…¬æœ‰æ–¹æ³•</span>      <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">load_param</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ParamDic&amp; pd)</span></span>;<span class="hljs-comment">// è™šå‡½æ•°ï¼Œå¯ä»¥è¢«å­ç±»è¦†ç›–</span>      <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">load_model</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ModelBin&amp; mb)</span></span>;   <span class="hljs-comment">// </span><span class="hljs-keyword">private</span>: <span class="hljs-comment">// ç§æœ‰å‚æ•°</span>      <span class="hljs-keyword">int</span> channels;   <span class="hljs-comment">// å‚æ•°1 é€šé“æ•°é‡</span>      <span class="hljs-keyword">float</span> eps;      <span class="hljs-comment">// å‚æ•°2 ç²¾åº¦</span>      Mat gamma_data; <span class="hljs-comment">// æƒé‡</span>&#125;ï¼›<span class="hljs-comment">// 2. mylayer.cpp</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;mylayer.h&quot;</span></span>DEFINE_LAYER_CREATOR(MyLayer) <span class="hljs-comment">// å®ç° load_param() è½½å…¥ç½‘ç»œå±‚å‚æ•°</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">MyLayer::load_param</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ParamDict&amp; pd)</span></span><span class="hljs-function"></span>&#123;      <span class="hljs-comment">// ä½¿ç”¨pd.get(key,default_val); ä»paramæ–‡ä»¶ä¸­ï¼ˆkey=valï¼‰è·å–å‚æ•°</span>      channels = pd.get(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);      <span class="hljs-comment">// è§£æ 0=&lt;int value&gt;, é»˜è®¤ä¸º0</span>      eps      = pd.get(<span class="hljs-number">1</span>, <span class="hljs-number">0.001f</span>); <span class="hljs-comment">// è§£æ 1=&lt;float value&gt;, é»˜è®¤ä¸º0.001f</span>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// è½½å…¥æˆåŠŸè¿”å›0</span>&#125;<span class="hljs-comment">// å®ç° load_model() è½½å…¥æ¨¡å‹æƒé‡</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">MyLayer::load_model</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ModelBin&amp; mb)</span></span><span class="hljs-function"></span>&#123;      <span class="hljs-comment">// è¯»å–äºŒè¿›åˆ¶æ•°æ®çš„é•¿åº¦ä¸º channels * sizeof(float)</span>      <span class="hljs-comment">// 0 è‡ªåŠ¨åˆ¤æ–­æ•°æ®ç±»å‹ï¼Œ float32 float16 int8</span>      <span class="hljs-comment">// 1 æŒ‰ float32è¯»å–  2 æŒ‰float16è¯»å– 3 æŒ‰int8è¯»å–</span>      gamma_data = mb.load(channels, <span class="hljs-number">1</span>);<span class="hljs-comment">// æŒ‰ float32è¯»å– </span>      <span class="hljs-keyword">if</span>(gamma_data.empty())            <span class="hljs-keyword">return</span> <span class="hljs-number">-100</span>; <span class="hljs-comment">// é”™è¯¯è¿”å›é0æ•°ï¼Œ-100è¡¨ç¤º out-of-memory </span>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">//  è½½å…¥æˆåŠŸè¿”å›0</span>&#125;</code></pre><h5 id="3-å®šä¹‰ç±»æ„é€ å‡½æ•°ï¼Œç¡®å®šå‰å‘ä¼ æ’­è¡Œä¸º"><a href="#3-å®šä¹‰ç±»æ„é€ å‡½æ•°ï¼Œç¡®å®šå‰å‘ä¼ æ’­è¡Œä¸º" class="headerlink" title="3.  å®šä¹‰ç±»æ„é€ å‡½æ•°ï¼Œç¡®å®šå‰å‘ä¼ æ’­è¡Œä¸º"></a>3.  å®šä¹‰ç±»æ„é€ å‡½æ•°ï¼Œç¡®å®šå‰å‘ä¼ æ’­è¡Œä¸º</h5><pre><code class="hljs c"><span class="hljs-comment">// mylayer.h</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;layer.h&quot;</span></span><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> ncnn;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyLayer</span> :</span> <span class="hljs-keyword">public</span> Layer&#123;<span class="hljs-keyword">public</span>:        MyLayer();  <span class="hljs-comment">// æ„é€ å‡½æ•°</span>      <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">load_param</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ParamDic&amp; pd)</span></span>;      <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">load_model</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ModelBin&amp; mb)</span></span>;  <span class="hljs-keyword">private</span>:      <span class="hljs-keyword">int</span> channels;         <span class="hljs-keyword">float</span> eps;       Mat gamma_data; &#125;ï¼›<span class="hljs-comment">// mylayer.cpp</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;mylayer.h&quot;</span></span>DEFINE_LAYER_CREATOR(MyLayer) <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">MyLayer::load_param</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ParamDict&amp; pd)</span></span><span class="hljs-function"></span>&#123;      channels = pd.get(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);           eps      = pd.get(<span class="hljs-number">1</span>, <span class="hljs-number">0.001f</span>);            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">MyLayer::load_model</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ModelBin&amp; mb)</span></span><span class="hljs-function"></span>&#123;      gamma_data = mb.load(channels, <span class="hljs-number">1</span>);      <span class="hljs-keyword">if</span>(gamma_data.empty())            <span class="hljs-keyword">return</span> <span class="hljs-number">-100</span>;      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;<span class="hljs-comment">// æ„é€ å‡½æ•°</span>MyLayer::MyLayer()&#123;      <span class="hljs-comment">// æ˜¯å¦ä¸º 1è¾“å…¥1è¾“å‡ºå±‚</span>      <span class="hljs-comment">// 1è¾“å…¥1è¾“å‡ºå±‚ï¼š Convolution, Pooling, ReLU, Softmax ...</span>      <span class="hljs-comment">// åä¾‹       ï¼š Eltwise, Split, Concat, Slice ...</span>      one_blob_only = <span class="hljs-literal">true</span>;      <span class="hljs-comment">// æ˜¯å¦å¯ä»¥åœ¨ è¾“å…¥blob ä¸Šç›´æ¥ä¿®æ”¹ åè¾“å‡º</span>      <span class="hljs-comment">// æ”¯æŒåœ¨åŸä½ç½®ä¸Šä¿®æ”¹ï¼š Reluã€BNã€scaleã€Sigmod...</span>      <span class="hljs-comment">// ä¸æ”¯æŒï¼š Convolutionã€Pooling ...</span>      support_inplace = <span class="hljs-literal">true</span>;&#125;</code></pre><h5 id="4-é€‰æ‹©åˆé€‚çš„-forward-å‡½æ•°æ¥å£ï¼Œ-å¹¶å®ç°å¯¹åº”çš„-forward-å‡½æ•°"><a href="#4-é€‰æ‹©åˆé€‚çš„-forward-å‡½æ•°æ¥å£ï¼Œ-å¹¶å®ç°å¯¹åº”çš„-forward-å‡½æ•°" class="headerlink" title="4.  é€‰æ‹©åˆé€‚çš„ forward()å‡½æ•°æ¥å£ï¼Œ å¹¶å®ç°å¯¹åº”çš„ forward å‡½æ•°"></a>4.  é€‰æ‹©åˆé€‚çš„ forward()å‡½æ•°æ¥å£ï¼Œ å¹¶å®ç°å¯¹åº”çš„ forward å‡½æ•°</h5><p>Layerç±»å®šä¹‰äº†å››ç§ forward()å‡½æ•°ï¼š</p><ul><li><p>å¤šè¾“å…¥å¤šè¾“å‡ºï¼Œconst ä¸å¯ç›´æ¥å¯¹è¾“å…¥è¿›è¡Œä¿®æ”¹</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">forward</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Mat&gt;&amp; bottom_blobs, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Mat&gt;&amp; top_blobs, <span class="hljs-keyword">const</span> Option&amp; opt)</span> <span class="hljs-keyword">const</span></span>;</code></pre></li><li><p>å•è¾“å…¥å•è¾“å‡ºï¼Œconst ä¸å¯ç›´æ¥å¯¹è¾“å…¥è¿›è¡Œä¿®æ”¹</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">forward</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Mat&amp; bottom_blob, Mat&amp; top_blob, <span class="hljs-keyword">const</span> Option&amp; opt)</span> <span class="hljs-keyword">const</span></span>;</code></pre></li><li><p>å¤šè¾“å…¥å¤šè¾“å‡ºï¼Œå¯ç›´æ¥å¯¹è¾“å…¥è¿›è¡Œä¿®æ”¹</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">forward_inplace</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Mat&gt;&amp; bottom_top_blobs, <span class="hljs-keyword">const</span> Option&amp; opt)</span> <span class="hljs-keyword">const</span></span>;</code></pre></li><li><p>å•è¾“å…¥å•è¾“å‡ºï¼Œå¯ç›´æ¥å¯¹è¾“å…¥è¿›è¡Œä¿®æ”¹</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">forward_inplace</span><span class="hljs-params">(Mat&amp; bottom_top_blob, <span class="hljs-keyword">const</span> Option&amp; opt)</span> <span class="hljs-keyword">const</span></span>;</code></pre></li></ul><p>å…·ä½“å®ç°:</p><pre><code class="hljs c"><span class="hljs-comment">// mylayer.h</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;layer.h&quot;</span></span><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> ncnn;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyLayer</span> :</span> <span class="hljs-keyword">public</span> Layer&#123;<span class="hljs-keyword">public</span>:      MyLayer();      <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">load_param</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ParamDic&amp; pd)</span></span>;      <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">load_model</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ModelBin&amp; mb)</span></span>;            <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">forward</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Mat&amp; bottom_blob, Mat&amp; top_blob, <span class="hljs-keyword">const</span> Option&amp; opt)</span> <span class="hljs-keyword">const</span></span>; <span class="hljs-comment">// å•è¾“å…¥å•è¾“å‡º</span>      <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">forward_inplace</span><span class="hljs-params">(Mat&amp; bottom_top_blob, <span class="hljs-keyword">const</span> Option&amp; opt)</span> <span class="hljs-keyword">const</span></span>;          <span class="hljs-comment">// å•å…¥å•å‡ºæœ¬åœ°ä¿®æ”¹ </span><span class="hljs-keyword">private</span>:       <span class="hljs-keyword">int</span> channels;        <span class="hljs-keyword">float</span> eps;       Mat gamma_data;&#125;ï¼›<span class="hljs-comment">// mylayer.cpp </span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;mylayer.h&quot;</span></span>DEFINE_LAYER_CREATOR(MyLayer)MyLayer::MyLayer()&#123;      one_blob_only = <span class="hljs-literal">true</span>;      support_inplace = <span class="hljs-literal">true</span>;&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">MyLayer::load_param</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ParamDict&amp; pd)</span></span><span class="hljs-function"></span>&#123;      channels = pd.get(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);      eps      = pd.get(<span class="hljs-number">1</span>, <span class="hljs-number">0.001f</span>);             <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">MyLayer::load_model</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ModelBin&amp; mb)</span></span><span class="hljs-function"></span>&#123;      gamma_data = mb.load(channels, <span class="hljs-number">1</span>);      <span class="hljs-keyword">if</span>(gamma_data.empty())            <span class="hljs-keyword">return</span> <span class="hljs-number">-100</span>;      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;<span class="hljs-comment">// å•å…¥å•å‡º å‰å‘ä¼ æ’­ç½‘ç»œ ä¸å¯ä¿®æ”¹ éconst</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">MyLayer::forward</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Mat&amp; bottom_blob, Mat&amp; top_blob, <span class="hljs-keyword">const</span> Option&amp; opt)</span> <span class="hljs-keyword">const</span></span><span class="hljs-function"></span>&#123;      <span class="hljs-keyword">if</span>(bottom_blob.c != channels)            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;            <span class="hljs-comment">// å®ç°è¿ç®— x = (x + eps) * gamma_per_channel</span>      <span class="hljs-keyword">int</span> w = bottom_blob.w;      <span class="hljs-keyword">int</span> h = bottom_blob.h;      <span class="hljs-keyword">size_t</span> elemsize = bottom_blob.elemsize;      <span class="hljs-keyword">int</span> size = w * h;            <span class="hljs-comment">// è¾“å‡ºéœ€è¦æ–°å»ºï¼Œä¸å¯ç›´æ¥åœ¨è¾“å…¥blobä¸Šä¿®æ”¹</span>      top_blob.create(w, h, channels, elemsize, opt.blob_allocator);      <span class="hljs-keyword">if</span>(top_blob.empty())            <span class="hljs-keyword">return</span> <span class="hljs-number">-100</span>;            <span class="hljs-meta">#pragam omp parallel for num_threads(opt.num_threads);</span>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> q=<span class="hljs-number">0</span>; q&lt;channels; q++)      &#123;            <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span>* in_ptr = bottom_blob.channel(q);            <span class="hljs-keyword">float</span>* out_ptr = top_blob.channel(q);            <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> gamma = gamma_data[q];                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;size; i++)            &#123;                  out_ptr[i] = (in_ptr[i] + eps)*gamma;            &#125;            &#125;            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>ï¼›&#125;<span class="hljs-comment">// å•å…¥å•å‡º å‰å‘ä¼ æ’­ç½‘ç»œ  å¯åœ¨è¾“å…¥blobä¸Šä¿®æ”¹</span><span class="hljs-keyword">int</span> MyLayer::forward_inplace(Mat&amp; bottom_top_blob, <span class="hljs-keyword">const</span> Option&amp; opt) <span class="hljs-keyword">const</span>&#123;      <span class="hljs-keyword">if</span>(bottom_blob.c != channels)            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;             <span class="hljs-comment">// å®ç°è¿ç®— x = (x + eps) * gamma_per_channel</span>      <span class="hljs-keyword">int</span> w = bottom_blob.w;      <span class="hljs-keyword">int</span> h = bottom_blob.h;      <span class="hljs-keyword">int</span> size = w * h;            <span class="hljs-comment">// è¾“å‡ºä¸éœ€è¦æ–°å»ºï¼Œå¯ç›´æ¥åœ¨è¾“å…¥blobä¸Šä¿®æ”¹</span>      <span class="hljs-meta">#pragam omp parallel for num_threads(opt.num_threads);</span>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> q=<span class="hljs-number">0</span>; q&lt;channels; q++)      &#123;            <span class="hljs-keyword">float</span>* in_out_ptr = bottom_top_blob.channel(q);            <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> gamma = gamma_data[q];            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;size; i++)            &#123;                  in_out_ptr[i] = (in_out_ptr[i] + eps)*gamma;            &#125;            &#125;            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>ï¼›&#125;</code></pre><h5 id="5-é›†æˆè¿›-ncnn-åº“"><a href="#5-é›†æˆè¿›-ncnn-åº“" class="headerlink" title="5. é›†æˆè¿› ncnn åº“"></a>5. é›†æˆè¿› ncnn åº“</h5><pre><code class="hljs c"><span class="hljs-comment">// å±‚ç±»å‹       å±‚åç§°   è¾“å…¥æ•°é‡  è¾“å‡ºæ•°é‡   è¾“å…¥å±‚   è¾“å‡ºå±‚</span><span class="hljs-comment">// MyLayer     mylayer    1       1     conv2d   mylayer0  0=32 1=0.2 // å¯¹åº” param</span><span class="hljs-comment">// å±‚ç±»å‹: å’Œå¯¹åº”çš„æ³¨å†Œçš„ååç§°ä¸€è‡´</span><span class="hljs-comment">// æ³¨å†Œæ–°å±‚</span>ncnn::Net net;net.register_custom_layer(<span class="hljs-string">&quot;MyLayer&quot;</span>, MyLayer_layer_creator); <span class="hljs-comment">// æ³¨å†Œæ–°å±‚</span>net.load_param(<span class="hljs-string">&quot;model.param&quot;</span>);net.load_model(<span class="hljs-string">&quot;model.bin&quot;</span>);</code></pre><p>â€‹      </p>]]></content>
    
    
    <categories>
      
      <category>DL_Deploy</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ncnnæºç åˆ†æ_4</title>
    <link href="/2020/09/21/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-4/"/>
    <url>/2020/09/21/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-4/</url>
    
    <content type="html"><![CDATA[<p>ncnnæºç åˆ†æ-4 æ¨¡å‹é‡åŒ–æºç </p><a id="more"></a><p>ncnné‡åŒ–åˆ†æä»£ç å¯¹åº”çš„æ–‡ä»¶ä¸»è¦æœ‰ä¸¤ä¸ª:ncnn/tools/quantize/<strong>ncnn2table.cpp</strong> å’Œ ncnn/tools/quantize/<strong>ncnn2int8.cpp</strong>ã€‚</p><ul><li><strong>ncnn2table.cpp</strong> <strong>ä¸»è¦æ˜¯åˆ†æç”Ÿæˆç›¸åº”çš„é‡åŒ–è¡¨ï¼Œ å…¶ä¸­å­˜å‚¨äº†æ¯ä¸ªå±‚çš„ scale å€¼ã€‚</strong></li><li><strong>ncnn2int8.cpp</strong> <strong>åˆ™æ˜¯å¯¹ç½‘ç»œè¿›è¡Œ int8é‡åŒ–</strong></li></ul><h4 id="1-ncnn2int8"><a href="#1-ncnn2int8" class="headerlink" title="1. ncnn2int8"></a>1. ncnn2int8</h4><p>â€‹    æˆ‘ä»¬é¦–å…ˆå¯¹ ncnn2int8.cpp è¿™ä¸ªæ–‡ä»¶è¿›è¡Œåˆ†æã€‚ è¯¥æ–‡ä»¶å®Œæˆçš„ä¸»è¦åŠŸèƒ½æ˜¯å°† float32 ç±»å‹è½¬åŒ–ä¸º int8 ç±»å‹ã€‚ä¸»è¦åˆ†ä¸ºå››ä¸ªæ­¥éª¤:</p><p>(1) è¯»å–ç”Ÿæˆçš„ table æ–‡ä»¶ï¼Œé‡Œé¢å­˜å‚¨äº†å¯¹åº”çš„ scaleã€‚è¿™æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶çš„è¯»å–å’Œè§£æã€‚</p><p>â€‹    read<em>int8_scale_table è´Ÿè´£è¯»å– table æ–‡ä»¶, å°† scale åˆ†åˆ«å­˜å‚¨åœ¨ weight_int8scale_table (å¸¦ _param\</em>) å’Œ blob<em>int8scale_table(ä¸å¸¦_param\</em>)ã€‚ è¿™é‡Œåªæ˜¯ä¸€ä¸ªè¯»å–æ–‡ä»¶å¹¶è§£æçš„è¿‡ç¨‹ã€‚</p><p><strong>weight</strong>( å¸¦_param_)æ ¼å¼ç¤ºä¾‹ï¼š scale ä¸ªæ•°å’Œé€šé“æ•°ç›¸åŒï¼Œæ˜¯ä¸»é€šé“è¿›è¡Œé‡åŒ–</p><p><img src="/2020/09/21/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-4/1.jpg" alt></p><p><strong>blob</strong> (ä¸å¸¦_param_) æ ¼å¼ç¤ºä¾‹ï¼š</p><p><img src="/2020/09/21/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-4/2.jpg" alt></p><p>(2) <strong>è½½å…¥åŸå§‹çš„å‚æ•°å’Œæ¨¡å‹æ–‡ä»¶ã€‚</strong>net ä¸­çš„ .param å’Œ .bin è½½å…¥æ–¹å¼<strong>ã€‚</strong></p><p>(3) <strong>å¯¹å·ç§¯å±‚ã€æ·±åº¦å¯åˆ†ç¦»å·ç§¯å±‚å’Œå…¨è¿æ¥å±‚è¿›è¡Œé‡åŒ–ã€‚quantize_convolutionã€quantize_convolutiondepthwiseã€quantize_innerproduct</strong> åˆ†åˆ«å¯¹å·ç§¯å±‚ã€å¯åˆ†ç¦»å·ç§¯å±‚å’Œå…¨è¿æ¥å±‚è¿›è¡Œé‡åŒ–<strong>ã€‚ è¿™é‡Œå…¶å®æ˜¯æ„å»ºäº†ä¸€ä¸ªé‡åŒ–å±‚ï¼Œç„¶åå°†åŸå§‹çš„fp32ç±»å‹çš„æƒé‡å’Œscaleä½œä¸ºè¾“å…¥, è¿›è¡Œä¸€æ¬¡forwardè¿ç®—ï¼Œå°†ç»“æœæ›¿æ¢åŸæ¥çš„fp32æƒé‡</strong></p><p>(4) <strong>ä¿å­˜é‡åŒ–åçš„æƒé‡æ–‡ä»¶</strong></p><p><img src="/2020/09/21/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-4/3.jpg" alt></p><p><strong>ä»ä¸»å‡½æ•°å…¥æ‰‹</strong>: åˆ†åˆ«è¯»å–äº†5ä¸ªå‚æ•°, <strong>åˆ†åˆ«æ˜¯è¾“å…¥æ¨¡å‹æ–‡ä»¶ã€å‚æ•°æ–‡ä»¶ã€è¾“å‡ºæ¨¡å‹æ–‡ä»¶ã€è¾“å‡ºå‚æ•°æ–‡ä»¶å’Œé‡åŒ–è¡¨çš„è·¯å¾„</strong>ã€‚ ç„¶åæ‰§è¡Œå¦‚ä¸Šæ‰€ç¤ºçš„å››ä¸ªæ­¥éª¤ã€‚</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-comment">// è¯»å–ç›¸åº”çš„å‚æ•° </span>    <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">6</span>)    &#123;        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;usage: %s [inparam] [inbin] [outparam] [outbin] [calibration table]\n&quot;</span>, argv[<span class="hljs-number">0</span>]);        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;    &#125;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* inparam = argv[<span class="hljs-number">1</span>];  <span class="hljs-comment">// è¾“å…¥æ¨¡å‹æ–‡ä»¶</span>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* inbin = argv[<span class="hljs-number">2</span>];  <span class="hljs-comment">// è¾“å…¥å‚æ•°æ–‡ä»¶</span>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* outparam = argv[<span class="hljs-number">3</span>];  <span class="hljs-comment">// è¾“å‡ºæ¨¡å‹æ–‡ä»¶</span>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* outbin = argv[<span class="hljs-number">4</span>];  <span class="hljs-comment">// è¾“å‡ºå‚æ•°æ–‡ä»¶</span>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* int8scale_table_path = argv[<span class="hljs-number">5</span>]; <span class="hljs-comment">// é‡åŒ–è¡¨çš„è·¯å¾„</span>    NetQuantize quantizer; <span class="hljs-comment">// ä¸»è¦çš„é‡åŒ–ç±»</span>    <span class="hljs-comment">// (1)  è¯»å–å¹¶è§£æ scale table æ–‡ä»¶</span>    <span class="hljs-keyword">if</span> (int8scale_table_path)    &#123;        <span class="hljs-keyword">bool</span> s2 = read_int8scale_table(int8scale_table_path, quantizer.blob_int8scale_table, quantizer.weight_int8scale_table);        <span class="hljs-keyword">if</span> (!s2)         &#123;            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;read_int8scale_table failed\n&quot;</span>);            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;        &#125;    &#125;    <span class="hljs-comment">// (2) è½½å…¥æ¨¡å‹æ–‡ä»¶å’Œå‚æ•°</span>    quantizer.load_param(inparam);     quantizer.load_model(inbin);    <span class="hljs-comment">// (3) é‡åŒ–: ä¸»è¦é‡åŒ–ä¸‰å±‚: convã€convdw å’Œ fc</span>    quantizer.quantize_convolution();    quantizer.quantize_convolutiondepthwise();    quantizer.quantize_innerproduct();    <span class="hljs-comment">// (4) å­˜å‚¨æ¨¡å‹å’Œå‚æ•°æ–‡ä»¶</span>    quantizer.save(outparam, outbin);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>â€‹    <strong>ä»£ç çš„æœ€æ ¸å¿ƒçš„ä¸‰ä¸ªå‡½æ•°:</strong> <strong>quantize_convolutionã€quantize_convolutiondepthwiseã€quantize_innerproduct</strong> åˆ†åˆ«å¯¹å·ç§¯å±‚ã€å¯åˆ†ç¦»å·ç§¯å±‚å’Œå…¨è¿æ¥å±‚è¿›è¡Œé‡åŒ–, </p><p>æˆ‘ä»¬åœ¨æ­¤ä»¥ <strong>quantize_convolution</strong> ä¸ºä¾‹:</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">NetQuantize::quantize_convolution</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> layer_count = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(layers.size());    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; layer_count; i++)    &#123;        <span class="hljs-comment">// æŸ¥æ‰¾æ‰€æœ‰çš„å·ç§¯å±‚</span>        <span class="hljs-keyword">if</span> (layers[i]-&gt;type != <span class="hljs-string">&quot;Convolution&quot;</span>)            <span class="hljs-keyword">continue</span>;                         <span class="hljs-comment">// è·å–å·ç§¯å±‚çš„åç§°           </span>        <span class="hljs-keyword">char</span> key[<span class="hljs-number">256</span>];        <span class="hljs-built_in">sprintf</span>(key, <span class="hljs-string">&quot;%s_param_0&quot;</span>, layers[i]-&gt;name.c_str());                            <span class="hljs-comment">// åœ¨ blob_int8scale_table æ‰¾åˆ°è¯¥å±‚  /* å…¶å®è¿™é‡Œçš„ blob_int8scale_table ä¸‹æ–‡å¹¶æ²¡æœ‰ç”¨åˆ° */</span>        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; &gt;::iterator iter_data = blob_int8scale_table.find(layers[i]-&gt;name);        <span class="hljs-keyword">if</span> (iter_data == blob_int8scale_table.end())            <span class="hljs-keyword">continue</span>;        <span class="hljs-comment">// åœ¨ weight_int8scale_table æ‰¾åˆ°è¯¥å±‚</span>        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; &gt;::iterator iter = weight_int8scale_table.find(key);        <span class="hljs-keyword">if</span> (iter == weight_int8scale_table.end())        &#123;            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;this layer need to be quantized, but no scale param!\n&quot;</span>);            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;        &#125;                <span class="hljs-comment">// å·ç§¯å±‚é‡åŒ– -&gt;  fp32 åˆ° int8</span>        ncnn::Convolution* convolution = (ncnn::Convolution*)layers[i]; <span class="hljs-comment">// (1) è·å–è¯¥å·ç§¯å±‚</span>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;quantize_convolution %s\n&quot;</span>, convolution-&gt;name.c_str());        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; weight_data_int8_scales = iter-&gt;second; <span class="hljs-comment">//  (2) è·å–weight_data_int8_scales</span>        &#123;            <span class="hljs-function">ncnn::Mat <span class="hljs-title">int8_weight_data</span><span class="hljs-params">(convolution-&gt;weight_data_size, (<span class="hljs-keyword">size_t</span>)<span class="hljs-number">1u</span>)</span></span>; <span class="hljs-comment">// (3) ç»“æœï¼Œå’Œweightçš„å¤§å°ä¸€è‡´</span>            <span class="hljs-keyword">if</span> (int8_weight_data.empty())                <span class="hljs-keyword">return</span> <span class="hljs-number">-100</span>;            <span class="hljs-comment">// è¿™é‡Œæ‰€è°“çš„é‡åŒ–ï¼Œå³è¿›è¡Œäº†ä¸€æ¬¡ç®€å•çš„å‰å‘ä¼ æ’­ï¼Œå°†åŸæ¥çš„float32ç±»å‹çš„æƒé‡æ›¿æ¢ä¸ºintç±»å‹ç»“æœ</span>            <span class="hljs-comment">// åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬å‡†å¤‡çš„ä¸œè¥¿æœ‰</span>            <span class="hljs-comment">// (1) å·ç§¯å±‚çš„ fp32 çš„æ•°æ® (2) scale æ•°æ® (3) å£°æ˜äº†ä¸€ä¸ª int8_weight_dataçš„æ•°æ®</span>            <span class="hljs-comment">// æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯ (1) + (2) -&gt; (3)</span>            <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> weight_data_size_output = convolution-&gt;weight_data_size / convolution-&gt;num_output;            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> n = <span class="hljs-number">0</span>; n &lt; convolution-&gt;num_output; n++)   <span class="hljs-comment">// é€å·ç§¯æ ¸è¿›è¡Œé‡åŒ–</span>            &#123;                <span class="hljs-comment">// (4) åˆ›å»ºä¸€ä¸ªquantize op</span>                ncnn::Layer* op = ncnn::create_layer(ncnn::LayerType::Quantize);                 <span class="hljs-comment">// (5) æŠŠé‡åŒ–è¡¨ä¸­çš„scaleè®¾ç½®è¿›opé‡Œå»</span>                ncnn::ParamDict pd;                pd.<span class="hljs-built_in">set</span>(<span class="hljs-number">0</span>, weight_data_int8_scales[n]);                op-&gt;load_param(pd);                <span class="hljs-comment">// (6) blob_allocator</span>                ncnn::Option opt;                opt.blob_allocator = int8_weight_data.allocator;                <span class="hljs-comment">// (7) weight_data &lt;-&gt; weight_data_n , int8_weight_data &lt;-&gt;  int8_weight_data_n </span>                <span class="hljs-keyword">const</span> ncnn::Mat weight_data_n = convolution-&gt;weight_data.range(weight_data_size_output * n, weight_data_size_output);                ncnn::Mat int8_weight_data_n = int8_weight_data.range(weight_data_size_output * n, weight_data_size_output);                <span class="hljs-comment">// (8) quantitze opå‰ä¼ ï¼Œè®¡ç®—é‡åŒ–æƒå€¼ weight_data_n -&gt;  int8_weight_data_n</span>                op-&gt;forward(weight_data_n, int8_weight_data_n, opt);                                 <span class="hljs-keyword">delete</span> op;            &#125;            convolution-&gt;weight_data = int8_weight_data; <span class="hljs-comment">// (9) ç”¨é‡åŒ–åçš„æƒå€¼æ›¿æ¢åŸæ¥çš„æƒå€¼</span>        &#125;        convolution-&gt;int8_scale_term = <span class="hljs-number">2</span>;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>å¯ä»¥æ¥ç®€å•çš„çœ‹ä¸€ä¸‹ <strong>quantize</strong> å±‚:</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">signed</span> <span class="hljs-keyword">char</span> <span class="hljs-title">float2int8</span><span class="hljs-params">(<span class="hljs-keyword">float</span> v)</span></span>&#123;    <span class="hljs-keyword">int</span> int32 = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(round(v)); <span class="hljs-comment">// å–æ•´æ•°, ç„¶åè½¬åŒ–ä¸º int32ç±»å‹</span>    <span class="hljs-keyword">if</span> (int32 &gt; <span class="hljs-number">127</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">127</span>;  <span class="hljs-comment">// å¦‚æœå¤§äº127, è¿”å›127</span>    <span class="hljs-keyword">if</span> (int32 &lt; <span class="hljs-number">-127</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">-127</span>; <span class="hljs-comment">// å¦‚æœå°äº -127, è¿”å› -127</span>    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">signed</span> <span class="hljs-keyword">char</span>)int32; <span class="hljs-comment">// è¿”å› int32 -&gt; int8</span>&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Quantize::forward</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Mat&amp; bottom_blob, Mat&amp; top_blob, <span class="hljs-keyword">const</span> Option&amp; opt)</span> <span class="hljs-keyword">const</span></span>&#123;    <span class="hljs-keyword">int</span> dims = bottom_blob.dims;    <span class="hljs-keyword">if</span> (dims == <span class="hljs-number">1</span>)&#123;        <span class="hljs-keyword">int</span> w = bottom_blob.w;        top_blob.create(w, (<span class="hljs-keyword">size_t</span>)<span class="hljs-number">1u</span>, opt.blob_allocator);        <span class="hljs-keyword">if</span> (top_blob.empty())            <span class="hljs-keyword">return</span> <span class="hljs-number">-100</span>;        <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span>* ptr = bottom_blob;        <span class="hljs-keyword">signed</span> <span class="hljs-keyword">char</span>* outptr = top_blob;        <span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> omp parallel for num_threads(opt.num_threads)</span>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;w; i++)        &#123;            <span class="hljs-comment">// ! è¿™ä¸€å¥æ˜¯æœ€æ ¸å¿ƒçš„ï¼Œä¹Ÿæ˜¯æ•´ä¸ªé‡åŒ–éƒ¨åˆ†ä»£ç çš„æ ¸å¿ƒ</span>            <span class="hljs-comment">// å°† float32 ä¹˜ä»¥ scaleï¼Œ ç„¶åå°†å…¶è½¬åŒ–ä¸º int8 ç±»å‹</span>            outptr[i] = float2int8(ptr[i] * scale);         &#125;    &#125;    <span class="hljs-keyword">if</span> (dims == <span class="hljs-number">2</span>)&#123;        ...    &#125;    <span class="hljs-keyword">if</span> (dims == <span class="hljs-number">3</span>)&#123;        ...    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p><strong>2. ncnn2table.cpp</strong> </p><p>ncnn2table.cpp ä¸»è¦ç”¨äº<strong>é‡åŒ–è¡¨çš„è®¡ç®—</strong>ï¼Œè¯´ç™½äº†å°±æ˜¯ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰è¯´çš„ç®—æ³•æ¥è®¡ç®—å„ä¸ªå‚æ•°çš„ scaleï¼Œåœ¨ncnn2table.cppä¸‹ï¼Œé¡¶å±‚ä»£ç æ ¸å¿ƒå°±ä¸€å¥è¯ï¼š</p><pre><code class="hljs cpp"><span class="hljs-comment">/* ncnn2table.cpp */</span><span class="hljs-comment">// filenames: ç”¨æ¥calibrationçš„å›¾ç‰‡list </span><span class="hljs-comment">// parampath: å‚æ•°æ–‡ä»¶è·¯å¾„</span><span class="hljs-comment">// binpath: bin äºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„</span><span class="hljs-comment">// tablepath: ç”Ÿæˆçš„é‡åŒ–è¡¨çš„è·¯å¾„</span><span class="hljs-comment">// pre_param: å‚æ•°</span>post_training_quantize(filenames, parampath, binpath, tablepath, pre_param);</code></pre><p>æˆ‘ä»¬æ¥ä¸‹æ¥é‡ç‚¹çœ‹post_training_quantizeè¿™ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°åšäº†å¦‚ä¸‹å‡ ä»¶äº‹ï¼š</p><p><strong>&gt;&gt;&gt;&gt;  (1) åˆå§‹åŒ–quantitize_datas    (2) è®¡ç®—æœ€å¤§å€¼    (3) åˆå§‹åŒ–ç›´æ–¹å›¾çš„é—´éš”      (4) è®¡ç®—ç›´æ–¹å›¾           (5) è®¡ç®—Scale</strong></p><p><strong>(1) åˆå§‹åŒ–quantitize_datas</strong></p><p>â€‹    æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œæ¯ä¸€ä¸ªå±‚æœ‰ä¸€ä¸ª<strong>QuantizeData</strong>å¯¹è±¡ï¼Œåˆå§‹åŒ– num_bins=2048ï¼Œä¹Ÿå°±æ˜¯åŸå§‹çš„fp32åˆ†å¸ƒPoï¼Œå…¶ç»Ÿè®¡ç›´æ–¹å›¾ä¸€å…±æœ‰<strong>2048ä¸ªbins</strong></p><pre><code class="hljs cpp"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;QuantizeData&gt; quantize_datas;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; net.conv_names.size(); i++)&#123;    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> layer_name = net.conv_names[i];    <span class="hljs-function">QuantizeData <span class="hljs-title">quantize_data</span><span class="hljs-params">(layer_name, <span class="hljs-number">2048</span>)</span></span>;    quantize_datas.push_back(quantize_data);&#125;</code></pre><p><strong>(2) è®¡ç®—æœ€å¤§å€¼</strong></p><p>â€‹    éå†æ‰€æœ‰å›¾ç‰‡ï¼Œè®¡ç®—æ¯ä¸ªblobçš„æœ€å¤§æ¿€æ´»å€¼ï¼Œè¿™é‡Œæ‰¾çš„æ˜¯ç»å¯¹å€¼æœ€å¤§çš„é‚£ä¸ª</p><pre><code class="hljs cpp">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; image_list.size(); i++) <span class="hljs-comment">// éå†calibrationæ•°æ®</span>    &#123;        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> img_name = image_list[i];        <span class="hljs-keyword">if</span> ((i + <span class="hljs-number">1</span>) % <span class="hljs-number">100</span> == <span class="hljs-number">0</span>)        &#123;            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;    %d/%d\n&quot;</span>, <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(i + <span class="hljs-number">1</span>), <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(size));        &#125;        cv::Mat bgr = cv::imread(img_name, cv::IMREAD_COLOR);        <span class="hljs-keyword">if</span> (bgr.empty())        &#123;            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;cv::imread %s failed\n&quot;</span>, img_name.c_str());            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;        &#125;        ncnn::Mat in = ncnn::Mat::from_pixels_resize(bgr.data, swapRB ? ncnn::Mat::PIXEL_BGR2RGB : ncnn::Mat::PIXEL_BGR, bgr.cols, bgr.rows, width, height);        in.substract_mean_normalize(mean_vals, norm_vals);        ncnn::Extractor ex = net.create_extractor();        ex.input(net.input_names[<span class="hljs-number">0</span>].c_str(), in);        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> j = <span class="hljs-number">0</span>; j &lt; net.conv_names.size(); j++)        &#123;            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> layer_name = net.conv_names[j];            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> blob_name = net.conv_bottom_blob_names[layer_name];            ncnn::Mat out;            ex.extract(blob_name.c_str(), out); <span class="hljs-comment">// å‰ä¼ ç½‘ç»œï¼Œç›¸å½“äºcaffeçš„forwardToï¼Œæ‹¿åˆ°blobæ•°æ®</span>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> k = <span class="hljs-number">0</span>; k &lt; quantize_datas.size(); k++)            &#123;                <span class="hljs-keyword">if</span> (quantize_datas[k].name == layer_name)                &#123;                    quantize_datas[k].initial_blob_max(out); <span class="hljs-comment">// ç»Ÿè®¡æœ€å¤§å€¼</span>                    <span class="hljs-keyword">break</span>;                &#125;            &#125;        &#125;    &#125;    <span class="hljs-comment">// è¢«è°ƒå‡½æ•°:</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">QuantizeData::initial_blob_max</span><span class="hljs-params">(ncnn::Mat data)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> channel_num = data.c;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> size = data.w * data.h;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> q = <span class="hljs-number">0</span>; q &lt; channel_num; q++)    &#123;        <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> *data_n = data.channel(q);        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; size; i++)        &#123;            max_value = <span class="hljs-built_in">std</span>::max(max_value, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">fabs</span>(data_n[i]));        &#125;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p><strong>(3) åˆå§‹åŒ–ç›´æ–¹å›¾é—´éš”</strong></p><p>ä¹Ÿå¾ˆç®€å•ï¼Œéå†æ¯ä¸ªå±‚ï¼Œåˆå§‹åŒ–ç›´æ–¹å›¾é—´éš”=æœ€å¤§æ¿€æ´»å€¼/2048</p><pre><code class="hljs cpp">    <span class="hljs-comment">// step 2 histogram_interval</span>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;    ====&gt; step 2 : generate the histogram_interval.\n&quot;</span>);    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; net.conv_names.size(); i++)    &#123;        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> layer_name = net.conv_names[i];        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> k = <span class="hljs-number">0</span>; k &lt; quantize_datas.size(); k++)        &#123;            <span class="hljs-keyword">if</span> (quantize_datas[k].name == layer_name)            &#123;                quantize_datas[k].initial_histogram_interval();                <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;%-20s : max = %-15f interval = %-10f\n&quot;</span>, quantize_datas[k].name.c_str(), quantize_datas[k].max_value, quantize_datas[k].histogram_interval);                <span class="hljs-keyword">break</span>;            &#125;        &#125;    &#125;    <span class="hljs-comment">// è¢«è°ƒå‡½æ•°    </span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">QuantizeData::initial_histogram_interval</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;    histogram_interval = max_value / <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">float</span>&gt;(num_bins);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p><strong>(4) è®¡ç®—ç›´æ–¹å›¾</strong></p><p>â€‹    å†å‰ä¼ ä¸€æ¬¡ï¼Œéå†æ¯ä¸ªblobï¼Œå‘æ¯ä¸ªbinä¸­æŠ•ç¥¨ï¼Œè®¡ç®—å‡ºç›´æ–¹å›¾ï¼Œå¾—åˆ°åŸå§‹fp32åˆ†å¸ƒ</p><pre><code class="hljs cpp">    <span class="hljs-comment">// step 3 histogram</span>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;    ====&gt; step 3 : generate the histogram.\n&quot;</span>);    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; image_list.size(); i++)    &#123;        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> img_name = image_list[i];        <span class="hljs-keyword">if</span> ((i + <span class="hljs-number">1</span>) % <span class="hljs-number">100</span> == <span class="hljs-number">0</span>)            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;          %d/%d\n&quot;</span>, (<span class="hljs-keyword">int</span>)(i + <span class="hljs-number">1</span>), (<span class="hljs-keyword">int</span>)size);                    cv::Mat bgr = cv::imread(img_name, cv::IMREAD_COLOR);        <span class="hljs-keyword">if</span> (bgr.empty())        &#123;            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;cv::imread %s failed\n&quot;</span>, img_name.c_str());            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;        &#125;        ncnn::Mat in = ncnn::Mat::from_pixels_resize(bgr.data, swapRB ? ncnn::Mat::PIXEL_BGR2RGB : ncnn::Mat::PIXEL_BGR, bgr.cols, bgr.rows, width, height);        in.substract_mean_normalize(mean_vals, norm_vals);        ncnn::Extractor ex = net.create_extractor();        ex.input(net.input_names[<span class="hljs-number">0</span>].c_str(), in);        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> j = <span class="hljs-number">0</span>; j &lt; net.conv_names.size(); j++)        &#123;            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> layer_name = net.conv_names[j];            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> blob_name = net.conv_bottom_blob_names[layer_name];            ncnn::Mat out;            ex.extract(blob_name.c_str(), out);            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> k = <span class="hljs-number">0</span>; k &lt; quantize_datas.size(); k++)            &#123;                <span class="hljs-keyword">if</span> (quantize_datas[k].name == layer_name)                &#123;                    quantize_datas[k].update_histogram(out);                    <span class="hljs-keyword">break</span>;                &#125;            &#125;        &#125;    &#125;    <span class="hljs-comment">// è¢«è°ƒå‡½æ•°      </span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">QuantizeData::update_histogram</span><span class="hljs-params">(ncnn::Mat data)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> channel_num = data.c;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> size = data.w * data.h;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> q = <span class="hljs-number">0</span>; q &lt; channel_num; q++)    &#123;        <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> *data_n = data.channel(q);        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; size; i++)        &#123;            <span class="hljs-keyword">if</span> (data_n[i] == <span class="hljs-number">0</span>)                <span class="hljs-keyword">continue</span>;            <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> index = <span class="hljs-built_in">std</span>::min(<span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">abs</span>(data_n[i]) / histogram_interval), <span class="hljs-number">2047</span>);            histogram[index]++;        &#125;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p><strong>(5) è®¡ç®—Scale</strong></p><pre><code class="hljs cpp">    <span class="hljs-comment">// step4 kld</span>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;    ====&gt; step 4 : using kld to find the best threshold value.\n&quot;</span>);    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; net.conv_names.size(); i++)    &#123;        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> layer_name = net.conv_names[i];        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> blob_name = net.conv_bottom_blob_names[layer_name];        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;%-20s &quot;</span>, layer_name.c_str());        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> k = <span class="hljs-number">0</span>; k &lt; quantize_datas.size(); k++)        &#123;            <span class="hljs-keyword">if</span> (quantize_datas[k].name == layer_name)            &#123;                quantize_datas[k].get_data_blob_scale();                <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;bin : %-8d threshold : %-15f interval : %-10f scale : %-10f\n&quot;</span>,                        quantize_datas[k].threshold_bin,                        quantize_datas[k].threshold,                        quantize_datas[k].histogram_interval,                        quantize_datas[k].scale);                <span class="hljs-built_in">fprintf</span>(fp, <span class="hljs-string">&quot;%s %f\n&quot;</span>, layer_name.c_str(), quantize_datas[k].scale);                <span class="hljs-keyword">break</span>;            &#125;        &#125;    &#125;<span class="hljs-comment">// è¢«è°ƒå‡½æ•° </span><span class="hljs-function"><span class="hljs-keyword">float</span> <span class="hljs-title">QuantizeData::get_data_blob_scale</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;       normalize_histogram();   <span class="hljs-comment">// ç›´æ–¹å›¾å½’ä¸€åŒ–</span>    threshold_bin = threshold_distribution(histogram);   <span class="hljs-comment">// è®¡ç®—æœ€åæœ‰å¤šå°‘ä¸ªbins</span>    threshold = (threshold_bin + <span class="hljs-number">0.5</span>) * histogram_interval;   <span class="hljs-comment">// ä¹‹åå¾ˆå®¹æ˜“å°±èƒ½æ‰¾åˆ°Threshold</span>    scale = <span class="hljs-number">127</span> / threshold;   <span class="hljs-comment">// Scaleä¹Ÿå¾ˆç®€å•å°±èƒ½zå¥½åˆ°</span>    <span class="hljs-keyword">return</span> scale;&#125;</code></pre><p>å…¶å®è¯´äº†åŠå¤©ï¼Œ<strong>æœ€æ ¸å¿ƒçš„å°±åœ¨get_data_blob_scaleè¿™ä¸ªå‡½æ•°é‡Œï¼Œå‡½æ•°åˆ†ä¸º3æ­¥</strong>ï¼š</p><p><strong>a. ç›´æ–¹å›¾å½’ä¸€åŒ–</strong></p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">QuantizeData::normalize_histogram</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">size_t</span> length = histogram.size();    <span class="hljs-keyword">float</span> sum = <span class="hljs-number">0</span>;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; length; i++)        sum += histogram[i];    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; length; i++)        histogram[i] /= sum;    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p><strong>b. ä½¿ç”¨KLæ•£åº¦è®¡ç®—æœ€åç”¨å¤šå°‘ä¸ªbinsæ¯”è¾ƒåˆé€‚</strong></p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">QuantizeData::threshold_distribution</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; &amp;distribution, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> target_bin = <span class="hljs-number">128</span>)</span></span><span class="hljs-function"></span>&#123;    ...    <span class="hljs-comment">// è¿™é‡Œlengthå°±æ˜¯åŸå§‹åˆ†å¸ƒPoçš„é•¿åº¦ï¼ŒNCNNé»˜è®¤2048ã€‚è¿™é‡Œçš„thresholdå®é™…ä¸Šæ˜¯num_binsï¼Œå¯ä»¥æ¢ç®—æˆT</span>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> threshold = target_bin; threshold &lt; length; threshold++)   <span class="hljs-comment">// target_bin=128ï¼Œlength = 2048</span>    &#123;         <span class="hljs-comment">// â‘ . è®¡ç®—æˆªæ–­çš„fp32åˆ†å¸ƒP</span>         <span class="hljs-comment">// â‘¡. è®¡ç®—int8åˆ†å¸ƒQ</span>         <span class="hljs-comment">// â‘¢. è®¡ç®—æ‰©å±•åˆ†å¸ƒQ_expand</span>        <span class="hljs-comment">// â‘£. è®¡ç®—KLæ•£åº¦</span>        <span class="hljs-comment">// â‘¤. æ¯”å¤§å°</span>    &#125;&#125;</code></pre><p>â‘ . è®¡ç®—æˆªæ–­çš„fp32åˆ†å¸ƒPä¹Ÿå¾ˆç®€å•ï¼š</p><pre><code class="hljs cpp"><span class="hljs-keyword">float</span> threshold_sum = <span class="hljs-number">0</span>;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> threshold=target_bin; threshold&lt;length; threshold++) &#123;    threshold_sum += distribution[threshold];   <span class="hljs-comment">// 128ä»¥ä¸Šçš„æ‰€æœ‰æ•°æ®å’Œ</span>&#125;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> threshold=target_bin; threshold&lt;length; threshold++) &#123;    <span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; <span class="hljs-title">t_distribution</span><span class="hljs-params">(distribution.begin(), distribution.begin()+threshold)</span></span>;        t_distribution[threshold<span class="hljs-number">-1</span>] += threshold_sum;   <span class="hljs-comment">// Pçš„æœ€åä¸€ä¸ªbinåŠ ä¸Šè¢«æˆªæ–­çš„æ‰€æœ‰æ¦‚ç‡ï¼Œå¾—åˆ°æˆªæ–­çš„fp32åˆ†å¸ƒP</span>    threshold_sum -= distribution[threshold];       <span class="hljs-comment">// æ˜¯é€šè¿‡å‡æ³•æ¥ä¿è¯æ•°å€¼æ­£ç¡®æ€§çš„ï¼Œå¾ˆå·§ç§’</span>    ...</code></pre><p>â‘¡. è®¡ç®—int8åˆ†å¸ƒQï¼Œæ³¨æ„Qæ˜¯ä»Poå¾—æ¥çš„ï¼Œè€Œä¸æ˜¯ä»På¾—æ¥çš„ï¼Œå¤§äºTçš„éƒ¨åˆ†å¹¶ä¸ä¼šåŠ è¿›æœ€åä¸€ä¸ªbinå†…ï¼ˆå­˜ç–‘ï¼Œä¸ç†è§£ï¼‰ï¼›å¦å¤–ï¼Œå½“å‘ç”Ÿäº†4èˆ5å…¥æ—¶ï¼Œä¼šæœ‰ç‰¹æ®Šå¤„ç†</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; <span class="hljs-title">quantize_distribution</span><span class="hljs-params">(target_bin)</span></span>;  <span class="hljs-comment">// é‡åŒ–ååˆ†å¸ƒQï¼Œé•¿åº¦æ˜¯128</span> fill(quantize_distribution.begin(), quantize_distribution.end(), <span class="hljs-number">0</span>);<span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> num_per_bin = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">float</span>&gt;(threshold) / target_bin;  <span class="hljs-comment">// å…¶å®å°±æ˜¯å½“å‰Tä¸‹çš„Scale </span><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;target_bin; i++) &#123;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> start = i * num_per_bin;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> end = start + num_per_bin;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> left_upper = <span class="hljs-built_in">ceil</span>(start);    <span class="hljs-keyword">if</span> (left_upper &gt; start)     &#123;   <span class="hljs-comment">// è¿™é‡Œçš„æ„æ€æ˜¯ï¼Œå¦‚æœå‘ç”Ÿäº†5å…¥ï¼Œåˆ™éœ€è¦å°†èˆæ‰çš„é‚£ä¸ªbinæŒ‰æ¯”ä¾‹åŠ è¿›æ¥</span>        <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> left_scale = left_upper - start;        quantize_distribution[i] += left_scale * distribution[left_upper - <span class="hljs-number">1</span>];    &#125;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> right_lower = <span class="hljs-built_in">floor</span>(end);    <span class="hljs-keyword">if</span> (right_lower &lt; end)     &#123;        <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> right_scale = end - right_lower;        quantize_distribution[i] += right_scale * distribution[right_lower];    &#125;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j=left_upper; j&lt;right_lower; j++)     &#123;        quantize_distribution[i] += distribution[j];    &#125;&#125;</code></pre><p>â‘¢. è®¡ç®—Q_expandï¼Œç»Ÿè®¡countæ—¶0ä¸ç®—åœ¨å†…ï¼Œæ³¨æ„ä¸ç®¡æ˜¯ç»Ÿè®¡æ•°é‡è¿˜æ˜¯ä¸Šé‡‡æ ·çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½æœ‰4èˆ5å…¥ç›¸å…³çš„é—®é¢˜</p><pre><code class="hljs cpp"><span class="hljs-comment">// get Q</span><span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; <span class="hljs-title">expand_distribution</span><span class="hljs-params">(threshold, <span class="hljs-number">0</span>)</span></span>;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;target_bin; i++) &#123;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> start = i * num_per_bin;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> end = start + num_per_bin;    <span class="hljs-keyword">float</span> count = <span class="hljs-number">0</span>;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> left_upper = <span class="hljs-built_in">ceil</span>(start);    <span class="hljs-keyword">float</span> left_scale = <span class="hljs-number">0</span>;    <span class="hljs-keyword">if</span> (left_upper &gt; start)     &#123;        left_scale = left_upper - start;        <span class="hljs-keyword">if</span> (distribution[left_upper - <span class="hljs-number">1</span>] != <span class="hljs-number">0</span>)         &#123;            count += left_scale;        &#125;    &#125;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> right_lower = <span class="hljs-built_in">floor</span>(end);    <span class="hljs-keyword">float</span> right_scale = <span class="hljs-number">0</span>;    <span class="hljs-keyword">if</span> (right_lower &lt; end)     &#123;        right_scale = end - right_lower;        <span class="hljs-keyword">if</span> (distribution[right_lower] != <span class="hljs-number">0</span>)         &#123;            count += right_scale;        &#125;    &#125;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j=left_upper; j&lt;right_lower; j++)     &#123;        <span class="hljs-keyword">if</span> (distribution[j] != <span class="hljs-number">0</span>)         &#123;            count++;        &#125;    &#125;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> expand_value = quantize_distribution[i] / count;    <span class="hljs-keyword">if</span> (left_upper &gt; start)     &#123;        <span class="hljs-keyword">if</span> (distribution[left_upper - <span class="hljs-number">1</span>] != <span class="hljs-number">0</span>)         &#123;            expand_distribution[left_upper - <span class="hljs-number">1</span>] += expand_value * left_scale;  <span class="hljs-comment">// ä¸Šé‡‡æ ·è¿‡ç¨‹ä¸­ä¸€æ ·æœ‰å››èˆäº”å…¥çš„é—®é¢˜</span>        &#125;    &#125;    <span class="hljs-keyword">if</span> (right_lower &lt; end)     &#123;        <span class="hljs-keyword">if</span> (distribution[right_lower] != <span class="hljs-number">0</span>)         &#123;            expand_distribution[right_lower] += expand_value * right_scale;        &#125;    &#125;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j=left_upper; j&lt;right_lower; j++)     &#123;        <span class="hljs-keyword">if</span> (distribution[j] != <span class="hljs-number">0</span>)         &#123;            expand_distribution[j] += expand_value;        &#125;    &#125;&#125;</code></pre><p>â‘£. è®¡ç®—KLæ•£åº¦ï¼Œæ³¨æ„å½“Qä¸º0æ—¶ï¼ŒKLæ•£åº¦åªåŠ ä¸€ï¼ˆå­˜ç–‘ï¼Œä¸ç†è§£ï¼‰</p><pre><code class="hljs cpp"><span class="hljs-keyword">float</span> kl_divergence = compute_kl_divergence(t_distribution, expand_distribution);<span class="hljs-function"><span class="hljs-keyword">float</span> <span class="hljs-title">QuantizeData::compute_kl_divergence</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; &amp;dist_a, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; &amp;dist_b)</span> </span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> length = dist_a.size();    assert(dist_b.size() == length);    <span class="hljs-keyword">float</span> result = <span class="hljs-number">0</span>;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;length; i++)     &#123;        <span class="hljs-keyword">if</span> (dist_a[i] != <span class="hljs-number">0</span>)         &#123;            <span class="hljs-keyword">if</span> (dist_b[i] == <span class="hljs-number">0</span>)             &#123;                result += <span class="hljs-number">1</span>;   <span class="hljs-comment">// Qä¸º0æ—¶ï¼ŒKLæ•£åº¦åªåŠ ä¸€</span>            &#125;             <span class="hljs-keyword">else</span>             &#123;                result += dist_a[i] * <span class="hljs-built_in">log</span>(dist_a[i] / dist_b[i]);            &#125;        &#125;    &#125;    <span class="hljs-keyword">return</span> result;&#125;</code></pre><p>â‘¤. è½»æ¾æ„‰æ‚¦çš„æ‰¾æœ€å¤§å€¼</p><pre><code class="hljs cpp"><span class="hljs-keyword">if</span> (kl_divergence &lt; min_kl_divergence) &#123;    min_kl_divergence = kl_divergence;       target_threshold = threshold;   <span class="hljs-comment">// å®é™…ä¸Šæ˜¯num_bins</span>&#125;</code></pre><p><strong>c. è®¡ç®— Threshold å’Œ bins</strong></p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¾—åˆ°äº†KLæ•£åº¦æœ€å°çš„æ¡¶æ•°num_binsï¼Œå¯ä»¥é€šè¿‡ä¸‹è¿°å…¬å¼å¾—åˆ°Tå’ŒScaleï¼Œå°±ä¸‰è¡Œï¼š</p><pre><code class="hljs cpp">threshold = (<span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">float</span>&gt;(threshold_bin) + <span class="hljs-number">0.5f</span>) * histogram_interval;scale = <span class="hljs-number">127</span> / threshold;<span class="hljs-keyword">return</span> scale;</code></pre><p>æœ€åå°±æ˜¯å°†Scaleæ•°æ®å­˜ä¸‹æ¥ï¼Œå¾—åˆ°é‡åŒ–è¡¨äº†ã€‚</p><p><strong>æ€»ç»“ä¸€ä¸‹ä»¥ä¸Šçš„ä»£ç é€»è¾‘:</strong></p><p><img src="/2020/09/21/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-4/4.png" alt></p>]]></content>
    
    
    <categories>
      
      <category>DL_Deploy</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>rk3399ç³»ç»Ÿçƒ§å†™</title>
    <link href="/2020/09/18/rk3399%E7%B3%BB%E7%BB%9F%E7%83%A7%E5%86%99/"/>
    <url>/2020/09/18/rk3399%E7%B3%BB%E7%BB%9F%E7%83%A7%E5%86%99/</url>
    
    <content type="html"><![CDATA[<h4 id="ä¸€-ç›¸å…³å·¥å…·çš„å‡†å¤‡"><a href="#ä¸€-ç›¸å…³å·¥å…·çš„å‡†å¤‡" class="headerlink" title="ä¸€. ç›¸å…³å·¥å…·çš„å‡†å¤‡"></a>ä¸€. ç›¸å…³å·¥å…·çš„å‡†å¤‡</h4><ol><li>ä¸‹è½½ çƒ§å†™å·¥å…·:</li></ol><pre><code class="hljs shell">git clone https://github.com/rockchip-linux/rkbin.git</code></pre><ol><li>ä¸‹è½½ç›¸å…³çš„ ubuntu é•œåƒã€‚ä¸‹è½½åœ°å€  <a href="https://github.com/lanseyujie/tn3399_v3/release">https://github.com/lanseyujie/tn3399_v3/release</a></li></ol><h4 id="äºŒ-åˆ·æœº"><a href="#äºŒ-åˆ·æœº" class="headerlink" title="äºŒ. åˆ·æœº"></a>äºŒ. åˆ·æœº</h4><ol><li>æ¿å¡è¿›å…¥åˆ·æœºæ¨¡å¼</li></ol><p>è¿æ¥ usb-c å’Œ PC ä¸»æœºã€‚æ–­å¼€ç”µæºï¼Œ æŒ‰ä½ recovey é”®ï¼Œ ç„¶åæ’ä¸Šç”µæºï¼Œ è®©æ¿å¡è¿›å…¥åˆ·æœºæ¨¡å¼ã€‚</p><ol><li><p>çŸ­æ¥æ¿å¡åé¢çš„ä¸¤ä¸ªè§¦ç‚¹ï¼Œ è¿›å…¥ maskrom æ¨¡å¼ã€‚</p></li><li><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œ å°†ç›¸åº”çš„é•œåƒåˆ·å…¥ æ¿å¡</p><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> rkdeveloptool db rk<span class="hljs-number">3399</span>_loader_v<span class="hljs-number">1</span>.<span class="hljs-number">24</span>.<span class="hljs-number">126</span>.bin<span class="hljs-attribute">sudo</span> rkdeveloptool ef<span class="hljs-attribute">sudo</span> rkdeveloptool wl <span class="hljs-number">0</span>x<span class="hljs-number">0</span> system.img</code></pre></li></ol><h4 id="ä¸‰-ç™»å½•"><a href="#ä¸‰-ç™»å½•" class="headerlink" title="ä¸‰. ç™»å½•"></a>ä¸‰. ç™»å½•</h4><ol><li><p>é‡æ–°å¯åŠ¨å¼€ç”µè„‘ï¼Œ å°±å¯ä»¥è¿›å…¥ ubuntu ç³»ç»Ÿï¼Œ é»˜è®¤ç”¨æˆ·åæ˜¯ root  å¯†ç æ˜¯ 1234</p></li><li><p>åˆ†åŒºæ‰©å®¹</p><pre><code class="hljs shell">sudo apt install -y partedsudo parted /dev/mmcblk2unit sprintresizepart 5 100%printQsudo resize2fs /dev/mmcblk2p5</code></pre></li><li><p>å¯ä»¥å®‰è£… ç›¸å…³çš„æ¡Œé¢ç³»ç»Ÿï¼Œ ubuntu æ–°å¢è´¦å·å¾ªç¯ç™»é™†æ¡Œé¢ã€‚åªæ˜¯åœ¨æ·»åŠ æ–°ç”¨æˆ·çš„æ—¶å€™éœ€è¦ä½¿ç”¨</p></li></ol><pre><code class="hljs shell">useradd -m usrname # åŠ  m å‚æ•°ä¼šåˆ›å»ºä¸€ä¸ªåŒåæ–‡ä»¶å¤¹ï¼Œ å¦‚æœæ²¡æœ‰åˆ™ä¼šå¯¼è‡´å¾ªç¯ç™»å½•</code></pre><h4 id="å‚è€ƒç½‘å€"><a href="#å‚è€ƒç½‘å€" class="headerlink" title="å‚è€ƒç½‘å€:"></a>å‚è€ƒç½‘å€:</h4><p><a href="https://github.com/lanseyujie/tn3399_v3">https://github.com/lanseyujie/tn3399_v3</a>     # å¾ˆé½å…¨çš„èµ„æ–™åŒ…</p><p><a href="https://naivekun.tk/">https://naivekun.tk/</a></p>]]></content>
    
    
    <categories>
      
      <category>åµŒå…¥å¼ç›¸å…³</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ncnnæºç åˆ†æ_3</title>
    <link href="/2020/09/17/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-3/"/>
    <url>/2020/09/17/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-3/</url>
    
    <content type="html"><![CDATA[<p>ncnn æºç åˆ†æ æ¨¡å‹é‡åŒ–åŸç†</p><a id="more"></a><h4 id="1-FP32-vs-int8"><a href="#1-FP32-vs-int8" class="headerlink" title="1. FP32 vs int8"></a>1. FP32 vs int8</h4><p>â€‹     æ¥çœ‹ä¸€ä¸‹ <strong>FP32ã€FP16å’Œint8</strong>ä¹‹é—´çš„åŠ¨æ€èŒƒå›´å’Œç²¾åº¦çš„å¯¹æ¯”ï¼Œ å¯ä»¥çœ‹åˆ°float32 çš„å–å€¼èŒƒå›´å‡ ä¹æ˜¯æ— ç©·çš„ï¼Œ è€Œint8åªæœ‰<strong>-128~127</strong>. å› æ­¤éœ€è¦å»ºç«‹æ˜ å°„å…³ç³»å°†float32ç±»å‹çš„æµ®ç‚¹æ•°æ˜ å°„åˆ°æŒ‡å®šèŒƒå›´çš„int8ç±»å‹ã€‚ </p><p><img src="/2020/09/17/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-3/ncnn1.png" alt></p><h4 id="2-TensorRT-int8-é‡åŒ–æ–¹æ¡ˆ"><a href="#2-TensorRT-int8-é‡åŒ–æ–¹æ¡ˆ" class="headerlink" title="2. TensorRT int8 é‡åŒ–æ–¹æ¡ˆ"></a>2. TensorRT int8 é‡åŒ–æ–¹æ¡ˆ</h4><p>Nvidia çš„ TensorRTæä¾›äº†ä¸€ç§é‡åŒ–æ–¹æ¡ˆï¼Œä½†æ˜¯å®ƒä»…ä»…æä¾›ç›¸åº”çš„SDKå’Œè§£å†³æ–¹æ¡ˆï¼Œ æ²¡æœ‰å…¬å¸ƒå¯¹åº”çš„æºä»£ç ï¼Œ è¯¸å¤šç¬¬ä¸‰æ–¹å‚å®¶åˆ™æ ¹æ®è¯¥è§£å†³æ–¹æ¡ˆè‡ªå·±é€ è½®å­ï¼Œäº§ç”Ÿäº†å¯¹åº”çš„è§£å†³æ–¹æ¡ˆã€‚è¯¥é‡åŒ–æ–¹æ¡ˆçš„æœ€é‡è¦çš„ä¸¤ä»½å‚è€ƒèµ„æ–™å¦‚ä¸‹æ‰€ç¤º:</p><p>- TensorRT Develop guide: <a href="https://docs.nvidia.com/deeplearning/sdk/tensorrt-developer-guide/index.html#work-with-qat-networks">https://docs.nvidia.com/deeplearning/sdk/tensorrt-developer-guide/index.html#work-with-qat-networks</a></p><p>- PDF é“¾æ¥ï¼š <a href="http://on-demand.gputechconf.com/gtc/2017/presentation/s7310-8-bit-inference-with-tensorrt.pdf">http://on-demand.gputechconf.com/gtc/2017/presentation/s7310-8-bit-inference-with-tensorrt.pdf</a></p><p><strong>(1)</strong> <strong>max-max æ˜ å°„</strong>ï¼š æœ€ç®€å•ç²—æš´çš„æ–¹å¼å¦‚ä¸‹å·¦å›¾æ‰€ç¤º</p><p>â€‹    é¦–å…ˆæ±‚å‡ºä¸€ä¸ªlaye çš„æ¿€æ´»å€¼èŒƒå›´ï¼Œ ç„¶åæŒ‰ç…§ç»å¯¹å€¼çš„æœ€å¤§å€¼ä½œä¸ºé˜ˆå€¼ï¼Œ ç„¶åæŠŠè¿™ä¸ªèŒƒå›´æŒ‰ç…§æ¯”ä¾‹æ˜ å°„åˆ°-127åˆ°128çš„èŒƒå›´å†…, å…¶fp32å’Œint8çš„è½¬æ¢å…¬å¼ä¸º:</p><p><strong>FP32 Tensor (T) = scale_factor(sf) * 8-bit Tensor(t) + FP32_bias (b)</strong> </p><p>é€šè¿‡å®éªŒå¾—çŸ¥ï¼Œbiaså€¼å»æ‰å¯¹ç²¾åº¦çš„å½±å“ä¸æ˜¯å¾ˆå¤§ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥å»æ‰, æ‰€ä»¥è¯¥å…¬å¼å¯ä»¥ç®€åŒ–ä¸º:</p><p><strong>T = sf * t</strong></p><p><img src="/2020/09/17/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-3/ncnn2.png" alt></p><p><strong>(2) é¥±å’Œæ˜ å°„</strong></p><p>â€‹    å¦‚ä¸Šæ–¹æ³•ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼š<strong>ä¸é¥±å’Œï¼Œå³é€šå¸¸åœ¨æ­£è´Ÿä¸Šä¼šæœ‰ä¸€äº›é‡åŒ–å€¼æœªè¢«åˆ©ç”¨ï¼Œä¸”ä¼šäº§ç”Ÿçš„ç²¾åº¦æŸå¤±è¾ƒå¤§ã€‚</strong>é’ˆå¯¹ max-max æ˜ å°„å­˜åœ¨çš„é—®é¢˜ï¼Œ TensorRTæå‡ºäº†å¦‚ä¸Šå³å›¾çš„é¥±å’Œæ˜ å°„ã€‚ <strong>é€‰å–ä¸€ä¸ªé˜ˆå€¼Tï¼Œç„¶åå°† -|T|~|T| ä¹‹é—´çš„å€¼æ˜ å°„åˆ° -127 åˆ° 128 è¿™ä¸ªèŒƒå›´å†…ã€‚è¿™æ ·ç¡®å®šäº†é˜ˆå€¼Tä¹‹åï¼Œå…¶å®ä¹Ÿèƒ½ç¡®å®šScaleï¼Œä¸€ä¸ªç®€å•çš„çº¿æ€§å…¬å¼æ˜¯: Scale = T/127ã€‚ æ‰€ä»¥è¦è®¡ç®—Scaleï¼Œåªè¦æ‰¾åˆ°åˆé€‚çš„é˜ˆå€¼Tå°±å¯ä»¥äº†ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒTåº”è¯¥å–ä½•å€¼? å…¶åŸºæœ¬æµç¨‹å¦‚ä¸‹:</strong></p><p>â€‹    <strong>(a) é€‰å–ä¸åŒçš„ T é˜ˆå€¼è¿›è¡Œé‡åŒ–, å°† P(fp32) æ˜ å°„åˆ° Q(int8)ã€‚</strong></p><p>â€‹    <strong>(b) å°† Q(int8) åé‡åŒ–åˆ° P(fp32) ä¸€æ ·é•¿åº¦ï¼Œå¾—åˆ°åˆ†å¸ƒ Q_expandï¼›</strong></p><p>â€‹    <strong>(c) è®¡ç®—På’ŒQ_expand çš„ç›¸å¯¹ç†µ(KLæ•£åº¦)ï¼Œç„¶åé€‰æ‹©ç›¸å¯¹ç†µæœ€å°‘çš„ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯è·ŸåŸåˆ†å¸ƒæœ€åƒçš„ä¸€ä¸ª,</strong> <strong>ä»è€Œç¡®å®šScale**</strong>ã€‚**</p><p><strong>(3) KL æ•£åº¦</strong></p><p>â€‹    KLæ•£åº¦å¯ä»¥ç”¨æ¥<strong>æè¿°Pã€Qä¸¤ä¸ªåˆ†å¸ƒçš„å·®å¼‚</strong>ã€‚<strong>æ•£åº¦è¶Šå°ï¼Œä¸¤ä¸ªåˆ†å¸ƒçš„å·®å¼‚è¶Šå°ï¼Œæ¦‚ç‡å¯†åº¦å‡½æ•°å½¢çŠ¶å’Œæ•°å€¼è¶Šæ¥è¿‘</strong>ã€‚è¿™é‡Œçš„æ‰€æœ‰åˆ†å¸ƒã€è®¡ç®—ï¼Œéƒ½æ˜¯ç¦»æ•£å½¢å¼çš„ã€‚åˆ†å¸ƒæ˜¯ä»¥ç»Ÿè®¡ç›´æ–¹å›¾çš„æ–¹å¼å­˜åœ¨ï¼ŒKLæ•£åº¦å…¬å¼ä¹Ÿæ˜¯ç¦»æ•£å…¬å¼ï¼š</p><p><img src="/2020/09/17/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-3/ncnn5.png" alt></p><p>ä»ä¸Šå¼ä¸­æˆ‘ä»¬è¿˜å‘ç°ä¸€ä¸ªé—®é¢˜ï¼šKLæ•£åº¦è®¡ç®—å…¬å¼è¦æ±‚Pã€Qä¸¤ä¸ªç»Ÿè®¡ç›´æ–¹å›¾é•¿åº¦ä¸€æ ·ï¼ˆä¹Ÿå°±æ˜¯binsçš„æ•°é‡ä¸€æ ·ï¼‰ã€‚Qä¸€ç›´éƒ½æ˜¯-127ï½127ï¼›å¯æ˜¯Pçš„æ•°é‡ä¼šéšç€Tçš„å˜åŒ–è€Œå˜åŒ–ã€‚é‚£è¿™æ€ä¹ˆåšKLæ•£åº¦å‘¢ï¼Ÿ</p><p>ncnn çš„åšæ³•æ˜¯å°† Qæ‰©å±•åˆ°å’ŒPä¸€æ ·çš„é•¿åº¦ï¼Œä¸‹é¢ä¸¾ä¸ªä¾‹å­(NVIDIA PPTä¸­çš„ä¾‹å­)ï¼š</p><pre><code class="hljs cpp">P = [<span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">5</span> <span class="hljs-number">3</span> <span class="hljs-number">1</span> <span class="hljs-number">7</span>]     <span class="hljs-comment">// fp32çš„ç»Ÿè®¡ç›´æ–¹å›¾ï¼ŒT=8</span><span class="hljs-comment">// å‡è®¾åªé‡åŒ–åˆ°ä¸¤ä¸ªbinsï¼Œå³é‡åŒ–åçš„å€¼åªæœ‰-1/0/+1ä¸‰ç§</span>Q=[<span class="hljs-number">1</span>+<span class="hljs-number">0</span>+<span class="hljs-number">2</span>+<span class="hljs-number">3</span>, <span class="hljs-number">5</span>+<span class="hljs-number">3</span>+<span class="hljs-number">1</span>+<span class="hljs-number">7</span>] = [<span class="hljs-number">6</span>, <span class="hljs-number">16</span>]<span class="hljs-comment">// På’ŒQç°åœ¨æ²¡æ³•åšKLæ•£åº¦ï¼Œæ‰€ä»¥è¦å°†Qæ‰©å±•åˆ°å’ŒPä¸€æ ·çš„é•¿åº¦</span>Q_expand = [<span class="hljs-number">6</span>/<span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">6</span>/<span class="hljs-number">3</span>, <span class="hljs-number">6</span>/<span class="hljs-number">3</span>, <span class="hljs-number">16</span>/<span class="hljs-number">4</span>, <span class="hljs-number">16</span>/<span class="hljs-number">4</span>, <span class="hljs-number">16</span>/<span class="hljs-number">4</span>, <span class="hljs-number">16</span>/<span class="hljs-number">4</span>] = [<span class="hljs-number">2</span> <span class="hljs-number">0</span> <span class="hljs-number">2</span> <span class="hljs-number">2</span> <span class="hljs-number">4</span> <span class="hljs-number">4</span> <span class="hljs-number">4</span> <span class="hljs-number">4</span>]  <span class="hljs-comment">// Pä¸­æœ‰0æ—¶ï¼Œä¸ç®—åœ¨å†…</span>D = KL(P||Q_expand)  <span class="hljs-comment">// è¿™æ ·å°±å¯ä»¥åšKLæ•£åº¦è®¡ç®—äº†</span></code></pre><p>â€‹    è¿™ä¸ªæ‰©å±•çš„æ“ä½œï¼Œå°±åƒå›¾åƒçš„ä¸Šé‡‡æ ·ä¸€æ ·ï¼Œå°†ä½ç²¾åº¦çš„ç»Ÿè®¡ç›´æ–¹å›¾(Q)ï¼Œä¸Šé‡‡æ ·çš„é«˜ç²¾åº¦çš„ç»Ÿè®¡ç›´æ–¹å›¾ä¸Šå»(Q_expand)ã€‚ç”±äºQä¸­ä¸€ä¸ªbinå¯¹åº”Pä¸­çš„4ä¸ªbinï¼Œå› æ­¤åœ¨Qä¸Šé‡‡æ ·çš„Q_expandçš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„æ•°æ®è¦é™¤ä»¥4ã€‚å¦å¤–ï¼Œåœ¨è®¡ç®—fp32çš„åˆ†å¸ƒPæ—¶ï¼Œè¢«Tæˆªæ–­çš„æ•°æ®ï¼Œæ˜¯è¦ç®—åœ¨æœ€åä¸€ä¸ªbiné‡Œé¢çš„ã€‚</p><h4 id="3-ncnnçš„convé‡åŒ–è®¡ç®—æµç¨‹"><a href="#3-ncnnçš„convé‡åŒ–è®¡ç®—æµç¨‹" class="headerlink" title="3. ncnnçš„convé‡åŒ–è®¡ç®—æµç¨‹"></a>3. ncnnçš„convé‡åŒ–è®¡ç®—æµç¨‹</h4><p>æ­£å¸¸çš„ fp32 è®¡ç®—ä¸­ï¼Œ ä¸€ä¸ªconv çš„è®¡ç®—æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼Œ æ‰€æœ‰çš„æ•°æ®å‡æ˜¯ fp32ï¼Œ æ²¡ä»€ä¹ˆç‰¹æ®Šçš„</p><p><img src="/2020/09/17/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-3/ncnn3.png" alt="fp32 convè®¡ç®—æµç¨‹"></p><p>åœ¨ ncnn conv è¿›è¡ŒInt8è®¡ç®—æ—¶ï¼Œ è®¡ç®—æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼Œncnné¦–å…ˆ<strong>å°†è¾“å…¥(bottom_blob)å’Œæƒé‡é‡åŒ–æˆInt8ï¼Œåœ¨Int8ä¸‹è®¡ç®—å·ç§¯ï¼Œç„¶ååé‡åŒ–åˆ° fp32ï¼Œå†å’Œæœªé‡åŒ–çš„biasç›¸åŠ ï¼Œå¾—åˆ°è¾“å‡º top_blob</strong>(ncnnå¹¶æ²¡æœ‰å¯¹biasåšé‡åŒ–)</p><p><img src="/2020/09/17/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-3/ncnn4.png" alt="int8 conv è®¡ç®—æµç¨‹ï¼Œ åœ¨convå‰ï¼Œ å¯¹inputå’Œweightåšé‡åŒ–ï¼Œ è®¡ç®—å®Œååé‡åŒ–åˆ° fp32, å†åŠ  bias"></p><p>è¾“å…¥å’Œæƒé‡çš„<strong>é‡åŒ–å…¬å¼</strong>ä¸º:</p><pre><code class="hljs cpp">bottom_blob(int8) = bottom_blob_in8t_scale * bottom(fp32)weight_blob(int8) = weight_data_int8_scale * weight(fp32)</code></pre><p><strong>åé‡åŒ–</strong>çš„ç›®çš„æ˜¯å°†int8æ˜ å°„å›åˆ°åŸæ¥çš„fp32,èŒƒå›´ä¿æŒè¦ä¸€è‡´, ç”±äº weight_blob(int8) å’Œ bottom_blob(int8) ç›¸ä¹˜ï¼Œ æ‰€ä»¥æ­¤å¤„çš„é‡åŒ–åé‡åŒ–çš„ scale åº”è¯¥ä¸º:</p><pre><code class="hljs cpp">dequantize_scale = <span class="hljs-number">1</span>/(bottom_blob_int8_scale * weight_data_int8_scale)innner_blob(fp32) = dequantize_scale * inner_blob</code></pre><p><strong>! å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ æƒé‡æ˜¯åœ¨ç½‘ç»œåˆå§‹åŒ–æ—¶å€™å°±è¿›è¡Œé‡åŒ–äº†ï¼Œ è€Œè¾“å…¥åˆ™æ˜¯åœ¨å‰å‘æ¨å¯¼æ—¶è¿›è¡Œé‡åŒ–ã€‚</strong></p><h4 id="4-ncnn-é‡åŒ–å·¥å…·çš„ä½¿ç”¨"><a href="#4-ncnn-é‡åŒ–å·¥å…·çš„ä½¿ç”¨" class="headerlink" title="4. ncnn é‡åŒ–å·¥å…·çš„ä½¿ç”¨"></a>4. <strong>ncnn é‡åŒ–å·¥å…·çš„ä½¿ç”¨</strong></h4><p>(1) <strong>Optimization graphic å›¾ä¼˜åŒ–: æœ€æ˜æ˜¾çš„å˜åŒ–æ˜¯å°†convå±‚å’Œbnå±‚è¿›è¡Œåˆå¹¶</strong></p><pre><code class="hljs shell">./ncnnoptimize mobilenet-fp32.param mobilenet-fp32.bin mobilenet-nobn-fp32.param mobilenet-nobn-fp32.bin</code></pre><p><strong>(2) Create the calibration table file(å»ºè®®ä½¿ç”¨è¶…è¿‡5000å¼ å›¾ç‰‡çš„éªŒè¯é›†è¿›è¡Œå¯¹é½): è®¡ç®—äº§ç”Ÿå¯¹åº”çš„ scale</strong></p><pre><code class="hljs shell">./ncnn2table --param mobilenet-nobn-fp32.param --bin mobilenet-nobn-fp32.bin --images images/ --output mobilenet-nobn.table --mean 104,117,123 --norm 0.017,0.017,0.017 --size 224,224 --thread 2</code></pre><p><strong>(3) Quantizationï¼šé‡åŒ–</strong></p><pre><code class="hljs shell">./ncnn2int8 mobilenet-nobn-fp32.param mobilenet-nobn-fp32.bin mobilenet-int8.param mobilenet-int8.bin mobilenet-nobn.table</code></pre><h4 id="5-å‚è€ƒèµ„æ–™"><a href="#5-å‚è€ƒèµ„æ–™" class="headerlink" title="5. å‚è€ƒèµ„æ–™"></a>5. å‚è€ƒèµ„æ–™</h4><p>[1] <a href="https://me.csdn.net/sinat_31425585">https://me.csdn.net/sinat_31425585</a></p><p>[2] <a href="https://zhuanlan.zhihu.com/c_1064124187198705664">https://zhuanlan.zhihu.com/c_1064124187198705664</a></p><p>[3] <a href="https://github.com/BUG1989/caffe-int8-convert-tools">https://github.com/BUG1989/caffe-int8-convert-tools</a></p><p>[4] <a href="https://github.com/Tencent/ncnn/wiki/quantized-int8-inference">Tencent/ncnn</a></p><p>[5] QNNPACK</p><p>[6] Nvidia solutionï¼š Szymon Migacz. 8-bit Inference with TensorRT</p><p>[7] Google solutionï¼šQuantizing deep convolutional networks for efficient inference: A whitepaper</p>]]></content>
    
    
    <categories>
      
      <category>DL_Deploy</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ncnnæºç åˆ†æ_2</title>
    <link href="/2020/09/17/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-2/"/>
    <url>/2020/09/17/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-2/</url>
    
    <content type="html"><![CDATA[<p>ncnn æºç åˆ†æï¼ˆäºŒï¼‰ Extractor</p><a id="more"></a><p>å‰é¢å¤§è‡´æ€»ç»“äº†ä¸€ä¸‹ncnnæ¨¡å‹è½½å…¥çš„æµç¨‹ï¼Œæ¨¡å‹è½½å…¥ä¹‹åï¼Œå°±æ˜¯æ–°å»ºä¸€ä¸ª<strong>Extractor</strong>ï¼Œç„¶åè®¾ç½®è¾“å…¥ï¼Œè·å–è¾“å‡ºï¼š</p><pre><code class="hljs cpp">ncnn::Extractor ex = net.create_extractor();ex.set_num_threads(<span class="hljs-number">4</span>); ex.input(<span class="hljs-string">&quot;data&quot;</span>, in); ncnn::Mat out;ex.extract(<span class="hljs-string">&quot;detection_out&quot;</span>, out);</code></pre><p>ç°åœ¨å¯ä»¥çœ‹ä¸€ä¸‹Extractorçš„å®šä¹‰äº†ï¼š</p><pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Extractor</span></span><span class="hljs-class">&#123;</span><span class="hljs-keyword">public</span>:    <span class="hljs-comment">// enable light mode, intermediate blob will be recycled when enabled</span>    <span class="hljs-comment">// enabled by default</span>    <span class="hljs-comment">// è®¾ç½®lightæ¨¡å¼ï¼Œå¯ç”¨æ—¶ä¸­é—´ blob å°†ä¼šå¾ªç¯åˆ©ç”¨</span>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_light_mode</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> enable)</span></span>;     <span class="hljs-comment">// set thread count for this extractor, è®¾ç½®çº¿ç¨‹æ•°</span>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_num_threads</span><span class="hljs-params">(<span class="hljs-keyword">int</span> num_threads)</span></span>;     <span class="hljs-comment">// set blob memory allocator, è®¾ç½®blobçš„å†…å­˜åˆ†é…å™¨</span>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_blob_allocator</span><span class="hljs-params">(Allocator* allocator)</span></span>;     <span class="hljs-comment">// set workspace memory allocator, è®¾ç½®å·¥ä½œç©ºé—´çš„å†…å­˜åˆ†é…å™¨</span>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_workspace_allocator</span><span class="hljs-params">(Allocator* allocator)</span></span>;  <span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> NCNN_STRING</span>    <span class="hljs-comment">// set input by blob name</span>    <span class="hljs-comment">// return 0 if success</span>    <span class="hljs-comment">// è®¾ç½®ç½‘ç»œè¾“å…¥ï¼šå­—ç¬¦ä¸²layerå</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">input</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* blob_name, <span class="hljs-keyword">const</span> Mat&amp; in)</span></span>;     <span class="hljs-comment">// get result by blob name</span>    <span class="hljs-comment">// return 0 if success</span>    <span class="hljs-comment">// è®¾ç½®æå–å™¨çš„è¾“å…¥ï¼šå¾—åˆ°å¯¹åº”è¾“å‡º</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">extract</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* blob_name, Mat&amp; feat)</span></span>;<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// NCNN_STRING</span></span>     <span class="hljs-comment">// set input by blob index</span>    <span class="hljs-comment">// return 0 if success</span>    <span class="hljs-comment">// è®¾ç½®intç±»å‹blobç´¢å¼•åŠè¾“å…¥</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">input</span><span class="hljs-params">(<span class="hljs-keyword">int</span> blob_index, <span class="hljs-keyword">const</span> Mat&amp; in)</span></span>;     <span class="hljs-comment">// get result by blob index</span>    <span class="hljs-comment">// return 0 if success</span>    <span class="hljs-comment">// è®¾ç½®intç±»å‹blobç´¢å¼•åŠè¾“å‡º</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">extract</span><span class="hljs-params">(<span class="hljs-keyword">int</span> blob_index, Mat&amp; feat)</span></span>; <span class="hljs-keyword">protected</span>:    <span class="hljs-comment">// å¯¹å¤–æä¾›create_extractoræ¥å£</span>    <span class="hljs-function"><span class="hljs-keyword">friend</span> Extractor <span class="hljs-title">Net::create_extractor</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span>;    Extractor(<span class="hljs-keyword">const</span> Net* net, <span class="hljs-keyword">int</span> blob_count); <span class="hljs-keyword">private</span>:    <span class="hljs-comment">// ç½‘ç»œ </span>    <span class="hljs-keyword">const</span> Net* net;    <span class="hljs-comment">// blobçš„ mat</span>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Mat&gt; blob_mats;    <span class="hljs-comment">// é€‰é¡¹</span>    Option opt; &#125;;</code></pre><p>é™¤äº†è®¾ç½®optionçš„æ¥å£ä¹‹å¤–ï¼Œå°±åªå‰©ä¸‹æˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„å‡ ä¸ªæ¥å£å‡½æ•°äº†ï¼š</p><p><strong>(1) Extractor</strong></p><pre><code class="hljs cpp"><span class="hljs-comment">// åˆ›å»ºExtractor</span><span class="hljs-function">Extractor <span class="hljs-title">Net::create_extractor</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">return</span> Extractor(<span class="hljs-keyword">this</span>, blobs.size());&#125;</code></pre><p>å†…éƒ¨è°ƒç”¨äº†æ¥å£ä¸ºï¼Œå°±æ˜¯å°†blob_matæ•°ç»„resizeåˆ°ç½‘ç»œçš„blobæ•°ç›®å¤§å°ï¼Œç„¶åè®¾ç½®äº†ä¸€ä¸‹é€‰é¡¹ï¼š</p><pre><code class="hljs cpp"><span class="hljs-comment">// æ‰§è¡Œå™¨</span>Extractor::Extractor(<span class="hljs-keyword">const</span> Net* _net, <span class="hljs-keyword">int</span> blob_count) : net(_net)&#123;    blob_mats.resize(blob_count);    opt = net-&gt;opt;&#125;</code></pre><p><strong>(2) inputæ¥å£ï¼š</strong></p><pre><code class="hljs cpp"><span class="hljs-comment">// è®¾ç½®è¾“å…¥</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Extractor::input</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* blob_name, <span class="hljs-keyword">const</span> Mat&amp; in)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-comment">// è·å–è¾“å…¥æ¨¡å—å¯¹åº”index</span>    <span class="hljs-keyword">int</span> blob_index = net-&gt;find_blob_index_by_name(blob_name);    <span class="hljs-keyword">if</span> (blob_index == <span class="hljs-number">-1</span>)        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;     <span class="hljs-comment">// è°ƒç”¨ç›´æ¥ç”¨indexçš„è®¾ç½®inputæ–¹æ³•</span>    <span class="hljs-keyword">return</span> input(blob_index, in);&#125;</code></pre><p>å†…éƒ¨è°ƒç”¨çš„æ¥å£ä¸ºï¼š</p><pre><code class="hljs cpp"><span class="hljs-comment">// è¾“å…¥ä¸ºindexçš„è¾“å…¥æ¥å£</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Extractor::input</span><span class="hljs-params">(<span class="hljs-keyword">int</span> blob_index, <span class="hljs-keyword">const</span> Mat&amp; in)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span> (blob_index &lt; <span class="hljs-number">0</span> || blob_index &gt;= (<span class="hljs-keyword">int</span>)blob_mats.size())        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;     <span class="hljs-comment">// è®¾ç½®blob_indexå¯¹åº” Mat</span>    blob_mats[blob_index] = in;     <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p><strong>(3) extractæ¥å£ï¼š</strong></p><pre><code class="hljs cpp"><span class="hljs-comment">// å°†è¾“å…¥stringç±»å‹nameè½¬æ¢æˆå¯¹åº”çš„ç´¢å¼•</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Extractor::extract</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* blob_name, VkMat&amp; feat, VkCompute&amp; cmd)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">int</span> blob_index = net-&gt;find_blob_index_by_name(blob_name);    <span class="hljs-keyword">if</span> (blob_index == <span class="hljs-number">-1</span>)        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;     <span class="hljs-keyword">return</span> extract(blob_index, feat, cmd);&#125;</code></pre><p>è¿™é‡Œè°ƒç”¨çš„æ¥å£ä¸ºï¼š</p><pre><code class="hljs cpp"><span class="hljs-comment">// æå–ç‰¹å¾</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Extractor::extract</span><span class="hljs-params">(<span class="hljs-keyword">int</span> blob_index, Mat&amp; feat)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span> (blob_index &lt; <span class="hljs-number">0</span> || blob_index &gt;= (<span class="hljs-keyword">int</span>)blob_mats.size())        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;     <span class="hljs-keyword">int</span> ret = <span class="hljs-number">0</span>;        <span class="hljs-keyword">if</span> (blob_mats[blob_index].dims == <span class="hljs-number">0</span>)     <span class="hljs-comment">// å¦‚æœè¾“å‡ºblobä¸ºç©º</span>    &#123;        <span class="hljs-keyword">int</span> layer_index = net-&gt;blobs[blob_index].producer;  <span class="hljs-comment">// æŸ¥æ‰¾è¾“å‡ºblobå¯¹åº”çš„ç”Ÿäº§è€…</span>        ret = net-&gt;forward_layer(layer_index, blob_mats, opt);   <span class="hljs-comment">// å‰å‘æ¨ç†</span>    &#125;    feat = blob_mats[blob_index];   <span class="hljs-comment">// è¾“å‡ºç‰¹å¾</span>     <span class="hljs-keyword">if</span> (opt.use_packing_layout)   <span class="hljs-comment">// å¯¹ç‰¹å¾è¿›è¡Œunpack</span>    &#123;        Mat bottom_blob_unpacked;        convert_packing(feat, bottom_blob_unpacked, <span class="hljs-number">1</span>, opt);        feat = bottom_blob_unpacked;    &#125;     <span class="hljs-keyword">return</span> ret;&#125;</code></pre><p>â€‹    è¿™é‡Œå°±æ˜¯è°ƒç”¨å„å±‚å‰å‘æ¨ç†forward_layeræ–¹æ³•æ¥è¿›è¡Œæ¨ç†çš„ï¼Œè¿™ä¸ªå¯¹åº”äºç‰¹å®šå±‚çš„æ¨ç†è¿‡ç¨‹ï¼Œåé¢æ€»ç»“å„ä¸ªå±‚çš„æ—¶å€™å†è¯´ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>DL_Deploy</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ncnnæºç åˆ†æ_1</title>
    <link href="/2020/09/17/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-1/"/>
    <url>/2020/09/17/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-1/</url>
    
    <content type="html"><![CDATA[<p>ncnn æºç åˆ†æ â€” å‚æ•°ä¸æ¨¡å‹è½½å…¥</p><a id="more"></a><h4 id="1-å®ä¾‹ä»£ç "><a href="#1-å®ä¾‹ä»£ç " class="headerlink" title="1. å®ä¾‹ä»£ç "></a>1. å®ä¾‹ä»£ç </h4><p>ä½¿ç”¨ncnnè¿›è¡Œå‰å‘è®¡ç®—çš„æ­¥éª¤å¾ˆç®€å•ï¼Œå°±å¦‚ä¸‹å‡ è¡Œä»£ç å³å¯å®Œæˆã€‚</p><pre><code class="hljs cpp"> <span class="hljs-comment">// ä»£ç æ¥è‡ª ncnn/examples/shufflenetv2.cpp</span> <span class="hljs-comment">/* Step 1.1 : åŠ è½½.parma æ–‡ä»¶ å’Œ .bin æ–‡ä»¶ */</span> ncnn::Net shufflenetv2; shufflenetv2.load_param(<span class="hljs-string">&quot;shufflenet_v2_x0.5.param&quot;</span>); shufflenetv2.load_model(<span class="hljs-string">&quot;shufflenet_v2_x0.5.bin&quot;</span>); <span class="hljs-comment">/* Step 1.2 : æ„å»ºå¹¶é…ç½® æå–å™¨ */</span> ncnn::Extractor ex = shufflenetv2.create_extractor(); <span class="hljs-comment">/* Step 1.3 : è®¾ç½®è¾“å…¥ï¼ˆå°†å›¾ç‰‡è½¬æ¢æˆncnn::Matç»“æ„ä½œä¸ºè¾“å…¥ï¼‰ */</span>    ncnn::Mat in = ncnn::Mat::from_pixels_resize(bgr.data, ncnn::Mat::PIXEL_BGR, bgr.cols, bgr.rows, <span class="hljs-number">224</span>, <span class="hljs-number">224</span>);<span class="hljs-keyword">const</span> <span class="hljs-keyword">float</span> norm_vals[<span class="hljs-number">3</span>] = &#123;<span class="hljs-number">1</span>/<span class="hljs-number">255.f</span>, <span class="hljs-number">1</span>/<span class="hljs-number">255.f</span>, <span class="hljs-number">1</span>/<span class="hljs-number">255.f</span>&#125;;in.substract_mean_normalize(<span class="hljs-number">0</span>, norm_vals);ex.input(<span class="hljs-string">&quot;data&quot;</span>, in);        <span class="hljs-comment">/* Step 1.4 : æå–è¾“å‡º */</span> ncnn::Mat out;ex.extract(<span class="hljs-string">&quot;fc&quot;</span>, out);</code></pre><h4 id="2-ä»£ç åˆ†æ"><a href="#2-ä»£ç åˆ†æ" class="headerlink" title="2. ä»£ç åˆ†æ"></a>2. ä»£ç åˆ†æ</h4><p><strong>æˆ‘å§‘ä¸”å°†å…¶åˆ†ä¸ºï¼šåŠ è½½æ¨¡å‹</strong>ã€<strong>æ„å»ºå¹¶é…ç½®æå–å™¨</strong>ã€<strong>è®¾ç½®è¾“å…¥</strong>ã€<strong>è¾“å‡ºå¤„ç†</strong>ã€<strong>æ¨¡å‹å°è£…</strong>äº”ä¸ªéƒ¨åˆ†æ¥åŠ ä»¥åˆ†æ</p><p><strong>æ¨¡å‹è½½å…¥</strong>:</p><p><strong>ç›¸å…³ä»£ç :</strong></p><p><strong>net.h/cpp</strong>   <strong>blob.h/cpp</strong>   <strong>layer.h/.cpp</strong>  </p><p>â€‹    <strong>paramdict.cpp/h</strong>  </p><p>â€‹    <strong>modelbin.h/.cpp</strong></p><p><strong>ç›¸å…³æ–‡ä»¶:</strong></p><p>xx.bin  xx.param</p><h4 id="3-åŠ è½½æ¨¡å‹"><a href="#3-åŠ è½½æ¨¡å‹" class="headerlink" title="3. åŠ è½½æ¨¡å‹"></a>3. åŠ è½½æ¨¡å‹</h4><p>ncnn åœ¨ä½¿ç”¨ <strong>.param</strong> å’Œ <strong>.bin</strong> ä¸¤ä¸ªæ–‡ä»¶æ¥æè¿°ä¸€ä¸ªç¥ç»ç½‘ç»œæ¨¡å‹ã€‚ æ¨¡å‹åŠ è½½çš„æ ¹æœ¬ç›®çš„æ˜¯å°† .param å’Œ .bin æ–‡ä»¶çš„ä¿¡æ¯åŠ è½½åˆ°ç›®æ ‡ç¥ç»ç½‘ç»œï¼ˆä¸€ä¸ªncnn::Netç»“æ„ï¼‰ä¸­</p><p>å…¶ä¸­ï¼š</p><p><strong>.param</strong>ï¼šæè¿°ç¥ç»ç½‘ç»œçš„ç»“æ„ï¼ŒåŒ…æ‹¬å±‚åç§°ï¼Œå±‚è¾“å…¥è¾“å‡ºä¿¡æ¯ï¼Œå±‚å‚æ•°ä¿¡æ¯ï¼ˆå¦‚å·ç§¯å±‚çš„kernalå¤§å°ç­‰ï¼‰ç­‰ã€‚</p><p><strong>.bin</strong> æ–‡ä»¶åˆ™è®°å½•ç¥ç»ç½‘ç»œè¿ç®—æ‰€éœ€è¦çš„æ•°æ®ä¿¡æ¯ï¼ˆæ¯”å¦‚å·ç§¯å±‚çš„æƒé‡ã€åç½®ä¿¡æ¯ç­‰ï¼‰</p><p><img src="/2020/09/17/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-1/ncnn1.png" alt="ncnnå®˜æ–¹demoä¸­çš„æ¨¡å‹æ–‡ä»¶"></p><h6 id="3-1-param-æ–‡ä»¶"><a href="#3-1-param-æ–‡ä»¶" class="headerlink" title="3.1 param æ–‡ä»¶"></a>3.1 param æ–‡ä»¶</h6><p><strong>ä¸€ä¸ª.paramæ–‡ä»¶ç”±ä»¥ä¸‹å‡ éƒ¨åˆ†ç»„æˆï¼š</strong></p><p><img src="/2020/09/17/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-1/ncnn2.png" alt></p><p><strong>1ï¼‰MagicNum</strong></p><p>å›ºå®šä½7767517ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ•°æ¥åˆ¤å®šç‰ˆæœ¬ -&gt; ä¸ºä»€ä¹ˆè¿™ä¸ªæ•°å­—ï¼Œä¸çŸ¥é“é—®å€ªç¥å»å§ </p><p>2ï¼‰<strong>layerã€blobä¸ªæ•°</strong></p><p>ä¸Šå›¾ç¤ºä¾‹çš„æ–‡ä»¶ä¸¤ä¸ªæ•°å­—åˆ†åˆ«ä¸ºï¼š75ã€83</p><p>â€‹    <strong>layerï¼šæˆ‘ä»¬çŸ¥é“ç¥ç»ç½‘ç»œæ˜¯ä¸€å±‚ä¸€å±‚å‘å‰æ¨è¿›è®¡ç®—çš„ï¼Œæ¯ä¸€å±‚æˆ‘ä»¬ç”¨ä¸€ä¸ªlayerè¡¨ç¤ºï¼›</strong></p><p>â€‹    <strong>blobï¼šæ¯ä¸€ä¸ªlayeréƒ½å¯èƒ½ä¼šæœ‰è¾“å…¥ã€è¾“å‡ºï¼Œåœ¨ncnnä¸­ï¼Œå®ƒä»¬ç»Ÿä¸€ç”¨ä¸€ä¸ªå¤šç»´ï¼ˆ3ç»´ï¼‰å‘é‡è¡¨ç¤ºï¼Œæˆ‘ä»¬ç§°æ¯ä¸€ä¸ªè¾“å…¥ã€è¾“å‡ºçš„åŸå­ä¸ºä¸€ä¸ªblobï¼Œå¹¶ä¸ºå®ƒèµ·å</strong></p><p>2.1.1.2 layerçš„æè¿°</p><p>layer åœ¨ .param ä¸­æ˜¯ä¸€ä¸ªç›¸å¯¹å¤æ‚çš„å…ƒç´ ï¼ˆä»ç¬¬3è¡Œèµ·çš„æ¯ä¸€è¡Œæè¿°ä¸€ä¸ªlayerï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠå®ƒå•ç‹¬æŠ½å‡ºæ¥è¿›è¡Œè¯´æ˜ã€‚</p><p><strong>1ï¼‰å±‚ç±»å‹</strong>     æ¯”å¦‚<strong>Inputã€Convolutionã€ReLU</strong></p><p><strong>2ï¼‰å±‚å</strong>       æ¨¡å‹è®­ç»ƒè€…ä¸ºè¯¥å±‚èµ·å¾—åå­—ï¼ˆæ¯•ç«Ÿç›¸åŒç±»å‹çš„å±‚å¯èƒ½å¤šæ¬¡ä½¿ç”¨ï¼Œæˆ‘ä»¬è¦åŒºåˆ†å®ƒä»¬ï¼‰</p><p><strong>3ï¼‰å±‚è¾“å…¥è¾“å‡º  åŒ…å«ï¼šå±‚è¾“å…¥blobæ•°é‡ï¼Œå±‚è¾“å‡ºblobæ•°é‡ï¼Œå±‚è¾“å…¥ã€è¾“å‡ºblobçš„åç§°</strong></p><p><strong>4ï¼‰å±‚é…ç½®å‚æ•°</strong></p><p>æ¯”å¦‚ <strong>å·ç§¯å±‚ï¼ˆConvolution Layerï¼‰çš„ å·ç§¯æ ¸å¤§å°ã€æ­¥é•¿ä¿¡æ¯</strong> ç­‰</p><p>åœ¨ å…·ä½“å±‚é‡Œé¢éƒ½æœ‰ä¸€ä¸ªå‡½æ•°: load_param, ä»é‡Œé¢å¯ä»¥æŸ¥è¯¢åˆ°ç›¸å…³ä¿¡æ¯ã€‚</p><p><strong>dataå±‚ï¼š 0=é•¿ 1=å®½ 3=é€šé“</strong></p><p><strong>Convolutionå±‚ 0=è¾“å‡ºå•å…ƒ 1=å·ç§¯æ ¸å¤§å°  2=æ ¸è†¨èƒ€[è§è†¨èƒ€å·ç§¯]    3=stride</strong>    </p><p>â€‹                                 <strong>4=padding    5=æ˜¯å¦å­˜åœ¨åç½®    6=æƒé‡æ•°é‡</strong></p><p><strong>pooling å±‚    0=æ± åŒ–ç±»å‹   1=å·ç§¯æ ¸å¤§å°   2=æ­¥é•¿stride   3=padding   4=å…¨å±€æ± åŒ–  5=paddingç±»å‹</strong></p><p><strong>ReLU å±‚ 0=0.000000 æ— å‚æ•°</strong></p><p><strong>softmax å±‚ 0=0 æ— å‚æ•°</strong></p><p><strong>Concat Split Dropout æ— å‚æ•°</strong></p><p><strong>ConvolutionDepthWise    7=group æ•°ç›®</strong></p><h6 id="3-2-è¯»å–"><a href="#3-2-è¯»å–" class="headerlink" title="3.2 è¯»å–"></a>3.2 è¯»å–</h6><p><strong>ä¸‹é¢æˆ‘ä»¬å…·ä½“ä»ä»£ç çš„è§’åº¦æ¥çœ‹çœ‹å¦‚ä½•è¯»å–è¿™ä¸ªæ–‡ä»¶çš„:(æ–‡ä»¶ä¸º net.cpp/h å’Œ paramdict.cpp/h) ä¸ºäº†æ–¹ä¾¿ï¼Œ æˆ‘ä»¬å°† Vulkan ç›¸å…³ä»£ç å‰”é™¤æ‰ã€‚</strong></p><p><strong>net.h ä¸»è¦æ˜¯ Net ç±»çš„æ¥å£ï¼Œ å…¶ä¸­æœ€é‡è¦çš„åŠŸèƒ½æ˜¯å®ç° load_param(è½½å…¥æ¨¡å‹å‚æ•°) å’Œ load_model(è½½å…¥æ¨¡å‹çš„æ•°æ®) åŠŸèƒ½</strong></p><pre><code class="hljs cpp"><span class="hljs-comment">// net.h</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Net</span></span><span class="hljs-class">&#123;</span><span class="hljs-keyword">public</span>:    <span class="hljs-comment">// empty init</span>    Net();    <span class="hljs-comment">// clear and destroy</span>    ~Net();<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> NCNN_STRING</span>    <span class="hljs-comment">// register custom layer by layer type name</span>    <span class="hljs-comment">// return 0 if success</span>    <span class="hljs-comment">// æ³¨å†Œè‡ªå®šä¹‰ç±»å‹å±‚ï¼Œ é€šè¿‡stringç±»å‹å</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">register_custom_layer</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* type, layer_creator_func creator)</span></span>;<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// NCNN_STRING</span></span>    <span class="hljs-comment">// register custom layer by layer type</span>    <span class="hljs-comment">// return 0 if success</span>    <span class="hljs-comment">// æ³¨å†Œè‡ªå®šä¹‰å±‚ï¼Œ é€šè¿‡intç±»å‹çš„ layer ç´¢å¼•</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">register_custom_layer</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index, layer_creator_func creator)</span></span>;<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> NCNN_STDIO</span><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> NCNN_STRING</span>    <span class="hljs-comment">// load network structure from plain param file</span>    <span class="hljs-comment">// return 0 if success</span>    <span class="hljs-comment">// ä»æ–‡ä»¶æŒ‡é’ˆä¸­è½½å…¥å‚æ•°</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">load_param</span><span class="hljs-params">(FILE* fp)</span></span>;    <span class="hljs-comment">// ä» param æ–‡ä»¶ä¸­è½½å…¥å‚æ•°</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">load_param</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* protopath)</span></span>;    <span class="hljs-comment">// ä» mem ä¸­è½½å…¥å‚æ•°</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">load_param_mem</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* mem)</span></span>;<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// NCNN_STRING</span></span>    <span class="hljs-comment">// load network structure from binary param file</span>    <span class="hljs-comment">// return 0 if success</span>    <span class="hljs-comment">// ä»äºŒè¿›åˆ¶æ–‡ä»¶æŒ‡é’ˆä¸­è½½å…¥ param å‚æ•°</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">load_param_bin</span><span class="hljs-params">(FILE* fp)</span></span>;    <span class="hljs-comment">// ä»äºŒè¿›åˆ¶æ–‡ä»¶ä¸­è½½å…¥å‚æ•°</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">load_param_bin</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* protopath)</span></span>;    <span class="hljs-comment">// load network weight data from model file</span>    <span class="hljs-comment">// return 0 if success</span>    <span class="hljs-comment">// ä» file æŒ‡é’ˆä¸­ä¼ å…¥æ¨¡å‹</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">load_model</span><span class="hljs-params">(FILE* fp)</span></span>;    <span class="hljs-comment">// ä»äºŒè¿›åˆ¶æ–‡ä»¶ä¸­è½½å…¥æ¨¡å‹</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">load_model</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* modelpath)</span></span>;<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// NCNN_STDIO</span></span>    <span class="hljs-comment">// load network structure from external memory</span>    <span class="hljs-comment">// memory pointer must be 32-bit aligned</span>    <span class="hljs-comment">// return bytes consumed</span>    <span class="hljs-comment">// ä»å¤–éƒ¨å†…å­˜ä¸­è½½å…¥å‚æ•°</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">load_param</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>* mem)</span></span>;    <span class="hljs-comment">// reference network weight data from external memory</span>    <span class="hljs-comment">// weight data is not copied but referenced</span>    <span class="hljs-comment">// so external memory should be retained when used</span>    <span class="hljs-comment">// memory pointer must be 32-bit aligned</span>    <span class="hljs-comment">// return bytes consumed</span>    <span class="hljs-comment">// ä»å¤–éƒ¨å†…å­˜ä¸­è½½å…¥ç½‘ç»œæƒé‡</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">load_model</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>* mem)</span></span>;    <span class="hljs-comment">// unload network structure and weight data</span>    <span class="hljs-comment">// æ¸…ç©ºç½‘ç»œç»“æ„</span>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span></span>;    <span class="hljs-comment">// construct an Extractor from network</span>    <span class="hljs-comment">// ä»ç½‘ç»œæ„å»ºä¸€ä¸ªæ‰§è¡Œå™¨</span>    <span class="hljs-function">Extractor <span class="hljs-title">create_extractor</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span>;<span class="hljs-keyword">protected</span>:    <span class="hljs-keyword">friend</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Extractor</span>;</span> <span class="hljs-comment">// å¤–éƒ¨ Extractor æ¥å£</span><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> NCNN_STRIN</span>    <span class="hljs-comment">// é€šè¿‡nameæŸ¥æ‰¾blobå¯¹åº”çš„ç´¢å¼•</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">find_blob_index_by_name</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* name)</span> <span class="hljs-keyword">const</span></span>;     <span class="hljs-comment">// é€šè¿‡nameæŸ¥æ‰¾å¯¹åº”çš„ layer ç´¢å¼•</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">find_layer_index_by_name</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* name)</span> <span class="hljs-keyword">const</span></span>;    <span class="hljs-comment">// é€šè¿‡ç±»å‹æŸ¥æ‰¾å¯¹åº”çš„ layerç´¢å¼•</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">custom_layer_to_index</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* type)</span></span>;    <span class="hljs-comment">// é€šè¿‡ç±»å‹åˆ›å»ºlayer</span>    <span class="hljs-function">Layer* <span class="hljs-title">create_custom_layer</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* type)</span></span>;<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// NCNN_STRING</span></span>    <span class="hljs-comment">// é€šè¿‡ index ç©¿ä»¶ layer</span>    <span class="hljs-function">Layer* <span class="hljs-title">create_custom_layer</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span></span>;    <span class="hljs-comment">// å‰å‘æ¨ç†å±‚</span>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">forward_layer</span><span class="hljs-params">(<span class="hljs-keyword">int</span> layer_index, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Mat&gt;&amp; blob_mats, Option&amp; opt)</span> <span class="hljs-keyword">const</span></span>;<span class="hljs-keyword">protected</span>:    <span class="hljs-comment">// blobs &amp; layers</span>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Blob&gt; blobs;    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Layer*&gt; layers;    <span class="hljs-comment">// layers</span>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;layer_registry_entry&gt; custom_layer_registry;&#125;;</code></pre><p>åœ¨æ­¤æˆ‘ä»¬å¯ä»¥å…ˆæ¥çœ‹ä¸€ä¸‹ blobç±» ! ç€é‡çœ‹ä¸€ä¸‹ï¼Œå¯¹åº”çš„ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…æ¨¡å‹</p><pre><code class="hljs cpp"><span class="hljs-comment">// Blob ç”¨äºè®°å½•æ•°æ®ä¼ è¾“è¿‡ç¨‹ï¼Œ producer è®°å½•å½“å‰blobä»é‚£ä¸€å±‚äº§ç”Ÿçš„ï¼Œ</span><span class="hljs-comment">// consumer è®°å½•å½“å‰blobè¢«å“ªäº›å±‚è°ƒç”¨:</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Blob</span></span><span class="hljs-class">&#123;</span><span class="hljs-keyword">public</span>:    <span class="hljs-comment">// empty</span>    Blob();<span class="hljs-keyword">public</span>:<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> NCNN_STRING</span>    <span class="hljs-comment">// blob name</span>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name;<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// NCNN_STRING</span></span>    <span class="hljs-comment">// layer index which produce this blob as output</span>    <span class="hljs-comment">// ç”Ÿäº§è€…</span>    <span class="hljs-keyword">int</span> producer;    <span class="hljs-comment">// layer index which need this blob as input</span>    <span class="hljs-comment">// æ¶ˆè´¹è€…</span>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; consumers;&#125;;</code></pre><p>ç„¶åæˆ‘ä»¬æ‰“å¼€ net.cpp æ–‡ä»¶ï¼Œæ¥çœ‹ä¸€ä¸‹ load_param çš„å…·ä½“å®ç°:</p><pre><code class="hljs cpp"><span class="hljs-comment">// ä»æ–‡ä»¶ä¸­è½½å…¥ net å‚æ•°</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Net::load_param</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* protopath)</span></span><span class="hljs-function"></span>&#123;    FILE* fp = fopen(protopath, <span class="hljs-string">&quot;rb&quot;</span>);    <span class="hljs-keyword">if</span> (!fp)    &#123;        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;fopen %s failed\n&quot;</span>, protopath);        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;    &#125;    <span class="hljs-comment">// ä»æ–‡ä»¶æŒ‡é’ˆä¸­è½½å…¥ param</span>    <span class="hljs-keyword">int</span> ret = load_param(fp);    fclose(fp);    <span class="hljs-keyword">return</span> ret;&#125;</code></pre><p>å‚æ•°è½½å…¥æ¥å£ä¸­ï¼Œ è°ƒç”¨äº†å¦å¤–ä¸€ä¸ªå‚æ•°è½½å…¥æ¥å£: load_param(FILE * fp)</p><p>(1) è¯»å– magic number, é€šè¿‡åˆ¤æ–­ magic number æ˜¯å¦ç­‰äº 7767517, å°±å¯ä»¥åˆ¤æ–­å½“å‰paramæ–‡ä»¶æ˜¯å¦æ˜¯æœ€æ–°çš„ param æ–‡ä»¶ </p><pre><code class="hljs cpp"><span class="hljs-keyword">int</span> magic = <span class="hljs-number">0</span>;<span class="hljs-comment">// è¯»å– magic number</span><span class="hljs-keyword">int</span> nbr = <span class="hljs-built_in">fscanf</span>(fp, <span class="hljs-string">&quot;%d&quot;</span>, &amp;magic);<span class="hljs-comment">// è¯»å–å¤±è´¥</span><span class="hljs-keyword">if</span> (nbr != <span class="hljs-number">1</span>)&#123;    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;issue with param file\n&quot;</span>);    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;&#125;<span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ˜¯æœ€æ–°çš„ magic number</span><span class="hljs-keyword">if</span> (magic != <span class="hljs-number">7767517</span>)&#123;    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;param is too old, please regenerate\n&quot;</span>);    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;&#125;</code></pre><p>(2) è§£æå‡ºç½‘ç»œçš„ layer å±‚æ•°å’Œ blob æ•°ç›® </p><pre><code class="hljs cpp"><span class="hljs-comment">// å¯¹ layer å’Œ blob è¿›è¡Œè§£æ</span><span class="hljs-keyword">int</span> layer_count = <span class="hljs-number">0</span>;<span class="hljs-keyword">int</span> blob_count = <span class="hljs-number">0</span>;<span class="hljs-comment">// å±‚æ•° &amp;&amp; blob æ•°ç›®</span>nbr = <span class="hljs-built_in">fscanf</span>(fp, <span class="hljs-string">&quot;%d %d&quot;</span>, &amp;layer_count, &amp;blob_count);<span class="hljs-comment">// å±‚æ•°å’Œ blobæ•°è¯»å–å¤±è´¥</span><span class="hljs-keyword">if</span> (nbr != <span class="hljs-number">2</span> || layer_count &lt;= <span class="hljs-number">0</span> || blob_count &lt;= <span class="hljs-number">0</span>)&#123;    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;issue with param file\n&quot;</span>);    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;&#125;<span class="hljs-comment">// resize ç½‘ç»œçš„å±‚æ•°å’Œblobæ•°ç›®</span>layers.resize((<span class="hljs-keyword">size_t</span>)layer_count);blobs.resize((<span class="hljs-keyword">size_t</span>)blob_count);</code></pre><p>(3) éå†æ‰€æœ‰çš„ layer, è§£ææ¯å±‚ layer å±‚çš„ç±»å‹(layer type)ã€åç§°(layer name)ã€è¾“å…¥æ•°ç›®(bottom_count) å’Œ è¾“å‡ºæ•°ç›®(top_count)</p><pre><code class="hljs cpp"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;layer_count; i++)&#123;    <span class="hljs-keyword">int</span> nscan = <span class="hljs-number">0</span>;    <span class="hljs-comment">// layer çš„ç±»å‹å’Œåç§°</span>    <span class="hljs-keyword">char</span> layer_type[<span class="hljs-number">257</span>];    <span class="hljs-keyword">char</span> layer_name[<span class="hljs-number">257</span>];    <span class="hljs-keyword">int</span> bottom_count = <span class="hljs-number">0</span>;    <span class="hljs-keyword">int</span> top_count = <span class="hljs-number">0</span>;    <span class="hljs-comment">// è¯»å–å±‚ç±»å‹ã€åç§°ã€‚è¾“å…¥bottomæ•°ç›®å’Œè¾“å‡ºtopæ•°ç›®</span>    nscan = <span class="hljs-built_in">fscanf</span>(fp, <span class="hljs-string">&quot;%256s %256s %d %d&quot;</span>, layer_type, layer_name, &amp;bottom_count, &amp;top_count);    <span class="hljs-keyword">if</span> (nscan != <span class="hljs-number">4</span>) <span class="hljs-comment">// è§£æå¤±è´¥</span>    &#123;        <span class="hljs-keyword">continue</span>;    &#125;</code></pre><p>(4) æ ¹æ®layerçš„ç±»å‹ï¼Œ åˆ›å»º layer</p><pre><code class="hljs cpp"><span class="hljs-comment">// åˆ›å»º layer</span>Layer* layer = create_layer(layer_type);<span class="hljs-comment">// layer_type ä¸æ˜¯é»˜è®¤ç±»å‹</span><span class="hljs-keyword">if</span> (!layer)&#123;    <span class="hljs-comment">// ä»è‡ªå®šä¹‰ layer è¯»å–</span>    layer = create_custom_layer(layer_type);&#125;<span class="hljs-keyword">if</span> (!layer) <span class="hljs-comment">// å¦‚æœè‡ªå®šä¹‰ layer ä¸­ä¸å­˜åœ¨å½“å‰ç±»å‹çš„ layer </span>&#123;    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;layer %s not exists or registered\n&quot;</span>, layer_type);    clear();    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;&#125;<span class="hljs-comment">// è®¾ç½® layer å‚æ•°: layerçš„ç±»å‹ã€åç§°ã€è¾“å…¥å’Œè¾“å‡º      </span>layer-&gt;type = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>(layer_type);layer-&gt;name = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>(layer_name);</code></pre><p>(5) åœ¨è®¾ç½®è¾“å…¥æ—¶ï¼Œå¦‚æœå½“å‰blobåä¸å­˜åœ¨ï¼Œå°±å°†å½“å‰blobåæ·»åŠ åˆ°netçš„blobsæ•°ç»„é‡Œé¢</p><pre><code class="hljs cpp">layer-&gt;bottoms.resize(bottom_count); <span class="hljs-comment">// layerçš„è¾“å…¥</span><span class="hljs-comment">// è§£æ layer çš„è¾“å…¥</span><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j=<span class="hljs-number">0</span>; j&lt;bottom_count; j++)&#123;    <span class="hljs-keyword">char</span> bottom_name[<span class="hljs-number">257</span>];    <span class="hljs-comment">// è§£æ bottomçš„name</span>    nscan = <span class="hljs-built_in">fscanf</span>(fp, <span class="hljs-string">&quot;%256s&quot;</span>, bottom_name);    <span class="hljs-keyword">if</span> (nscan != <span class="hljs-number">1</span>)    &#123;        <span class="hljs-keyword">continue</span>;    &#125;    <span class="hljs-comment">// æŒ‰ç…§ bottom çš„name æŸ¥æ‰¾å¯¹åº” blob çš„index</span>    <span class="hljs-keyword">int</span> bottom_blob_index = find_blob_index_by_name(bottom_name);    <span class="hljs-comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ° bottom_name å¯¹åº”çš„ blob</span>    <span class="hljs-comment">// å°†å‘ blobs æ•°ç»„ä¸­æ’å…¥ä¸€ä¸ªåä¸º bottom_name çš„ blob</span>    <span class="hljs-keyword">if</span> (bottom_blob_index == <span class="hljs-number">-1</span>)    &#123;        <span class="hljs-comment">// è®¾ç½®ç¬¬blob_indexä¸ªblob çš„å‚æ•°</span>        Blob&amp; blob = blobs[blob_index];        <span class="hljs-comment">// blobçš„ç´¢å¼•</span>        bottom_blob_index = blob_index;        <span class="hljs-comment">// è®¾ç½®blobçš„name</span>        blob.name = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>(bottom_name);        <span class="hljs-comment">// æ›´æ–°å…¨å±€çš„ blob ç´¢å¼•</span>        blob_index++;    &#125;    <span class="hljs-comment">// è®¾ç½®å½“å‰çš„blobçš„å‚æ•°</span>    Blob&amp; blob = blobs[bottom_blob_index];    <span class="hljs-comment">// ä½¿ç”¨å½“å‰çš„blobè®°å½•ä¼ è¾“å…³ç³»ï¼Œ ç¬¬iå±‚ä»¥å½“å‰blobä¸ºè¾“å…¥</span>    blob.consumers.push_back(i);    <span class="hljs-comment">// ç¬¬iå±‚layerçš„ç¬¬jä¸ªè¾“å…¥</span>    layer-&gt;bottoms[j] = bottom_blob_index;&#125;</code></pre><p> (6) è®¾ç½®è¾“å‡ºçš„è¿‡ç¨‹å’Œè¿™ä¸ªç±»ä¼¼ï¼Œåœ¨æ­¤ä¸å†èµ˜è¿°ï¼Œæœ€åå°±æ˜¯<strong>å‚æ•°è½½å…¥äº†</strong>:</p><p>ä¾‹å¦‚: <strong>conv1çš„å‚æ•°: 0=64 1=3 11=3 5=1 6=1728</strong></p><pre><code class="hljs cpp"><span class="hljs-comment">//è§£æ blobåé¢è·Ÿéšçš„ç‰¹å®šå‚æ•°å­—å…¸ pd</span><span class="hljs-keyword">int</span> pdlr = pd.load_param(fp);<span class="hljs-keyword">if</span> (pdlr != <span class="hljs-number">0</span>)&#123;    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;ParamDict load_param failed\n&quot;</span>);    <span class="hljs-keyword">continue</span>;&#125;<span class="hljs-comment">// layer è½½å…¥ param</span><span class="hljs-keyword">int</span> lr = layer-&gt;load_param(pd);<span class="hljs-keyword">if</span> (lr != <span class="hljs-number">0</span>)&#123;    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;layer load_param failed\n&quot;</span>);    <span class="hljs-keyword">continue</span>;&#125;layers[i] = layer;</code></pre><p>è¿™å…¶ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„å‡½æ•°:</p><p>pd.load_param(fp) å’Œ  layer_param(pd)ã€‚å‰è€…è´Ÿè´£è§£æ .param æ–‡ä»¶ä¸­ç‰¹å®šçš„å‚æ•°ï¼Œ åè€…åˆ™æ˜¯ç”¨è§£æçš„å‚æ•°æ¥æ„å»ºå¯¹åº”çš„layer</p><p>(7) ç”¨å‚æ•°å­—å…¸æ¥è§£ælayerç›¸å…³å‚æ•°ï¼ çœ‹ä¸€ä¸‹è¿™ä¸ªè‡ªå·±æ„é€ layerï¼Œ ä»¥åŠè§£æçš„è¿‡ç¨‹ </p><p>   åœ¨ä½¿ç”¨load_paramæ¥å£è½½å…¥å‚æ•°æ—¶ï¼Œéœ€è¦ç”¨å‚æ•°å­—å…¸ParamDictæ¥è§£æ.paramæ–‡ä»¶ä¸­çš„ç‰¹å®šå‚æ•°ï¼Œé‚£ä¹ˆå‚æ•°å­—å…¸å…·ä½“å¦‚ä½•è¿›è¡Œè§£æçš„ï¼Ÿæˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹paramdict.hæ–‡ä»¶ä¸­å®šä¹‰çš„æ•°æ®æˆå‘˜å˜é‡ï¼š</p><pre><code class="hljs cpp"><span class="hljs-comment">// parameters</span><span class="hljs-class"><span class="hljs-keyword">struct</span></span><span class="hljs-class">&#123;</span>    <span class="hljs-comment">// æ˜¯å¦å·²ç»è¢«è½½å…¥ï¼š1è¡¨ç¤ºå·²è½½å…¥</span>    <span class="hljs-keyword">int</span> loaded;    <span class="hljs-comment">// å•ä¸ªå€¼å¯èƒ½ä¸ºæ•´å½¢ä¹Ÿæœ‰å¯èƒ½ä¸ºæµ®ç‚¹å‹</span>    <span class="hljs-keyword">union</span> &#123; <span class="hljs-keyword">int</span> i; <span class="hljs-keyword">float</span> f; &#125;;    <span class="hljs-comment">// è¿˜æœ‰å¯èƒ½æ˜¯æ•°ç»„</span>    Mat v;&#125; params[NCNN_MAX_PARAM_COUNT];</code></pre><p>â€‹    è¿™é‡Œï¼ŒNCNN_MAX_PARAM_COUNTå¤§å°ä¸º20ï¼Œparamsæ˜¯ä¸€ä¸ªå¤§å°ä¸º32çš„ç»“æ„ä½“æ•°ç»„ï¼Œå³ä¸€è¡Œä¸­ç‰¹å®šå‚æ•°æ•°é‡ä¸èƒ½è¶…è¿‡20ï¼Œå½“ç„¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¹Ÿä¸ä¼šè¶…è¿‡20ã€‚</p><pre><code class="hljs cpp"><span class="hljs-comment">// at most 20 parameters</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NCNN_MAX_PARAM_COUNT 20</span></code></pre><p>â€‹    ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹paramdict.cppæºç ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œä¼šè§£æå‡ºå½“å‰è¡Œçš„indexï¼ˆidï¼‰ï¼Œä¹Ÿå³æ˜¯ç­‰å·å·¦è¾¹éƒ¨åˆ†ï¼š </p><pre><code class="hljs cpp"><span class="hljs-comment">// è§£æä¹‹åçš„ key=value å¯¹</span><span class="hljs-keyword">int</span> id = <span class="hljs-number">0</span>;<span class="hljs-keyword">while</span> (<span class="hljs-built_in">fscanf</span>(fp, <span class="hljs-string">&quot;%d=&quot;</span>, &amp;id) == <span class="hljs-number">1</span>)&#123;    ...&#125;</code></pre><p> åœ¨è¿™é‡Œå¯ä»¥ç»“åˆ <a href="https://github.com/Tencent/ncnn/wiki/param-and-model-file-structure">https://github.com/Tencent/ncnn/wiki/param-and-model-file-structure</a> é˜…è¯»æºç ï¼š</p><p><strong>index-value çš„è§„åˆ™ä¸º:</strong></p><ul><li>indexä¸º0~19: å¯¹åº”æ•´å½¢æˆ–æµ®ç‚¹å‹æ•°æ®</li><li><p>indexå°äº -23000ï¼š å¯¹åº”æ•´å½¢æˆ–æµ®ç‚¹å‹æ•°ç»„, ç­‰å·å³è¾¹ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯æ•°ç»„é•¿åº¦ï¼Œåé¢é¡ºåºå°±æ˜¯æ•°ç»„å†…å®¹ï¼Œ[array size],int,int,â€¦,intæˆ–[array size],float,float,â€¦,floatï¼Œä¾‹å¦‚ï¼š</p><p><strong>0=1 1=2.5 -23303=2,2.0,3.0</strong></p><p>indexä¸º -23303ï¼Œè¡¨æ˜å½“å‰å‚æ•°ä¸ºæ•°ç»„ï¼Œç­‰å·å³è¾¹ç¬¬ä¸€ä¸ªå‚æ•°ä¸º2ï¼Œè¡¨æ˜æ•°ç»„é•¿åº¦ä¸º2ï¼Œåé¢2.0,3.0å°±æ˜¯æ•°ç»„çš„å†…å®¹</p></li></ul><pre><code class="hljs cpp"><span class="hljs-keyword">bool</span> is_array = id &lt;= <span class="hljs-number">-23300</span>; <span class="hljs-comment">// index &lt;= -23300ï¼šæ•°ç»„</span><span class="hljs-keyword">if</span> (is_array) <span class="hljs-comment">// å¦‚æœæ˜¯æ•°ç»„</span>&#123;  <span class="hljs-comment">// è®¡ç®—id</span>    id = -id - <span class="hljs-number">23300</span>;&#125;<span class="hljs-keyword">if</span> (is_array)  <span class="hljs-comment">// å¦‚æœå½“å‰å‚æ•°æ˜¯æ•°ç»„ç±»å‹</span>&#123;    <span class="hljs-keyword">int</span> len = <span class="hljs-number">0</span>;  <span class="hljs-comment">// æ•°ç»„é•¿åº¦</span>    <span class="hljs-keyword">int</span> nscan = <span class="hljs-built_in">fscanf</span>(fp, <span class="hljs-string">&quot;%d&quot;</span>, &amp;len);    <span class="hljs-keyword">if</span> (nscan != <span class="hljs-number">1</span>)             <span class="hljs-comment">// ç­‰äº1æ‰è¡¨ç¤ºè¯»å–æˆåŠŸ</span>    &#123;        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;ParamDict read array length failed\n&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;    &#125;        params[id].v.create(len);  <span class="hljs-comment">// åˆ›å»ºæ•°ç»„ï¼šå°±æ˜¯ä¸€ä¸ªMat</span>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; len; j++)    &#123;        <span class="hljs-keyword">char</span> vstr[<span class="hljs-number">16</span>]; <span class="hljs-comment">// ä»äºŒå€¼æ–‡ä»¶ä¸­è¯»å–string</span>        nscan = <span class="hljs-built_in">fscanf</span>(fp, <span class="hljs-string">&quot;,%15[^,\n ]&quot;</span>, vstr);        <span class="hljs-keyword">if</span> (nscan != <span class="hljs-number">1</span>) <span class="hljs-comment">// å¦‚æœè¯»å–å¤±è´¥</span>        &#123;            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;ParamDict read array element failed\n&quot;</span>);            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;        &#125;         <span class="hljs-comment">// æ˜¯å¦ä¸ºæµ®ç‚¹å‹ï¼šçœ‹è§£æçš„å­—ç¬¦ä¸²ä¸­æ˜¯å¦å­˜åœ¨&#x27;.&#x27;æˆ–&#x27;e&#x27;</span>        <span class="hljs-comment">// å°æ•°ç‚¹è®¡æ•°æ³•å’Œç§‘å­¦è®¡æ•°æ³•</span>        <span class="hljs-keyword">bool</span> is_float = vstr_is_float(vstr);        <span class="hljs-comment">// å¦‚æœæ˜¯æµ®ç‚¹æ•°</span>        <span class="hljs-keyword">if</span> (is_float)  <span class="hljs-comment">// vstrèµ‹å€¼ç»™params[id].v[j]</span>        &#123;            <span class="hljs-keyword">float</span>* ptr = params[id].v;            nscan = <span class="hljs-built_in">sscanf</span>(vstr, <span class="hljs-string">&quot;%f&quot;</span>, &amp;ptr[j]);        &#125;        <span class="hljs-keyword">else</span>  <span class="hljs-comment">// vstrèµ‹å€¼ç»™params[id].v[j]</span>        &#123;            <span class="hljs-keyword">int</span>* ptr = params[id].v;            nscan = <span class="hljs-built_in">sscanf</span>(vstr, <span class="hljs-string">&quot;%d&quot;</span>, &amp;ptr[j]);        &#125;        <span class="hljs-keyword">if</span> (nscan != <span class="hljs-number">1</span>)  <span class="hljs-comment">// èµ‹å€¼å¤±è´¥</span>        &#123;            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;ParamDict parse array element failed\n&quot;</span>);            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;        &#125;    &#125;&#125;</code></pre><p>â€‹    è¿™é‡Œæœ‰ä¸ªvstr_is_floatå‡½æ•°ï¼ŒåŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ¤æ–­æ•°å­—å¯¹åº”å­—ç¬¦ä¸²ä¸­æ˜¯å¦å­˜åœ¨å°æ•°ç‚¹â€™.â€™æˆ–å­—æ¯â€™eâ€™ï¼Œå¯¹åº”å°æ•°çš„ä¸¤ç§å†™æ³•ï¼Œä¸€ç§æ­£å¸¸çš„å°æ•°ç‚¹è¡¨ç¤ºæ³•ï¼Œä¸€ç§æ˜¯ç§‘å­¦è®¡æ•°æ³•ã€‚</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">vstr_is_float</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> vstr[<span class="hljs-number">16</span>])</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-comment">// look ahead for determine isfloat</span>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j=<span class="hljs-number">0</span>; j&lt;<span class="hljs-number">16</span>; j++)    &#123;        <span class="hljs-keyword">if</span> (vstr[j] == <span class="hljs-string">&#x27;\0&#x27;</span>)            <span class="hljs-keyword">break</span>;        <span class="hljs-keyword">if</span> (vstr[j] == <span class="hljs-string">&#x27;.&#x27;</span> || <span class="hljs-built_in">tolower</span>(vstr[j]) == <span class="hljs-string">&#x27;e&#x27;</span>)            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;&#125;</code></pre><p>â€‹    å¦‚æœä¸æ˜¯æ•°ç»„ï¼Œç›´æ¥è¯»å–å³å¯ï¼š</p><pre><code class="hljs cpp"><span class="hljs-keyword">else</span>   <span class="hljs-comment">// ä¸æ˜¯æ•°ç»„</span>&#123;    <span class="hljs-keyword">char</span> vstr[<span class="hljs-number">16</span>];    <span class="hljs-keyword">int</span> nscan = <span class="hljs-built_in">fscanf</span>(fp, <span class="hljs-string">&quot;%15s&quot;</span>, vstr); <span class="hljs-comment">// ç›´æ¥å°†å­—ç¬¦ä¸²èµ‹å€¼ç»™vstr</span>    <span class="hljs-keyword">if</span> (nscan != <span class="hljs-number">1</span>)  <span class="hljs-comment">// èµ‹å€¼å¤±è´¥</span>    &#123;        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;ParamDict read value failed\n&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;    &#125;    <span class="hljs-keyword">bool</span> is_float = vstr_is_float(vstr);  <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦ä¸ºæµ®ç‚¹æ•°</span>    <span class="hljs-keyword">if</span> (is_float)  <span class="hljs-comment">// å°†å­—ç¬¦ä¸²ä¸­çš„å€¼èµ‹ç»™å‚æ•°å­—å…¸</span>        nscan = <span class="hljs-built_in">sscanf</span>(vstr, <span class="hljs-string">&quot;%f&quot;</span>, &amp;params[id].f);    <span class="hljs-keyword">else</span>        nscan = <span class="hljs-built_in">sscanf</span>(vstr, <span class="hljs-string">&quot;%d&quot;</span>, &amp;params[id].i);    <span class="hljs-keyword">if</span> (nscan != <span class="hljs-number">1</span>)  <span class="hljs-comment">// èµ‹å€¼å¤±è´¥</span>    &#123;        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;ParamDict parse value failed\n&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;    &#125;&#125;params[id].loaded = <span class="hljs-number">1</span>;         <span class="hljs-comment">// è½½å…¥æˆåŠŸ</span></code></pre><p>(8) ç”¨å‚æ•°å­—å…¸æ¥è§£ælayerç›¸å…³å‚æ•°</p><p>å¦‚å‰æ‰€ç¤º, layerä¼šæ ¹æ®å‚æ•°å­—å…¸æ¥æ„é€  layer</p><pre><code class="hljs cpp"> <span class="hljs-comment">// layerè½½å…¥param</span><span class="hljs-keyword">int</span> lr = layer-&gt;load_param(pd);</code></pre><p>è½¬åˆ° layerå±‚çš„ load_param æ¥å£å¯ä»¥çœ‹åˆ°ï¼š</p><pre><code class="hljs cpp"><span class="hljs-comment">// è½½å…¥å‚æ•°ï¼šå‚æ•°åˆ—è¡¨</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Layer::load_param</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ParamDict&amp; <span class="hljs-comment">/*pd*/</span>)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>è¿™é‡Œå¹¶æ²¡æœ‰å®ç°ï¼Œåœ¨layer.hå¤´æ–‡ä»¶ä¸­æœ‰ï¼š</p><pre><code class="hljs cpp"><span class="hljs-comment">// load layer specific parameter from parsed dict</span><span class="hljs-comment">// return 0 if success</span><span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">load_param</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ParamDict&amp; pd)</span></span>;</code></pre><p> ! load_paramå®é™…ä¸Šæ˜¯ä¸€ä¸ªè™šå‡½æ•°ï¼Œç†Ÿæ‚‰C++çš„åŒå­¦åº”è¯¥çŸ¥é“ï¼Œè°ƒç”¨è™šå‡½æ•°æ—¶ï¼Œå®é™…è°ƒç”¨çš„æ˜¯ç»§æ‰¿ç±»çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆåˆ°åº•å¦‚ä½•è°ƒç”¨çš„ï¼Ÿï¼Œæˆ‘ä»¬å¯ä»¥å¾€å›çœ‹ï¼Œæœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š</p><pre><code class="hljs cpp">Layer* layer = create_layer(layer_type)  <span class="hljs-comment">// åˆ›å»ºlayer</span><span class="hljs-keyword">if</span> (!layer) <span class="hljs-comment">// layer_typeä¸æ˜¯é»˜è®¤ç±»å‹</span>&#123;       layer = create_custom_layer(layer_type);   <span class="hljs-comment">// ä»è‡ªå®šä¹‰layerè¯»å–</span>&#125;<span class="hljs-keyword">if</span> (!layer)   <span class="hljs-comment">// å¦‚æœè‡ªå®šä¹‰layerä¸­ä¹Ÿä¸å­˜åœ¨å½“å‰ç±»å‹layer</span>&#123;    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;layer %s not exists or registered\n&quot;</span>, layer_type);    clear();    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;&#125;</code></pre><p>å›åˆ°layer.cppæ–‡ä»¶ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œä»£ç ä¸­å…ˆæ‰¾åˆ°å½“å‰å±‚layerç±»å‹å¯¹åº”å±‚æ³¨å†Œå™¨ä¸­ç±»å‹çš„ç´¢å¼•indexã€‚</p><p><strong>layer_type -&gt; index -&gt; create_layer</strong></p><pre><code class="hljs cpp"> <span class="hljs-comment">// å°†stringå¯¹åº”layerç±»å‹è½¬æ¢æˆå¯¹åº”index</span> <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">layer_to_index</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* type)</span></span><span class="hljs-function"> </span>&#123;     <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;layer_registry_entry_count; i++)     &#123;         <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(type, layer_registry[i].name) == <span class="hljs-number">0</span>)             <span class="hljs-keyword">return</span> i;     &#125;     <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; &#125;   <span class="hljs-comment">// æ ¹æ®indexåˆ›å»ºlayerï¼š</span><span class="hljs-function">Layer* <span class="hljs-title">create_layer</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-number">0</span> || index &gt;= layer_registry_entry_count)     <span class="hljs-comment">// indexä¸èƒ½è¶…è¿‡ç´¢å¼•èŒƒå›´</span>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;     layer_creator_func layer_creator = layer_registry[index].creator;     <span class="hljs-comment">// åˆ›å»ºlayeræ„é€ å™¨</span>    <span class="hljs-keyword">if</span> (!layer_creator)     <span class="hljs-comment">// layeræ„é€ å™¨åˆ›å»ºå¤±è´¥</span>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;     Layer* layer = layer_creator();     <span class="hljs-comment">// æ„é€ layer</span>    layer-&gt;typeindex = index;    <span class="hljs-comment">// è®¾ç½®layerçš„ç±»å‹index</span>    <span class="hljs-keyword">return</span> layer;&#125;<span class="hljs-comment">// æ ¹æ®å­—ç¬¦ä¸²layerç±»å‹åˆ›å»ºlayer -&gt; è°ƒç”¨ä¸Šé¢ä¸¤ä¸ªå‡½æ•°ï¼Œ åˆ›å»ºlayer</span><span class="hljs-function">Layer* <span class="hljs-title">create_layer</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* type)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">int</span> index = layer_to_index(type);    <span class="hljs-keyword">if</span> (index == <span class="hljs-number">-1</span>)        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;     <span class="hljs-keyword">return</span> create_layer(index);&#125;</code></pre><p>line 18 æœ‰ä¸ªlayer_registryï¼Œå…¶å®šä¹‰ä¸ºï¼š</p><pre><code class="hljs cpp"><span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> layer_registry_entry layer_registry[] =&#123;    #include <span class="hljs-string">&quot;layer_registry.h&quot;</span>&#125;;</code></pre><p>è€Œè¿™ä¸ªâ€layer_registry.hâ€æ–‡ä»¶æ˜¯åœ¨buildé¡¹ç›®çš„æ—¶å€™è‡ªåŠ¨äº§ç”Ÿçš„ï¼Œéƒ¨åˆ†å†…å®¹å¦‚ä¸‹ï¼š</p><pre><code class="hljs cpp"> <span class="hljs-comment">// Layer Registry header</span> <span class="hljs-comment">//</span> <span class="hljs-comment">// This file is auto-generated by cmake, don&#x27;t edit it.</span>  <span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> NCNN_STRING</span> &#123;<span class="hljs-string">&quot;AbsVal&quot;</span>,AbsVal_final_layer_creator&#125;, <span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span> &#123;AbsVal_final_layer_creator&#125;, <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span> <span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> NCNN_STRING</span>&#123;<span class="hljs-string">&quot;ArgMax&quot;</span>,<span class="hljs-number">0</span>&#125;,<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>&#123;<span class="hljs-number">0</span>&#125;,<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> NCNN_STRING</span>&#123;<span class="hljs-string">&quot;BatchNorm&quot;</span>,BatchNorm_final_layer_creator&#125;,<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>&#123;BatchNorm_final_layer_creator&#125;,<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> NCNN_STRING</span>&#123;<span class="hljs-string">&quot;Bias&quot;</span>,Bias_final_layer_creator&#125;,<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>&#123;Bias_final_layer_creator&#125;,<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></code></pre><p>è€Œ layer_registry_entry çš„ç»“æ„ä¸ºï¼š</p><pre><code class="hljs cpp"><span class="hljs-comment">// layer factory function</span><span class="hljs-keyword">typedef</span> Layer* (*layer_creator_func)(); <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">layer_registry_entry</span></span><span class="hljs-class">&#123;</span><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> NCNN_STRING</span>    <span class="hljs-comment">// layer type name</span>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* name;<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// NCNN_STRING</span></span>    <span class="hljs-comment">// layer factory entry</span>    layer_creator_func creator;&#125;;</code></pre><p>æˆ‘ä»¬ä»£å…¥ä¸€ç»„å‚æ•°è¿›å»å°±æ˜¯ï¼š</p><pre><code class="hljs cpp">name = <span class="hljs-string">&quot;AbsVal&quot;</span>;layer_creator_func = AbsVal_final_layer_creator;</code></pre><p>è¿™é‡Œlayer_creator_funcå®šä¹‰ä¸ºï¼š</p><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> Layer* (*layer_creator_func)();</code></pre><p>é‚£ä¹ˆï¼Œlayer_creator_func AbsVal_final_layer_creatorè½¬æ¢è¿‡å»å°±æ˜¯ï¼š </p><pre><code class="hljs isbl"><span class="hljs-variable">Layer</span>* <span class="hljs-function"><span class="hljs-title">AbsVal_final_layer_creator</span>()</span></code></pre><p>åœ¨layer.hæ–‡ä»¶æœ€ä¸‹é¢è¿˜æœ‰ä¸€ä¸ªå®šä¹‰ï¼š</p><pre><code class="hljs cpp"><span class="hljs-comment">// ## å­—ç¬¦ä¸²è¿æ¥</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEFINE_LAYER_CREATOR(name) \</span>    ::ncnn::Layer* name##_layer_creator() &#123; <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> name; &#125;</code></pre><p>æˆ‘ä»¬åœ¨absval.cppæ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ° DEFINE_LAYER_CREATOR(AbsVal)ï¼Œç›¸å½“äºå°±æ˜¯å£°æ˜äº†ä¸€ä¸ªå‡½æ•°ï¼š</p><pre><code class="hljs cpp"><span class="hljs-comment">// #define DEFINE_LAYER_CREATOR(name) \</span><span class="hljs-comment">//    ::ncnn::Layer* name##_layer_creator() &#123; return new name; &#125;</span><span class="hljs-comment">// ç”±ä¸Šé¢è¿™æ®µä»£ç å¯çŸ¥ï¼ŒDEFINE_LAYER_CREATOR(AbsVal)ç­‰ä»·äºï¼š</span>::<span class="hljs-function">ncnn::Layer* <span class="hljs-title">AbsVal_layer_creator</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AbsVal; &#125;</code></pre><p>â€‹    ä¸Šé¢é‚£å¥è¯ç›¸å½“äºå°±æ˜¯newäº†ä¸€ä¸ªAbsValå±‚ï¼Œä½†æ˜¯è¿™é‡Œè¿˜æ˜¯å¯¹åº”ä¸èµ·æ¥ï¼Œä¸Šé¢çš„æ˜¯ AbsVal_final_layer_creator()ï¼Œè¿™é‡Œå£°æ˜çš„æ˜¯AbsVal_layer_creator()ï¼Œè¿™é‡Œå°±æ¶‰åŠåˆ°ncnnè¿˜æœ‰ä¸€å±‚ç»§æ‰¿ï¼Œä½¿ç”¨cmakeç¼–è¯‘ncnné¡¹ç›®åï¼Œé™¤äº†ç”Ÿæˆäº†layer_registry.hæ–‡ä»¶ä¹‹å¤–ï¼Œè¿˜ç”Ÿæˆäº†ä¸€ä¸ªlayer_declaration.hæ–‡ä»¶ï¼Œæ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œä¸€åˆ‡å°±æ¸…æ¥šäº†ï¼š</p><pre><code class="hljs cpp"><span class="hljs-comment">// Layer Declaration header</span><span class="hljs-comment">//</span><span class="hljs-comment">// This file is auto-generated by cmake, don&#x27;t edit it.</span> <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;layer/absval.h&quot;</span></span><span class="hljs-keyword">namespace</span> ncnn &#123;    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AbsVal_final</span> :</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">public</span> AbsVal&#123;<span class="hljs-keyword">public</span>:    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">create_pipeline</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Option&amp; opt)</span> </span>&#123;        &#123; <span class="hljs-keyword">int</span> ret = AbsVal::create_pipeline(opt); <span class="hljs-keyword">if</span> (ret) <span class="hljs-keyword">return</span> ret; &#125;        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">destroy_pipeline</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Option&amp; opt)</span> </span>&#123;        &#123; <span class="hljs-keyword">int</span> ret = AbsVal::destroy_pipeline(opt); <span class="hljs-keyword">if</span> (ret) <span class="hljs-keyword">return</span> ret; &#125;        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    &#125;&#125;;DEFINE_LAYER_CREATOR(AbsVal_final)&#125; <span class="hljs-comment">// namespace ncnn</span> <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;layer/batchnorm.h&quot;</span></span><span class="hljs-keyword">namespace</span> ncnn &#123;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BatchNorm_final</span> :</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">public</span> BatchNorm&#123;<span class="hljs-keyword">public</span>:    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">create_pipeline</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Option&amp; opt)</span> </span>&#123;        &#123; <span class="hljs-keyword">int</span> ret = BatchNorm::create_pipeline(opt); <span class="hljs-keyword">if</span> (ret) <span class="hljs-keyword">return</span> ret; &#125;        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">destroy_pipeline</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Option&amp; opt)</span> </span>&#123;        &#123; <span class="hljs-keyword">int</span> ret = BatchNorm::destroy_pipeline(opt); <span class="hljs-keyword">if</span> (ret) <span class="hljs-keyword">return</span> ret; &#125;        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    &#125;&#125;;DEFINE_LAYER_CREATOR(BatchNorm_final)&#125; <span class="hljs-comment">// namespace ncnn</span></code></pre><p>â€‹    AbsVal_finalå±‚ç»§æ‰¿äº†AbsValå±‚ï¼Œå¦‚æœå½“å‰æ“ä½œç³»ç»Ÿä¸æ˜¯linuxç³»ç»Ÿï¼Œå°±ä¼šå°†create_pipeline()å’Œdestroy_pipeline()æŠ½è±¡å‡ºæ¥ï¼Œå…·ä½“è°ƒç”¨æ—¶ï¼Œå°±è°ƒç”¨å¯¹åº”ä¼˜åŒ–äº†çš„ä»£ç ã€‚é‚£ä¹ˆlayerè½½å…¥ParamDictå…·ä½“å®ç°å°±å¯¹åº”äºå„ä¸ªlayerçš„è½½å…¥æµç¨‹äº†ã€‚</p><h6 id="3-3-binæ–‡ä»¶"><a href="#3-3-binæ–‡ä»¶" class="headerlink" title="3.3 binæ–‡ä»¶"></a>3.3 binæ–‡ä»¶</h6><p>â€‹    å‰é¢å·²ç»å¤§è‡´æ€»ç»“äº†ncnnçš„paramæ–‡ä»¶è½½å…¥ï¼Œæ ¹æ®paramæ–‡ä»¶åˆ›å»ºç½‘ç»œç»“æ„ï¼Œç„¶åé€šè¿‡binæ–‡ä»¶è½½å…¥æ¯ä¸€å±‚å¯¹åº”çš„ç½‘ç»œå‚æ•°ã€‚è¿™é‡Œå°±æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚ä½•è½½å…¥æ¯ä¸€å±‚çš„å‚æ•°ï¼š</p><p>â€‹        æˆ‘ä»¬å¸¸ç”¨çš„ç½‘ç»œå‚æ•°è½½å…¥çš„æ¥å£ä¸ºï¼š</p><pre><code class="hljs reasonml"><span class="hljs-comment">// ä»äºŒè¿›åˆ¶æ–‡ä»¶ä¸­è½½å…¥æ¨¡å‹</span><span class="hljs-built_in">int</span> load<span class="hljs-constructor">_model(<span class="hljs-params">const</span> <span class="hljs-params">char</span><span class="hljs-operator">*</span> <span class="hljs-params">modelpath</span>)</span>;</code></pre><p>â€‹    æ‰¾åˆ°å¯¹åº”net.cppæ–‡ä»¶å®ç°éƒ¨åˆ†æœ‰ï¼š</p><pre><code class="hljs cpp"><span class="hljs-comment">// ä»äºŒè¿›åˆ¶æ–‡ä»¶ä¸­è½½å…¥æ¨¡å‹</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Net::load_model</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* modelpath)</span></span><span class="hljs-function"></span>&#123;    FILE* fp = fopen(modelpath, <span class="hljs-string">&quot;rb&quot;</span>);    <span class="hljs-keyword">if</span> (!fp)    &#123;        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;fopen %s failed\n&quot;</span>, modelpath);        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;    &#125;     <span class="hljs-keyword">int</span> ret = load_model(fp);     fclose(fp);     <span class="hljs-keyword">return</span> ret;&#125;</code></pre><p>å’Œè½½å…¥æ¨¡å‹å‚æ•°ä¸€æ ·ï¼Œncnnæ¨¡å‹è½½å…¥è¿™é‡Œè°ƒç”¨äº†å¦å¤–ä¸€ä¸ªæ¥å£ï¼Œä»æ–‡ä»¶æŒ‡é’ˆè½½å…¥æƒé‡å‚æ•°ï¼š</p><pre><code class="hljs cpp"><span class="hljs-comment">// ä»æ–‡ä»¶æŒ‡é’ˆè½½å…¥æ¨¡å‹</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Net::load_model</span><span class="hljs-params">(FILE* fp)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span> (layers.empty()) <span class="hljs-comment">// åˆ¤æ–­å½“å‰layeræ˜¯å¦ä¸ºç©º</span>    &#123;        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;network graph not ready\n&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;    &#125;        <span class="hljs-keyword">int</span> ret = <span class="hljs-number">0</span>;     <span class="hljs-comment">// load file</span>    <span class="hljs-function">ModelBinFromStdio <span class="hljs-title">mb</span><span class="hljs-params">(fp)</span></span>;     <span class="hljs-comment">// ä»äºŒè¿›åˆ¶æ–‡ä»¶è¯»å–</span>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i=<span class="hljs-number">0</span>; i&lt;layers.size(); i++)     <span class="hljs-comment">// éå†æ‰€æœ‰çš„å±‚</span>    &#123;        Layer* layer = layers[i]; <span class="hljs-comment">// è¯»å–ç¬¬iå±‚</span>        <span class="hljs-comment">//Here we found inconsistent content in the parameter file.</span>        <span class="hljs-keyword">if</span> (!layer)&#123;    <span class="hljs-comment">// å¦‚æœç¬¬iå±‚ä¸å­˜åœ¨</span>            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;load_model error at layer %d, parameter file has inconsistent content.\n&quot;</span>, (<span class="hljs-keyword">int</span>)i);            ret = <span class="hljs-number">-1</span>;            <span class="hljs-keyword">break</span>;        &#125;         <span class="hljs-comment">// è½½å…¥æ¨¡å‹å‚æ•°</span>        <span class="hljs-keyword">int</span> lret = layer-&gt;load_model(mb);        <span class="hljs-keyword">if</span> (lret != <span class="hljs-number">0</span>)        &#123;            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;layer load_model %d failed\n&quot;</span>, (<span class="hljs-keyword">int</span>)i);            ret = <span class="hljs-number">-1</span>;            <span class="hljs-keyword">break</span>;        &#125;         <span class="hljs-keyword">int</span> cret = layer-&gt;create_pipeline(opt);  <span class="hljs-comment">// ä»optå¤„åˆ›å»ºç½‘ç»œçš„pipline</span>        <span class="hljs-keyword">if</span> (cret != <span class="hljs-number">0</span>) <span class="hljs-comment">// å¦‚æœåˆ›å»ºç¬¬iå±‚çš„piplineå¤±è´¥</span>        &#123;            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;layer create_pipeline %d failed\n&quot;</span>, (<span class="hljs-keyword">int</span>)i);            ret = <span class="hljs-number">-1</span>;            <span class="hljs-keyword">break</span>;        &#125;    &#125;     <span class="hljs-comment">// ç½‘ç»œå¤ç”¨</span>    fuse_network();    <span class="hljs-keyword">return</span> ret;&#125;</code></pre><p>â€‹    æŒ‰ç…§ä»£ç æ³¨é‡Šï¼Œåº”è¯¥è¿˜æ˜¯æ¯”è¾ƒå¥½æ‡‚å¾—ï¼Œè¿™é‡Œéœ€è¦è§£æä¸¤ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€ä¸ªéƒ¨åˆ†ä¸º<strong>ModelBinFromStdio</strong>ï¼Œå¯¹åº”äºäºŒè¿›åˆ¶æ¨¡å‹æ–‡ä»¶è§£æï¼Œå¦å¤–ä¸€éƒ¨åˆ†ä¸º <strong>layer-&gt;load_model(mb)</strong>ï¼Œå¯¹åº”äºå…·ä½“æŸä¸ªå±‚çš„å‚æ•°è½½å…¥ï¼š</p><p>â€‹    ï¼ˆ1ï¼‰äºŒè¿›åˆ¶æ¨¡å‹æ–‡ä»¶è§£æ</p><p>â€‹    è¿™é‡Œå¯¹åº”äºmodelbin.hå’Œmodelbin.cppæ–‡ä»¶ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹modelbin.hæ–‡ä»¶ï¼š</p><pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ModelBin</span></span><span class="hljs-class">&#123;</span><span class="hljs-keyword">public</span>:    <span class="hljs-keyword">virtual</span> ~ModelBin();    <span class="hljs-comment">// element type</span>    <span class="hljs-comment">// 0 = auto</span>    <span class="hljs-comment">// 1 = float32</span>    <span class="hljs-comment">// 2 = float16</span>    <span class="hljs-comment">// 3 = int8</span>    <span class="hljs-comment">// load vec</span>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> Mat <span class="hljs-title">load</span><span class="hljs-params">(<span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> type)</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;    <span class="hljs-comment">// load image</span>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> Mat <span class="hljs-title">load</span><span class="hljs-params">(<span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h, <span class="hljs-keyword">int</span> type)</span> <span class="hljs-keyword">const</span></span>;    <span class="hljs-comment">// load dim</span>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> Mat <span class="hljs-title">load</span><span class="hljs-params">(<span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> h, <span class="hljs-keyword">int</span> c, <span class="hljs-keyword">int</span> type)</span> <span class="hljs-keyword">const</span></span>;&#125;; <span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> NCNN_STDIO</span><span class="hljs-comment">// è½½å…¥æ¨¡å‹å‚æ•°åˆ°ä¸€ä¸ªMatä¸­</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ModelBinFromStdio</span> :</span> <span class="hljs-keyword">public</span> ModelBin&#123;<span class="hljs-keyword">public</span>:    <span class="hljs-comment">// construct from file</span>    ModelBinFromStdio(FILE* binfp);     <span class="hljs-function"><span class="hljs-keyword">virtual</span> Mat <span class="hljs-title">load</span><span class="hljs-params">(<span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> type)</span> <span class="hljs-keyword">const</span></span>; <span class="hljs-keyword">protected</span>:    FILE* binfp;&#125;;<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// NCNN_STDIO</span></span> <span class="hljs-comment">// è½½å…¥æ¨¡å‹å‚æ•°åˆ°ä¸€ä¸ªMatä¸­</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ModelBinFromMemory</span> :</span> <span class="hljs-keyword">public</span> ModelBin&#123;<span class="hljs-keyword">public</span>:    <span class="hljs-comment">// construct from external memory</span>    ModelBinFromMemory(<span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>*&amp; mem);     <span class="hljs-function"><span class="hljs-keyword">virtual</span> Mat <span class="hljs-title">load</span><span class="hljs-params">(<span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> type)</span> <span class="hljs-keyword">const</span></span>; <span class="hljs-keyword">protected</span>:    <span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>*&amp; mem;&#125;; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ModelBinFromMatArray</span> :</span> <span class="hljs-keyword">public</span> ModelBin&#123;<span class="hljs-keyword">public</span>:    <span class="hljs-comment">// construct from weight blob array</span>    ModelBinFromMatArray(<span class="hljs-keyword">const</span> Mat* weights);     <span class="hljs-function"><span class="hljs-keyword">virtual</span> Mat <span class="hljs-title">load</span><span class="hljs-params">(<span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> type)</span> <span class="hljs-keyword">const</span></span>; <span class="hljs-keyword">protected</span>:    <span class="hljs-keyword">mutable</span> <span class="hljs-keyword">const</span> Mat* weights;&#125;;</code></pre><p>   æ‰¾åˆ°å¯¹åº”å®ç°éƒ¨åˆ†ï¼Œå°±æ˜¯modelbin.cppï¼Œå¯ä»¥çœ‹åˆ°ï¼ŒModelBinFromStdio mb(fp);å°±æ˜¯å°†æ–‡ä»¶æŒ‡é’ˆä¼ ç»™binfpå¯¹è±¡</p><pre><code class="hljs cpp">ModelBinFromStdio::ModelBinFromStdio(FILE* _binfp) : binfp(_binfp)&#123;&#125;</code></pre><p>â€‹    ä¸‹é¢å†çœ‹ä¸€ä¸‹layerè½½å…¥å‚æ•°ï¼Œlayerå…·ä½“æ“ä½œå¯¹åº”äºå…·ä½“ç±»å‹çš„å±‚æ“ä½œï¼Œä¾‹å¦‚batchnormï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p><pre><code class="hljs cpp"><span class="hljs-comment">// è½½å…¥æ¨¡å‹</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">BatchNorm::load_model</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ModelBin&amp; mb)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-comment">// slopeæ•°æ®</span>    slope_data = mb.load(channels, <span class="hljs-number">1</span>);    <span class="hljs-comment">// è½½å…¥å¤±è´¥ï¼šè¿”è¿˜-100</span>    <span class="hljs-keyword">if</span> (slope_data.empty())        <span class="hljs-keyword">return</span> <span class="hljs-number">-100</span>;     <span class="hljs-comment">// meanæ•°æ®</span>    mean_data = mb.load(channels, <span class="hljs-number">1</span>);    <span class="hljs-comment">// è½½å…¥æ•°æ®å¤±è´¥ï¼Œè¿”è¿˜-100</span>    <span class="hljs-keyword">if</span> (mean_data.empty())        <span class="hljs-keyword">return</span> <span class="hljs-number">-100</span>;     <span class="hljs-comment">// varianceæ•°æ®</span>    var_data = mb.load(channels, <span class="hljs-number">1</span>);    <span class="hljs-comment">// è½½å…¥æ•°æ®å¤±è´¥ï¼Œè¿”è¿˜-100</span>    <span class="hljs-keyword">if</span> (var_data.empty())        <span class="hljs-keyword">return</span> <span class="hljs-number">-100</span>;     <span class="hljs-comment">// biasæ•°æ®</span>    bias_data = mb.load(channels, <span class="hljs-number">1</span>);    <span class="hljs-comment">// è½½å…¥æ•°æ®å¤±è´¥ï¼Œè¿”è¿˜-100</span>    <span class="hljs-keyword">if</span> (bias_data.empty())        <span class="hljs-keyword">return</span> <span class="hljs-number">-100</span>;     <span class="hljs-comment">// åˆ›å»ºçŸ©é˜µ</span>    a_data.create(channels);    <span class="hljs-keyword">if</span> (a_data.empty())        <span class="hljs-keyword">return</span> <span class="hljs-number">-100</span>;    <span class="hljs-comment">// åˆ›å»ºçŸ©é˜µ</span>    b_data.create(channels);    <span class="hljs-keyword">if</span> (b_data.empty())        <span class="hljs-keyword">return</span> <span class="hljs-number">-100</span>;     <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;channels; i++)    &#123;        <span class="hljs-comment">// sqrt variance</span>        <span class="hljs-keyword">float</span> sqrt_var = <span class="hljs-built_in">sqrt</span>(var_data[i] + eps);        a_data[i] = bias_data[i] - slope_data[i] * mean_data[i] / sqrt_var;        b_data[i] = slope_data[i] / sqrt_var;    &#125;     <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ModelBinFromStdio çš„loadæ¥å£ï¼š</p><pre><code class="hljs cpp"><span class="hljs-function">Mat <span class="hljs-title">ModelBinFromStdio::load</span><span class="hljs-params">(<span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> type)</span> <span class="hljs-keyword">const</span></span></code></pre><p>åé¢typeå¯¹åº”æœ‰å››ç§ç±»å‹ï¼šautoï¼Œfloat32ï¼Œfloat16å’Œint8</p><pre><code class="hljs cpp"><span class="hljs-comment">// 0 = auto</span><span class="hljs-comment">// 1 = float32</span><span class="hljs-comment">// 2 = float16</span><span class="hljs-comment">// 3 = int8</span></code></pre><p> ç„¶åï¼Œæ ¹æ®è¿™å››ç§ç±»å‹è¿›è¡Œæ¨¡å‹å‚æ•°è½½å…¥ï¼Œæ„Ÿè§‰æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œä¸»è¦æ˜¯é‡Œé¢æœ‰ä¸ªalignSizeå‡½æ•°éœ€è¦åšä¸ªç¬”è®°ï¼š</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">size_t</span> <span class="hljs-title">alignSize</span><span class="hljs-params">(<span class="hljs-keyword">size_t</span> sz, <span class="hljs-keyword">int</span> n)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">return</span> (sz + n<span class="hljs-number">-1</span>) &amp; -n;&#125;</code></pre><p>alignSizeå°±æ˜¯ç”³è¯·szå¤§å°çš„å†…å­˜ï¼Œå®é™…ç”³è¯·å†…å­˜æ˜¯ y =(sz+n-1)&amp;-n å¤§å°çš„å†…å­˜ï¼Œy &gt;= szï¼Œä¸”yæ˜¯nçš„æ•´æ•°å€ï¼Œç„¶åå¯¹(sz+n-1)&amp; -nçš„è§£é‡Šæ˜¯ï¼š</p><p>â€‹    å‡è®¾nä¸º16ï¼Œ-nå°±æ˜¯0xfffffff0ï¼Œ(sz+n-1)ï¼ŒåŠ è¿™ä¸ªn-1ä¸€æ˜¯ä¸ºäº†ä¿è¯szåˆšå¥½æ˜¯16çš„å€æ•°ä¸ä¼šå¤šç®—ï¼ŒäºŒåä¸ºäº†é˜²æ­¢ä¸æ˜¯16çš„å€æ•°ä¼šå°‘ç®—ï¼Œå¦‚ï¼Œsz=3, å°±æ˜¯ä»äºŒè¿›åˆ¶è§’åº¦èˆå¼ƒ19å°äº16éƒ¨åˆ†ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ncnnæºç åˆ†æ_0</title>
    <link href="/2020/09/17/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-0/"/>
    <url>/2020/09/17/ncnn%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-0/</url>
    
    <content type="html"><![CDATA[<p>ncnn æºç åˆ†æç¬¬ä¸€ç¯‡</p><a id="more"></a><p>ncnn æ˜¯ä¸€ä¸ªæ¶æ„æ¯”è¾ƒç®€å•çš„æ·±åº¦å­¦ä¹ æ¨å¯¼æ¡†æ¶ã€‚ å…¶é¡¹ç›®ç›®å½•å¦‚ä¸‹æ‰€ç¤º:</p><pre><code class="hljs ncnn">.â”œâ”€â”€ CMakeLists.txtâ”œâ”€â”€ CONTRIBUTING.mdâ”œâ”€â”€ Info.plistâ”œâ”€â”€ LICENSE.txtâ”œâ”€â”€ README.mdâ”œâ”€â”€ benchmarkâ”œâ”€â”€ build.shâ”œâ”€â”€ cmakeâ”œâ”€â”€ docs    &#x2F;&#x2F; æ–‡æ¡£â”œâ”€â”€ examples    &#x2F;&#x2F; å®ä¾‹â”œâ”€â”€ images   &#x2F;&#x2F; å›¾ç‰‡â”œâ”€â”€ package.shâ”œâ”€â”€ src      &#x2F;&#x2F; ä¸»è¦çš„æºä»£ç â”‚   â”œâ”€â”€ arm &#x2F;&#x2F; é’ˆå¯¹äº arm å¹³å°çš„ä¼˜åŒ–â”‚   â”œâ”€â”€ mips &#x2F;&#x2F; é’ˆå¯¹äº mips å¹³å°çš„ä¼˜åŒ–â”‚   â”œâ”€â”€ vulkan &#x2F;&#x2F; GPU ä¼˜åŒ–ä»£ç â”‚   â”œâ”€â”€ x86 &#x2F;&#x2F; é’ˆå¯¹äº x86 å¹³å°çš„ä¼˜åŒ–â”œâ”€â”€ ... &#x2F;&#x2F; é€šç”¨å¹³å°ä»£ç â””â”€â”€ xxx.hâ”œâ”€â”€ tests  &#x2F;&#x2F; æµ‹è¯•â”œâ”€â”€ toolchainsâ””â”€â”€ tools   &#x2F;&#x2F; å·¥å…·: (1) å…¶ä»–æ¨¡å‹ -&gt; ncnn  (2) æ¨¡å‹ä¼˜åŒ–å’Œé‡åŒ–</code></pre><p>æœ¬ç³»åˆ—æ—¨åœ¨äºå»æ·±å…¥äº†è§£ ncnn çš„å†…éƒ¨æœºç†ï¼Œ ä¸»è¦åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><p>ncnn æºç åˆ†æ_1  å‚æ•°ä¸æ¨¡å‹è½½å…¥</p><p>ncnn æºç åˆ†æ_2 Extractor</p><p>ncnn æºç åˆ†æ_3 æ¨¡å‹é‡åŒ–åŸç†</p><p>ncnn æºç åˆ†æ_4 æ¨¡å‹é‡åŒ–æºç </p><p>ncnn æºç åˆ†æ_5 æ·»åŠ  layer</p><p>ncnn æºç åˆ†æ_6 å±‚åˆ†æ</p>]]></content>
    
    
    <categories>
      
      <category>DL_Deploy</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>mxnet2ncnn</title>
    <link href="/2020/09/17/mxnet2ncnn/"/>
    <url>/2020/09/17/mxnet2ncnn/</url>
    
    <content type="html"><![CDATA[<p>mxnet2ncnn éƒ¨ç½²æ–¹æ¡ˆ</p><a id="more"></a><h4 id="1-ä¸‹è½½å¹¶ç¼–è¯‘-ncnn-æ¡†æ¶"><a href="#1-ä¸‹è½½å¹¶ç¼–è¯‘-ncnn-æ¡†æ¶" class="headerlink" title="1. ä¸‹è½½å¹¶ç¼–è¯‘ ncnn æ¡†æ¶"></a>1. ä¸‹è½½å¹¶ç¼–è¯‘ ncnn æ¡†æ¶</h4><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> install xcode and protobuf</span><span class="hljs-meta">#</span><span class="bash"> install protobuf</span><span class="hljs-meta">$</span><span class="bash"> brew install protobuf</span><span class="hljs-meta">#</span><span class="bash"> build &amp; install ncnn</span><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> &lt;ncnn-root-dir&gt;</span><span class="hljs-meta">$</span><span class="bash"> mkdir -p build</span><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> build</span><span class="hljs-meta">$</span><span class="bash"> cmake -DNCNN_VULKAN=OFF ..</span><span class="hljs-meta">$</span><span class="bash"> make -j4</span><span class="hljs-meta">$</span><span class="bash"> make install</span></code></pre><h4 id="2-model-slim"><a href="#2-model-slim" class="headerlink" title="2. model slim"></a>2. model slim</h4><p>ä»å¦‚ä¸‹åœ°å€ä¸‹è½½ mobileface çš„æ–‡ä»¶ï¼š</p><p><a href="https://pan.baidu.com/s/1If28BkHde4fiuweJrbicVA"><strong>https://pan.baidu.com/s/1If28BkHde4fiuweJrbicVA</strong></a></p><p>è§£å‹å¯ä»¥å¾—åˆ°ä¸‰ä¸ªæ–‡ä»¶ï¼š  logã€model-0000.params å’Œ model-symbol.json</p><p>æ‰§è¡Œï¼š</p><pre><code class="hljs shell">python model_slim.py  --model  ../models/model-y1-test2/model,0</code></pre><p>æ­¤æ—¶ ä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼š../models/model-y1-test2/models-</p><h4 id="3-ä½¿ç”¨-mxnet2ncnn-å·¥å…·æ¥è½¬åŒ–æ¨¡å‹"><a href="#3-ä½¿ç”¨-mxnet2ncnn-å·¥å…·æ¥è½¬åŒ–æ¨¡å‹" class="headerlink" title="3. ä½¿ç”¨ mxnet2ncnn å·¥å…·æ¥è½¬åŒ–æ¨¡å‹"></a>3. ä½¿ç”¨ mxnet2ncnn å·¥å…·æ¥è½¬åŒ–æ¨¡å‹</h4><pre><code class="hljs shell">cd ncnn/build/tools/mxnet./mxnet2ncnn models-symbol.json models-0000.params mobilefacenet.param mobilefacenet.bin</code></pre><p>ç”Ÿæˆä¸¤ä¸ªæ–°çš„æ–‡ä»¶ mobilefacenet.param ï¼Œmobilefacenet.binï¼Œè¿™å°±æ˜¯æˆ‘ä»¬éƒ¨ç½² ncnn éœ€è¦ç”¨åˆ°çš„æ–‡ä»¶ã€‚</p><h4 id="4-é¡¹ç›®æ„å»º"><a href="#4-é¡¹ç›®æ„å»º" class="headerlink" title="4.  é¡¹ç›®æ„å»º"></a>4.  é¡¹ç›®æ„å»º</h4><pre><code class="hljs crystal">arcface æˆ‘ä»¬çš„ä¸»é¡¹ç›®æ–‡ä»¶image  å­˜å‚¨æµ‹è¯•å›¾åƒæ–‡ä»¶models  å­˜å‚¨æˆ‘ä»¬çš„è½¬æ¢å®Œæˆçš„ äººè„¸æ£€æµ‹ã€äººè„¸è¯†åˆ«æ¨¡å‹ncnn  å­˜æ”¾ ncnn çš„ <span class="hljs-class"><span class="hljs-keyword">lib</span> å’Œ <span class="hljs-title">include</span> æ–‡ä»¶</span>Makefile æ–‡ä»¶</code></pre><p>å…¶ä¸­ arcface å­˜æ”¾ç›¸å…³æ–‡ä»¶å’Œ Makefile æ–‡ä»¶ã€‚è¿›å…¥ä¸»é¡¹ç›®æ–‡ä»¶ make ç„¶åæ‰§è¡Œ ./main å³å¯ã€‚</p><p>éœ€è¦é‡ç‚¹ç ”ç©¶çš„æ–‡ä»¶ï¼šï¼ˆ1ï¼‰ model_slim.py   ï¼ˆ2ï¼‰arcface ä¸‹çš„ å››ä¸ª æ–‡ä»¶ arcface/mtcnn/base/Makefile æ–‡ä»¶ã€‚</p><p>â€‹    ncnnåªæ˜¯ä¸€ä¸ªå‰å‘æ¨æ–­çš„åº“ï¼Œåˆ©ç”¨å®ƒå¯ä»¥å¿«é€Ÿå®Œæˆå‰å‘ä¼ æ’­ã€‚åœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°†å›¾ç‰‡ä¼ ç»™MTCNNï¼Œ åˆ†åˆ«ç»è¿‡ä¸‰ä¸ªç½‘ç»œPnetã€RNetã€ONetï¼Œç„¶åäº§ç”Ÿå¾…æ£€æµ‹çš„äººè„¸ï¼Œ ç„¶åå†å°†å¾…æ£€æµ‹çš„äººè„¸é€ç»™facentï¼Œ æœ€åæ¯”å¯¹äº§ç”Ÿçš„128Då‘é‡çš„è·ç¦»ã€‚è¿™æ ·å°±å¯ä»¥å®Œæˆäººè„¸çš„è¯†åˆ«ã€‚å…·ä½“ç»“åˆä»£ç æ¥è¯´ï¼š</p><p>ä¸‹é¢è¿™ä¸ªå‡½æ•°æ˜¯MTCNNçš„ä¸»è¦çš„æ¥å£æ–‡ä»¶ï¼š</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;FaceInfo&gt; <span class="hljs-title">MtcnnDetector::Detect</span><span class="hljs-params">(ncnn::Mat img)</span></span>&#123;    <span class="hljs-keyword">int</span> img_w = img.w;  <span class="hljs-comment">// è·å– å®½åº¦</span>    <span class="hljs-keyword">int</span> img_h = img.h; <span class="hljs-comment">// è·å–é«˜åº¦</span>    <span class="hljs-built_in">vector</span>&lt;FaceInfo&gt; pnet_results = Pnet_Detect(img);  <span class="hljs-comment">// è®©å›¾ç‰‡ç»è¿‡PNet</span>    doNms(pnet_results, <span class="hljs-number">0.7</span>, <span class="hljs-string">&quot;union&quot;</span>);  <span class="hljs-comment">// å¯¹è¾“å‡ºçš„ç»“æœè¿›è¡Œnms</span>    refine(pnet_results, img_h, img_w, <span class="hljs-literal">true</span>);  <span class="hljs-comment">// refineï¼ŒæŠŠç»“æœæ”¾åœ¨ pnet_results ä¸­</span>    <span class="hljs-built_in">vector</span>&lt;FaceInfo&gt; rnet_results = Rnet_Detect(img, pnet_results);  <span class="hljs-comment">// è®©å›¾ç‰‡ç»è¿‡ RNet</span>    doNms(rnet_results, <span class="hljs-number">0.7</span>, <span class="hljs-string">&quot;union&quot;</span>); <span class="hljs-comment">// å¯¹è¾“å‡ºç»“æœè¿›è¡Œ nms</span>    refine(rnet_results, img_h, img_w, <span class="hljs-literal">true</span>); <span class="hljs-comment">// refineï¼Œ æŠŠç»“æœæ”¾åœ¨ Rnet_resultsä¸­</span>    <span class="hljs-built_in">vector</span>&lt;FaceInfo&gt; onet_results = Onet_Detect(img, rnet_results);  <span class="hljs-comment">// æŠŠå›¾ç‰‡ ç»è¿‡ Onet</span>    refine(onet_results, img_h, img_w, <span class="hljs-literal">false</span>);  <span class="hljs-comment">// refine</span>    doNms(onet_results, <span class="hljs-number">0.7</span>, <span class="hljs-string">&quot;min&quot;</span>);  <span class="hljs-comment">//  å¯¹æœ€åçš„ç»“æœè¿›è¡Œrefine</span>    Lnet_Detect(img, onet_results);  <span class="hljs-comment">// åå¤„ç†</span>    <span class="hljs-keyword">return</span> onet_results;  <span class="hljs-comment">// è¿”å›æ£€æµ‹ç»“æœ</span>&#125;</code></pre><p>è¿™ä¸ªæ–‡ä»¶æ˜¯ facenet çš„å‰å‘æ¨æ–­æ¡†æ¶ï¼š</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; <span class="hljs-title">Arcface::getFeature</span><span class="hljs-params">(ncnn::Mat img)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; feature;    ncnn::Mat in = resize(img, <span class="hljs-number">112</span>, <span class="hljs-number">112</span>); <span class="hljs-comment">// å°†äººè„¸è°ƒæ•´åˆ° 112x112</span>    in = bgr2rgb(in); <span class="hljs-comment">// é€šé“å˜å¹»</span>    ncnn::Extractor ex = net.create_extractor();  <span class="hljs-comment">// è®¾ç½®æå–å™¨</span>    ex.set_light_mode(<span class="hljs-literal">true</span>);      ex.input(<span class="hljs-string">&quot;data&quot;</span>, in);  <span class="hljs-comment">// è®©å›¾ç‰‡è¿›å…¥ç½‘ç»œ</span>    ncnn::Mat out;    ex.extract(<span class="hljs-string">&quot;fc1&quot;</span>, out);  <span class="hljs-comment">// æå–å‡º fc1 å±‚çš„ç»“æœ</span>    feature.resize(<span class="hljs-keyword">this</span>-&gt;feature_dim);  <span class="hljs-comment">// ç»“æœresize</span>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>-&gt;feature_dim; i++)         feature[i] = out[i];      normalize(feature); <span class="hljs-comment">// æ­£åˆ™åŒ–ç‰¹å¾</span>    <span class="hljs-keyword">return</span> feature; <span class="hljs-comment">// è¿”å›ç‰¹å¾</span>&#125;</code></pre><p>ä¸‹é¢è¿™ä¸ªæ–‡ä»¶æ˜¯ main.cppï¼Œ ç°åœ¨çœ‹æ¥éå¸¸ç®€å•äº†</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span></span><span class="hljs-function"></span>&#123;    Mat img1;    Mat img2;    img1 = imread(<span class="hljs-string">&quot;../image/gyy1.jpeg&quot;</span>);  <span class="hljs-comment">// è¯»å–å›¾ç‰‡</span>    img2 = imread(<span class="hljs-string">&quot;../image/gyy2.jpeg&quot;</span>);    ncnn::Mat ncnn_img1 = ncnn::Mat::from_pixels(img1.data, ncnn::Mat::PIXEL_BGR, img1.cols, img1.rows);  <span class="hljs-comment">// è½¬æ¢ä¸º ncnn æ ¼å¼</span>    ncnn::Mat ncnn_img2 = ncnn::Mat::from_pixels(img2.data, ncnn::Mat::PIXEL_BGR, img2.cols, img2.rows);    <span class="hljs-comment">// æ£€æµ‹</span>    <span class="hljs-function">MtcnnDetector <span class="hljs-title">detector</span><span class="hljs-params">(<span class="hljs-string">&quot;../../models&quot;</span>)</span></span>;     <span class="hljs-built_in">vector</span>&lt;FaceInfo&gt; results1 = detector.Detect(ncnn_img1);    <span class="hljs-built_in">vector</span>&lt;FaceInfo&gt; results2 = detector.Detect(ncnn_img2);    <span class="hljs-comment">// å¤„ç†æ£€æµ‹ç»“æœï¼Œå…¶å®å°±æ˜¯æå–å›¾ç‰‡</span>    ncnn::Mat det1 = preprocess(ncnn_img1, results1[<span class="hljs-number">0</span>]);    ncnn::Mat det2 = preprocess(ncnn_img2, results2[<span class="hljs-number">0</span>]);     <span class="hljs-function">Arcface <span class="hljs-title">arc</span><span class="hljs-params">(<span class="hljs-string">&quot;../../models&quot;</span>)</span></span>;    <span class="hljs-comment">// æå–ç‰¹å¾</span>    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; feature1 = arc.getFeature(det1);    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">float</span>&gt; feature2 = arc.getFeature(det2);    <span class="hljs-comment">// ç‰¹å¾æ¯”è¾ƒ</span>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;Similarity: &quot;</span> &lt;&lt; calcSimilar(feature1, feature2) &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;;    imshow(<span class="hljs-string">&quot;det1&quot;</span>, ncnn2cv(det1));    imshow(<span class="hljs-string">&quot;det2&quot;</span>, ncnn2cv(det2));    waitKey(<span class="hljs-number">0</span>);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>ç§»åŠ¨ç«¯éƒ¨ç½²è¦ç‚¹</p><p>ä¸»è¦çš„è§£å†³æ–¹æ¡ˆï¼šå°†MTCNN å’Œ facenet çš„æ¥å£ç»„ç»‡æˆä¸ºä¸€ä¸ªäººè„¸ face_reg çš„æ¥å£ï¼Œç„¶åä½¿ç”¨ objective-c è°ƒç”¨è¯¥C++ ä»£ç ï¼Œç„¶ååœ¨ä½¿ç”¨swift è°ƒç”¨ objective-c çš„ä»£ç ã€‚ä¹‹æ‰€ä»¥è¿™æ ·åšæ˜¯å› ä¸ºï¼Œswift ä¸èƒ½è°ƒç”¨ C++ å‘€ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>DL_Deploy</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pytorch2ncnn</title>
    <link href="/2020/09/17/pytorch2ncnn/"/>
    <url>/2020/09/17/pytorch2ncnn/</url>
    
    <content type="html"><![CDATA[<p>å€ŸåŠ© onnx å®ç° pytorch åˆ° ncnn çš„è½¬æ¢</p><a id="more"></a><p><strong>1. å®‰è£… onnx</strong> </p><pre><code class="hljs shell">pip3 install onnx</code></pre><p><strong>2. pytorch model &gt; onnx</strong></p><pre><code class="hljs python"><span class="hljs-keyword">from</span> models.pfld <span class="hljs-keyword">import</span> PFLDInference, AuxiliaryNet<span class="hljs-keyword">from</span> torch.autograd <span class="hljs-keyword">import</span> Variable<span class="hljs-keyword">import</span> onnx<span class="hljs-keyword">import</span> torchcheckpoint = torch.load(<span class="hljs-string">&quot;./checkpoint/snapshot/checkpoint.pth.tar&quot;</span>, map_location=<span class="hljs-string">&#x27;cpu&#x27;</span>)pfld_backbone = PFLDInference()pfld_backbone.load_state_dict(checkpoint[<span class="hljs-string">&#x27;pfld_backbone&#x27;</span>])dummy_input = Variable(torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">112</span>, <span class="hljs-number">112</span>)) torch.onnx.export(plfd_backbone, dummy_input, <span class="hljs-string">&quot;output/plfd.onnx&quot;</span>)model = onnx.load(<span class="hljs-string">&#x27;output/pfld.onnx&#x27;</span>)</code></pre><p><strong>3. å®‰è£…ncnn</strong></p><p>(1) å®‰è£… protobuf</p><pre><code class="hljs shell">unzip protobuf-all-3.7.1.zipcd protobuf-all-3.7.1./configure --prefix=/usr/localmake -j4make check -j4sudo make installsudo ldconfig</code></pre><p>(2) å®‰è£… opencvï¼Œ opencv è¿™é‡Œç”¨çš„æ˜¯2.4.13.6</p><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># æºç ç¼–è¯‘</span></span>unzip opencv-2.4.13.6.zipcd opencv-2.4.13.6mkdir buildcd buildcmake -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/usr/local ..make -j8sudo make installsudo ldconfig</code></pre><p>(3) å®‰è£…ä¾èµ–é¡¹</p><pre><code class="hljs shell">sudo apt-get install build-essentialsudo apt-get install cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-devsudo apt-get install  libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev libjasper-dev libdc1394-22-dev</code></pre><p>(4) æŠŠncnnçš„æºç cloneä¸‹æ¥ï¼Œæˆ‘ä»¬è¿™é‡Œä¸»è¦æƒ³ä½¿ç”¨toolsä¸‹é¢çš„onnxè½¬æ¢å·¥å…·ã€‚</p><p>è¿™é‡Œä½œä¸€ç‚¹ä¿®æ”¹ï¼Œpytorch1.0ä¹‹åæ”¯æŒ0ç»´çš„å¼ é‡ï¼Œè¿™åœ¨ncnnè½¬æ¢ä¸­ä¼šå‡ºç°é—®é¢˜ï¼Œä¿®æ”¹onnx2ncnn.cppä¸­Constantå’ŒMemoryDataçš„è½¬æ¢ï¼Œ<strong>æœ‰2å¤„</strong></p><pre><code class="hljs cpp"><span class="hljs-keyword">if</span> (M.dims_size() == <span class="hljs-number">1</span>) &#123;   <span class="hljs-built_in">fprintf</span>(pp, <span class="hljs-string">&quot; 0=%d&quot;</span>, (<span class="hljs-keyword">int</span>)M.dims(<span class="hljs-number">0</span>));&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (M.dims_size() == <span class="hljs-number">2</span>) &#123;    <span class="hljs-built_in">fprintf</span>(pp, <span class="hljs-string">&quot; 0=%d&quot;</span>, (<span class="hljs-keyword">int</span>)M.dims(<span class="hljs-number">1</span>));    <span class="hljs-built_in">fprintf</span>(pp, <span class="hljs-string">&quot; 1=%d&quot;</span>, (<span class="hljs-keyword">int</span>)M.dims(<span class="hljs-number">0</span>));&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (M.dims_size() == <span class="hljs-number">3</span>) &#123;    <span class="hljs-built_in">fprintf</span>(pp, <span class="hljs-string">&quot; 0=%d&quot;</span>, (<span class="hljs-keyword">int</span>)M.dims(<span class="hljs-number">2</span>));    <span class="hljs-built_in">fprintf</span>(pp, <span class="hljs-string">&quot; 1=%d&quot;</span>, (<span class="hljs-keyword">int</span>)M.dims(<span class="hljs-number">1</span>));    <span class="hljs-built_in">fprintf</span>(pp, <span class="hljs-string">&quot; 2=%d&quot;</span>, (<span class="hljs-keyword">int</span>)M.dims(<span class="hljs-number">0</span>));&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (get_tensor_proto_data_size(M)==<span class="hljs-number">1</span>) &#123;    <span class="hljs-comment">// scalar tensor!!! </span>    <span class="hljs-built_in">fprintf</span>(pp, <span class="hljs-string">&quot; 0=1&quot;</span>);&#125;</code></pre><p>(3) ç¼–è¯‘ ncnn</p><pre><code class="hljs shell">cd ncnnmkdir -p buildcd buildcmake ..make -j4</code></pre><p>è¿™æ ·åœ¨ build/tools/onnx/ ç›®å½•ä¸‹å°±æœ‰è½¬æ¢å·¥å…· onnx2ncnn äº†</p><p><strong>4. ç®€åŒ–ä¸€äº›onnx æ¨¡å‹</strong></p><p>å…ˆåˆ«æ€¥ç€è½¬æ¢ï¼Œonnxè½¬æ¢æ¨¡å‹æ—¶æœ‰ä¸€äº›å†—ä½™ï¼Œæˆ‘ä»¬ç”¨å·¥å…·ç®€åŒ–ä¸€äº›onnxæ¨¡å‹</p><pre><code class="hljs shell">pip3 install onnx-simplifierpython3 -m onnxsim pfld.onnx pfld-sim.onnx</code></pre><p><strong>5.  onnx &gt; ncnn</strong></p><pre><code class="hljs shell">cd ~/xxx/ncnn/build/tools/onnx/./onnx2ncnn pfld-sim.onnx pfld-sim.param pfld-sim.bin</code></pre><p>ç°åœ¨å°±ç”Ÿæˆäº†ä¸¤ä¸ªæ–‡ä»¶å¯ä»¥ä¾›ä½¿ç”¨: <strong>pfld-sim.bin</strong> å’Œ <strong>pfld-sim.param</strong></p><p><strong>6. ç¼–å†™ä¸€ä¸ªå¯ä»¥ä¾›è°ƒç”¨çš„ncnnæ–‡ä»¶è¿›è¡Œè°ƒç”¨å³å¯ã€‚</strong></p><p><strong>é”™è¯¯ä¿¡æ¯:</strong></p><p><strong>Q: Pythonä¸­Import Error: no module named â€˜pastâ€™é”™è¯¯ä»¥åŠè§£å†³æ–¹æ³•</strong></p><pre><code class="hljs shell">pip3 install future</code></pre>]]></content>
    
    
    <categories>
      
      <category>DL_Deploy</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>3Dç‚¹äº‘ç»¼è¿°</title>
    <link href="/2020/09/17/3D%E7%82%B9%E4%BA%91%E7%BB%BC%E8%BF%B0/"/>
    <url>/2020/09/17/3D%E7%82%B9%E4%BA%91%E7%BB%BC%E8%BF%B0/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>æ¢ç´¢</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>å›¾åƒå¤„ç†åŸºç¡€çŸ¥è¯†</title>
    <link href="/2020/09/17/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    <url>/2020/09/17/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>åŸºç¡€</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>æš—å…‰å¢å¼º</title>
    <link href="/2020/09/17/%E6%9A%97%E5%85%89%E5%A2%9E%E5%BC%BA/"/>
    <url>/2020/09/17/%E6%9A%97%E5%85%89%E5%A2%9E%E5%BC%BA/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>æ™ºèƒ½å›¾åƒå¤„ç†</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>leetcode</title>
    <link href="/2020/09/13/leetcode/"/>
    <url>/2020/09/13/leetcode/</url>
    
    <content type="html"><![CDATA[<h2 id="Leetcode-åˆ·é¢˜è®°å½•-ï¼ˆä¸€ï¼‰"><a href="#Leetcode-åˆ·é¢˜è®°å½•-ï¼ˆä¸€ï¼‰" class="headerlink" title="Leetcode åˆ·é¢˜è®°å½• ï¼ˆä¸€ï¼‰"></a>Leetcode åˆ·é¢˜è®°å½• ï¼ˆä¸€ï¼‰</h2><p>ä¸»è¦ç”¨æ¥è®°å½•åœ¨åˆ·é¢˜è¿‡ç¨‹ä¸­çš„å¿ƒå¾—ä½“ä¼šï¼Œ é¢˜ç›®çš„è§£æ³•ï¼Œ å®¹æ˜“çŠ¯çš„é”™è¯¯å’Œé¢˜ç›®åˆ†ç±»ã€‚ä¼°è®¡ä»¥åå¯èƒ½ä¸ä¼šå†åˆ·é¢˜äº†å§ã€‚ ğŸ™‚</p><p>è¿™éƒ¨åˆ†ä¸»è¦æ˜¯å…³äºä¸‰ä¸ªçŸ¥è¯†ç‚¹: æ ˆ/å †/é˜Ÿåˆ—ã€ä½è¿ç®—ã€é“¾è¡¨ã€‚</p><a id="more"></a><h3 id="1-æ ˆã€å †ã€é˜Ÿåˆ—"><a href="#1-æ ˆã€å †ã€é˜Ÿåˆ—" class="headerlink" title="1. æ ˆã€å †ã€é˜Ÿåˆ—"></a>1. æ ˆã€å †ã€é˜Ÿåˆ—</h3><p><strong>å¸¸è§æŠ€å·§æ€»ç»“</strong></p><ul><li>ä¸è¦å¯¹ç©ºå®¹å™¨(æ ˆã€å †ã€é˜Ÿåˆ—è¿›è¡Œæ“ä½œ)</li><li>å•è°ƒæ ˆ/é˜Ÿåˆ—çš„åº”ç”¨</li></ul><p><strong>æ ˆ : å…ˆè¿›åå‡º</strong></p><pre><code class="hljs c++"><span class="hljs-built_in">stack</span>&lt;<span class="hljs-keyword">int</span>&gt; m_stack;size()  empty()push()     pop()     top()</code></pre><p><strong>é˜Ÿåˆ—ï¼šå…ˆè¿›å…ˆå‡º</strong></p><pre><code class="hljs cpp"><span class="hljs-built_in">queue</span>&lt;<span class="hljs-keyword">int</span>&gt; m_queue;size()    empty()push()     pop()     front()</code></pre><p><strong>åŒç«¯é˜Ÿåˆ—</strong></p><pre><code class="hljs cpp"><span class="hljs-built_in">deque</span>&lt;<span class="hljs-keyword">int</span>&gt; m_deque;size()    empty()push_back()   pop_back()    pop_back()   pop_front()    front()    back()</code></pre><p><strong>ä¼˜å…ˆé˜Ÿåˆ—</strong></p><p>å®ç°ï¼šäºŒå‰å †ï¼Œ æœ€å¤§(å°)å€¼ å…ˆå‡ºçš„å®Œå…¨äºŒå‰æ ‘</p><pre><code class="hljs cpp"><span class="hljs-built_in">priority_queue</span>&lt;<span class="hljs-keyword">int</span>&gt; max_heap;      <span class="hljs-comment">// é»˜è®¤æ„é€ æœ€å¤§å †</span><span class="hljs-built_in">priority_queue</span>&lt;<span class="hljs-keyword">int</span>, <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;, less&lt;<span class="hljs-keyword">int</span>&gt; &gt; max_heap;     <span class="hljs-comment">// æ„é€ æœ€å¤§å †</span><span class="hljs-built_in">priority_queue</span>&lt;<span class="hljs-keyword">int</span>, <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;, greater&lt;<span class="hljs-keyword">int</span>&gt; &gt; min_heap;   <span class="hljs-comment">// æ„é€ æœ€å°å † </span>size()    empty()push()     pop()     top()</code></pre><p><strong>[155] <a href="https://leetcode-cn.com/problems/min-stack/">https://leetcode-cn.com/problems/min-stack/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-comment">// è§£é¢˜æ€è·¯:</span><span class="hljs-comment">// ä½¿ç”¨è¾…åŠ©æ ˆè®°å½•æ ˆçš„æœ€å°å€¼</span><span class="hljs-comment">// å½“æ·»åŠ å…ƒç´ æ—¶ï¼Œ å°†å¾…æ·»åŠ å…ƒç´ ä¸è¾…åŠ©æ ˆæ ˆé¡¶å…ƒç´ è¿›è¡Œæ¯”è¾ƒ</span><span class="hljs-comment">//     å½“æ ˆé¡¶å…ƒç´ å°äºå¾…æ·»åŠ å…ƒç´  -&gt; è¾…åŠ©æ ˆæ·»åŠ æ ˆé¡¶å…ƒç´ </span><span class="hljs-comment">//     å½“æ ˆé¡¶å…ƒç´ å¤§äºå¾…æ·»åŠ å…ƒç´  -&gt; è¾…åŠ©æ ˆæ·»åŠ å¾…æ·»åŠ å…ƒç´ </span><span class="hljs-comment">// !! é¢˜ç›®é»˜è®¤å„ç§æ“ä½œåˆæ³•:å³ä¸å›å¯¹ç©ºæ ˆè¿›è¡Œtopã€minå’Œ pop æ“ä½œï¼Œæ‰€ä»¥ä»£ç ä¸­æ²¡æœ‰è¿›è¡Œç›¸å…³åˆ¤å®š</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MinStack</span> &#123;</span><span class="hljs-keyword">public</span>:    <span class="hljs-comment">/** initialize your data structure here. */</span>    MinStack() &#123;    &#125;        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">push</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;        m_stk.push(x);        <span class="hljs-keyword">if</span>(min_stk.empty())   min_stk.push(x);        <span class="hljs-keyword">else</span> min_stk.push(<span class="hljs-built_in">std</span>::min(min_stk.top(), x));    &#125;        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pop</span><span class="hljs-params">()</span> </span>&#123;        m_stk.pop();        min_stk.pop();    &#125;        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">top</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> m_stk.top();    &#125;        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">min</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> min_stk.top();    &#125;<span class="hljs-keyword">private</span>:    <span class="hljs-built_in">stack</span>&lt;<span class="hljs-keyword">int</span>&gt; min_stk;    <span class="hljs-built_in">stack</span>&lt;<span class="hljs-keyword">int</span>&gt; m_stk;&#125;;</code></pre><p><strong>[232] <a href="https://leetcode.com/problems/implement-queue-using-stacks/">https://leetcode.com/problems/implement-queue-using-stacks/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-comment">// è§£é¢˜æ€è·¯:</span><span class="hljs-comment">// (1) ç”³è¯·ä¸¤ä¸ªæ ˆ data_stack å’Œ m_stack</span><span class="hljs-comment">// (2) å½“å…¥é˜Ÿ(æ·»åŠ æ•°æ®)æ—¶, æ‰§è¡Œå¦‚ä¸‹ä¸‰ä¸ªæ­¥éª¤</span><span class="hljs-comment">//      - å°† data_stack ä¸­çš„æ•°æ®é€ä¸ª æ”¾åˆ° m_stack ä¸­</span><span class="hljs-comment">//      - å°† value æ·»åŠ åˆ° m_stack ä¸­</span><span class="hljs-comment">//      - å°† m_stack ä¸­çš„æ•°æ® é€ä¸ªæ”¾å…¥åˆ° data_stack ä¸­ </span><span class="hljs-comment">// (3) å½“å‡ºé˜Ÿ(åˆ é™¤æ•°æ®)æ—¶ï¼Œ ç›´æ¥å¼¹å‡º data_stack æ ˆé¡¶æ•°æ®å³å¯    </span><span class="hljs-keyword">private</span>:    <span class="hljs-built_in">stack</span>&lt;<span class="hljs-keyword">int</span>&gt; data_stack;    <span class="hljs-built_in">stack</span>&lt;<span class="hljs-keyword">int</span>&gt; m_stack;<span class="hljs-keyword">public</span>:    CQueue() &#123;    &#125;        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">appendTail</span><span class="hljs-params">(<span class="hljs-keyword">int</span> value)</span> </span>&#123;        <span class="hljs-keyword">while</span>(!data_stack.empty())&#123;            m_stack.push(data_stack.top());            data_stack.pop();        &#125;        data_stack.push(value);        <span class="hljs-keyword">while</span>(!m_stack.empty())&#123;            data_stack.push(m_stack.top());            m_stack.pop();        &#125;    &#125;        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">deleteHead</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">if</span>(data_stack.empty()) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// è¾¹ç•Œæ¡ä»¶!  æ ˆç©º!</span>              <span class="hljs-keyword">int</span> x = data_stack.top();        data_stack.pop();        <span class="hljs-keyword">return</span> x;    &#125;</code></pre><p><strong>[946] <a href="https://leetcode-cn.com/problems/validate-stack-sequences/">https://leetcode-cn.com/problems/validate-stack-sequences/</a></strong></p><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">validateStackSequences</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; pushed, <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; popped)</span> </span>&#123;    <span class="hljs-built_in">stack</span>&lt;<span class="hljs-keyword">int</span>&gt; m_stk;    <span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;  i &lt; pushed.<span class="hljs-built_in">size</span>(); i++)&#123;        m_stk.push(pushed[i]);        <span class="hljs-keyword">while</span>(!m_stk.empty() &amp;&amp; m_stk.top() == popped[j])&#123;            j++;            m_stk.pop();        &#125;    &#125;    <span class="hljs-keyword">return</span> m_stk.empty();&#125;</code></pre><p><strong>[259] <a href="https://leetcode-cn.com/problems/find-median-from-data-stream/">https://leetcode-cn.com/problems/find-median-from-data-stream/</a></strong></p><p><strong>[lcof 59]<a href="https://leetcode-cn.com/problems/find-median-from-data-stream/">https://leetcode-cn.com/problems/find-median-from-data-stream/</a></strong></p><p><strong>[239] <a href="https://leetcode-cn.com/problems/sliding-window-maximum/">https://leetcode-cn.com/problems/sliding-window-maximum/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-comment">// ä½¿ç”¨äº†å•è°ƒåŒå‘é˜Ÿåˆ—</span><span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">maxSlidingWindow</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; nums, <span class="hljs-keyword">int</span> k)</span> </span>&#123;    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; res;    <span class="hljs-built_in">deque</span>&lt;<span class="hljs-keyword">int</span>&gt; m_deque;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; nums.size(); i++)&#123;        <span class="hljs-keyword">while</span>(!m_deque.empty() &amp;&amp; nums[i] &gt; nums[m_deque.back()])&#123;            m_deque.pop_back();        &#125;        m_deque.push_back(i);   <span class="hljs-comment">// è¿™é‡Œè¿›å…¥é˜Ÿåˆ—çš„æ˜¯ indexï¼Œ è€Œä¸æ˜¯ value</span>        <span class="hljs-keyword">if</span>(i - m_deque.front() &gt;= k) m_deque.pop_front();        <span class="hljs-keyword">if</span>(i &gt;= k<span class="hljs-number">-1</span>) res.push_back(nums[m_deque.front()]);    &#125;    <span class="hljs-keyword">return</span> res;&#125;</code></pre><div class="table-container"><table><thead><tr><th>é¢è¯•é¢˜ 08.14</th><th><a href="https://leetcode-cn.com/problems/boolean-evaluation-lcci">å¸ƒå°”è¿ç®—</a></th></tr></thead><tbody><tr><td>é¢è¯•é¢˜ 17.21</td><td><a href="https://leetcode-cn.com/problems/volume-of-histogram-lcci">ç›´æ–¹å›¾çš„æ°´é‡</a></td></tr><tr><td>225</td><td><a href="https://leetcode.com/problems/implement-stack-using-queues/description/">Implement Stack using Queues</a></td></tr><tr><td>150</td><td><a href="https://leetcode.com/problems/evaluate-reverse-polish-notation/description/">Evaluate Reverse Polish Notation</a></td></tr><tr><td>71</td><td><a href="https://leetcode.com/problems/simplify-path/description/">Simplify Path</a></td></tr><tr><td>388</td><td><a href="https://leetcode.com/problems/longest-absolute-file-path/description/">Longest Absolute File Path</a></td></tr><tr><td>394</td><td><a href="https://leetcode.com/problems/decode-string/">Decode String</a></td></tr><tr><td>224</td><td><a href="https://leetcode.com/problems/basic-calculator/description/">Basic Calculator</a></td></tr><tr><td>227</td><td><a href="https://leetcode.com/problems/basic-calculator-ii/description/">Basic Calculator II</a></td></tr><tr><td>385</td><td><a href="https://leetcode.com/problems/mini-parser/description/">Mini Parser</a></td></tr><tr><td>84</td><td><a href="https://leetcode.com/problems/largest-rectangle-in-histogram/description/">Largest Rectangle in Histogram</a></td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>é¢˜å·</th><th>é¢˜ç›®é“¾æ¥</th><th></th></tr></thead><tbody><tr><td>215</td><td><a href="https://leetcode.com/problems/kth-largest-element-in-an-array/description/">Kth Largest Element in an Array</a></td><td></td></tr><tr><td>347</td><td><a href="https://leetcode.com/problems/top-k-frequent-elements/description/">Top K Frequent Elements</a></td><td></td></tr><tr><td>313</td><td><a href="https://leetcode.com/problems/super-ugly-number/description/">Super Ugly Number</a></td><td>å¾ˆå°‘è€ƒ</td></tr><tr><td>373</td><td><a href="https://leetcode.com/problems/find-k-pairs-with-smallest-sums/description/">Find K Pairs with Smallest Sums</a></td><td>å¾ˆå°‘è€ƒ</td></tr><tr><td>218</td><td><a href="https://leetcode.com/problems/the-skyline-problem/description/">The Skyline Problem</a></td><td></td></tr><tr><td>332</td><td><a href="https://leetcode.com/problems/reconstruct-itinerary/description/">Reconstruct Itinerary</a></td><td></td></tr><tr><td>341</td><td><a href="https://leetcode.com/problems/flatten-nested-list-iterator/">Flatten Nested List Iterator</a></td><td></td></tr><tr><td></td><td></td></tr></tbody></table></div><h3 id="2-ä½è¿ç®—"><a href="#2-ä½è¿ç®—" class="headerlink" title="2. ä½è¿ç®—"></a>2. ä½è¿ç®—</h3><p><img src="/2020/09/13/leetcode/bit.png" alt></p><h5 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h5><pre><code class="hljs cpp"><span class="hljs-comment">// &amp;   ä¸    |   æˆ–    ~  é      ^   å¼‚æˆ–</span><span class="hljs-comment">// æœ€å¸¸è§çš„å‡ ä¸ªç”¨æ³•</span><span class="hljs-comment">// (1) </span>n &amp; (n<span class="hljs-number">-1</span>)  <span class="hljs-comment">// å°†äºŒè¿›åˆ¶ n çš„æœ€åä¸€ä½ ç”± 1 å˜æˆ 0</span>n ^ (n &amp; (n<span class="hljs-number">-1</span>)) <span class="hljs-comment">// åªä¿ç•™æœ€åä¸€ä¸ª bit ä½ï¼Œ å°† n = 1110 å˜ä¸º n = 0010</span><span class="hljs-comment">// (2) </span><span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> n:nums) ret ^= num;  <span class="hljs-comment">// åˆ©ç”¨ n ^ n = 0 è¿›è¡Œå»é‡  </span><span class="hljs-comment">// (3) å–ä½å’Œç½®ä½</span>n |= <span class="hljs-number">1</span> &lt;&lt; bit<span class="hljs-comment">// ç½®ä½æ“ä½œ: å°† n çš„ bit ä½è®¾ç½®ä¸º 1, 1 &lt;&lt; bit äº§ç”Ÿä¸€ä¸ªåªæœ‰ bit ä½ä¸º 1ï¼Œ å…¶ä»–å‡ä¸º 0 çš„æ•°</span>n &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; bit) <span class="hljs-comment">// ç½®ä½æ“ä½œï¼Œ å°† n çš„ bit ä½ç½® 0</span>n &amp; <span class="hljs-number">1</span> &lt;&lt; bit   <span class="hljs-comment">// å–ä½æ“ä½œ: åˆ¤æ–­ n çš„ bit ä½æ˜¯å¦æ˜¯ 1</span></code></pre><h5 id="1-ä½¿ç”¨ä½è¿ç®—æ›¿æ¢-ã€-gt-ã€swap-æ“ä½œ"><a href="#1-ä½¿ç”¨ä½è¿ç®—æ›¿æ¢-ã€-gt-ã€swap-æ“ä½œ" class="headerlink" title="(1)  ä½¿ç”¨ä½è¿ç®—æ›¿æ¢ +ã€&gt;ã€swap æ“ä½œ"></a>(1)  ä½¿ç”¨ä½è¿ç®—æ›¿æ¢ +ã€&gt;ã€swap æ“ä½œ</h5><p><strong>[371] <a href="https://leetcode-cn.com/problems/sum-of-two-integers/">https://leetcode-cn.com/problems/sum-of-two-integers/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getSum</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>&#123;    <span class="hljs-keyword">while</span>(b)&#123;        <span class="hljs-keyword">int</span> carry = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(a &amp; b) &lt;&lt; <span class="hljs-number">1</span>;        a = a ^ b;        b = carry;    &#125;    <span class="hljs-keyword">return</span> a;&#125;</code></pre><h5 id="2-n-amp-n-1-å°†äºŒè¿›åˆ¶-n-çš„æœ€åä¸€ä½-1-å˜æˆ-0"><a href="#2-n-amp-n-1-å°†äºŒè¿›åˆ¶-n-çš„æœ€åä¸€ä½-1-å˜æˆ-0" class="headerlink" title="(2) n &amp; (n - 1) å°†äºŒè¿›åˆ¶ n çš„æœ€åä¸€ä½ 1 å˜æˆ 0"></a>(2) n &amp; (n - 1) å°†äºŒè¿›åˆ¶ n çš„æœ€åä¸€ä½ 1 å˜æˆ 0</h5><p><strong>[191] <a href="https://leetcode-cn.com/problems/number-of-1-bits/">https://leetcode-cn.com/problems/number-of-1-bits/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">hammingWeight</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span> n)</span> </span>&#123;    <span class="hljs-keyword">int</span> res = <span class="hljs-number">0</span>;    <span class="hljs-keyword">while</span>(n &gt; <span class="hljs-number">0</span>)&#123;        n = n &amp; (n<span class="hljs-number">-1</span>);        res++;    &#125;    <span class="hljs-keyword">return</span> res; &#125;</code></pre><p><strong>[338] <a href="https://leetcode.com/problems/counting-bits/">https://leetcode.com/problems/counting-bits/</a></strong>   ğŸŒŸğŸŒŸ</p><pre><code class="hljs cpp"><span class="hljs-comment">// i &amp; (i - 1) å¯ä»¥å»æ‰ i æœ€å³è¾¹çš„ä¸€ä¸ª1(å¦‚æœæœ‰)ï¼Œ</span><span class="hljs-comment">// æ‰€ä»¥ i çš„1çš„ä¸ªæ•°å°±æ˜¯ i &amp; (i - 1)çš„1çš„ä¸ªæ•°åŠ ä¸Š1</span><span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">countBits</span><span class="hljs-params">(<span class="hljs-keyword">int</span> num)</span> </span>&#123;    <span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">dp</span><span class="hljs-params">(num + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>)</span></span>;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= num; i++)&#123;        dp[i] = dp[i &amp; (i<span class="hljs-number">-1</span>)] + <span class="hljs-number">1</span>;    &#125;    <span class="hljs-keyword">return</span> dp;&#125;</code></pre><p><strong>[461] <a href="https://leetcode-cn.com/problems/hamming-distance/">https://leetcode-cn.com/problems/hamming-distance/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-comment">// æ±‚å¼‚æˆ–ç»“æœçš„ 1 çš„ä¸ªæ•°</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">hammingDistance</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>&#123;    <span class="hljs-keyword">int</span> cnt = <span class="hljs-number">0</span>, n = x ^ y;    <span class="hljs-keyword">while</span>(n)&#123;        n &amp;= (n<span class="hljs-number">-1</span>);        cnt++;    &#125;    <span class="hljs-keyword">return</span> cnt;&#125;</code></pre><p><strong>[477] <a href="https://leetcode-cn.com/problems/total-hamming-distance/">https://leetcode-cn.com/problems/total-hamming-distance/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-comment">// !! å¯¹ 32 bit çš„æ¯ä¸€ä½è¿›è¡Œå¤„ç†ï¼Œè¿™æ˜¯ä¸€ç§æ€æƒ³</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">totalHammingDistance</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; nums)</span> </span>&#123;    <span class="hljs-keyword">int</span> res = <span class="hljs-number">0</span>;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++)&#123;        <span class="hljs-keyword">int</span> cnt = <span class="hljs-number">0</span>;        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> n:nums) <span class="hljs-keyword">if</span>(n &amp; (<span class="hljs-number">1</span> &lt;&lt; i)) cnt += <span class="hljs-number">1</span>;        res += (cnt) * (nums.size() - cnt);    &#125;    <span class="hljs-keyword">return</span> res;&#125;</code></pre><p><strong>[231] <a href="https://leetcode-cn.com/problems/power-of-two/">https://leetcode-cn.com/problems/power-of-two/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-comment">// å¦‚æœä¸€ä¸ªæ•°æ˜¯2çš„å¹‚ï¼Œé‚£ä¹ˆå…¶äºŒè¿›åˆ¶ä¸­åªæœ‰ä¸€ä½æ•°ä¸º 1</span><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">isPowerOfTwo</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span> </span>&#123;    <span class="hljs-keyword">if</span>(n &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;    <span class="hljs-keyword">return</span> (n &amp; (n<span class="hljs-number">-1</span>)) == <span class="hljs-number">0</span>;&#125;</code></pre><p><strong>[326] <a href="https://leetcode-cn.com/problems/power-of-three/">https://leetcode-cn.com/problems/power-of-three/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">isPowerOfThree</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span> </span>&#123;    <span class="hljs-keyword">if</span>(n &lt; <span class="hljs-number">3</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;    <span class="hljs-keyword">while</span>( n % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>)&#123;        n /= <span class="hljs-number">3</span>;    &#125;    <span class="hljs-keyword">return</span> n == <span class="hljs-number">1</span>;&#125;</code></pre><p><strong>[342] <a href="https://leetcode-cn.com/problems/power-of-four/">https://leetcode-cn.com/problems/power-of-four/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-comment">// !!! ç­‰å·çš„ä¼˜å…ˆçº§æ˜¯è¦å¤§äº ä½è¿ç®—çš„</span><span class="hljs-comment">// power of fourçš„ç‰¹ç‚¹æ˜¯å…¶äºŒè¿›åˆ¶è¡¨ç¤ºé™¤äº†åªæœ‰1ä½ä¸º1å¤–ï¼Œ</span><span class="hljs-comment">// å…¶äºŒè¿›åˆ¶ä¸º1çš„æ•°åœ¨å¥‡æ•°æ•°ä½ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ® num &amp; 0xaaaaaaaa æ¥è·å–ç»“æœ</span><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">isPowerOfFour</span><span class="hljs-params">(<span class="hljs-keyword">int</span> num)</span> </span>&#123;    <span class="hljs-keyword">return</span> (num &gt; <span class="hljs-number">0</span>) &amp;&amp; (num &amp; (num - <span class="hljs-number">1</span>)) == <span class="hljs-number">0</span> &amp;&amp; (num &amp; <span class="hljs-number">0xaaaaaaaa</span>) == <span class="hljs-number">0</span>; &#125;</code></pre><h5 id="3-å¼‚æˆ–è¿ç®—-n-n-åˆ©ç”¨-n-n-0-æ¥å»é‡"><a href="#3-å¼‚æˆ–è¿ç®—-n-n-åˆ©ç”¨-n-n-0-æ¥å»é‡" class="headerlink" title="(3) å¼‚æˆ–è¿ç®—  n ^ n, åˆ©ç”¨ n ^ n = 0 æ¥å»é‡"></a>(3) å¼‚æˆ–è¿ç®—  n ^ n, åˆ©ç”¨ n ^ n = 0 æ¥å»é‡</h5><pre><code class="hljs cpp"><span class="hljs-comment">// å¸¸è§ç”¨æ³•</span><span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> n:nums) ret ^= num;</code></pre><p><strong>[136] <a href="https://leetcode.com/problems/single-number/">https://leetcode.com/problems/single-number/</a></strong>    ğŸŒŸğŸŒŸ</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">singleNumber</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; nums)</span> </span>&#123;    <span class="hljs-keyword">int</span> res = <span class="hljs-number">0</span>;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> n:nums) res ^= n;    <span class="hljs-keyword">return</span> res;&#125;</code></pre><p><strong>[389] <a href="https://leetcode.com/problems/find-the-difference/">https://leetcode.com/problems/find-the-difference/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">char</span> <span class="hljs-title">findTheDifference</span><span class="hljs-params">(<span class="hljs-built_in">string</span> s, <span class="hljs-built_in">string</span> t)</span> </span>&#123;    <span class="hljs-keyword">char</span> res = t[<span class="hljs-number">0</span>];    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; s.size(); i++) res ^= s[i];    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; t.size(); i++) res ^= t[i];    <span class="hljs-keyword">return</span> res;&#125;</code></pre><p><strong>[268] <a href="https://leetcode.com/problems/missing-number/">https://leetcode.com/problems/missing-number/</a></strong>  ğŸŒŸğŸŒŸ</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">missingNumber</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; nums)</span> </span>&#123;    <span class="hljs-keyword">int</span> len = nums.size()ï¼Œ res = <span class="hljs-number">0</span>;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= len; i++)   res ^= i;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; len; i++)  res ^= nums[i];    <span class="hljs-keyword">return</span> res;&#125;<span class="hljs-comment">// è§£æ³•äºŒ: æ±‚å’Œ 0-n, ç„¶åå‡å»æ•°ç»„ä¸­æ‰€æœ‰çš„æ•°</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">missingNumber</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; nums)</span> </span>&#123;    <span class="hljs-keyword">if</span>(nums.size() == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    <span class="hljs-keyword">int</span> res = <span class="hljs-number">0</span>;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= nums.size(); i++) res ^= i;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; nums.size(); i++) res ^= nums[i];    <span class="hljs-keyword">return</span> res;&#125;</code></pre><p><strong>[260] <a href="https://leetcode-cn.com/problems/single-number-iii/">https://leetcode-cn.com/problems/single-number-iii/</a></strong>  ğŸŒŸğŸŒŸ</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">singleNumbers</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; nums)</span> </span>&#123;    <span class="hljs-keyword">int</span> diff = <span class="hljs-number">0</span>;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> n:nums) diff ^= n;    <span class="hljs-keyword">int</span> last_diff = (diff &amp; (diff - <span class="hljs-number">1</span>)) ^ diff;    <span class="hljs-keyword">int</span> resA = <span class="hljs-number">0</span>, resB = <span class="hljs-number">0</span>;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; nums.size(); i++)&#123;        <span class="hljs-keyword">if</span>(nums[i] &amp; last_diff) resA ^= nums[i];        <span class="hljs-keyword">else</span> resB ^= nums[i];    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; &#123;resA, resB&#125;;&#125;</code></pre><p><strong>[169] <a href="https://leetcode-cn.com/problems/majority-element/">https://leetcode-cn.com/problems/majority-element/</a></strong>   ğŸŒŸğŸŒŸ</p><pre><code class="hljs cpp"><span class="hljs-comment">// æ²¡æœ‰ç”¨åˆ° ä½è¿ç®—ï¼Œ ä½†æ˜¯å¤§éƒ¨åˆ†é¢˜ç›®éƒ½ä¼šå°†å…¶æ”¾åˆ°ä½è¿ç®—è¿™ä¸ªç±»åˆ«å½“ä¸­</span><span class="hljs-comment">// è§£æ³•äºŒ: æ‘©å°”æŠ•ç¥¨æ³•</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">majorityElement</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; nums)</span> </span>&#123;    <span class="hljs-keyword">int</span> cur = nums[<span class="hljs-number">0</span>];    <span class="hljs-keyword">int</span> cnt = <span class="hljs-number">1</span>;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; nums.size(); i++)&#123;        <span class="hljs-keyword">if</span>(nums[i] != cur)&#123;            --cnt;            <span class="hljs-keyword">if</span>(cnt &lt;= <span class="hljs-number">0</span>)&#123;                cur = nums[i];                cnt = <span class="hljs-number">1</span>;            &#125;        &#125;<span class="hljs-keyword">else</span>&#123;            cnt += <span class="hljs-number">1</span>;         &#125;    &#125;    <span class="hljs-keyword">return</span> cur;&#125;</code></pre><h5 id="4-å–ä½å’Œ-ç½®ä½æ“ä½œ"><a href="#4-å–ä½å’Œ-ç½®ä½æ“ä½œ" class="headerlink" title="(4) å–ä½å’Œ ç½®ä½æ“ä½œ"></a>(4) å–ä½å’Œ ç½®ä½æ“ä½œ</h5><pre><code class="hljs cpp">n |= <span class="hljs-number">1</span> &lt;&lt; bit<span class="hljs-comment">// ç½®ä½æ“ä½œ: å°† n çš„ bit ä½è®¾ç½®ä¸º 1, 1 &lt;&lt; bit äº§ç”Ÿä¸€ä¸ªåªæœ‰ bit ä½ä¸º 1ï¼Œ å…¶ä»–å‡ä¸º 0 çš„æ•°</span>n &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; bit) <span class="hljs-comment">// ç½®ä½æ“ä½œï¼Œ å°† n çš„ bit ä½ç½® 0</span>n &amp; <span class="hljs-number">1</span> &lt;&lt; bit   <span class="hljs-comment">// å–ä½æ“ä½œ: åˆ¤æ–­ n çš„ bit ä½æ˜¯å¦æ˜¯ 1</span></code></pre><p><strong>[190] <a href="https://leetcode.com/problems/reverse-bits/">https://leetcode.com/problems/reverse-bits/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-comment">// A &amp; (1 &lt;&lt; i)  è·å– i ä½çš„ bit</span><span class="hljs-comment">// A |= (1 &lt;&lt; i)  å°† i ä½ è®¾ç½®ä¸º bit</span><span class="hljs-function"><span class="hljs-keyword">uint32_t</span> <span class="hljs-title">reverseBits</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span> n)</span> </span>&#123;    <span class="hljs-keyword">uint32_t</span> res = <span class="hljs-number">0</span>;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++)&#123;        <span class="hljs-keyword">bool</span> bit = (<span class="hljs-number">1</span> &lt;&lt; i) &amp; n; <span class="hljs-comment">// get</span>        res |= (bit &lt;&lt; (<span class="hljs-number">32</span> - i - <span class="hljs-number">1</span>)); <span class="hljs-comment">// set</span>    &#125;    <span class="hljs-keyword">return</span> res;&#125;</code></pre><p><strong>[137] <a href="https://leetcode.com/problems/single-number-ii/">https://leetcode.com/problems/single-number-ii/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">singleNumber</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; nums)</span> </span>&#123;    <span class="hljs-keyword">int</span> res = <span class="hljs-number">0</span>;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++)&#123;        <span class="hljs-keyword">int</span> cnt = <span class="hljs-number">0</span>;        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> n:nums) <span class="hljs-keyword">if</span>((<span class="hljs-number">1</span> &lt;&lt; i) &amp; n) cnt+=<span class="hljs-number">1</span>;        <span class="hljs-keyword">if</span>(cnt % <span class="hljs-number">3</span> == <span class="hljs-number">1</span>) res += (<span class="hljs-number">1</span> &lt;&lt; i);    &#125;    <span class="hljs-keyword">return</span> res;&#125;</code></pre><h5 id="5-å…¶ä»–"><a href="#5-å…¶ä»–" class="headerlink" title="(5) å…¶ä»–"></a>(5) å…¶ä»–</h5><p><strong>[89] <a href="https://leetcode-cn.com/problems/gray-code/">https://leetcode-cn.com/problems/gray-code/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">grayCode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span> </span>&#123;    <span class="hljs-keyword">int</span> max = <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, n);    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; res;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; max; i++)&#123;        res.push_back((i &gt;&gt; <span class="hljs-number">1</span>) ^ i); <span class="hljs-comment">// æ ¼é›·ç è¿ç®—</span>    &#125;    <span class="hljs-keyword">return</span> res;&#125;</code></pre><p><strong>[201] <a href="https://leetcode-cn.com/problems/bitwise-and-of-numbers-range/">https://leetcode-cn.com/problems/bitwise-and-of-numbers-range/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">rangeBitwiseAnd</span><span class="hljs-params">(<span class="hljs-keyword">int</span> m, <span class="hljs-keyword">int</span> n)</span> </span>&#123;    <span class="hljs-keyword">int</span> res = n;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = m; i &lt; n &amp; res != <span class="hljs-number">0</span>; i++)&#123;  <span class="hljs-comment">// æ·»åŠ ä¸€ä¸ª res != 0 é˜²æ­¢è¶…æ—¶</span>        res &amp;= i;    &#125;    <span class="hljs-keyword">return</span> res;&#125;</code></pre><h5 id="TBD"><a href="#TBD" class="headerlink" title="TBD"></a>TBD</h5><div class="table-container"><table><thead><tr><th>é¢˜å·</th><th>é¢˜ç›®é“¾æ¥</th></tr></thead><tbody><tr><td>318</td><td><a href="https://leetcode.com/problems/maximum-product-of-word-lengths/description/">Maximum Product of Word Lengths</a></td></tr><tr><td>393</td><td><a href="https://leetcode.com/problems/utf-8-validation/description/">UTF-8 Validation</a></td></tr></tbody></table></div><h3 id="3-é“¾è¡¨"><a href="#3-é“¾è¡¨" class="headerlink" title="3. é“¾è¡¨"></a>3. é“¾è¡¨</h3><p><img src="/2020/09/13/leetcode/linklist.png" alt></p><h5 id="å¸¸ç”¨æŠ€å·§æ€»ç»“"><a href="#å¸¸ç”¨æŠ€å·§æ€»ç»“" class="headerlink" title="å¸¸ç”¨æŠ€å·§æ€»ç»“"></a>å¸¸ç”¨æŠ€å·§æ€»ç»“</h5><ul><li><p>æ·»åŠ å“‘èŠ‚ç‚¹</p><pre><code class="hljs haxe">ListNode * <span class="hljs-keyword">new</span><span class="hljs-type">head</span> = <span class="hljs-keyword">new</span> <span class="hljs-type">ListNode</span>(<span class="hljs-number">0</span>);<span class="hljs-keyword">new</span><span class="hljs-type">head</span> -&gt; next = head;</code></pre></li><li><p>å¤´æŒ‡é’ˆä¸€èˆ¬ä¸å¯ä»¥éšæ„æ”¹å˜ï¼Œ å¯ä»¥ç”³è¯·ä¸€ä¸ªæŒ‡å‘å¤´æŒ‡é’ˆçš„æŒ‡é’ˆ</p><pre><code class="hljs abnf">ListNode * p = head<span class="hljs-comment">;</span></code></pre></li><li><p>ä¸è¦è®©é“¾è¡¨æ–­å¼€äº†ï¼Œ é€‚å½“çš„åœ¨çº¸ä¸Šæ¨¡æ‹Ÿä¸€ä¸‹å¯¹åº”çš„é“¾è¡¨æŒ‡å‘æ“ä½œã€‚</p></li><li><p>æ³¨æ„ä¸€ä¸‹å¸¸è§çš„è¾¹ç•Œæ¡ä»¶ï¼šå¤´ç»“ç‚¹ å’Œ å°¾ç»“ç‚¹ï¼Œ é“¾è¡¨ä¸ºç©ºï¼Œ åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p></li><li><p>ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆ</p></li><li><p>æ³¨æ„äº›å°ç»†èŠ‚ï¼šåˆ é™¤èŠ‚ç‚¹çš„é‡Šæ”¾ï¼Œæœ«å°¾æŒ‡é’ˆä¸è¦ä¹±æŒ‡</p></li></ul><h5 id="1-æ€§è´¨åˆ¤å®š"><a href="#1-æ€§è´¨åˆ¤å®š" class="headerlink" title="(1) æ€§è´¨åˆ¤å®š"></a>(1) æ€§è´¨åˆ¤å®š</h5><p><strong>[141] <a href="https://leetcode.com/problems/linked-list-cycle/">https://leetcode.com/problems/linked-list-cycle/</a></strong>  </p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">hasCycle</span><span class="hljs-params">(ListNode *head)</span> </span>&#123;    <span class="hljs-keyword">if</span>(head == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;    ListNode * fast = head -&gt; next;    ListNode * slow = head;    <span class="hljs-keyword">while</span>(fast != <span class="hljs-literal">NULL</span> &amp;&amp; fast -&gt; next != <span class="hljs-literal">NULL</span>)&#123;        <span class="hljs-keyword">if</span>(fast == slow) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;        fast = fast -&gt; next -&gt; next;        slow = slow -&gt; next;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  &#125;</code></pre><p><strong>[142] <a href="https://leetcode-cn.com/problems/linked-list-cycle-ii/">https://leetcode-cn.com/problems/linked-list-cycle-ii/</a></strong>    ğŸŒŸğŸŒŸ</p><pre><code class="hljs cpp"><span class="hljs-function">ListNode *<span class="hljs-title">detectCycle</span><span class="hljs-params">(ListNode *head)</span> </span>&#123;    <span class="hljs-keyword">if</span>(head == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> head;    ListNode * slow = head;    ListNode * fast = head; <span class="hljs-comment">// fast ç­‰äº head </span>    <span class="hljs-keyword">bool</span> hasCycle = <span class="hljs-literal">false</span>;    <span class="hljs-keyword">while</span>(fast &amp;&amp; fast -&gt; next)&#123;        <span class="hljs-comment">// å…ˆç§»åŠ¨æŒ‡é’ˆï¼Œå†åˆ¤æ–­</span>        fast = fast -&gt; next -&gt; next;        slow = slow -&gt; next;        <span class="hljs-keyword">if</span>(fast == slow)&#123;            hasCycle = <span class="hljs-literal">true</span>;            <span class="hljs-keyword">break</span>;        &#125;     &#125;      <span class="hljs-comment">// ä¸€ä¸ªæŒ‡é’ˆä»ç›¸é‡èŠ‚ç‚¹å¼€å§‹ï¼Œ å¦ä¸€ä¸ªæŒ‡é’ˆä»å¤´å¼€å§‹ï¼Œä¸¤è€…å¦‚æœç›¸é‡</span>    <span class="hljs-comment">// åˆ™è¯¥èŠ‚ç‚¹å³ä¸ºå…¥ç¯èŠ‚ç‚¹</span>    <span class="hljs-keyword">if</span>(!hasCycle) <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;    slow = head;    <span class="hljs-keyword">while</span>(fast != slow)&#123;        fast = fast -&gt; next;        slow = slow -&gt; next;    &#125;    <span class="hljs-keyword">return</span> fast;    &#125;</code></pre><p><strong>[234] <a href="https://leetcode-cn.com/problems/palindrome-linked-list/">https://leetcode-cn.com/problems/palindrome-linked-list/</a></strong>   ğŸŒŸğŸŒŸ</p><pre><code class="hljs cpp"><span class="hljs-function">ListNode * <span class="hljs-title">reverseLinkList</span><span class="hljs-params">(ListNode * head)</span></span>&#123;    <span class="hljs-keyword">if</span>(head == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> head;    ListNode * prev = <span class="hljs-literal">NULL</span>;    ListNode * cur = head;    <span class="hljs-keyword">while</span>(cur)&#123;        ListNode * next = cur -&gt; next;        cur -&gt; next = prev;        prev = cur;        cur = next;    &#125;    <span class="hljs-keyword">return</span> prev;&#125;<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">isPalindrome</span><span class="hljs-params">(ListNode* head)</span> </span>&#123;    ListNode * p = head; <span class="hljs-comment">// æ‰¾åˆ°ä¸­é—´èŠ‚ç‚¹</span>    <span class="hljs-keyword">int</span> cnt = <span class="hljs-number">0</span>;    <span class="hljs-keyword">while</span>(p)&#123;        cnt += <span class="hljs-number">1</span>;        p = p -&gt; next;    &#125;    cnt /= <span class="hljs-number">2</span>;    p = head;    <span class="hljs-keyword">while</span>(cnt--)  p = p -&gt; next;         ListNode * q = reverseLinkList(p); <span class="hljs-comment">// ç¿»è½¬ååŠéƒ¨åˆ†</span>      <span class="hljs-keyword">while</span>(q &amp;&amp; head)&#123; <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦ç›¸ç­‰</span>        <span class="hljs-keyword">if</span>(head -&gt; val != q -&gt; val) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;        q = q -&gt; next;        head = head -&gt; next;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;&#125;</code></pre><h5 id="2-è·å–æŒ‡å®šèŠ‚ç‚¹"><a href="#2-è·å–æŒ‡å®šèŠ‚ç‚¹" class="headerlink" title="(2) è·å–æŒ‡å®šèŠ‚ç‚¹"></a>(2) è·å–æŒ‡å®šèŠ‚ç‚¹</h5><p><strong>[19] <a href="https://leetcode.com/problems/remove-nth-node-from-end-of-list/">https://leetcode.com/problems/remove-nth-node-from-end-of-list/</a></strong>   ğŸŒŸğŸŒŸ</p><pre><code class="hljs cpp"><span class="hljs-function">ListNode* <span class="hljs-title">removeNthFromEnd</span><span class="hljs-params">(ListNode* head, <span class="hljs-keyword">int</span> n)</span> </span>&#123;    ListNode * newhead = <span class="hljs-keyword">new</span> ListNode(<span class="hljs-number">0</span>);    newhead -&gt; next = head;    ListNode * fast = newhead;    ListNode * slow = newhead;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n+<span class="hljs-number">1</span>; i++)&#123;        fast = fast -&gt; next;        &#125;    <span class="hljs-keyword">while</span>(fast)&#123;        fast = fast -&gt; next;        slow = slow -&gt; next;    &#125;    slow -&gt; next = slow -&gt; next -&gt; next;    <span class="hljs-keyword">return</span> newhead -&gt; next;&#125;</code></pre><p><strong>[160] <a href="https://leetcode-cn.com/problems/intersection-of-two-linked-lists/">https://leetcode-cn.com/problems/intersection-of-two-linked-lists/</a></strong>   ğŸŒŸğŸŒŸ</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getLinkedListLength</span><span class="hljs-params">(ListNode *head)</span></span>&#123;    <span class="hljs-keyword">int</span> cnt = <span class="hljs-number">0</span>;    ListNode * p = head;    <span class="hljs-keyword">while</span>(p)&#123;        p = p -&gt; next;        cnt++;    &#125;    <span class="hljs-keyword">return</span> cnt;&#125;<span class="hljs-function">ListNode *<span class="hljs-title">getIntersectionNode</span><span class="hljs-params">(ListNode *headA, ListNode *headB)</span> </span>&#123;    <span class="hljs-keyword">int</span> length_A = getLinkedListLength(headA);    <span class="hljs-keyword">int</span> length_B = getLinkedListLength(headB);    <span class="hljs-keyword">int</span> diff = <span class="hljs-built_in">abs</span>(length_A - length_B);    <span class="hljs-keyword">if</span>(length_A &gt; length_B)         <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; diff; i++)  headA = headA -&gt; next;    <span class="hljs-keyword">else</span>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;  i &lt; diff; i++)  headB = headB -&gt; next;    <span class="hljs-keyword">while</span>(headA != headB)&#123;        headA  = headA -&gt; next;        headB = headB -&gt; next;    &#125;    <span class="hljs-keyword">return</span> headA;&#125;</code></pre><h5 id="3-é“¾è¡¨èŠ‚ç‚¹é¡ºåºçš„è°ƒæ•´"><a href="#3-é“¾è¡¨èŠ‚ç‚¹é¡ºåºçš„è°ƒæ•´" class="headerlink" title="(3) é“¾è¡¨èŠ‚ç‚¹é¡ºåºçš„è°ƒæ•´"></a>(3) é“¾è¡¨èŠ‚ç‚¹é¡ºåºçš„è°ƒæ•´</h5><p><strong>[206] <a href="https://leetcode.com/problems/reverse-linked-list">https://leetcode.com/problems/reverse-linked-list</a></strong>   ğŸŒŸğŸŒŸ</p><pre><code class="hljs cpp"><span class="hljs-function">ListNode* <span class="hljs-title">reverseList</span><span class="hljs-params">(ListNode* head)</span> </span>&#123;    ListNode * prev = <span class="hljs-literal">NULL</span>;    ListNode * cur = head;    <span class="hljs-keyword">while</span>(cur)&#123;        ListNode * next = cur -&gt; next;        cur -&gt; next = prev;        prev = cur;        cur = next;    &#125;    <span class="hljs-keyword">return</span> prev;&#125;</code></pre><p><strong>[328] <a href="https://leetcode.com/problems/odd-even-linked-list/">https://leetcode.com/problems/odd-even-linked-list/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-function">ListNode* <span class="hljs-title">oddEvenList</span><span class="hljs-params">(ListNode* head)</span> </span>&#123;    <span class="hljs-keyword">if</span>(head == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> head;    ListNode * oddhead = <span class="hljs-keyword">new</span> ListNode(<span class="hljs-number">0</span>);    ListNode * evenhead = <span class="hljs-keyword">new</span> ListNode(<span class="hljs-number">0</span>);    ListNode * p_odd = oddhead;    ListNode * p_even = evenhead;    ListNode * p = head;    <span class="hljs-keyword">int</span> index = <span class="hljs-number">0</span>;    <span class="hljs-keyword">while</span>(p)&#123;        <span class="hljs-keyword">if</span>(index % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>)&#123;            p_even -&gt; next = p;            p_even = p_even -&gt; next;        &#125;<span class="hljs-keyword">else</span>&#123;            p_odd -&gt; next = p;            p_odd = p_odd -&gt; next;        &#125;        p = p -&gt; next;          index += <span class="hljs-number">1</span>;       &#125;    p_even -&gt; next = oddhead -&gt; next;    p_odd -&gt; next = <span class="hljs-literal">NULL</span>;  <span class="hljs-comment">// ä¸è¦å¿˜è®°å°†è¿™ä¸ªé“¾è¡¨ç½®é›¶ &lt;--- å¦åˆ™ä¼šäº§ç”Ÿæ­»å¾ªç¯! è®¡ç®—è¶…æ—¶</span>    <span class="hljs-keyword">return</span> evenhead -&gt; next; &#125;</code></pre><p><strong>[86] <a href="https://leetcode-cn.com/problems/partition-list/">https://leetcode-cn.com/problems/partition-list/</a></strong>  ğŸŒŸğŸŒŸ</p><pre><code class="hljs cpp"><span class="hljs-function">ListNode* <span class="hljs-title">partition</span><span class="hljs-params">(ListNode* head, <span class="hljs-keyword">int</span> x)</span> </span>&#123;    <span class="hljs-keyword">if</span>(head == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> head;    ListNode * before = <span class="hljs-keyword">new</span> ListNode(<span class="hljs-number">0</span>);    ListNode * p1 = before;    ListNode * after = <span class="hljs-keyword">new</span> ListNode(<span class="hljs-number">0</span>);    ListNode * p2 = after;    ListNode * p = head;    <span class="hljs-keyword">while</span>(p)&#123;        <span class="hljs-keyword">if</span>(p -&gt; val &lt; x)&#123;            p1 -&gt; next = p;            p1 = p1 -&gt; next;        &#125;<span class="hljs-keyword">else</span>&#123;            p2 -&gt; next = p;            p2 = p2 -&gt; next;        &#125;            p = p -&gt; next;    &#125;    p1 -&gt; next = after -&gt; next;    p2 -&gt; next = <span class="hljs-literal">NULL</span>;    <span class="hljs-keyword">return</span> before -&gt; next;&#125;</code></pre><p><strong>[143] <a href="https://leetcode-cn.com/problems/reorder-list/">https://leetcode-cn.com/problems/reorder-list/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">reorderList</span><span class="hljs-params">(ListNode* head)</span> </span>&#123;    <span class="hljs-keyword">if</span>(head == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span>;    <span class="hljs-comment">// è·å–é“¾è¡¨é•¿åº¦</span>    ListNode * p = head;    <span class="hljs-keyword">int</span> len = <span class="hljs-number">0</span>;    <span class="hljs-keyword">while</span>(p)&#123;        len++;        p = p -&gt; next;    &#125;    <span class="hljs-comment">// ç¿»è½¬ååŠéƒ¨åˆ†</span>    <span class="hljs-keyword">int</span> mid = len / <span class="hljs-number">2</span>;    p = head;    <span class="hljs-keyword">while</span>(mid--)  p = p -&gt; next;    ListNode * rhead = reverseList(p-&gt;next);    p -&gt; next = <span class="hljs-literal">NULL</span>;  <span class="hljs-comment">// !!! </span>    <span class="hljs-comment">// åˆå¹¶ä¸¤ä¸ªé“¾è¡¨</span>    ListNode * dummy = <span class="hljs-keyword">new</span> ListNode(<span class="hljs-number">0</span>);    ListNode * ptr = dummy;    <span class="hljs-keyword">while</span>(rhead &amp;&amp; head)&#123;        ptr -&gt; next = head;        head = head -&gt; next;        ptr = ptr -&gt; next;        ptr -&gt; next = rhead;        rhead = rhead -&gt; next;        ptr = ptr -&gt; next;    &#125;    <span class="hljs-keyword">if</span>(rhead != <span class="hljs-literal">NULL</span>) ptr -&gt; next = rhead;    <span class="hljs-keyword">if</span>(head != <span class="hljs-literal">NULL</span>) ptr -&gt; next = head;    head = dummy -&gt; next;&#125;</code></pre><p><strong>[61] <a href="https://leetcode-cn.com/problems/rotate-list/">https://leetcode-cn.com/problems/rotate-list/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-function">ListNode* <span class="hljs-title">rotateRight</span><span class="hljs-params">(ListNode* head, <span class="hljs-keyword">int</span> k)</span> </span>&#123;    <span class="hljs-keyword">if</span>(head == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> head;        <span class="hljs-keyword">int</span> cnt = <span class="hljs-number">1</span>;    ListNode * ptr = head;    <span class="hljs-keyword">while</span>(ptr -&gt; next)&#123;        ptr = ptr -&gt; next;        ++cnt;    &#125;    <span class="hljs-comment">// åšç¯</span>    ptr -&gt; next = head;    <span class="hljs-comment">// ç§»åŠ¨</span>    k = cnt - k % cnt;    <span class="hljs-keyword">while</span>(k<span class="hljs-number">-1</span>)&#123;        k--;        head = head -&gt; next;    &#125;    <span class="hljs-comment">// ä¿®æ”¹æŒ‡é’ˆ</span>    ptr = head;    head = head -&gt; next;    ptr -&gt; next = <span class="hljs-literal">NULL</span>;    <span class="hljs-keyword">return</span> head; &#125;</code></pre><h5 id="4-åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹"><a href="#4-åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹" class="headerlink" title="(4) åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹"></a>(4) åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹</h5><p><strong>[237] <a href="https://leetcode.com/problems/delete-node-in-a-linked-list/">https://leetcode.com/problems/delete-node-in-a-linked-list/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteNode</span><span class="hljs-params">(ListNode* node)</span> </span>&#123;    node -&gt; val = node -&gt; next -&gt; val;    node -&gt; next = node -&gt; next -&gt; next;&#125;</code></pre><p><strong>[203] <a href="https://leetcode.com/problems/remove-linked-list-elements/">https://leetcode.com/problems/remove-linked-list-elements/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-function">ListNode* <span class="hljs-title">deleteNode</span><span class="hljs-params">(ListNode* head, <span class="hljs-keyword">int</span> val)</span> </span>&#123;    <span class="hljs-keyword">if</span>(head == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> head;    <span class="hljs-comment">// æ·»åŠ å“‘èŠ‚ç‚¹</span>    ListNode * newhead = <span class="hljs-keyword">new</span> ListNode(<span class="hljs-number">0</span>);    newhead -&gt; next = head;    ListNode * p = newhead;    <span class="hljs-keyword">while</span>(p -&gt; next)&#123;        <span class="hljs-keyword">if</span>(p -&gt; next -&gt; val == val)&#123;            ListNode * tmp = p -&gt; next;            p -&gt; next = p -&gt; next -&gt; next;            <span class="hljs-keyword">delete</span> tmp;  <span class="hljs-comment">// åˆ é™¤æ— ç”¨èŠ‚ç‚¹</span>        &#125;         <span class="hljs-keyword">else</span>            p = p -&gt; next;    &#125;    <span class="hljs-keyword">return</span> newhead -&gt; next;&#125;</code></pre><p><strong>[83] <a href="https://leetcode.com/problems/remove-duplicates-from-sorted-list/">https://leetcode.com/problems/remove-duplicates-from-sorted-list/</a></strong>  ğŸŒŸğŸŒŸ</p><pre><code class="hljs cpp"><span class="hljs-function">ListNode* <span class="hljs-title">deleteDuplicates</span><span class="hljs-params">(ListNode* head)</span> </span>&#123;    <span class="hljs-keyword">if</span>(head == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;    ListNode * dummy = <span class="hljs-keyword">new</span> ListNode(<span class="hljs-number">0</span>);    dummy -&gt; next = head;    ListNode * ptr = head;    <span class="hljs-keyword">while</span>(ptr &amp;&amp; ptr -&gt; next)&#123;        <span class="hljs-keyword">if</span>(ptr-&gt;val == ptr-&gt;next-&gt;val)&#123;            ListNode * tmp = ptr -&gt; next;            ptr -&gt; next = ptr -&gt; next -&gt; next;            <span class="hljs-keyword">delete</span> tmp;        &#125;<span class="hljs-keyword">else</span>&#123;            ptr = ptr -&gt; next;        &#125;    &#125;    <span class="hljs-keyword">return</span> dummy -&gt; next;&#125;</code></pre><h5 id="5-åˆå¹¶æœ‰åºé“¾è¡¨"><a href="#5-åˆå¹¶æœ‰åºé“¾è¡¨" class="headerlink" title="(5) åˆå¹¶æœ‰åºé“¾è¡¨"></a>(5) åˆå¹¶æœ‰åºé“¾è¡¨</h5><p><strong>[21] <a href="https://leetcode-cn.com/problems/merge-two-sorted-lists/">https://leetcode-cn.com/problems/merge-two-sorted-lists/</a></strong>  ğŸŒŸğŸŒŸ</p><pre><code class="hljs cpp"><span class="hljs-function">ListNode* <span class="hljs-title">mergeTwoLists</span><span class="hljs-params">(ListNode* l1, ListNode* l2)</span> </span>&#123;    ListNode * newhead = <span class="hljs-keyword">new</span> ListNode(<span class="hljs-number">0</span>);    ListNode * p = newhead;    ListNode * p_l1 = l1, * p_l2 = l2;    <span class="hljs-keyword">while</span>(p_l1 &amp;&amp; p_l2)&#123;        <span class="hljs-keyword">if</span>(p_l1 -&gt; val &gt; p_l2 -&gt; val)&#123;            p -&gt; next = p_l2;            p_l2 = p_l2 -&gt; next;            p = p -&gt; next;        &#125;<span class="hljs-keyword">else</span>&#123;            p -&gt; next = p_l1;            p_l1 = p_l1 -&gt; next;            p = p -&gt; next;         &#125;    &#125;    <span class="hljs-keyword">if</span>(p_l1 == <span class="hljs-literal">NULL</span>) p-&gt;next = p_l2;    <span class="hljs-keyword">else</span> p-&gt; next = p_l1;    <span class="hljs-keyword">return</span> newhead -&gt; next;&#125;</code></pre><p><strong>[23] <a href="https://leetcode-cn.com/problems/merge-k-sorted-lists/">https://leetcode-cn.com/problems/merge-k-sorted-lists/</a></strong>  ğŸŒŸğŸŒŸ</p><pre><code class="hljs cpp"><span class="hljs-function">ListNode* <span class="hljs-title">mergeKLists</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;ListNode*&gt;&amp; lists)</span> </span>&#123;    <span class="hljs-keyword">if</span>(lists.size() == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;    <span class="hljs-keyword">if</span>(lists.size() == <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> lists[<span class="hljs-number">0</span>];    <span class="hljs-keyword">if</span>(lists.size() == <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> mergeTwoLists(lists[<span class="hljs-number">0</span>], lists[<span class="hljs-number">1</span>]);    <span class="hljs-keyword">int</span> len = lists.size();    <span class="hljs-keyword">int</span> mid = len / <span class="hljs-number">2</span>;    <span class="hljs-built_in">vector</span>&lt;ListNode* &gt; lists1;    <span class="hljs-built_in">vector</span>&lt;ListNode* &gt; lists2;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; mid; i++)  lists1.push_back(lists[i]);      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = mid; i &lt; len; i++)  lists2.push_back(lists[i]);    ListNode * p1 = mergeKLists(lists1);    ListNode * p2 = mergeKLists(lists2);    <span class="hljs-keyword">return</span> mergeTwoLists(p1, p2);  &#125;</code></pre><h5 id="6-æ¨¡æ‹Ÿæ•°å­¦è¿ç®—-ä¸¤æ•°ç›¸åŠ ã€é“¾è¡¨-1"><a href="#6-æ¨¡æ‹Ÿæ•°å­¦è¿ç®—-ä¸¤æ•°ç›¸åŠ ã€é“¾è¡¨-1" class="headerlink" title="(6) æ¨¡æ‹Ÿæ•°å­¦è¿ç®—(ä¸¤æ•°ç›¸åŠ ã€é“¾è¡¨+1)"></a>(6) æ¨¡æ‹Ÿæ•°å­¦è¿ç®—(ä¸¤æ•°ç›¸åŠ ã€é“¾è¡¨+1)</h5><p><strong>[2] <a href="https://leetcode.com/problems/add-two-numbers/">https://leetcode.com/problems/add-two-numbers/</a></strong>  ğŸŒŸğŸŒŸ</p><pre><code class="hljs cpp"><span class="hljs-comment">// æ¨¡æ‹Ÿå¸¸è§çš„åŠ æ³•æ“ä½œ: éœ€è¦æ³¨æ„ï¼Œå½“ä¸€æ¡é“¾è¡¨ä¸ºç©ºæ—¶å€™ï¼Œä»ç„¶åœ¨æ­¤æ¡†æ¶ä¸‹ç›¸åŠ ï¼Œæœ€åè¿˜éœ€è¦æ·»åŠ  c_in</span><span class="hljs-function">ListNode* <span class="hljs-title">addTwoNumbers</span><span class="hljs-params">(ListNode* l1, ListNode* l2)</span> </span>&#123;    ListNode * dummy = <span class="hljs-keyword">new</span> ListNode(<span class="hljs-number">0</span>);    ListNode * p = dummy;    <span class="hljs-keyword">int</span> c_in = <span class="hljs-number">0</span>;    <span class="hljs-keyword">while</span>(l1 != <span class="hljs-literal">NULL</span> || l2 != <span class="hljs-literal">NULL</span>)&#123;        <span class="hljs-keyword">int</span> val1 = l1 != <span class="hljs-literal">NULL</span> ? l1 -&gt; val : <span class="hljs-number">0</span>;        <span class="hljs-keyword">int</span> val2 = l2 != <span class="hljs-literal">NULL</span> ? l2 -&gt; val : <span class="hljs-number">0</span>;        <span class="hljs-keyword">int</span> res = val1 + val2 + c_in;        ListNode * newNode =  <span class="hljs-keyword">new</span> ListNode(res % <span class="hljs-number">10</span>);        c_in = res / <span class="hljs-number">10</span>;        p -&gt; next = newNode;        p = p -&gt; next;        <span class="hljs-keyword">if</span>(l1 != <span class="hljs-literal">NULL</span>) l1 = l1 -&gt; next;        <span class="hljs-keyword">if</span>(l2 != <span class="hljs-literal">NULL</span>) l2 = l2 -&gt; next;                                                 &#125;    <span class="hljs-keyword">if</span>(c_in)&#123;        ListNode * newNode = <span class="hljs-keyword">new</span> ListNode(c_in);        p -&gt; next = newNode;        p = p -&gt; next;    &#125;    <span class="hljs-keyword">return</span> dummy -&gt; next;  &#125;</code></pre><p><strong>[369] <a href="https://leetcode.com/problems/plus-one-linked-list/">https://leetcode.com/problems/plus-one-linked-list/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> &#123;</span><span class="hljs-keyword">public</span>:    <span class="hljs-function">ListNode * <span class="hljs-title">reverseList</span><span class="hljs-params">(ListNode * head)</span></span>&#123;        <span class="hljs-keyword">if</span>(head == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> head;        ListNode * prev = <span class="hljs-literal">NULL</span>;        <span class="hljs-keyword">while</span>(head)&#123;            ListNode * next = head -&gt; next;            head -&gt; next = prev;            prev = head;            head = next;        &#125;        <span class="hljs-keyword">return</span> prev;            &#125;        <span class="hljs-function">ListNode* <span class="hljs-title">plusOne</span><span class="hljs-params">(ListNode* head)</span> </span>&#123;        <span class="hljs-keyword">if</span>(head == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;        head = reverseList(head);                <span class="hljs-keyword">int</span> c_in = <span class="hljs-number">1</span>;        ListNode * ptr = head;        ListNode * prev = head;        <span class="hljs-keyword">while</span>(ptr)&#123;            <span class="hljs-keyword">int</span> res = ptr -&gt; val + c_in;            c_in = res / <span class="hljs-number">10</span>;            ptr -&gt; val = res % <span class="hljs-number">10</span>;            prev = ptr;            ptr = ptr -&gt; next;        &#125;                <span class="hljs-keyword">if</span>(c_in)  prev -&gt; next = <span class="hljs-keyword">new</span> ListNode(<span class="hljs-number">1</span>);                <span class="hljs-keyword">return</span> reverseList(head);            &#125;&#125;;</code></pre><h5 id="7-å¤æ‚é“¾è¡¨çš„å¤åˆ¶"><a href="#7-å¤æ‚é“¾è¡¨çš„å¤åˆ¶" class="headerlink" title="(7) å¤æ‚é“¾è¡¨çš„å¤åˆ¶"></a>(7) å¤æ‚é“¾è¡¨çš„å¤åˆ¶</h5><h5 id="8-é“¾è¡¨ä¸äºŒå‰æ ‘"><a href="#8-é“¾è¡¨ä¸äºŒå‰æ ‘" class="headerlink" title="(8) é“¾è¡¨ä¸äºŒå‰æ ‘"></a>(8) é“¾è¡¨ä¸äºŒå‰æ ‘</h5><h5 id="TBD-1"><a href="#TBD-1" class="headerlink" title="TBD"></a>TBD</h5><div class="table-container"><table><thead><tr><th>é¢˜å·</th><th>é¢˜ç›®é“¾æ¥</th></tr></thead><tbody><tr><td>82</td><td><a href="https://leetcode.com/problems/remove-duplicates-from-sorted-list-ii/description/">Remove Duplicates from Sorted List II</a>  ğŸŒŸğŸŒŸ</td></tr><tr><td>148</td><td><a href="https://leetcode.com/problems/sort-list/description/">Sort List</a></td></tr><tr><td>147</td><td><a href="https://leetcode.com/problems/insertion-sort-list/description/">Insertion Sort List</a></td></tr><tr><td>24</td><td><a href="https://leetcode.com/problems/swap-nodes-in-pairs/description/">Swap Nodes in Pairs</a>  ğŸŒŸğŸŒŸ</td></tr><tr><td>25</td><td><a href="https://leetcode.com/problems/reverse-nodes-in-k-group/description/">Reverse Nodes in k-Group</a>  ğŸŒŸğŸŒŸ</td></tr><tr><td>92</td><td><a href="https://leetcode.com/problems/reverse-linked-list-ii/description/">Reverse Linked List II</a>    ğŸŒŸğŸŒŸ</td></tr></tbody></table></div><h3 id="10-å…¶ä»–-leetcode-é¢˜ç›®"><a href="#10-å…¶ä»–-leetcode-é¢˜ç›®" class="headerlink" title="10. å…¶ä»– leetcode é¢˜ç›®"></a>10. å…¶ä»– leetcode é¢˜ç›®</h3><p>æ•°ç»„ä¸­é‡å¤çš„æ•°å­—</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">findRepeatNumber</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; nums)</span> </span>&#123;    <span class="hljs-built_in">set</span>&lt;<span class="hljs-keyword">int</span>&gt; m_set;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> n:nums)&#123;        <span class="hljs-keyword">if</span>(m_set.find(n) == m_set.end())            m_set.insert(n);        <span class="hljs-keyword">else</span>            <span class="hljs-keyword">return</span> n;    &#125;     <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>çŸ©é˜µæœç´¢</p><p>æ›¿æ¢ç©ºæ ¼</p><p>æ–æ³¢é‚£å¥‘</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">fib</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span> </span>&#123;    <span class="hljs-keyword">if</span>(n == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    <span class="hljs-keyword">if</span>(n == <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;    <span class="hljs-keyword">int</span> first = <span class="hljs-number">0</span>, second = <span class="hljs-number">1</span>;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">2</span>; i &lt;= n; i++)&#123;        <span class="hljs-keyword">int</span> third = (first + second) % <span class="hljs-number">1000000007</span>;        first = second;        second = third;    &#125;    <span class="hljs-keyword">return</span> second;&#125;</code></pre><p><a href="https://leetcode-cn.com/problems/climbing-stairs/">https://leetcode-cn.com/problems/climbing-stairs/</a></p><pre><code class="hljs angelscript"><span class="hljs-built_in">int</span> numWays(<span class="hljs-built_in">int</span> n) &#123;    <span class="hljs-keyword">if</span>(n &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;    <span class="hljs-keyword">if</span>(n == <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;    <span class="hljs-built_in">int</span> first = <span class="hljs-number">1</span>, second = <span class="hljs-number">2</span>;    <span class="hljs-keyword">for</span>(<span class="hljs-built_in">int</span> i = <span class="hljs-number">3</span>; i &lt;= n; i++)&#123;        <span class="hljs-built_in">int</span> third = (first + second) % <span class="hljs-number">1000000007</span>;        first = second;        second = third;    &#125;    <span class="hljs-keyword">return</span> second;&#125;</code></pre><p><strong>[53] <a href="https://leetcode-cn.com/problems/maximum-subarray/">https://leetcode-cn.com/problems/maximum-subarray/</a></strong></p><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">maxSubArray</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; nums)</span> </span>&#123;    <span class="hljs-comment">// dp æ•°ç»„çš„ç¬¬ i ä¸ªæ•°å­—è¡¨ç¤ºä»¥è¯¥æ•°ç»“å°¾çš„ è¿ç»­æ•°ç»„çš„æœ€å¤§å€¼</span>    <span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">dp</span><span class="hljs-params">(nums.<span class="hljs-built_in">size</span>(), nums[<span class="hljs-number">0</span>])</span></span>;    <span class="hljs-keyword">int</span> res = nums[<span class="hljs-number">0</span>];    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; nums.<span class="hljs-built_in">size</span>(); i++)&#123;        dp[i] = <span class="hljs-built_in">max</span>(nums[i], dp[i<span class="hljs-number">-1</span>] + nums[i]);        res = <span class="hljs-built_in">max</span>(dp[i], res);    &#125;    <span class="hljs-keyword">return</span> res;&#125;</code></pre><pre><code class="hljs cpp"><span class="hljs-comment">// ä¸è¦ä½¿ç”¨ map, ç›´æ¥ä½¿ç”¨ æ•°ç»„ ä½œä¸º å“ˆå¸Œè¡¨å³å¯</span><span class="hljs-function"><span class="hljs-keyword">char</span> <span class="hljs-title">firstUniqChar</span><span class="hljs-params">(<span class="hljs-built_in">string</span> s)</span> </span>&#123;    <span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">dic</span><span class="hljs-params">(<span class="hljs-number">26</span>, <span class="hljs-number">0</span>)</span></span>;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> c:s)   dic[ c - <span class="hljs-string">&#x27;a&#x27;</span>] += <span class="hljs-number">1</span>;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> c:s)   <span class="hljs-keyword">if</span>(dic[c - <span class="hljs-string">&#x27;a&#x27;</span>] == <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> c;    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27; &#x27;</span>; <span class="hljs-comment">// å¯ä»¥ç›´æ¥ return  &#x27; &#x27; çš„</span>&#125;</code></pre><h4 id="å‰‘æŒ‡-Offer-57-å’Œä¸ºsçš„ä¸¤ä¸ªæ•°å­—"><a href="#å‰‘æŒ‡-Offer-57-å’Œä¸ºsçš„ä¸¤ä¸ªæ•°å­—" class="headerlink" title="å‰‘æŒ‡ Offer 57. å’Œä¸ºsçš„ä¸¤ä¸ªæ•°å­—"></a><a href="https://leetcode-cn.com/problems/he-wei-sde-liang-ge-shu-zi-lcof/">å‰‘æŒ‡ Offer 57. å’Œä¸ºsçš„ä¸¤ä¸ªæ•°å­—</a></h4><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">twoSum</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; nums, <span class="hljs-keyword">int</span> target)</span> </span>&#123;    <span class="hljs-built_in">set</span>&lt;<span class="hljs-keyword">int</span>&gt; m_set;    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; res;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> n : nums)&#123;        <span class="hljs-keyword">if</span>(m_set.find(target - n) == m_set.end())&#123;            m_set.insert(n);        &#125;<span class="hljs-keyword">else</span>&#123;            res.push_back(n);            res.push_back(target - n);            <span class="hljs-keyword">break</span>;        &#125;    &#125;    <span class="hljs-keyword">return</span> res; &#125;</code></pre><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">maxDepth</span><span class="hljs-params">(TreeNode* root)</span> </span>&#123;    <span class="hljs-keyword">if</span>(root == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> + max(maxDepth(root-&gt;left), maxDepth(root-&gt;right));&#125;</code></pre><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">printNumbers</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span> </span>&#123;    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; res;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-built_in">pow</span>(<span class="hljs-number">10</span>, n); i++)&#123;        res.push_back(i);    &#125;    <span class="hljs-keyword">return</span> res;&#125;</code></pre><p><strong><a href="https://leetcode-cn.com/problems/diao-zheng-shu-zu-shun-xu-shi-qi-shu-wei-yu-ou-shu-qian-mian-lcof/">å‰‘æŒ‡ Offer 21. è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢</a></strong></p><pre><code class="hljs matlab">vector&lt;int&gt; exchange(vector&lt;int&gt;&amp; nums) &#123;    int <span class="hljs-built_in">i</span> = <span class="hljs-number">0</span>, <span class="hljs-built_in">j</span> = nums.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>;    <span class="hljs-keyword">while</span>(<span class="hljs-built_in">i</span> &lt; <span class="hljs-built_in">j</span>)&#123;        <span class="hljs-keyword">while</span>(<span class="hljs-built_in">i</span> &lt;<span class="hljs-built_in">j</span> &amp;&amp; nums[<span class="hljs-built_in">i</span>] <span class="hljs-comment">% 2 == 1) i++;</span>        <span class="hljs-keyword">while</span>(<span class="hljs-built_in">i</span> &lt; <span class="hljs-built_in">j</span> &amp;&amp; nums[<span class="hljs-built_in">j</span>] <span class="hljs-comment">% 2 == 0) j--;</span>        swap(nums[<span class="hljs-built_in">i</span>++], nums[<span class="hljs-built_in">j</span>--]);    &#125;    <span class="hljs-keyword">return</span> nums;&#125;</code></pre><h4 id="å‰‘æŒ‡-Offer-58-II-å·¦æ—‹è½¬å­—ç¬¦ä¸²"><a href="#å‰‘æŒ‡-Offer-58-II-å·¦æ—‹è½¬å­—ç¬¦ä¸²" class="headerlink" title="å‰‘æŒ‡ Offer 58 - II. å·¦æ—‹è½¬å­—ç¬¦ä¸²"></a><a href="https://leetcode-cn.com/problems/zuo-xuan-zhuan-zi-fu-chuan-lcof/">å‰‘æŒ‡ Offer 58 - II. å·¦æ—‹è½¬å­—ç¬¦ä¸²</a></h4><pre><code class="hljs angelscript"><span class="hljs-built_in">void</span> reverse(<span class="hljs-built_in">string</span>&amp; s, <span class="hljs-built_in">int</span> i, <span class="hljs-built_in">int</span> j)&#123;    <span class="hljs-keyword">while</span>(i &lt; j)&#123;        swap(s[i++], s[j--]);    &#125;&#125;<span class="hljs-built_in">string</span> reverseLeftWords(<span class="hljs-built_in">string</span> s, <span class="hljs-built_in">int</span> n) &#123;    reverse(s, <span class="hljs-number">0</span>, n<span class="hljs-number">-1</span>);    reverse(s, n, s.size() - <span class="hljs-number">1</span>);    reverse(s, <span class="hljs-number">0</span>, s.size() - <span class="hljs-number">1</span>);    <span class="hljs-keyword">return</span> s;&#125;</code></pre><h4 id="å‰‘æŒ‡-Offer-27-äºŒå‰æ ‘çš„é•œåƒ"><a href="#å‰‘æŒ‡-Offer-27-äºŒå‰æ ‘çš„é•œåƒ" class="headerlink" title="å‰‘æŒ‡ Offer 27. äºŒå‰æ ‘çš„é•œåƒ"></a><a href="https://leetcode-cn.com/problems/er-cha-shu-de-jing-xiang-lcof/">å‰‘æŒ‡ Offer 27. äºŒå‰æ ‘çš„é•œåƒ</a></h4><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">exchangeLeaf</span><span class="hljs-params">(TreeNode * node)</span></span>&#123;    <span class="hljs-comment">// æ³¨æ„è¿”å›æ¡ä»¶</span>    <span class="hljs-keyword">if</span>(node == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span>;    <span class="hljs-keyword">if</span>(node -&gt; left == <span class="hljs-literal">NULL</span> &amp;&amp; node -&gt; right == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span>;    TreeNode * tmp = node -&gt; left;    node -&gt; left = node -&gt; right;    node -&gt; right = tmp;    <span class="hljs-keyword">if</span>(node -&gt; left) exchangeLeaf(node -&gt; left);    <span class="hljs-keyword">if</span>(node -&gt; right) exchangeLeft(node -&gt; right);&#125;<span class="hljs-function">TreeNode* <span class="hljs-title">mirrorTree</span><span class="hljs-params">(TreeNode* root)</span> </span>&#123;    exchangeLeft(root);    <span class="hljs-keyword">return</span> root;&#125;</code></pre><h4 id="å‰‘æŒ‡-Offer-32-I-ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘"><a href="#å‰‘æŒ‡-Offer-32-I-ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘" class="headerlink" title="å‰‘æŒ‡ Offer 32 - I. ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘"></a><a href="https://leetcode-cn.com/problems/cong-shang-dao-xia-da-yin-er-cha-shu-lcof/">å‰‘æŒ‡ Offer 32 - I. ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘</a></h4><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">levelOrder</span><span class="hljs-params">(TreeNode* root)</span> </span>&#123;    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; res;    <span class="hljs-keyword">if</span>(root == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> res;    <span class="hljs-built_in">queue</span>&lt;TreeNode *&gt; m_queue;    m_queue.push(root);    <span class="hljs-keyword">while</span>(!m_queue.empty())&#123;        res.push_back(m_queue.front() -&gt; val);        <span class="hljs-keyword">if</span>(m_queue.front() -&gt; left) m_queue.push(m_queue.front() -&gt; left);        <span class="hljs-keyword">if</span>(m_queue.front() -&gt; right) m_queue.push(m_queue.front() -&gt; right);        m_queue.pop();    &#125;    <span class="hljs-keyword">return</span> res;&#125;</code></pre><p><strong>[102]<a href="https://leetcode-cn.com/problems/binary-tree-level-order-traversal/">https://leetcode-cn.com/problems/binary-tree-level-order-traversal/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&gt; <span class="hljs-title">levelOrder</span><span class="hljs-params">(TreeNode* root)</span> </span>&#123;    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; &gt; res;    <span class="hljs-keyword">if</span>(root == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> res;    <span class="hljs-built_in">queue</span>&lt;TreeNode *&gt; m_queue;       <span class="hljs-comment">// queue çš„å‡ ä¸ª æ–¹æ³•: empty(), size(), front(), pop(), push()</span>    m_queue.push(root);    <span class="hljs-keyword">while</span>(!m_queue.empty())&#123;        <span class="hljs-keyword">int</span> n = m_queue.size();        <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; raw;        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)&#123;            raw.push_back(m_queue.front() -&gt; val);            <span class="hljs-keyword">if</span>(m_queue.front() -&gt;left) m_queue.push(m_queue.front() -&gt; left);            <span class="hljs-keyword">if</span>(m_queue.front() -&gt; right) m_queue.push(m_queue.front() -&gt; right);            m_queue.pop();        &#125;        res.push_back(raw);    &#125;     <span class="hljs-keyword">return</span> res;&#125;</code></pre><p><a href="https://leetcode-cn.com/problems/li-wu-de-zui-da-jie-zhi-lcof/">å‰‘æŒ‡ Offer 47. ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼</a></p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">maxValue</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&gt;&amp; grid)</span> </span>&#123;    <span class="hljs-keyword">int</span> m = grid.size();    <span class="hljs-keyword">int</span> n = grid[<span class="hljs-number">0</span>].size();    <span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; &gt; <span class="hljs-title">dp</span><span class="hljs-params">(m, <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;(n))</span></span>;   <span class="hljs-comment">// è¿™ä¸ªè¯­æ³•ä½¿ç”¨é”™äº†  vector</span>    dp[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = grid[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>];    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; m; i++) dp[i][<span class="hljs-number">0</span>] = dp[i<span class="hljs-number">-1</span>][<span class="hljs-number">0</span>] + grid[i][<span class="hljs-number">0</span>];    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt; n; j++) dp[<span class="hljs-number">0</span>][j] = dp[<span class="hljs-number">0</span>][j<span class="hljs-number">-1</span>] + grid[<span class="hljs-number">0</span>][j];    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; m; i++)&#123;        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>;  j &lt; n; j++)&#123;            dp[i][j] = max(dp[i<span class="hljs-number">-1</span>][j], dp[i][j<span class="hljs-number">-1</span>]) + grid[i][j];        &#125;    &#125;    <span class="hljs-keyword">return</span> dp[m<span class="hljs-number">-1</span>][n<span class="hljs-number">-1</span>];&#125;</code></pre><p><strong>[121] <a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock/">https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">maxProfit</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; prices)</span> </span>&#123;    <span class="hljs-keyword">int</span> max_profit = <span class="hljs-number">0</span>;    <span class="hljs-keyword">int</span> min_val = INT_MAX;        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; prices.size(); i++)&#123;        min_val = min(min_val, prices[i]); <span class="hljs-comment">// ä¿å­˜ä¹‹å‰çš„æœ€å°å€¼</span>        max_profit = max(max_profit, prices[i] - min_val);  <span class="hljs-comment">// å½“å‰ä¸æœ€å°å€¼çš„å·®</span>    &#125;    <span class="hljs-keyword">return</span> max_profit;&#125;</code></pre><p><a href="https://leetcode-cn.com/problems/gou-jian-cheng-ji-shu-zu-lcof/">å‰‘æŒ‡ Offer 66. æ„å»ºä¹˜ç§¯æ•°ç»„</a></p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">constructArr</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; a)</span> </span>&#123;    <span class="hljs-keyword">if</span>(a.size() == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> &#123;&#125;;    <span class="hljs-keyword">int</span> len = a.size();    <span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">res</span><span class="hljs-params">(a.size(), a[len<span class="hljs-number">-1</span>])</span></span>;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = len - <span class="hljs-number">2</span>; i &gt;= <span class="hljs-number">0</span>; i--)        res[i] = res[i+<span class="hljs-number">1</span>] * a[i];    <span class="hljs-keyword">int</span> m = <span class="hljs-number">1</span>;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;  i &lt; a.size()<span class="hljs-number">-1</span>; i++)&#123;        res[i] = m * res[i+<span class="hljs-number">1</span>];        m *= a[i];    &#125;    res[a.size()<span class="hljs-number">-1</span>] = m;    <span class="hljs-keyword">return</span> res;&#125;</code></pre><p><strong>[110] <a href="https://leetcode-cn.com/problems/balanced-binary-tree/">https://leetcode-cn.com/problems/balanced-binary-tree/</a></strong></p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getDepth</span><span class="hljs-params">(TreeNode * root)</span></span>&#123;    <span class="hljs-keyword">if</span>(root == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    <span class="hljs-keyword">return</span> max(getDepth(root-&gt;left), getDepth(root-&gt;right)) + <span class="hljs-number">1</span>;&#125;<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">isBalanced</span><span class="hljs-params">(TreeNode* root)</span> </span>&#123;    <span class="hljs-comment">// é€’å½’çš„è§£å†³æ–¹æ¡ˆï¼Œ å…ˆçœ‹é€€å‡ºæ¡ä»¶æ¯”è¾ƒå¥½!</span>    <span class="hljs-keyword">if</span>(root == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;    <span class="hljs-keyword">int</span> left_depth = getDepth(root-&gt;left);    <span class="hljs-keyword">int</span> right_depth = getDepth(root-&gt;right);    <span class="hljs-keyword">return</span> <span class="hljs-built_in">abs</span>(left_depth - right_depth) &lt;= <span class="hljs-number">1</span> &amp;&amp; isBalanced(root -&gt; left) &amp;&amp; isBalanced(root -&gt; right);</code></pre><p><a href="https://leetcode-cn.com/problems/xuan-zhuan-shu-zu-de-zui-xiao-shu-zi-lcof/">å‰‘æŒ‡ Offer 11. æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—</a></p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">minArray</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; numbers)</span> </span>&#123;    <span class="hljs-keyword">int</span> left = <span class="hljs-number">0</span>, right = numbers.size() <span class="hljs-number">-1</span>;    <span class="hljs-keyword">while</span>(left &lt; right)&#123; <span class="hljs-comment">// è¿™é‡Œæ²¡æœ‰ç­‰å·</span>        <span class="hljs-keyword">int</span> mid = left + (right - left) / <span class="hljs-number">2</span>;        <span class="hljs-keyword">if</span>(numbers[mid] &gt; numbers[right])&#123;            left = mid + <span class="hljs-number">1</span>;        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(numbers[mid] &lt; numbers[right])&#123;            right = mid;        &#125;<span class="hljs-keyword">else</span>&#123;            right -= <span class="hljs-number">1</span>;  <span class="hljs-comment">// è¿™é‡Œè¦åˆ†ä¸‰ç§æƒ…å†µçš„ï¼Œ ç­‰äºçš„æ—¶å€™ right -= 1 å³å¯</span>        &#125;    &#125;    <span class="hljs-keyword">return</span> numbers[left];&#125;</code></pre><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">spiralOrder</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&gt;&amp; matrix)</span> </span>&#123;    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; res;    <span class="hljs-keyword">if</span>(matrix.size() == <span class="hljs-number">0</span> || matrix[<span class="hljs-number">0</span>].size() == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> res;    <span class="hljs-keyword">int</span> start_r = <span class="hljs-number">0</span>,  end_r = matrix.size() - <span class="hljs-number">1</span>;    <span class="hljs-keyword">int</span> start_c = <span class="hljs-number">0</span>, end_c = matrix[<span class="hljs-number">0</span>].size() - <span class="hljs-number">1</span>;    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>)&#123; <span class="hljs-comment">// è¿™é‡Œé€€å‡ºçš„æ¡ä»¶æ”¾åœ¨æ¯ä¸ªå†…å±‚å¾ªç¯é‡Œé¢</span>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = start_c; i &lt;= end_c; i++) res.push_back(matrix[start_r][i]);        <span class="hljs-keyword">if</span>(++start_r &gt; end_r) <span class="hljs-keyword">break</span>;        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = start_r; i &lt;= end_r; i++) res.push_back(matrix[i][end_c]);         <span class="hljs-keyword">if</span>(--end_c &lt; start_c) <span class="hljs-keyword">break</span>;        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = end_c; i &gt;= start_c; i--) res.push_back(matrix[end_r][i]);        <span class="hljs-keyword">if</span>(--end_r &lt; start_r) <span class="hljs-keyword">break</span>;        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = end_r; i &gt;= start_r; i--) res.push_back(matrix[i][start_c]);        <span class="hljs-keyword">if</span>(++start_c &gt; end_c)  <span class="hljs-keyword">break</span>;    &#125;    <span class="hljs-keyword">return</span> res;&#125;</code></pre><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">getLeastNumbers</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; arr, <span class="hljs-keyword">int</span> k)</span> </span>&#123;    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; res;    <span class="hljs-keyword">if</span>(arr.size() == <span class="hljs-number">0</span> || k == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> res;    <span class="hljs-built_in">priority_queue</span>&lt;<span class="hljs-keyword">int</span>&gt; max_heap; <span class="hljs-comment">// æœ€å¤§å †</span>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; arr.size(); i++)&#123;        <span class="hljs-keyword">if</span>(i &lt; k) max_heap.push(arr[i]);        <span class="hljs-keyword">else</span>&#123;            <span class="hljs-keyword">if</span>(arr[i] &lt; max_heap.top())&#123;                max_heap.pop();                max_heap.push(arr[i]);            &#125;        &#125;    &#125;    <span class="hljs-keyword">while</span>(!max_heap.empty())&#123;        res.push_back(max_heap.top());        max_heap.pop();    &#125;    <span class="hljs-keyword">return</span> res;&#125;</code></pre><h4 id="å‰‘æŒ‡-Offer-58-I-ç¿»è½¬å•è¯é¡ºåº"><a href="#å‰‘æŒ‡-Offer-58-I-ç¿»è½¬å•è¯é¡ºåº" class="headerlink" title="å‰‘æŒ‡ Offer 58 - I. ç¿»è½¬å•è¯é¡ºåº"></a><a href="https://leetcode-cn.com/problems/fan-zhuan-dan-ci-shun-xu-lcof/">å‰‘æŒ‡ Offer 58 - I. ç¿»è½¬å•è¯é¡ºåº</a></h4><pre><code class="hljs cpp"><span class="hljs-comment">// å…¨æ‰‹å†™: æœ‰ç‚¹ç¹ç</span><span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">reverseWords</span><span class="hljs-params">(<span class="hljs-built_in">string</span> s)</span> </span>&#123;    <span class="hljs-comment">// é¢„å¤„ç†: å»é™¤é¦–å°¾å­—ç¬¦</span>    s.erase(<span class="hljs-number">0</span>, s.find_first_not_of(<span class="hljs-string">&quot; &quot;</span>));      s.erase(s.find_last_not_of(<span class="hljs-string">&quot; &quot;</span>) + <span class="hljs-number">1</span>);    <span class="hljs-keyword">if</span>(s.empty()) <span class="hljs-keyword">return</span> s; <span class="hljs-comment">// å¯ä»¥é˜²æ­¢å¤šç©ºæ ¼çš„æƒ…å†µ</span>    <span class="hljs-comment">// å•è¯æ‹†åˆ†</span>    <span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">string</span>&gt; vec_word;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; s.size();)&#123;        <span class="hljs-keyword">int</span> j = i + <span class="hljs-number">1</span>;        <span class="hljs-keyword">while</span>(j &lt; s.size() &amp;&amp; s[j] != <span class="hljs-string">&#x27; &#x27;</span>) j++;        vec_word.push_back(s.substr(i, j-i));        <span class="hljs-keyword">while</span>(j &lt; s.size() &amp;&amp; s[j] == <span class="hljs-string">&#x27; &#x27;</span>) j++;        i = j;    &#125;    <span class="hljs-comment">// è¿æ¥</span>    <span class="hljs-built_in">string</span> res;    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = vec_word.size()<span class="hljs-number">-1</span>; i &gt; <span class="hljs-number">0</span>; i--)&#123;        res += vec_word[i];        res += <span class="hljs-string">&quot; &quot;</span>;    &#125;    res += vec_word[<span class="hljs-number">0</span>];    <span class="hljs-keyword">return</span> res;&#125;</code></pre><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ol><li><a href="https://leetcode.com/">https://leetcode.com/</a></li><li>ã€Šå‰‘æŒ‡ offerã€‹</li><li>ã€ŠCracking the Coding Interview: 150 Programming Interview Questions and Solutionsã€‹</li><li><a href="https://cspiration.com/leetcodeClassification">https://cspiration.com/leetcodeClassification</a></li><li><a href="https://greyireland.gitbook.io/algorithm-pattern/">https://greyireland.gitbook.io/algorithm-pattern/</a></li><li>leetcode åˆ·é¢˜ç­ <a href="https://www.bilibili.com/video/BV1GW411Q77S">https://www.bilibili.com/video/BV1GW411Q77S</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Interview</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>int8_quantize</title>
    <link href="/2020/02/07/int8-quantize/"/>
    <url>/2020/02/07/int8-quantize/</url>
    
    <content type="html"><![CDATA[<h3 id="1-FP32-vs-int8"><a href="#1-FP32-vs-int8" class="headerlink" title="1. FP32 vs int8"></a>1. FP32 vs int8</h3><p>â€‹        é¦–å…ˆæ¥çœ‹ä¸€ä¸‹ <strong>FP32ã€FP16 å’Œ int8</strong>ä¹‹é—´çš„åŠ¨æ€èŒƒå›´å’Œç²¾åº¦çš„å¯¹æ¯”ï¼Œ å¯ä»¥çœ‹åˆ°float32 çš„å–å€¼èŒƒå›´å‡ ä¹æ˜¯æ— ç©·çš„ï¼Œè€Œint8åªæœ‰<strong>-128~127</strong>. å› æ­¤éœ€è¦å»ºç«‹æ˜ å°„å…³ç³»å°†float32ç±»å‹çš„æµ®ç‚¹æ•°æ˜ å°„åˆ°æŒ‡å®šèŒƒå›´çš„int8ç±»å‹ã€‚ </p><p><img src="/2020/02/07/int8-quantize/fpvsint8.png" alt></p><p>â€‹        ç›®å‰æœ€å¸¸è§çš„ä¸¤ç§<strong>int8é‡åŒ–å®ç°æ–¹å¼</strong>æ˜¯ <strong>Nvidiaçš„TensorRTæ–¹æ¡ˆ</strong> å’Œ <strong>googleçš„æ–¹æ¡ˆ</strong>ï¼Œå…¶ä¸­å‰è€…ç›´æ¥é‡åŒ–ï¼Œæ— éœ€retrainï¼Œå®ç°ç®€å•ï¼›è€Œåè€…éœ€è¦é‡æ–°è®­ç»ƒï¼Œç¨æ˜¾å¤æ‚ã€‚ å¤§éƒ¨åˆ†çš„å¼€æºæ–¹æ¡ˆæ˜¯åŸºäºå‰è€…çš„ï¼Œ<strong>æœ¬æ–‡åŸºäºncnnæ¡†æ¶ï¼Œä¸»è¦è®²è¿°ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚</strong></p><h3 id="2-TensorRT-int8-é‡åŒ–æ–¹æ¡ˆ"><a href="#2-TensorRT-int8-é‡åŒ–æ–¹æ¡ˆ" class="headerlink" title="2. TensorRT int8 é‡åŒ–æ–¹æ¡ˆ"></a>2. TensorRT int8 é‡åŒ–æ–¹æ¡ˆ</h3><p>â€‹    Nvidia çš„ TensorRTæä¾›äº†ä¸€ç§é‡åŒ–æ–¹æ¡ˆï¼Œä½†æ˜¯å®ƒä»…ä»…æä¾›ç›¸åº”çš„SDKå’Œè§£å†³æ–¹æ¡ˆï¼Œ æ²¡æœ‰å…¬å¸ƒå¯¹åº”çš„æºä»£ç ï¼Œ è¯¸å¤šç¬¬ä¸‰æ–¹å‚å®¶åˆ™æ ¹æ®è¯¥è§£å†³æ–¹æ¡ˆè‡ªå·±é€ è½®å­ï¼Œäº§ç”Ÿäº†å¯¹åº”çš„è§£å†³æ–¹æ¡ˆã€‚è¯¥é‡åŒ–æ–¹æ¡ˆçš„æœ€é‡è¦çš„ä¸¤ä»½å‚è€ƒèµ„æ–™å¦‚ä¸‹æ‰€ç¤º:</p><ul><li><p>TensorRT Develop guide: <a href="https://docs.nvidia.com/deeplearning/sdk/tensorrt-developer-guide/index.html#work-with-qat-networks">https://docs.nvidia.com/deeplearning/sdk/tensorrt-developer-guide/index.html#work-with-qat-networks</a></p></li><li><p>PDF é“¾æ¥ï¼š <a href="http://on-demand.gputechconf.com/gtc/2017/presentation/s7310-8-bit-inference-with-tensorrt.pdf">http://on-demand.gputechconf.com/gtc/2017/presentation/s7310-8-bit-inference-with-tensorrt.pdf</a></p></li></ul><p><strong>(1)</strong> <strong>max-max æ˜ å°„</strong>ï¼š æœ€ç®€å•ç²—æš´çš„æ–¹å¼å¦‚ä¸‹å·¦å›¾æ‰€ç¤º</p><p>â€‹    é¦–å…ˆæ±‚å‡ºä¸€ä¸ªlaye çš„æ¿€æ´»å€¼èŒƒå›´ï¼Œ ç„¶åæŒ‰ç…§ç»å¯¹å€¼çš„æœ€å¤§å€¼ä½œä¸ºé˜ˆå€¼ï¼Œ ç„¶åæŠŠè¿™ä¸ªèŒƒå›´æŒ‰ç…§æ¯”ä¾‹æ˜ å°„åˆ°-127åˆ°128çš„èŒƒå›´å†…, å…¶fp32å’Œint8çš„è½¬æ¢å…¬å¼ä¸º:</p><pre><code class="hljs lisp">FP32 Tensor (<span class="hljs-name">T</span>) = scale_factor(<span class="hljs-name">sf</span>) * <span class="hljs-number">8</span>-bit Tensor(<span class="hljs-name">t</span>) + FP32_bias (<span class="hljs-name">b</span>)</code></pre><p>â€‹    é€šè¿‡å®éªŒå¾—çŸ¥ï¼Œbiaså€¼å»æ‰å¯¹ç²¾åº¦çš„å½±å“ä¸æ˜¯å¾ˆå¤§ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥å»æ‰, æ‰€ä»¥è¯¥å…¬å¼å¯ä»¥ç®€åŒ–ä¸º:</p><pre><code class="hljs excel"><span class="hljs-built_in">T</span> = sf * <span class="hljs-built_in">t</span></code></pre><p><img src="/2020/02/07/int8-quantize/tensorrt_qua.png" alt></p><p><strong>(2) é¥±å’Œæ˜ å°„</strong></p><p>â€‹    å¦‚ä¸Šæ–¹æ³•ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼š<strong>ä¸é¥±å’Œï¼Œå³é€šå¸¸åœ¨æ­£è´Ÿä¸Šä¼šæœ‰ä¸€äº›é‡åŒ–å€¼æœªè¢«åˆ©ç”¨ï¼Œä¸”ä¼šäº§ç”Ÿçš„ç²¾åº¦æŸå¤±è¾ƒå¤§ã€‚</strong>é’ˆå¯¹ max-max æ˜ å°„å­˜åœ¨çš„é—®é¢˜ï¼Œ TensorRTæå‡ºäº†å¦‚ä¸Šå³å›¾çš„é¥±å’Œæ˜ å°„ã€‚ <strong>é€‰å–ä¸€ä¸ªé˜ˆå€¼Tï¼Œç„¶åå°† -|T|~|T| ä¹‹é—´çš„å€¼æ˜ å°„åˆ° -127 åˆ° 128 è¿™ä¸ªèŒƒå›´å†…ã€‚è¿™æ ·ç¡®å®šäº†é˜ˆå€¼Tä¹‹åï¼Œå…¶å®ä¹Ÿèƒ½ç¡®å®šScaleï¼Œä¸€ä¸ªç®€å•çš„çº¿æ€§å…¬å¼æ˜¯: Scale = T/127ã€‚ æ‰€ä»¥è¦è®¡ç®—Scaleï¼Œåªè¦æ‰¾åˆ°åˆé€‚çš„é˜ˆå€¼Tå°±å¯ä»¥äº†ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒTåº”è¯¥å–ä½•å€¼? å…¶åŸºæœ¬æµç¨‹å¦‚ä¸‹:</strong></p><p>â€‹    <strong>(a) é€‰å–ä¸åŒçš„ T é˜ˆå€¼è¿›è¡Œé‡åŒ–, å°† P(fp32) æ˜ å°„åˆ° Q(int8)ã€‚</strong></p><p>â€‹    <strong>(b) å°† Q(int8) åé‡åŒ–åˆ° P(fp32) ä¸€æ ·é•¿åº¦ï¼Œå¾—åˆ°åˆ†å¸ƒ Q_expandï¼›</strong></p><p>â€‹    <strong>(c) è®¡ç®—På’ŒQ_expand çš„ç›¸å¯¹ç†µ(KLæ•£åº¦)ï¼Œç„¶åé€‰æ‹©ç›¸å¯¹ç†µæœ€å°‘çš„ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯è·ŸåŸåˆ†å¸ƒæœ€åƒçš„ä¸€ä¸ª,</strong> <strong>ä»è€Œç¡®å®šScale</strong>ã€‚</p><p><strong>(3) KL æ•£åº¦</strong></p><p>â€‹    KLæ•£åº¦å¯ä»¥ç”¨æ¥<strong>æè¿°Pã€Qä¸¤ä¸ªåˆ†å¸ƒçš„å·®å¼‚</strong>ã€‚<strong>æ•£åº¦è¶Šå°ï¼Œä¸¤ä¸ªåˆ†å¸ƒçš„å·®å¼‚è¶Šå°ï¼Œæ¦‚ç‡å¯†åº¦å‡½æ•°å½¢çŠ¶å’Œæ•°å€¼è¶Šæ¥è¿‘</strong>ã€‚è¿™é‡Œçš„æ‰€æœ‰åˆ†å¸ƒã€è®¡ç®—ï¼Œéƒ½æ˜¯ç¦»æ•£å½¢å¼çš„ã€‚åˆ†å¸ƒæ˜¯ä»¥ç»Ÿè®¡ç›´æ–¹å›¾çš„æ–¹å¼å­˜åœ¨ï¼ŒKLæ•£åº¦å…¬å¼ä¹Ÿæ˜¯ç¦»æ•£å…¬å¼ï¼š</p><p><img src="/2020/02/07/int8-quantize/kl.png" alt="img"></p><p>â€‹        ä»ä¸Šå¼ä¸­æˆ‘ä»¬è¿˜å‘ç°ä¸€ä¸ªé—®é¢˜ï¼šKLæ•£åº¦è®¡ç®—å…¬å¼è¦æ±‚Pã€Qä¸¤ä¸ªç»Ÿè®¡ç›´æ–¹å›¾é•¿åº¦ä¸€æ ·ï¼ˆä¹Ÿå°±æ˜¯binsçš„æ•°é‡ä¸€æ ·ï¼‰ã€‚Qä¸€ç›´éƒ½æ˜¯-127ï½127ï¼›å¯æ˜¯Pçš„æ•°é‡ä¼šéšç€Tçš„å˜åŒ–è€Œå˜åŒ–ã€‚é‚£è¿™æ€ä¹ˆåšKLæ•£åº¦å‘¢ï¼Ÿ</p><p>ncnn çš„åšæ³•æ˜¯å°† Qæ‰©å±•åˆ°å’ŒPä¸€æ ·çš„é•¿åº¦ï¼Œä¸‹é¢ä¸¾ä¸ªä¾‹å­(NVIDIA PPTä¸­çš„ä¾‹å­)ï¼š</p><pre><code class="hljs python">P = [<span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">5</span> <span class="hljs-number">3</span> <span class="hljs-number">1</span> <span class="hljs-number">7</span>]     // fp32çš„ç»Ÿè®¡ç›´æ–¹å›¾ï¼ŒT=<span class="hljs-number">8</span> // å‡è®¾åªé‡åŒ–åˆ°ä¸¤ä¸ªbinsï¼Œå³é‡åŒ–åçš„å€¼åªæœ‰<span class="hljs-number">-1</span>/<span class="hljs-number">0</span>/+<span class="hljs-number">1</span>ä¸‰ç§ Q=[<span class="hljs-number">1</span>+<span class="hljs-number">0</span>+<span class="hljs-number">2</span>+<span class="hljs-number">3</span>, <span class="hljs-number">5</span>+<span class="hljs-number">3</span>+<span class="hljs-number">1</span>+<span class="hljs-number">7</span>] = [<span class="hljs-number">6</span>, <span class="hljs-number">16</span>]  // På’ŒQç°åœ¨æ²¡æ³•åšKLæ•£åº¦ï¼Œæ‰€ä»¥è¦å°†Qæ‰©å±•åˆ°å’ŒPä¸€æ ·çš„é•¿åº¦ Q_expand = [<span class="hljs-number">6</span>/<span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">6</span>/<span class="hljs-number">3</span>, <span class="hljs-number">6</span>/<span class="hljs-number">3</span>, <span class="hljs-number">16</span>/<span class="hljs-number">4</span>, <span class="hljs-number">16</span>/<span class="hljs-number">4</span>, <span class="hljs-number">16</span>/<span class="hljs-number">4</span>, <span class="hljs-number">16</span>/<span class="hljs-number">4</span>]=[<span class="hljs-number">2</span> <span class="hljs-number">0</span> <span class="hljs-number">2</span> <span class="hljs-number">2</span> <span class="hljs-number">4</span> <span class="hljs-number">4</span> <span class="hljs-number">4</span> <span class="hljs-number">4</span>]  // Pä¸­æœ‰<span class="hljs-number">0</span>æ—¶ä¸ç®—åœ¨å†… D = KL(P||Q_expand)  // è¿™æ ·å°±å¯ä»¥åšKLæ•£åº¦è®¡ç®—äº†</code></pre><p>â€‹    è¿™ä¸ªæ‰©å±•çš„æ“ä½œï¼Œå°±åƒå›¾åƒçš„ä¸Šé‡‡æ ·ä¸€æ ·ï¼Œå°†ä½ç²¾åº¦çš„ç»Ÿè®¡ç›´æ–¹å›¾(Q)ï¼Œä¸Šé‡‡æ ·çš„é«˜ç²¾åº¦çš„ç»Ÿè®¡ç›´æ–¹å›¾ä¸Šå»(Q_expand)ã€‚ç”±äºQä¸­ä¸€ä¸ªbinå¯¹åº”Pä¸­çš„4ä¸ªbinï¼Œå› æ­¤åœ¨Qä¸Šé‡‡æ ·çš„Q_expandçš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„æ•°æ®è¦é™¤ä»¥4ã€‚å¦å¤–ï¼Œåœ¨è®¡ç®—fp32çš„åˆ†å¸ƒPæ—¶ï¼Œè¢«Tæˆªæ–­çš„æ•°æ®ï¼Œæ˜¯è¦ç®—åœ¨æœ€åä¸€ä¸ªbiné‡Œé¢çš„ã€‚</p><h3 id="3-ncnnçš„convé‡åŒ–è®¡ç®—æµç¨‹"><a href="#3-ncnnçš„convé‡åŒ–è®¡ç®—æµç¨‹" class="headerlink" title="3. ncnnçš„convé‡åŒ–è®¡ç®—æµç¨‹"></a>3. ncnnçš„convé‡åŒ–è®¡ç®—æµç¨‹</h3><p>æ­£å¸¸çš„ fp32 è®¡ç®—ä¸­ï¼Œ ä¸€ä¸ªconv çš„è®¡ç®—æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼Œ æ‰€æœ‰çš„æ•°æ®å‡æ˜¯ fp32ï¼Œ æ²¡ä»€ä¹ˆç‰¹æ®Šçš„</p><p><img src="/2020/02/07/int8-quantize/fpconv.png" alt></p><p>åœ¨ ncnn conv è¿›è¡ŒInt8è®¡ç®—æ—¶ï¼Œ è®¡ç®—æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼Œncnné¦–å…ˆ<strong>å°†è¾“å…¥(bottom_blob)å’Œæƒé‡é‡åŒ–æˆInt8ï¼Œåœ¨Int8ä¸‹è®¡ç®—å·ç§¯ï¼Œç„¶ååé‡åŒ–åˆ° fp32ï¼Œå†å’Œæœªé‡åŒ–çš„biasç›¸åŠ ï¼Œå¾—åˆ°è¾“å‡º top_blob</strong>(ncnnå¹¶æ²¡æœ‰å¯¹biasåšé‡åŒ–)</p><p><img src="/2020/02/07/int8-quantize/int8conv.png" alt></p><p>è¾“å…¥å’Œæƒé‡çš„<strong>é‡åŒ–å…¬å¼</strong>ä¸º:</p><script type="math/tex; mode=display">bottom\_blob[int8] = bottom\_blob\_in8t\_scale * bottom[fp32] \\weight\_blob[int8] = weight\_data\_int8\_scale * weight[fp32]</script><p><strong>åé‡åŒ–</strong>çš„ç›®çš„æ˜¯å°†int8æ˜ å°„å›åˆ°åŸæ¥çš„fp32,èŒƒå›´ä¿æŒè¦ä¸€è‡´, ç”±äº weight_blob(int8) å’Œ bottom_blob(int8) ç›¸ä¹˜ï¼Œ æ‰€ä»¥æ­¤å¤„çš„é‡åŒ–åé‡åŒ–çš„ scale åº”è¯¥ä¸º:</p><script type="math/tex; mode=display">dequantize\_scale = 1/(bottom\_blob\_int8\_scale * weight\_data\_int8\_scale) \\innner\_blob[fp32] = dequantize\_scale * inner\_blob</script><p>! å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ æƒé‡æ˜¯åœ¨ç½‘ç»œåˆå§‹åŒ–æ—¶å€™å°±è¿›è¡Œé‡åŒ–äº†ï¼Œ è€Œè¾“å…¥åˆ™æ˜¯åœ¨å‰å‘æ¨å¯¼æ—¶è¿›è¡Œé‡åŒ–ã€‚</p><h3 id="4-ncnn-é‡åŒ–å·¥å…·çš„ä½¿ç”¨"><a href="#4-ncnn-é‡åŒ–å·¥å…·çš„ä½¿ç”¨" class="headerlink" title="4. ncnn é‡åŒ–å·¥å…·çš„ä½¿ç”¨"></a>4. ncnn é‡åŒ–å·¥å…·çš„ä½¿ç”¨</h3><p>(1)  Optimization graphic</p><pre><code class="hljs smali"><span class="hljs-keyword">.</span>/ncnnoptimize mobilenet-fp32.param mobilenet-fp32.bin mobilenet-nobn-fp32.param mobilenet-nobn-fp32.bin</code></pre><p>(2) Create the calibration table file</p><pre><code class="hljs angelscript">./ncnn2table --param mobilenet-nobn-fp32.param --bin mobilenet-nobn-fp32.bin --images images/ --output mobilenet-nobn.table --mean <span class="hljs-number">104</span>,<span class="hljs-number">117</span>,<span class="hljs-number">123</span> --norm <span class="hljs-number">0.017</span>,<span class="hljs-number">0.017</span>,<span class="hljs-number">0.017</span> --size <span class="hljs-number">224</span>,<span class="hljs-number">224</span> --thread <span class="hljs-number">2</span></code></pre><p>(3) Quantization</p><pre><code class="hljs stylus">./ncnn2int8 mobilenet-nobn-fp32<span class="hljs-selector-class">.param</span> mobilenet-nobn-fp32<span class="hljs-selector-class">.bin</span> mobilenet-int8<span class="hljs-selector-class">.param</span> mobilenet-int8<span class="hljs-selector-class">.bin</span> mobilenet-nobn.table</code></pre><h3 id="5-å‚è€ƒèµ„æ–™"><a href="#5-å‚è€ƒèµ„æ–™" class="headerlink" title="5. å‚è€ƒèµ„æ–™"></a>5. å‚è€ƒèµ„æ–™</h3><p>[1] <a href="https://me.csdn.net/sinat_31425585">https://me.csdn.net/sinat_31425585</a></p><p>[2] <a href="https://zhuanlan.zhihu.com/c_1064124187198705664">https://zhuanlan.zhihu.com/c_1064124187198705664</a></p><p>[3] <a href="https://github.com/BUG1989/caffe-int8-convert-tools">https://github.com/BUG1989/caffe-int8-convert-tools</a></p><p>[4] <a href="https://github.com/Tencent/ncnn/wiki/quantized-int8-inference">Tencent/ncnn</a></p><p>[5] QNNPACK</p><p>[6] Nvidia solutionï¼š Szymon Migacz. 8-bit Inference with TensorRT</p><p>[7] Google solutionï¼šQuantizing deep convolutional networks for efficient inference: A whitepaper</p>]]></content>
    
    
    <categories>
      
      <category>DL_Deploy</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>RNN</title>
    <link href="/2020/02/06/RNN/"/>
    <url>/2020/02/06/RNN/</url>
    
    <content type="html"><![CDATA[<hr><p>title: RNN<br>date: 2019-03-05 11:49:20<br>tags:</p><h2 id="mathjax-true"><a href="#mathjax-true" class="headerlink" title="mathjax: true"></a>mathjax: true</h2><p>â€‹        <strong>å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRecurrent Neural Networkï¼‰</strong>æ˜¯ç”¨æ¥å»ºæ¨¡åºåˆ—åŒ–æ•°æ®çš„ä¸€ç§ä¸»æµæ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œä¼ ç»Ÿçš„å‰é¦ˆç¥ç»ç½‘ç»œä¸€èˆ¬çš„è¾“å…¥éƒ½æ˜¯ä¸€ä¸ªå®šé•¿çš„å‘é‡ï¼Œæ— æ³•å¤„ç†å˜é•¿çš„åºåˆ—ä¿¡æ¯ï¼Œå³ä½¿é€šè¿‡ä¸€äº›æ–¹æ³•æŠŠåºåˆ—å¤„ç†æˆå®šé•¿çš„å‘é‡ï¼Œæ¨¡å‹ä¹Ÿå¾ˆéš¾æ•æ‰åºåˆ—ä¸­çš„é•¿è·ç¦»ä¾èµ–å…³ç³»ã€‚RNNåˆ™é€šè¿‡å°†ç¥ç»å…ƒä¸²è¡Œèµ·æ¥å¤„ç†åºåˆ—åŒ–çš„æ•°æ®ã€‚ç”±äºæ¯ä¸ªç¥ç»å…ƒéƒ½èƒ½ç”¨å®ƒçš„å†…éƒ¨å˜é‡ä¿å­˜ä¹‹å‰è¾“å…¥çš„åºåˆ—ä¿¡æ¯ï¼Œå› æ­¤æ•´ä¸ªåºåˆ—è¢«æµ“ç¼©æˆæŠ½è±¡çš„è¡¨ç¤ºï¼Œå¹¶å¯ä»¥æ®æ­¤è¿›è¡Œåˆ†ç±»æˆ–ç”Ÿæˆæ–°çš„åºåˆ—ã€‚è¿‘å¹´æ¥RNNåœ¨å¾ˆå¤šé¢†åŸŸå–å¾—çªç ´æ€§è¿›å±• â€”â€” æœºå™¨ç¿»è¯‘ã€åºåˆ—æ ‡æ³¨ã€å›¾åƒæè¿°ã€æ¨èç³»ç»Ÿã€æ™ºèƒ½èŠå¤©æœºå™¨äººã€è‡ªåŠ¨ä½œè¯ä½œæ›²ç­‰ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªå…¸å‹çš„å¾ªç¯ç¥ç»ç½‘ç»œç»“æ„ï¼š</p><p><img src="/2020/02/06/RNN/rnn.png" alt></p><p>ä¸€ä¸ªé•¿åº¦ä¸ºT çš„åºåˆ—ç”¨å¾ªç¯ç¥ç»ç½‘ç»œå»ºæ¨¡ï¼Œå±•å¼€ä¹‹åå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªTæ›¾çš„å‰é¦ˆç¥ç»ç½‘ç»œã€‚å…¶ä¸­ï¼Œç¬¬ $t$ å±‚çš„éšå«çŠ¶æ€ $h<em>{t}$ ç¼–ç äº†åºåˆ—ä¸­å‰ $t$ ä¸ªè¾“å…¥çš„ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡å½“å‰çš„è¾“å…¥$x</em>{t}$å’Œä¸Šä¸€å±‚çš„çŠ¶æ€ $h<em>{t-1}$ è®¡ç®—å¾—åˆ°ï¼›æœ€åä¸€å±‚çš„çŠ¶æ€ $h</em>{t}$ ç¼–ç äº†æ•´ä¸ªåºåˆ—çš„ä¿¡æ¯ï¼Œå› æ­¤å¯ä»¥ä½œä¸ºæ•´ä¸ªåºåˆ—çš„å‹ç¼©è¡¨ç¤ºã€‚å¾ªç¯ç¥ç»ç½‘ç»œçš„å‰å‘ä¼ æ’­å…¬å¼ä¸º:</p><script type="math/tex; mode=display">net_{t} = Ux_{t} + Wh_{t-1}  \\h_{t} = f(net_{t})  \\y = g(Vh_{t})</script><p>â€‹    å…¶ä¸­ $f$ å’Œ $g$  ä¸ºæ¿€æ´»å‡½æ•°ï¼Œ$U$ ä¸ºè¾“å…¥å±‚åˆ°éšå«å±‚çš„æƒé‡çŸ©é˜µï¼Œ$W$ ä¸ºéšå«å±‚ä»ä¸Šä¸€æ—¶åˆ»åˆ°ä¸‹ä¸€æ—¶åˆ»çŠ¶æ€è½¬ç§»çš„æƒé‡çŸ©é˜µã€‚$f$ å¯ä»¥é€‰å– Tanh å‡½æ•° æˆ–è€… ReLU å‡½æ•°ï¼Œ$g$ å¯ä»¥é‡‡ç”¨ Softmax å‡½æ•°ã€‚</p><h5 id="é—®é¢˜1ï¼šå¾ªç¯ç¥ç»ç½‘ç»œçš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜"><a href="#é—®é¢˜1ï¼šå¾ªç¯ç¥ç»ç½‘ç»œçš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜" class="headerlink" title="é—®é¢˜1ï¼šå¾ªç¯ç¥ç»ç½‘ç»œçš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜"></a>é—®é¢˜1ï¼šå¾ªç¯ç¥ç»ç½‘ç»œçš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜</h5><p>å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹çš„æ±‚è§£å¯ä»¥é‡‡ç”¨ <strong>BPTT</strong> ç®—æ³•å®ç°ï¼Œ BPTT å®é™…ä¸Šæ˜¯åå‘ä¼ æ’­ç®—æ³•çš„å˜ç§ã€‚è¿™ä¸€ç°è±¡ä¸»è¦æºäºæ·±åº¦ç¥ç»ç½‘ç»œä¸­çš„æ¢¯åº¦æ¶ˆå¤±ã€‚ä¼ ç»Ÿçš„å¾ªç¯ç¥ç»ç½‘ç»œæ¢¯åº¦å¯ä»¥å†™æˆè¿ä¹˜çš„å½¢å¼ï¼š</p><script type="math/tex; mode=display">\frac{\partial{net_t}}{\partial{net_1}} = \frac{\partial{net_t}}{\partial{net_{t-1}}}.\frac{\partial{net_{t-1}}}{\partial{net_{t-2}}} ...\frac{\partial{net_{2}}}{\partial{net_{1}}}</script><p>å…¶ä¸­ï¼Œ</p><script type="math/tex; mode=display">net_{t} = Ux_{t} + Wh_{t-1} \\h_{t} = f(net_{t}) \\y = g(Vh_{t})</script><script type="math/tex; mode=display">\frac{\partial{net_t}}{\partial{net_{t-1}}} = \frac{\partial{net_t}}{\partial{h_{t-1}}}\frac{\partial{h_{t-1}}}{\partial{net_{t-1}}}= W \cdot diag[f'(net_{t-1})] \\=   \begin{bmatrix}W_{11}f'(net_{t-1}^1)      &  \dots  & W_{1n}f'(net_{t-1}^n) \\\vdots  &  \ddots & \vdots  \\W_{n1}f'(net_{t-1}^1)       &  \dots  & W_{nn}f'(net_{t-1}^n) \end{bmatrix}</script><p>å…¶ä¸­ $n$ ä¸º éšå«å±‚ $h<em>{t-1}$  çš„ç»´åº¦ï¼ˆå³éšå«å•å…ƒçš„ä¸ªæ•°ï¼‰ï¼Œ $\frac{\partial{net_1}}{\partial{net</em>{t-1}}}$ å¯¹åº” $n*n$ ç»´çŸ©é˜µï¼Œåˆè¢«ç§°ä¸ºé›…å„æ¯”çŸ©é˜µã€‚</p><p>ç”±äºé¢„æµ‹è¯¯å·®æ˜¯æ²¿ç€ç¥ç»ç½‘ç»œçš„æ¯ä¸€å±‚åå‘ä¼ æ’­çš„ï¼Œå› æ­¤å½“é›…å„æ¯”çŸ©é˜µçš„æœ€å¤§ç‰¹å¾å€¼å¤§äº1æ—¶ï¼Œ éšç€ç¦»è¾“å‡ºè¶Šæ¥è¶Šè¿œï¼Œæ¯å±‚æ¢¯åº¦å¤§å°ä¼šå‘ˆæŒ‡æ•°å¢é•¿ï¼Œå¯¼è‡´æ¢¯åº¦çˆ†ç‚¸ï¼›åä¹‹ï¼Œè‹¥é›…å„æ¯”çŸ©é˜µçš„æœ€å¤§ç‰¹å¾å€¼å°äº1ï¼Œ æ¢¯åº¦çš„å¤§å°ä¼šå‘ˆæŒ‡æ•°å‡å°ï¼Œäº§ç”Ÿæ¢¯åº¦æ¶ˆå¤±ã€‚</p><p>æ¢¯åº¦çˆ†ç‚¸çš„é—®é¢˜å¯ä»¥é€šè¿‡æ¢¯åº¦è£å‰ªæ¥ç¼“è§£ï¼Œå³å½“æ¢¯åº¦çš„èŒƒå¼å¤§äºæŸä¸ªæŸä¸ªç»™å®šå€¼æ—¶ï¼Œ å¯¹æ¢¯åº¦è¿›è¡Œç­‰æ¯”æ”¶ç¼©ã€‚è€Œå¯¹äºæ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œ å¯ä»¥é€šè¿‡åŠ å…¥é—¨å£æœºåˆ¶æ¥å¼¥è¡¥æ¢¯åº¦æ¶ˆå¤±å¸¦æ¥çš„æŸå¤±ã€‚</p><h5 id="é—®é¢˜-2ï¼š-åœ¨å¾ªç¯ç¥ç»ç½‘ç»œä¸­ï¼Œæ˜¯å¦å¯ä»¥ä½¿ç”¨-ReLU-ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Ÿ"><a href="#é—®é¢˜-2ï¼š-åœ¨å¾ªç¯ç¥ç»ç½‘ç»œä¸­ï¼Œæ˜¯å¦å¯ä»¥ä½¿ç”¨-ReLU-ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Ÿ" class="headerlink" title="é—®é¢˜ 2ï¼š åœ¨å¾ªç¯ç¥ç»ç½‘ç»œä¸­ï¼Œæ˜¯å¦å¯ä»¥ä½¿ç”¨ ReLU ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Ÿ"></a>é—®é¢˜ 2ï¼š åœ¨å¾ªç¯ç¥ç»ç½‘ç»œä¸­ï¼Œæ˜¯å¦å¯ä»¥ä½¿ç”¨ ReLU ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Ÿ</h5><p>å¯ä»¥ï¼Œä½†æ˜¯éœ€è¦å°†$W$åˆå§‹åŒ–ä¸ºå•ä½çŸ©é˜µã€‚å¦‚æœä¸ç„¶ä¼šå¼•å‘ä¸¥é‡çš„æ•°å€¼é—®é¢˜å’Œæ¢¯åº¦æ¶ˆå¤±æˆ–çˆ†ç‚¸é—®é¢˜ã€‚</p><p><strong>æ•°å€¼é—®é¢˜ï¼š</strong></p><p>è€ƒè™‘å‰å‘ä¼ æ’­å…¬å¼ï¼š</p><script type="math/tex; mode=display">net_{t} = Ux_{t} + Wh_{t-1}  \\h_{t} = f(net_{t})  \\</script><p>æ ¹æ®å‰å‘ä¼ æ’­å…¬å¼å‘å‰ä¼ é€’ä¸€å±‚ï¼Œå¯ä»¥å¾—åˆ°</p><script type="math/tex; mode=display">net_{t} = Ux_{t} + Wh_{t-1} + Wf(Ux_{t-1} + Wh_{t-2})</script><p>å¦‚æœä½¿ç”¨ $ReLU$ æ›¿ä»£å…¬å¼ä¸­çš„æ¿€æ´»å‡½æ•° $f$ï¼Œ å¹¶ä¸”å‡è®¾ $ReLU$ å¤„äºæ¿€æ´»åŒºåŸŸï¼ˆå³è¾“å…¥å¤§äº0ï¼‰ï¼Œåˆ™æœ‰ $f(x)=x, net<em>{t}=Ux</em>{t}+W(Ux<em>{t-1}+Wh</em>{t-2})$, ç»§ç»­å°†å…¶å±•å¼€ï¼Œ$net_{t}$ çš„è¡¨è¾¾å¼ä¸­æœ€ç»ˆå°†åŒ…å«$t$ ä¸ª $W$ è¿ä¹˜ã€‚å¦‚æœ $W$ ä¸æ˜¯å•ä½çŸ©é˜µï¼Œæœ€ç»ˆçš„ç»“æœå°†è¶‹äº $0$ æˆ–è€…æ— ç©·ï¼Œå¼•å‘ä¸¥é‡çš„æ•°å€¼é—®é¢˜ã€‚</p><p><strong>æ¢¯åº¦çˆ†ç‚¸æˆ–æ¢¯åº¦æ¶ˆå¤±ï¼š</strong></p><p>è€ƒè™‘å¾ªç¯ç¥ç»ç½‘ç»œçš„æ¢¯åº¦è®¡ç®—å…¬å¼ï¼š</p><script type="math/tex; mode=display">\frac{\partial{net_t}}{\partial{net_{t-1}}} = W \cdot diag[f'(net_{t-1})] \\=   \begin{bmatrix}W_{11}f'(net_{t-1}^1)      &  \dots  & W_{1n}f'(net_{t-1}^n) \\\vdots  &  \ddots & \vdots  \\W_{n1}f'(net_{t-1}^1)       &  \dots  & W_{nn}f'(net_{t-1}^n) \end{bmatrix}</script><p>å‡è®¾é‡‡ç”¨ $ReLU$ æ¿€æ´»å‡½æ•°ï¼Œä¸”ä¸€å¼€å§‹æ‰€æœ‰çš„ç¥ç»å…ƒéƒ½å¤„äºæ¿€æ´»ä¸­ï¼Œ åˆ™ $diag[fâ€™(net<em>{t-1})]$ ä¸ºå•ä½çŸ©é˜µï¼Œ æœ‰ $\frac{\partial{net_t}}{\partial{net</em>{t-1}}}=W$ã€‚åœ¨æ¢¯åº¦ç»è¿‡äº†$n$ å±‚ä¹‹åï¼Œ $\frac{\partial{net<em>{t}}}{\partial{net</em>{1}}} = W^n$ã€‚å¯ä»¥çœ‹åˆ°å³ä½¿é‡‡ç”¨äº† $ReLU$ æ¿€æ´»å‡½æ•°ï¼Œåªè¦$W$ ä¸æ˜¯å•ä½çŸ©é˜µï¼Œè¿˜æ˜¯ä¼šå‡ºç°æ¢¯åº¦æ¶ˆå¤±æˆ–è€…çˆ†ç‚¸çš„ç°è±¡ã€‚</p><h5 id="é—®é¢˜-3ï¼š-LSTM-æ˜¯å¦‚ä½•å®ç°é•¿çŸ­æœŸè®°å¿†åŠŸèƒ½çš„ï¼Ÿ"><a href="#é—®é¢˜-3ï¼š-LSTM-æ˜¯å¦‚ä½•å®ç°é•¿çŸ­æœŸè®°å¿†åŠŸèƒ½çš„ï¼Ÿ" class="headerlink" title="é—®é¢˜ 3ï¼š LSTM æ˜¯å¦‚ä½•å®ç°é•¿çŸ­æœŸè®°å¿†åŠŸèƒ½çš„ï¼Ÿ"></a>é—®é¢˜ 3ï¼š LSTM æ˜¯å¦‚ä½•å®ç°é•¿çŸ­æœŸè®°å¿†åŠŸèƒ½çš„ï¼Ÿ</h5><p>â€‹    ä¸ä¼ ç»Ÿçš„å¾ªç¯ç¥ç»ç½‘ç»œç›¸æ¯”ï¼ŒLSTM ä»ç„¶æ˜¯åŸºäº$x<em>t$ å’Œ $h</em>{t-1}$ æ¥è®¡ç®— $h_t$, åªä¸è¿‡å¯¹å†…éƒ¨çš„ç»“æ„è¿›è¡Œäº†æ›´åŠ ç²¾å¿ƒçš„è®¾è®¡ï¼ŒåŠ å…¥äº†è¾“å…¥é—¨ $i_t$ ã€é—å¿˜é—¨ $f_t$ ä»¥åŠè¾“å‡ºé—¨ $o_t$ ä¸‰ä¸ªé—¨å’Œä¸€ä¸ªå†…éƒ¨è®°å¿†å•å…ƒ $c_t$ã€‚</p><p>â€‹    è¾“å…¥é—¨æ§åˆ¶å½“å‰è®¡ç®—çš„æ–°çŠ¶æ€ä»¥å¤šå¤§ç¨‹åº¦æ›´æ–°åˆ°è®°å¿†å•å…ƒä¸­ï¼›é—å¿˜é—¨æ§åˆ¶å‰ä¸€æ­¥è®°å¿†å•å…ƒä¸­çš„ä¿¡æ¯æœ‰å¤šå¤§ç¨‹åº¦è¢«é—å¿˜æ‰ï¼›è¾“å‡ºé—¨æ§åˆ¶å½“å‰çš„è¾“å‡ºæœ‰å¤šå¤§ç¨‹åº¦å–å†³äºå½“å‰çš„è®°å¿†å•å…ƒã€‚</p><p>ç»å…¸çš„LSTMä¸­ï¼Œ ç¬¬ $t$ æ­¥çš„æ›´æ–°è®¡ç®—å…¬å¼ä¸ºï¼š</p><script type="math/tex; mode=display">i_t = \sigma(W_{i}x_{t}+U_{i}h_{t-1}+b_{i}) \\f_t = \sigma(W_{f}x_{t}+U_{f}h_{t-1}+b_{f}) \\o_t = \sigma(W_{o}x_{t}+U_{o}h_{t-1}+b_{o}) \\\widetilde{c_{t}} = Tanh(W_{c}x_{t}+U_{c}h_{t-1}) \\c_{t} = f_{t} \odot c_{t-1} + i_{t} \odot \widetilde{c_{t}} \\h_{t} = o_{t} \odot Tanh(c_t)</script><p>å…¶ä¸­<strong>è¾“å…¥é—¨  $i<em>{t}$ æ˜¯é€šè¿‡è¾“å…¥ $x_t$å’Œä¸Šä¸€æ­¥çš„éšå«å±‚è¾“å‡º $h</em>{t-1}$ æ¥è¿›è¡Œçº¿æ€§å˜æ¢ï¼Œå†ç»è¿‡æ¿€æ´»å‡½æ•° $\sigma$ å¾—åˆ°çš„</strong>ã€‚è¾“å…¥é—¨ $i<em>t$  çš„ç»“æœæ˜¯å‘é‡ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ æ˜¯ 0 åˆ° 1 ä¹‹é—´çš„å®æ•°ï¼Œ ç”¨äºæ§åˆ¶å„ç»´åº¦æµè¿‡é˜€é—¨çš„ä¿¡æ¯é‡ï¼›$W</em>{i}$ã€$U<em>i$ ä¸¤ä¸ªçŸ©é˜µæ ¸å‘é‡ $b_i$ ä¸ºè¾“å…¥é—¨çš„å‚æ•°ï¼Œæ˜¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¾—åˆ°çš„ã€‚**é—å¿˜é—¨ $f</em>{t}$ å’Œè¾“å‡ºé—¨ $o<em>{t}$ çš„è®¡ç®—æ–¹å¼ä¸è¾“å…¥é—¨ç±»ä¼¼ï¼Œå®ƒä»¬æœ‰å„è‡ªçš„å‚æ•° $W$ã€$U$ å’Œ $b$ **ã€‚ ä¸ä¼ ç»Ÿçš„å¾ªç¯ç¥ç»ç½‘ç»œä¸é€šçš„æ˜¯ï¼Œä»ä¸Šä¸€ä¸ªè®°å¿†å•å…ƒçš„çŠ¶æ€ $c</em>{t-1}$ åˆ° å½“å‰çš„çŠ¶æ€ $c_{t} â€‹$ çš„è½¬ç§»ä¸ä¸€å®šå®Œå…¨å–å†³äºæ¿€æ´»å‡½æ•°è®¡ç®—å¾—åˆ°çš„çŠ¶æ€ï¼Œè¿˜ç”±è¾“å…¥é—¨å’Œé—å¿˜é—¨æ¥å…±åŒæ§åˆ¶ã€‚</p><p>â€‹    åœ¨ä¸€ä¸ªå¾ªç¯å¥½çš„ç½‘ç»œä¸­ï¼Œå½“è¾“å…¥çš„åºåˆ—ä¸­æ²¡æœ‰é‡è¦ä¿¡æ¯æ—¶ï¼Œ $LSTM$ çš„é—å¿˜é—¨çš„å€¼ä¼šæ¥è¿‘äº 1ï¼Œ è¾“å…¥é—¨çš„å€¼ä¼šæ¥è¿‘äº0ï¼Œ æ­¤æ—¶è¿‡å»çš„ä¿¡æ¯å›æœ¬ä¿å­˜ï¼Œä»è€Œå®ç°é•¿æœŸè®°å¿†åŠŸèƒ½ï¼›å½“è¾“å…¥åºåˆ—ä¸­å‡ºç°é‡è¦ä¿¡æ¯æ—¶ï¼Œ$LSTM$ åº”å½“å°†å…¶å­˜å…¥è®°å¿†ä¸­ï¼Œæ­¤æ—¶å…¶è¾“å…¥é—¨çš„å€¼ä¼šæ¥è¿‘äº1ï¼› å½“è¾“å…¥çš„åºåˆ—å‡ºç°äº†é‡è¦ä¿¡æ¯ï¼Œä¸”è¯¥ä¿¡æ¯æ„å‘³ç€ä¹‹å‰çš„è®°å¿†ä¸åœ¨é‡è¦æ—¶ï¼Œè¾“å…¥é—¨çš„å€¼ä¼šæ¥è¿‘äº1ï¼Œ è€Œé—å¿˜é—¨çš„å€¼æ¥è¿‘äº0ï¼Œ è¿™æ ·æ—§çš„è®°å¿†è¢«é—å¿˜ï¼Œæ–°çš„é‡è¦ä¿¡æ¯è¢«è®°å¿†ã€‚ç»è¿‡è¿™æ ·çš„è®¾è®¡ï¼Œæ•´ä¸ªç½‘ç»œæ›´å®¹æ˜“å­¦åˆ°åºåˆ—ä¹‹é—´çš„é•¿æœŸä¾èµ–ã€‚</p><p><img src="/2020/02/06/RNN/lstm_1.png" alt></p><h5 id="é—®é¢˜4ï¼šLSTM-é‡Œå„ä¸ªæ¨¡å—åˆ†åˆ«ä½¿ç”¨ä»€ä¹ˆæ¿€æ´»å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨åˆ«çš„æ¿€æ´»å‡½æ•°å—ï¼Ÿ"><a href="#é—®é¢˜4ï¼šLSTM-é‡Œå„ä¸ªæ¨¡å—åˆ†åˆ«ä½¿ç”¨ä»€ä¹ˆæ¿€æ´»å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨åˆ«çš„æ¿€æ´»å‡½æ•°å—ï¼Ÿ" class="headerlink" title="é—®é¢˜4ï¼šLSTM é‡Œå„ä¸ªæ¨¡å—åˆ†åˆ«ä½¿ç”¨ä»€ä¹ˆæ¿€æ´»å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨åˆ«çš„æ¿€æ´»å‡½æ•°å—ï¼Ÿ"></a>é—®é¢˜4ï¼šLSTM é‡Œå„ä¸ªæ¨¡å—åˆ†åˆ«ä½¿ç”¨ä»€ä¹ˆæ¿€æ´»å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨åˆ«çš„æ¿€æ´»å‡½æ•°å—ï¼Ÿ</h5><p>å…³äºæ¿€æ´»å‡½æ•°çš„é€‰å–ï¼Œ <strong>åœ¨ $LSTMâ€‹$ ä¸­ï¼Œé—å¿˜é—¨ã€è¾“å…¥é—¨å’Œè¾“å‡ºé—¨ä½¿ç”¨ $Sigmoidâ€‹$ å‡½æ•°ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼›åœ¨ç”Ÿæˆå€™é€‰è®°å¿†æ—¶ï¼Œä½¿ç”¨åŒæ›²æ­£åˆ‡å‡½æ•° $Tanhâ€‹$ ä½œä¸ºæ¿€æ´»å‡½æ•°ã€‚</strong><br> ï¼ˆ1ï¼‰  è¿™ä¸¤ä¸ªæ¿€æ´»å‡½æ•°éƒ½æ˜¯é¥±å’Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¾“å…¥è¾¾åˆ°ä¸€å®šå€¼å¾—æƒ…å†µä¸‹ï¼Œè¾“å‡ºå°±ä¸ä¼šå‘ç”Ÿæ˜æ˜¾å˜åŒ–äº†ã€‚å¦‚æœä½¿ç”¨éé¥±å’Œçš„æ¿€æ´»å‡½æ•°ï¼Œä¾‹å¦‚ $ReLUâ€‹$ï¼Œé‚£ä¹ˆå°†å¾ˆéš¾å®ç°é—¨æ§çš„æ•ˆæœã€‚</p><p>ï¼ˆ2ï¼‰ $Sigmoid$ å‡½æ•°çš„è¾“å‡ºåœ¨ 0 ~ 1 ä¹‹é—´ï¼Œ<strong>ç¬¦åˆé—¨æ§çš„ç‰©ç†å®šä¹‰</strong>ã€‚å½“è¾“å…¥è¾ƒå¤§æˆ–è€…è¾ƒå°æ—¶ï¼Œ å…¶è¾“å‡ºä¼šéå¸¸æ¥è¿‘1æˆ– 0ï¼Œ ä»è€Œä¿è¯è¯¥é—¨çš„å¼€å…³ã€‚</p><p>ï¼ˆ3ï¼‰åœ¨ç”Ÿæˆå€™é€‰è®°å¿†æ—¶ï¼Œä½¿ç”¨ $Tanh$ å‡½æ•°ï¼Œæ—¶å› ä¸ºå…¶è¾“å‡ºåœ¨-1~1 ä¹‹é—´ï¼Œè¿™<strong>ä¸å¤§å¤šæ•°åœºæ™¯ä¸‹ç‰¹å¾åˆ†å¸ƒæ˜¯0ä¸­å¿ƒå»åˆ</strong>ã€‚æ­¤å¤–ï¼ŒTanh å‡½æ•°åœ¨è¾“å…¥ä¸º $0$ é™„è¿‘ç›¸æ¯” â€‹$Sigmoid$ å«æœ‰æœ‰æ›´å¤§çš„æ¢¯åº¦ï¼Œé€šå¸¸ä½¿<strong>æ¨¡å‹æ”¶æ•›æ›´å¿«</strong>ã€‚</p><p>æ­¤å¤–ï¼Œ<strong>åœ¨ä¸€äº›å¯¹è®¡ç®—èƒ½åŠ›æœ‰é™åˆ¶çš„è®¾å¤‡ï¼Œè¯¸å¦‚å¯ç©¿æˆ´è®¾å¤‡ä¸­ï¼Œç”±äº $Sigmoidâ€‹$ å‡½æ•°æ±‚æŒ‡æ•°éœ€è¦ä¸€å®šçš„è®¡ç®—é‡ï¼Œæ­¤æ—¶ä¼šä½¿ç”¨0/1é—¨$ï¼ˆhard gardï¼‰â€‹$è®©é—¨æ§è¾“å‡ºä¸º0æˆ–è€…1çš„ç¦»æ•£å€¼ï¼Œå³å½“è¾“å…¥å°äºé˜ˆå€¼æ—¶ï¼Œé—¨æ§è¾“å‡ºä¸º0ï¼›å½“è¾“å…¥å¤§äºé˜ˆå€¼æ—¶ï¼Œè¾“å‡ºä¸º1</strong>ã€‚ä»è€Œåœ¨æ€§èƒ½ä¸‹é™ä¸æ˜æ˜¾çš„æƒ…å†µä¸‹ï¼Œå‡å°‘è®¡ç®—é‡ã€‚</p><h5 id="é—®é¢˜-5ï¼š-ä»€ä¹ˆæ˜¯-Seq2Seqæ¨¡å‹ï¼ŸSeq2Seqæ¨¡å‹æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ"><a href="#é—®é¢˜-5ï¼š-ä»€ä¹ˆæ˜¯-Seq2Seqæ¨¡å‹ï¼ŸSeq2Seqæ¨¡å‹æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ" class="headerlink" title="é—®é¢˜ 5ï¼š ä»€ä¹ˆæ˜¯ Seq2Seqæ¨¡å‹ï¼ŸSeq2Seqæ¨¡å‹æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ"></a>é—®é¢˜ 5ï¼š ä»€ä¹ˆæ˜¯ Seq2Seqæ¨¡å‹ï¼ŸSeq2Seqæ¨¡å‹æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ</h5><p>$Seq2Seq$ æ¨¡å‹çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œ<strong>é€šè¿‡æ·±åº¦ç¥ç»ç½‘ç»œå°†ä¸€ä¸ªä½œä¸ºè¾“å…¥çš„åºåˆ—æ˜ å°„ä¸ºä¸€ä¸ªä½œä¸ºè¾“å‡ºçš„åºåˆ—ï¼Œè¿™ä¸€è¿‡ç¨‹ç”±ç¼–ç è¾“å…¥ä¸è§£ç è¾“å‡ºä¸¤ä¸ªç¯èŠ‚æ„æˆ</strong>ã€‚åœ¨ç»å…¸çš„å®ç°ä¸­ï¼Œç¼–ç å™¨å’Œè§£ç å™¨å„ç”±ä¸€ä¸ªå¾ªç¯ç¥ç»ç½‘ç»œæ„æˆï¼Œæ—¢å¯ä»¥é€‰æ‹©ä¼ ç»Ÿçš„å¾ªç¯ç¥ç»ç½‘ç»œç»“æ„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é•¿çŸ­æœŸè®°å¿†æ¨¡å‹ã€‚é—¨æ§å¾ªç¯å•å…ƒç­‰ã€‚åœ¨ $Seq2Seq$ æ¨¡å‹ä¸­ï¼Œä¸¤ä¸ªå¾ªç¯ç¥ç»ç½‘ç»œæ˜¯å…±åŒè®­ç»ƒçš„ã€‚å…¸å‹çš„å¾ªç¯ç¥ç»ç½‘ç»œç¼–è§£ç ç»“æ„å›¾å¦‚ä¸‹æ‰€ç¤º:</p><p><img src="/2020/02/06/RNN/seq2seq_ts.png" alt></p><h5 id="é—®é¢˜-6ï¼š-Seq2Seq-æ¨¡å‹åœ¨è§£ç æ—¶ï¼Œ-æœ‰å“ªäº›å¸¸ç”¨çš„æ–¹æ³•ï¼Ÿ"><a href="#é—®é¢˜-6ï¼š-Seq2Seq-æ¨¡å‹åœ¨è§£ç æ—¶ï¼Œ-æœ‰å“ªäº›å¸¸ç”¨çš„æ–¹æ³•ï¼Ÿ" class="headerlink" title="é—®é¢˜ 6ï¼š Seq2Seq æ¨¡å‹åœ¨è§£ç æ—¶ï¼Œ æœ‰å“ªäº›å¸¸ç”¨çš„æ–¹æ³•ï¼Ÿ"></a>é—®é¢˜ 6ï¼š Seq2Seq æ¨¡å‹åœ¨è§£ç æ—¶ï¼Œ æœ‰å“ªäº›å¸¸ç”¨çš„æ–¹æ³•ï¼Ÿ</h5><p>$Seq2Seq$ æ¨¡å‹æœ€åŸºç¡€çš„è§£ç æ–¹æ³•æ˜¯<strong>è´ªå¿ƒæ³•</strong>ï¼Œ å³é€‰å–ä¸€ç§åº¦é‡æ ‡å‡†åï¼Œæ¯æ¬¡éƒ½åœ¨å½“å‰çŠ¶æ€ä¸‹é€‰æ‹©æœ€ä½³çš„ä¸€ä¸ªç»“æœï¼Œ ç›´åˆ°ç»“æŸã€‚å¾ˆæ˜¾ç„¶ï¼Œè´ªå¿ƒæ³•è·å¾—çš„æ˜¯ä¸€ä¸ªå±€éƒ¨æœ€ä¼˜è§£ï¼Œç”±äºå®é™…é—®é¢˜çš„å¤æ‚æ€§ï¼Œè¯¥æ–¹æ³•å¾€å¾€ä¸èƒ½å–å¾—æ›´å¥½çš„æ•ˆæœã€‚<strong>é›†æŸæœç´¢(beam search) </strong> æ˜¯ä¸€ç§å¸¸è§çš„æ”¹è¿›ç®—æ³•ã€‚è¯¥æ–¹æ³•ä¼š<strong>ä¿å­˜ beam size ä¸ªå½“å‰çš„è¾ƒä½³é€‰æ‹©ï¼Œç„¶åè§£ç æ—¶æ¯ä¸€æ­¥æ ¹æ®ä¿å­˜çš„é€‰æ‹©è¿›è¡Œä¸‹ä¸€æ­¥æ‰©å±•å’Œæ’åºï¼Œæ¥ç€é€‰æ‹©å‰ beam size ä¸ªè¿›è¡Œä¿å­˜ï¼Œå¾ªç¯è¿­ä»£ï¼Œç›´åˆ°ç»“æŸæ—¶é€‰æ‹©æœ€ä½³çš„ä¸€ä¸ªä½œä¸ºè§£ç çš„ç»“æœã€‚</strong> éšç€ beam size çš„å¢å¤§ï¼Œå…¶æœç´¢çš„ç©ºé—´å¢å¤§ï¼Œæœ€ç»ˆæ•ˆæœä¼šæœ‰æ‰€æå‡ï¼Œä½†éœ€è¦çš„è®¡ç®—é‡ä¹Ÿç›¸åº”å¢å¤§ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œbå¾€å¾€ä¼šé€‰æ‹©ä¸€ä¸ªé€‚ä¸­çš„èŒƒå›´ï¼Œä»¥8 ~ 12 ä¸ºä½³ã€‚ä¸‹å›¾æ˜¯ beam size ä¸º2æ—¶çš„é›†æŸæœç´¢ç¤ºä¾‹ã€‚</p><p><img src="/2020/02/06/RNN/beam search.png" alt></p><p>è§£ç æ—¶ä½¿ç”¨<strong>å †å çš„RNN</strong>ã€<strong>å¢åŠ  Dropoutæœºåˆ¶</strong>ã€<strong>ä¸ç¼–ç å™¨ä¹‹é—´å»ºç«‹æ®‹å·®è¿æ¥</strong>ã€<strong>å¢åŠ Attentionæœºåˆ¶</strong>ç­‰ï¼Œå‡æ˜¯å¸¸è§çš„æ”¹è¿›æªæ–½ã€‚åœ¨å®é™…çš„ç ”ç©¶å·¥ä½œä¸­ï¼Œå¯ä»¥æ ¹æ®ä¸åŒä½¿ç”¨åœºæ™¯ï¼Œæœ‰é’ˆå¯¹æ€§çš„é€‰æ‹©å’Œå®è·µã€‚</p><h5 id="é—®é¢˜7ï¼šSeq2Seq-æ¨¡å‹å¼•å…¥æ³¨æ„åŠ›æœºåˆ¶æ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ-ä¸ºä»€ä¹ˆé€‰ç”¨åŒå‘çš„å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Ÿ"><a href="#é—®é¢˜7ï¼šSeq2Seq-æ¨¡å‹å¼•å…¥æ³¨æ„åŠ›æœºåˆ¶æ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ-ä¸ºä»€ä¹ˆé€‰ç”¨åŒå‘çš„å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Ÿ" class="headerlink" title="é—®é¢˜7ï¼šSeq2Seq æ¨¡å‹å¼•å…¥æ³¨æ„åŠ›æœºåˆ¶æ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ ä¸ºä»€ä¹ˆé€‰ç”¨åŒå‘çš„å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Ÿ"></a>é—®é¢˜7ï¼šSeq2Seq æ¨¡å‹å¼•å…¥æ³¨æ„åŠ›æœºåˆ¶æ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ ä¸ºä»€ä¹ˆé€‰ç”¨åŒå‘çš„å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Ÿ</h5><p>åœ¨ Seq2Seq æ¨¡å‹ä¸­ï¼Œå½“å‰éšçŠ¶æ€ä»¥åŠä¸Šä¸€ä¸ªè¾“å‡ºè¯å†³å®šäº†å½“å‰çš„è¾“å‡ºè¯ï¼Œ å³ï¼š</p><script type="math/tex; mode=display">s_{i} = f(y_{i-1}, s_{i-1}) \\p(y_{i} | y_{1}, y_{2}, ..., y_{i-1}) = g(y_{i-1}, s_{i})</script><p><strong>åœ¨å®é™…åº”ç”¨ä¸­ä¼šå‘ç°éšç€åºåˆ—çš„å¢é•¿ï¼Œæ¨¡å‹çš„æ€§èƒ½å‘ç”Ÿæ˜¾è‘—ä¸‹é™ã€‚è¿™æ˜¯å› ä¸ºç¼–ç æ—¶è¾“å…¥åºåˆ—çš„å…¨éƒ¨ä¿¡æ¯è¢«å‹ç¼©åˆ°ä¸€ä¸ªå‘é‡è¡¨ç¤ºä¸­ã€‚éšç€åºåˆ—å¢é•¿ï¼Œå¥å­çº¦å‰é¢çš„ä¿¡æ¯å°±ä¸¢å¤±çš„è¶Šä¸¥é‡ã€‚</strong>$Seq2Seq$ æ¨¡å‹ä¸­å¼•å…¥æ³¨æ„åŠ›æœºåˆ¶å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p><img src="/2020/02/06/RNN/seq2seq_attn.png" alt></p><p>(1)  åœ¨ç¼–ç è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶ä½¿ç”¨æ™®é€šçš„å¾ªç¯ç¥ç»ç½‘ç»œå¯¹è¾“å…¥åºåˆ—è¿›è¡Œç¼–ç ï¼Œå¾—åˆ°éšçŠ¶æ€ $h1, h2, â€¦, h<em>T$ã€‚ä½¿ç”¨ä¸€ä¸ªç¥ç»ç½‘ç»œ $align$ ä¸Šä¸€ä¸ªè¾“å…¥åºåˆ—çš„éšçŠ¶æ€ $s</em>{i-1}$ å’Œè¾“å…¥åºåˆ—éšçŠ¶æ€  $h<em>{j}$ ä½œä¸ºè¾“å…¥ï¼Œè®¡ç®—å‡ºä¸€ä¸ª $x</em>{j}, y<em>{i}$ å¯¹é½çš„å€¼ $e</em>{ij}$ï¼Œ å†å½’ä¸€åŒ–å¾—åˆ°æƒé‡ $\alpha_{ij}$ã€‚</p><script type="math/tex; mode=display">e_{ij} = align(s_{i-1}, h_{j})  \\\alpha_{ij} = \frac{exp(e_{ij})}{\sum_{k=1}^{T}{exp(e_{ik})}}</script><p>(2) è®¡ç®—è¯­å¢ƒå‘é‡ $c_{i}â€‹$ , å³æ˜¯è¾“å…¥åºåˆ—å…¨éƒ¨éšçŠ¶æ€ $h1, h2, â€¦, h_Tâ€‹$çš„ä¸€ä¸ªåŠ æƒå’Œã€‚</p><script type="math/tex; mode=display">c_{i} = \sum_{j=1}^{T}{\alpha_{ij}h_{j}}</script><p>(3) åœ¨è§£ç è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€ä¸ªè¾“å‡ºè¯éƒ½ä¾èµ–äºå‰ä¸€ä¸ªéšçŠ¶æ€ä»¥åŠè¾“å…¥åºåˆ—æ¯ä¸€ä¸ªå¯¹åº”çš„éšçŠ¶æ€ã€‚</p><script type="math/tex; mode=display">s_{i} = f(y_{i-1}, s_{i-1}, x_{i}) \\p(y_{i} | y_{1}, y_{2}, ..., y_{i-1}) = g(y_{i-1}, s_{i}, c_{i})</script>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>camera-calibration</title>
    <link href="/2019/06/09/camera-calibration/"/>
    <url>/2019/06/09/camera-calibration/</url>
    
    <content type="html"><![CDATA[<p>ç›¸æœºæ ‡å®šç›¸å…³æ€»ç»“</p><a id="more"></a><h4 id="1-ä¸ºä»€ä¹ˆéœ€è¦ç›¸æœºæ ‡å®šï¼Ÿ"><a href="#1-ä¸ºä»€ä¹ˆéœ€è¦ç›¸æœºæ ‡å®šï¼Ÿ" class="headerlink" title="1. ä¸ºä»€ä¹ˆéœ€è¦ç›¸æœºæ ‡å®šï¼Ÿ"></a>1. ä¸ºä»€ä¹ˆéœ€è¦ç›¸æœºæ ‡å®šï¼Ÿ</h4><p>ç›¸æœºæœºæ ‡å®šçš„ç›®çš„ï¼šå»ºç«‹ç›¸æœºæˆåƒå‡ ä½•æ¨¡å‹å¹¶çŸ«æ­£é€é•œç•¸å˜ã€‚</p><p><strong>å»ºç«‹ç›¸æœºæˆåƒé›†åˆæ¨¡å‹</strong>ï¼šè®¡ç®—æœºè§†è§‰çš„é¦–è¦ä»»åŠ¡å°±æ˜¯è¦é€šè¿‡æ‹æ‘„åˆ°çš„å›¾åƒä¿¡æ¯è·å–åˆ°ç‰©ä½“åœ¨çœŸå®ä¸‰ç»´ä¸–ç•Œé‡Œç›¸å¯¹åº”çš„ä¿¡æ¯ï¼Œäºæ˜¯ï¼Œå»ºç«‹ç‰©ä½“ä»ä¸‰ç»´ä¸–ç•Œæ˜ å°„åˆ°ç›¸æœºæˆåƒå¹³é¢è¿™ä¸€è¿‡ç¨‹ä¸­çš„å‡ ä½•æ¨¡å‹å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ï¼Œè€Œè¿™ä¸€è¿‡ç¨‹æœ€å…³é”®çš„éƒ¨åˆ†å°±æ˜¯è¦å¾—åˆ°ç›¸æœºçš„<strong>å†…å‚å’Œå¤–å‚</strong>ã€‚</p><p><strong>çŸ«æ­£é€é•œç•¸å˜</strong>ï¼šæˆ‘ä»¬æœ€å¼€å§‹æ¥è§¦åˆ°çš„æˆåƒæ–¹é¢çš„çŸ¥è¯†åº”è¯¥æ˜¯æœ‰å…³å°å­”æˆåƒçš„ï¼Œä½†æ˜¯ç”±äºè¿™ç§æˆåƒæ–¹å¼åªæœ‰å°å­”éƒ¨åˆ†èƒ½é€è¿‡å…‰çº¿å°±ä¼šå¯¼è‡´ç‰©ä½“çš„æˆåƒäº®åº¦å¾ˆä½ï¼Œäºæ˜¯èªæ˜çš„äººç±»å‘æ˜äº†é€é•œã€‚è™½ç„¶äº®åº¦é—®é¢˜è§£å†³äº†ï¼Œä½†æ˜¯æ–°çš„é—®é¢˜åˆæ¥äº†ï¼šç”±äºé€é•œçš„åˆ¶é€ å·¥è‰ºï¼Œä¼šä½¿æˆåƒäº§ç”Ÿå¤šç§å½¢å¼çš„ç•¸å˜ï¼Œäºæ˜¯ä¸ºäº†å»é™¤ç•¸å˜ï¼ˆä½¿æˆåƒåçš„å›¾åƒä¸çœŸå®ä¸–ç•Œçš„æ™¯è±¡ä¿æŒä¸€è‡´ï¼‰ï¼Œäººä»¬è®¡ç®—å¹¶åˆ©ç”¨<strong>ç•¸å˜ç³»æ•°</strong>æ¥çŸ«æ­£è¿™ç§åƒå·®ã€‚è™½ç„¶ç†è®ºä¸Šå¯ä»¥è®¾è®¡å‡ºä¸äº§ç”Ÿç•¸å˜çš„é€é•œï¼Œä½†å…¶åˆ¶é€ å·¥è‰ºç›¸å¯¹äºçƒé¢é€é•œä¼šå¤æ‚å¾ˆå¤šï¼Œæ‰€ä»¥ç›¸å¯¹äºå¤æ‚ä¸”é«˜æˆæœ¬çš„åˆ¶é€ å·¥è‰ºï¼Œäººä»¬æ›´å–œæ¬¢ç”¨æ•°å­¦æ¥è§£å†³é—®é¢˜ã€‚</p><p>å¸¸è§æœ¯è¯­ï¼š</p><ul><li>å†…å‚çŸ©é˜µ: Intrinsic Matrix </li><li>ç„¦è·: Focal Length </li><li>ä¸»ç‚¹: Principal Point </li><li>å¾„å‘ç•¸å˜: Radial Distortion </li><li>åˆ‡å‘ç•¸å˜: Tangential Distortion </li><li>æ—‹è½¬çŸ©é˜µ: Rotation Matrices </li><li>å¹³ç§»å‘é‡: Translation Vectors </li><li>å¹³å‡é‡æŠ•å½±è¯¯å·®: Mean Reprojection Error </li><li>é‡æŠ•å½±è¯¯å·®: Reprojection Errors </li><li>é‡æŠ•å½±ç‚¹: Reprojected Points</li></ul><h4 id="2-åŸºç¡€çŸ¥è¯†"><a href="#2-åŸºç¡€çŸ¥è¯†" class="headerlink" title="2. åŸºç¡€çŸ¥è¯†"></a>2. åŸºç¡€çŸ¥è¯†</h4><p>ç›¸æœºæ ‡å®šçš„ç›®çš„ä¹‹ä¸€æ˜¯ä¸ºäº†å»ºç«‹ç‰©ä½“ä»ä¸‰ç»´ä¸–ç•Œåˆ°æˆåƒå¹³é¢ä¸Šå„åæ ‡ç‚¹çš„å¯¹åº”å…³ç³»ï¼Œæ‰€ä»¥é¦–å…ˆæˆ‘ä»¬éœ€è¦å®šä¹‰è¿™æ ·å‡ ä¸ªåæ ‡ç³»æ¥ä¸ºæ•´ä¸ªè¿‡ç¨‹åšå¥½é“ºå«ï¼š</p><p><strong>ä¸–ç•Œåæ ‡ç³»(world coordinate system)</strong>ï¼šç”¨æˆ·å®šä¹‰çš„ä¸‰ç»´ä¸–ç•Œçš„åæ ‡ç³»ï¼Œä¸ºäº†æè¿°ç›®æ ‡ç‰©åœ¨çœŸå®ä¸–ç•Œé‡Œçš„ä½ç½®è€Œè¢«å¼•å…¥ï¼Œå•ä½ä¸ºmã€‚</p><p><strong>ç›¸æœºåæ ‡ç³»(camera coordinate system)</strong>ï¼šåœ¨ç›¸æœºä¸Šå»ºç«‹çš„åæ ‡ç³»ï¼Œä¸ºäº†ä»ç›¸æœºçš„è§’åº¦æè¿°ç‰©ä½“ä½ç½®è€Œå®šä¹‰ï¼Œä½œä¸ºæ²Ÿé€šä¸–ç•Œåæ ‡ç³»å’Œå›¾åƒ/åƒç´ åæ ‡ç³»çš„ä¸­é—´ä¸€ç¯ã€‚å•ä½ä¸ºmã€‚</p><p><strong>å›¾åƒåæ ‡ç³»(image coordinate system)</strong>ï¼šä¸ºäº†æè¿°æˆåƒè¿‡ç¨‹ä¸­ç‰©ä½“ä»ç›¸æœºåæ ‡ç³»åˆ°å›¾åƒåæ ‡ç³»çš„æŠ•å½±é€å°„å…³ç³»è€Œå¼•å…¥ï¼Œæ–¹ä¾¿è¿›ä¸€æ­¥å¾—åˆ°åƒç´ åæ ‡ç³»ä¸‹çš„åæ ‡ã€‚ å•ä½ä¸ºmã€‚</p><p><strong>åƒç´ åæ ‡ç³»(pixel coordinate system)</strong>ï¼šä¸ºäº†æè¿°ç‰©ä½“æˆåƒåçš„åƒç‚¹åœ¨æ•°å­—å›¾åƒä¸Šï¼ˆç›¸ç‰‡ï¼‰çš„åæ ‡è€Œå¼•å…¥ï¼Œæ˜¯æˆ‘ä»¬çœŸæ­£ä»ç›¸æœºå†…è¯»å–åˆ°çš„ä¿¡æ¯æ‰€åœ¨çš„åæ ‡ç³»ã€‚å•ä½ä¸ºä¸ªï¼ˆåƒç´ æ•°ç›®ï¼‰ã€‚</p><p>ä¸‹å›¾å¯ä»¥æ›´æ¸…æ™°åœ°è¡¨è¾¾è¿™å››ä¸ªåæ ‡ç³»ä¹‹é—´çš„å…³ç³»ï¼š</p><p><img src="/2019/06/09/camera-calibration/1.jpg" alt="img"></p><p>ä¸–ç•Œåæ ‡ç³»ï¼š$X_w$ ã€$Y_w$ã€$Z_w$</p><p>ç›¸æœºåæ ‡ç³»ï¼š $X_c$ã€$Y_c$ã€$Z_c$</p><p>å›¾åƒåæ ‡ç³»ï¼š$x$ã€$y$</p><p>åƒç´ åæ ‡ç³»ï¼š$u$ã€$v$ã€‚</p><p>ç›¸æœºåæ ‡ç³»çš„ $Z$ è½´ä¸å…‰è½´é‡åˆï¼Œä¸”å‚ç›´äºå›¾åƒåæ ‡ç³»å¹³é¢å¹¶é€šè¿‡å›¾åƒåæ ‡ç³»çš„åŸç‚¹ï¼Œç›¸æœºåæ ‡ç³»ä¸å›¾åƒåæ ‡ç³»ä¹‹é—´çš„è·ç¦»ä¸ºç„¦è·$f$ï¼ˆä¹Ÿå³å›¾åƒåæ ‡ç³»åŸç‚¹ä¸ç„¦ç‚¹é‡åˆï¼‰ã€‚åƒç´ åæ ‡ç³»å¹³é¢$u-v$å’Œå›¾åƒåæ ‡ç³»å¹³é¢$x-y$é‡åˆï¼Œä½†åƒç´ åæ ‡ç³»åŸç‚¹ä½äºå›¾ä¸­å·¦ä¸Šè§’ï¼ˆä¹‹æ‰€ä»¥è¿™ä¹ˆå®šä¹‰ï¼Œç›®çš„æ˜¯ä»å­˜å‚¨ä¿¡æ¯çš„é¦–åœ°å€å¼€å§‹è¯»å†™ï¼‰ã€‚</p><p><strong>æ£‹ç›˜</strong>æ˜¯ä¸€å—ç”±é»‘ç™½æ–¹å—é—´éš”ç»„æˆçš„æ ‡å®šæ¿ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥ä½œä¸ºç›¸æœºæ ‡å®šçš„<strong>æ ‡å®šç‰©</strong>ï¼ˆä»çœŸå®ä¸–ç•Œæ˜ å°„åˆ°æ•°å­—å›¾åƒå†…çš„å¯¹è±¡ï¼‰ã€‚ä¹‹æ‰€ä»¥æˆ‘ä»¬ç”¨æ£‹ç›˜ä½œä¸ºæ ‡å®šç‰©æ˜¯å› ä¸ºå¹³é¢æ£‹ç›˜æ¨¡å¼æ›´å®¹æ˜“å¤„ç†ï¼ˆç›¸å¯¹äºå¤æ‚çš„ä¸‰ç»´ç‰©ä½“ï¼‰ï¼Œä½†ä¸æ­¤åŒæ—¶ï¼ŒäºŒç»´ç‰©ä½“ç›¸å¯¹äºä¸‰ç»´ç‰©ä½“ä¼šç¼ºå°‘ä¸€éƒ¨åˆ†ä¿¡æ¯ï¼Œäºæ˜¯<strong>æˆ‘ä»¬ä¼šå¤šæ¬¡æ”¹å˜æ£‹ç›˜çš„æ–¹ä½æ¥æ•æ‰å›¾åƒï¼Œä»¥æ±‚è·å¾—æ›´ä¸°å¯Œçš„åæ ‡ä¿¡æ¯</strong>ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ˜¯ç›¸æœºåœ¨ä¸åŒæ–¹å‘ä¸‹æ‹æ‘„çš„åŒä¸€ä¸ªæ£‹ç›˜å›¾åƒã€‚</p><p><img src="/2019/06/09/camera-calibration/2.png" alt></p><p>ä¸‹é¢å°†ä¾æ¬¡å¯¹åˆšä½“è¿›è¡Œä¸€ç³»åˆ—å˜æ¢ï¼Œä½¿ä¹‹<strong>ä»ä¸–ç•Œåæ ‡ç³»è¿›è¡Œä»¿å°„å˜æ¢ã€æŠ•å½±é€å°„ï¼Œæœ€ç»ˆå¾—åˆ°åƒç´ åæ ‡ç³»ä¸‹çš„ç¦»æ•£å›¾åƒç‚¹ï¼Œè¿‡ç¨‹ä¸­ä¼šé€æ­¥å¼•å…¥å„å‚æ•°çŸ©é˜µ</strong>ã€‚</p><h5 id="1-ä»ä¸–ç•Œåæ ‡ç³»åˆ°ç›¸æœºåæ ‡ç³»"><a href="#1-ä»ä¸–ç•Œåæ ‡ç³»åˆ°ç›¸æœºåæ ‡ç³»" class="headerlink" title="(1) ä»ä¸–ç•Œåæ ‡ç³»åˆ°ç›¸æœºåæ ‡ç³»"></a>(1) ä»ä¸–ç•Œåæ ‡ç³»åˆ°ç›¸æœºåæ ‡ç³»</h5><p>åˆšä½“ä»ä¸–ç•Œåæ ‡ç³»è½¬æ¢åˆ°ç›¸æœºåæ ‡ç³»çš„è¿‡ç¨‹ï¼Œå¯ä»¥é€šè¿‡æ—‹è½¬å’Œå¹³ç§»æ¥å¾—åˆ°ï¼Œæˆ‘ä»¬å°†å…¶å˜æ¢çŸ©é˜µç”±ä¸€ä¸ªæ—‹è½¬çŸ©é˜µå’Œå¹³ç§»å‘é‡ç»„åˆæˆçš„é½æ¬¡åæ ‡çŸ©é˜µæ¥è¡¨ç¤ºï¼š</p><p><img src="/2019/06/09/camera-calibration/4.png" alt></p><p>å…¶ä¸­ï¼Œ$R$ä¸ºæ—‹è½¬çŸ©é˜µï¼Œ$t$ä¸ºå¹³ç§»å‘é‡ã€‚å…¶ä¸­å˜æ¢çŸ©é˜µ</p><p><img src="/2019/06/09/camera-calibration/7.png" alt></p><p>å³ä¸ºå‰æ–‡æåˆ°çš„å¤–å‚çŸ©é˜µï¼Œä¹‹æ‰€ç§°ä¹‹ä¸ºå¤–å‚çŸ©é˜µå¯ä»¥ç†è§£ä¸ºåªä¸ç›¸æœºå¤–éƒ¨å‚æ•°æœ‰å…³ï¼Œä¸”å¤–å‚çŸ©é˜µéšåˆšä½“ä½ç½®çš„å˜åŒ–è€Œå˜åŒ–ã€‚ä¸‹å›¾è¡¨ç¤ºäº†ç”¨Rï¼Œtå°†ä¸Šè¿°ä¸–ç•Œåæ ‡ç³»è½¬æ¢åˆ°ç›¸æœºåæ ‡ç³»çš„è¿‡ç¨‹ã€‚</p><p><img src="/2019/06/09/camera-calibration/8.png" alt></p><h5 id="2-ä»ç›¸æœºåæ ‡ç³»åˆ°ç†æƒ³å›¾åƒåæ ‡ç³»"><a href="#2-ä»ç›¸æœºåæ ‡ç³»åˆ°ç†æƒ³å›¾åƒåæ ‡ç³»" class="headerlink" title="(2) ä»ç›¸æœºåæ ‡ç³»åˆ°ç†æƒ³å›¾åƒåæ ‡ç³»"></a>(2) ä»ç›¸æœºåæ ‡ç³»åˆ°ç†æƒ³å›¾åƒåæ ‡ç³»</h5><p>è¿™ä¸€è¿‡ç¨‹è¿›è¡Œäº†ä»ä¸‰ç»´åæ ‡åˆ°äºŒç»´åæ ‡çš„è½¬æ¢ï¼Œä¹Ÿå³æŠ•å½±é€è§†è¿‡ç¨‹ï¼ˆç”¨ä¸­å¿ƒæŠ•å½±æ³•å°†ç‰©ä½“æŠ•å°„åˆ°æŠ•å½±é¢ä¸Šï¼Œä»è€Œè·å¾—çš„ä¸€ç§è¾ƒä¸ºæ¥è¿‘è§†è§‰æ•ˆæœçš„å•é¢æŠ•å½±å›¾ï¼Œä¹Ÿå°±æ˜¯ä½¿æˆ‘ä»¬äººçœ¼çœ‹åˆ°æ™¯ç‰©è¿‘å¤§è¿œå°çš„ä¸€ç§æˆåƒæ–¹å¼ï¼‰ã€‚æˆ‘ä»¬è¿˜æ˜¯æ‹¿é’ˆå­”æˆåƒæ¥è¯´æ˜ï¼ˆé™¤äº†æˆåƒäº®åº¦ä½å¤–ï¼Œæˆåƒæ•ˆæœå’Œé€é•œæˆåƒæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯å…‰è·¯æ›´ç®€å•ï¼‰ã€‚æˆåƒè¿‡ç¨‹å¦‚å›¾äºŒæ‰€ç¤ºï¼šé’ˆå­”é¢ï¼ˆç›¸æœºåæ ‡ç³»ï¼‰åœ¨å›¾åƒå¹³é¢ï¼ˆå›¾åƒåæ ‡ç³»ï¼‰å’Œç‰©ç‚¹å¹³é¢ï¼ˆæ£‹ç›˜å¹³é¢ï¼‰ä¹‹é—´ï¼Œæ‰€æˆå›¾åƒä¸ºå€’ç«‹å®åƒã€‚</p><p><img src="/2019/06/09/camera-calibration/9.png" alt></p><p>ä½†æ˜¯ä¸ºäº†åœ¨æ•°å­¦ä¸Šæ›´æ–¹ä¾¿æè¿°ï¼Œæˆ‘ä»¬å°†ç›¸æœºåæ ‡ç³»å’Œå›¾åƒåæ ‡ç³»ä½ç½®å¯¹è°ƒï¼Œå˜æˆå›¾ä¸‰æ‰€ç¤ºçš„å¸ƒç½®æ–¹å¼ï¼ˆæ²¡æœ‰å®é™…çš„ç‰©ç†æ„ä¹‰ï¼Œåªæ˜¯æ–¹ä¾¿è®¡ç®—ï¼‰ï¼š</p><p><img src="/2019/06/09/camera-calibration/10.png" alt></p><p>æ­¤æ—¶ï¼Œå‡è®¾ç›¸æœºåæ ‡ç³»ä¸­æœ‰ä¸€ç‚¹Mï¼Œåˆ™åœ¨ç†æƒ³å›¾åƒåæ ‡ç³»ä¸‹ï¼ˆæ— ç•¸å˜ï¼‰çš„æˆåƒç‚¹Pçš„åæ ‡ä¸ºï¼ˆå¯ç”±ç›¸ä¼¼ä¸‰è§’å½¢åŸåˆ™å¾—å‡ºï¼‰ï¼š</p><p><img src="/2019/06/09/camera-calibration/11.png" alt="img"></p><p>å°†ä¸Šå¼åŒ–ä¸ºé½æ¬¡åæ ‡è¡¨ç¤ºå½¢å¼ä¸ºï¼š</p><p><img src="/2019/06/09/camera-calibration/12.png" alt="img"></p><h5 id="3-ä»ç†æƒ³å›¾åƒåæ ‡ç³»åˆ°å®é™…å›¾åƒåæ ‡ç³»ï¼ˆè€ƒè™‘ç•¸å˜ï¼‰"><a href="#3-ä»ç†æƒ³å›¾åƒåæ ‡ç³»åˆ°å®é™…å›¾åƒåæ ‡ç³»ï¼ˆè€ƒè™‘ç•¸å˜ï¼‰" class="headerlink" title="(3) ä»ç†æƒ³å›¾åƒåæ ‡ç³»åˆ°å®é™…å›¾åƒåæ ‡ç³»ï¼ˆè€ƒè™‘ç•¸å˜ï¼‰"></a>(3) ä»ç†æƒ³å›¾åƒåæ ‡ç³»åˆ°å®é™…å›¾åƒåæ ‡ç³»ï¼ˆè€ƒè™‘ç•¸å˜ï¼‰</h5><p>â€‹        é€é•œçš„ç•¸å˜ä¸»è¦åˆ†ä¸ºå¾„å‘ç•¸å˜å’Œåˆ‡å‘ç•¸å˜ï¼Œè¿˜æœ‰è–„é€é•œç•¸å˜ç­‰ç­‰ï¼Œä½†éƒ½æ²¡æœ‰å¾„å‘å’Œåˆ‡å‘ç•¸å˜å½±å“æ˜¾è‘—ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œåªè€ƒè™‘å¾„å‘å’Œåˆ‡å‘ç•¸å˜ã€‚</p><ul><li><strong>å¾„å‘ç•¸å˜</strong>æ˜¯ç”±äºé€é•œå½¢çŠ¶çš„åˆ¶é€ å·¥è‰ºå¯¼è‡´ã€‚ä¸”è¶Šå‘é€é•œè¾¹ç¼˜ç§»åŠ¨å¾„å‘ç•¸å˜è¶Šä¸¥é‡ã€‚ä¸‹å›¾æ‰€ç¤ºæ˜¯å¾„å‘ç•¸å˜çš„ä¸¤ç§ç±»å‹ï¼šæ¡¶å½¢ç•¸å˜å’Œæ•å½¢ç•¸å˜ã€‚</li></ul><p><img src="/2019/06/09/camera-calibration/13.png" alt="img"></p><p>å®é™…æƒ…å†µä¸­æˆ‘ä»¬å¸¸ç”¨r=0å¤„çš„æ³°å‹’çº§æ•°å±•å¼€çš„å‰å‡ é¡¹æ¥è¿‘ä¼¼æè¿°å¾„å‘ç•¸å˜ã€‚çŸ«æ­£å¾„å‘ç•¸å˜å‰åçš„åæ ‡å…³ç³»ä¸ºï¼š</p><p><img src="/2019/06/09/camera-calibration/14.png" alt="img"></p><p>ç”±æ­¤å¯çŸ¥å¯¹äºå¾„å‘ç•¸å˜ï¼Œæˆ‘ä»¬æœ‰3ä¸ªç•¸å˜å‚æ•°éœ€è¦æ±‚è§£ã€‚</p><ul><li><strong>åˆ‡å‘ç•¸å˜</strong>æ˜¯ç”±äºé€é•œå’ŒCMOSæˆ–è€…CCDçš„å®‰è£…ä½ç½®è¯¯å·®å¯¼è‡´ã€‚å› æ­¤ï¼Œå¦‚æœå­˜åœ¨åˆ‡å‘ç•¸å˜ï¼Œä¸€ä¸ªçŸ©å½¢è¢«æŠ•å½±åˆ°æˆåƒå¹³é¢ä¸Šæ—¶ï¼Œå¾ˆå¯èƒ½ä¼šå˜æˆä¸€ä¸ªæ¢¯å½¢ã€‚åˆ‡å‘ç•¸å˜éœ€è¦ä¸¤ä¸ªé¢å¤–çš„ç•¸å˜å‚æ•°æ¥æè¿°ï¼ŒçŸ«æ­£å‰åçš„åæ ‡å…³ç³»ä¸ºï¼š</li></ul><p><img src="/2019/06/09/camera-calibration/15.png" alt="img"></p><p>ç”±æ­¤å¯çŸ¥å¯¹äºåˆ‡å‘ç•¸å˜ï¼Œæˆ‘ä»¬æœ‰2ä¸ªç•¸å˜å‚æ•°éœ€è¦æ±‚è§£ã€‚</p><p>ç»¼ä¸Šï¼Œæˆ‘ä»¬ä¸€å…±éœ€è¦5ä¸ªç•¸å˜å‚æ•°ï¼ˆk1ã€k2ã€k3ã€p1å’Œp2 ï¼‰æ¥æè¿°é€é•œç•¸å˜ã€‚</p><h5 id="4-ä»å®é™…å›¾åƒåæ ‡ç³»åˆ°åƒç´ åæ ‡ç³»"><a href="#4-ä»å®é™…å›¾åƒåæ ‡ç³»åˆ°åƒç´ åæ ‡ç³»" class="headerlink" title="(4) ä»å®é™…å›¾åƒåæ ‡ç³»åˆ°åƒç´ åæ ‡ç³»"></a>(4) ä»å®é™…å›¾åƒåæ ‡ç³»åˆ°åƒç´ åæ ‡ç³»</h5><p>ç”±äºå®šä¹‰çš„åƒç´ åæ ‡ç³»åŸç‚¹ä¸å›¾åƒåæ ‡ç³»åŸç‚¹ä¸é‡åˆï¼Œå‡è®¾å›¾åƒåæ ‡ç³»åŸç‚¹åœ¨åƒç´ åæ ‡ç³»ä¸‹çš„åæ ‡ä¸ºï¼ˆu0ï¼Œv0ï¼‰ï¼Œæ¯ä¸ªåƒç´ ç‚¹åœ¨å›¾åƒåæ ‡ç³»xè½´ã€yè½´æ–¹å‘çš„å°ºå¯¸ä¸ºï¼šdxã€dyï¼Œä¸”åƒç‚¹åœ¨å®é™…å›¾åƒåæ ‡ç³»ä¸‹çš„åæ ‡ä¸ºï¼ˆxcï¼Œycï¼‰ï¼Œäºæ˜¯å¯å¾—åˆ°åƒç‚¹åœ¨åƒç´ åæ ‡ç³»ä¸‹çš„åæ ‡ä¸ºï¼š</p><p><img src="/2019/06/09/camera-calibration/16.png" alt="img"></p><p>åŒ–ä¸ºé½æ¬¡åæ ‡è¡¨ç¤ºå½¢å¼å¯å¾—ï¼š</p><p><img src="/2019/06/09/camera-calibration/17.png" alt="img"></p><p>å…¬å¼2ä¸­(xp, yp)ä¸å…¬å¼5ä¸­(xc, yc)ç›¸åŒï¼Œéƒ½æ˜¯å›¾åƒåæ ‡ç³»ä¸‹çš„åæ ‡ã€‚</p><p>è‹¥æš‚ä¸è€ƒè™‘é€é•œç•¸å˜ï¼Œåˆ™å°†å¼2ä¸å¼5çš„è½¬æ¢çŸ©é˜µç›¸ä¹˜å³ä¸ºå†…å‚çŸ©é˜µMï¼š</p><p><img src="/2019/06/09/camera-calibration/17.png" alt="img"></p><p>ä¹‹æ‰€ä»¥ç§°ä¹‹ä¸ºå†…å‚çŸ©é˜µå¯ä»¥ç†è§£ä¸ºçŸ©é˜µå†…å„å€¼åªä¸ç›¸æœºå†…éƒ¨å‚æ•°æœ‰å…³ï¼Œä¸”ä¸éšç‰©ä½“ä½ç½®å˜åŒ–è€Œå˜åŒ–ã€‚</p><p>æœ€åç”¨ä¸€å¹…å›¾æ¥æ€»ç»“ä»ä¸–ç•Œåæ ‡ç³»åˆ°åƒç´ åæ ‡ç³»ï¼ˆä¸è€ƒè™‘ç•¸å˜ï¼‰çš„è½¬æ¢å…³ç³»ï¼š</p><p><img src="/2019/06/09/camera-calibration/3.png" alt></p><h4 id="3-æ ‡å®šæ–¹æ³•"><a href="#3-æ ‡å®šæ–¹æ³•" class="headerlink" title="3. æ ‡å®šæ–¹æ³•"></a>3. æ ‡å®šæ–¹æ³•</h4><h5 id="1-ã€ä¼ ç»Ÿç›¸æœºæ ‡å®š"><a href="#1-ã€ä¼ ç»Ÿç›¸æœºæ ‡å®š" class="headerlink" title="(1)ã€ä¼ ç»Ÿç›¸æœºæ ‡å®š"></a>(1)ã€ä¼ ç»Ÿç›¸æœºæ ‡å®š</h5><p>æœ€ç®€å•çš„ç›¸æœºæ ‡å®šä¸ºçº¿æ€§æ ‡å®šï¼Œå³ä¸è€ƒè™‘ç›¸æœºçš„ç•¸å˜è€Œåªè€ƒè™‘ç©ºé—´åæ ‡è½¬æ¢ã€‚<br>æ¯ä¸ªåæ ‡ç‚¹æœ‰X,Yä¸¤ä¸ªå˜é‡ï¼Œå¯åˆ—ä¸¤ä¸ªæ–¹ç¨‹ï¼Œç›¸æœºå†…å‚æœ‰5ä¸ªæœªçŸ¥æ•°ï¼Œå¤–å‚å¹³ç§»å’Œæ—‹è½¬å„3ä¸ªï¼Œå…±æœ‰11ä¸ªå˜é‡ï¼Œå› æ­¤è‡³å°‘éœ€è¦6ä¸ªç‰¹å¾ç‚¹æ¥æ±‚è§£ã€‚</p><h5 id="2-ã€éçº¿æ€§æ ‡å®š"><a href="#2-ã€éçº¿æ€§æ ‡å®š" class="headerlink" title="(2)ã€éçº¿æ€§æ ‡å®š"></a>(2)ã€éçº¿æ€§æ ‡å®š</h5><p>å½“é•œå¤´ç•¸å˜æ˜æ˜¾æ—¶å¿…é¡»è€ƒè™‘ç•¸å˜ï¼Œä¸€èˆ¬è¾ƒä¸ºä¾¿å®œçš„ç½‘ç»œæ‘„åƒå¤´ç•¸å˜ç‰¹åˆ«å¤§ï¼Œè€Œä»·æ ¼è¾ƒè´µçš„å·¥ä¸šæ‘„åƒå¤´åˆ™ç•¸å˜å¾ˆå°ï¼Œå› ä¸ºå…¶ä¸­å·²ç»åµŒå…¥äº†è®¸å¤šæ¶ˆé™¤ç•¸å˜çš„ç¨‹åºã€‚è¿™æ—¶çº¿æ€§æ¨¡å‹è½¬åŒ–ä¸ºéçº¿æ€§æ¨¡å‹ï¼Œéœ€è¦é€šè¿‡éçº¿æ€§æ ‡å®šæ–¹æ³•æ±‚è§£ã€‚æœ‰æœ€é€Ÿä¸‹é™æ³•ï¼Œé—ä¼ ç®—æ³•ï¼Œé«˜æ–¯ç‰›é¡¿æ³•å’Œç¥ç»ç½‘ç»œç®—æ³•ç­‰ã€‚</p><h5 id="3-ã€å¼ æ­£å‹æ ‡å®š"><a href="#3-ã€å¼ æ­£å‹æ ‡å®š" class="headerlink" title="(3)ã€å¼ æ­£å‹æ ‡å®š"></a>(3)ã€å¼ æ­£å‹æ ‡å®š</h5><h4 id="4-ç›¸æœºæ ‡å®šæ­¥éª¤ï¼š"><a href="#4-ç›¸æœºæ ‡å®šæ­¥éª¤ï¼š" class="headerlink" title="4.  ç›¸æœºæ ‡å®šæ­¥éª¤ï¼š"></a>4.  ç›¸æœºæ ‡å®šæ­¥éª¤ï¼š</h4><blockquote><p>(1)ã€æ‰“å°ä¸€å¼ æ£‹ç›˜æ ¼ï¼ŒæŠŠå®ƒè´´åœ¨ä¸€ä¸ªå¹³é¢ä¸Šï¼Œä½œä¸ºæ ‡å®šç‰©ã€‚<br>(2)ã€é€šè¿‡è°ƒæ•´æ ‡å®šç‰©æˆ–æ‘„åƒæœºçš„æ–¹å‘ï¼Œä¸ºæ ‡å®šç‰©æ‹æ‘„ä¸€äº›ä¸åŒæ–¹å‘çš„ç…§ç‰‡ã€‚<br>(3)ã€ä»ç…§ç‰‡ä¸­æå–æ£‹ç›˜æ ¼è§’ç‚¹ã€‚<br>(4)ã€ä¼°ç®—ç†æƒ³æ— ç•¸å˜çš„æƒ…å†µä¸‹ï¼Œäº”ä¸ªå†…å‚å’Œå…­ä¸ªå¤–å‚ã€‚<br>(5)ã€åº”ç”¨æœ€å°äºŒä¹˜æ³•ä¼°ç®—å®é™…å­˜åœ¨å¾„å‘ç•¸å˜ä¸‹çš„ç•¸å˜ç³»æ•°ã€‚<br>(6)ã€æå¤§ä¼¼ç„¶æ³•ï¼Œä¼˜åŒ–ä¼°è®¡ï¼Œæå‡ä¼°è®¡ç²¾åº¦ã€‚</p></blockquote><h4 id="5-å‚è€ƒèµ„æ–™ï¼š"><a href="#5-å‚è€ƒèµ„æ–™ï¼š" class="headerlink" title="5. å‚è€ƒèµ„æ–™ï¼š"></a>5. å‚è€ƒèµ„æ–™ï¼š</h4><ul><li>ä»é›¶å¼€å§‹å­¦ä¹ å¼ æ°ç›¸æœºæ ‡å®šå‘ï¼š <a href="https://zhuanlan.zhihu.com/p/35223115">https://zhuanlan.zhihu.com/p/35223115</a></li><li>ç›¸æœºæ ‡å®šï¼ˆCamera calibrationï¼‰åŸç†ã€æ­¥éª¤<a href="https://blog.csdn.net/qq_37791134/article/details/80942171">https://blog.csdn.net/qq_37791134/article/details/80942171</a></li><li>è°­å¹³ï¼šä»ç›¸æœºæ ‡å®šåˆ°SLAMï¼Œæç®€ä¸‰ç»´è§†è§‰å…­å°æ—¶è¯¾ç¨‹è§†é¢‘ <a href="http://www.sohu.com/a/317611305_100007727">http://www.sohu.com/a/317611305_100007727</a></li><li>SLAM bookï¼š <a href="https://github.com/gaoxiang12/slambook">https://github.com/gaoxiang12/slambook</a></li><li>åŒç›®è§†è§‰ä¹‹ç›¸æœºæ ‡å®šï¼š<a href="https://www.cnblogs.com/zyly/p/9366080.html">https://www.cnblogs.com/zyly/p/9366080.html</a></li><li>æœ€è¯¦ç»†ã€æœ€å®Œæ•´çš„ç›¸æœºæ ‡å®šè®²è§£<a href="https://blog.csdn.net/lxy_2011/article/details/80675803">https://blog.csdn.net/lxy_2011/article/details/80675803</a></li><li>OPENCV ç›¸æœºå‚æ•°æ ‡å®š <a href="https://www.jianshu.com/p/967a35dbb56a">https://www.jianshu.com/p/967a35dbb56a</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ¢ç´¢</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pytorchæ·±å…¥ç†è§£</title>
    <link href="/2019/05/17/pytorch%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/"/>
    <url>/2019/05/17/pytorch%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<p>æŒ–ä¸ªå‘ï¼šä¸»è¦æƒ³å­¦ä¹ ä¸€ä¸‹ Pytorch çš„å†…éƒ¨å®ç°æœºåˆ¶</p><a id="more"></a><p>å‚è€ƒèµ„æ–™</p><p><a href="https://minitorch.github.io/index.html">https://minitorch.github.io/index.html</a></p>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pytorchåˆ†å¸ƒå¼è®­ç»ƒ</title>
    <link href="/2019/05/17/pytorch%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83/"/>
    <url>/2019/05/17/pytorch%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83/</url>
    
    <content type="html"><![CDATA[<p>pytorch åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆå°è¯•: nn.Dataparallelã€torch.distributed å’Œ horovod ç­‰è§£å†³æ–¹æ¡ˆ</p><a id="more"></a><h4 id="os-environ"><a href="#os-environ" class="headerlink" title="os.environ"></a>os.environ</h4><pre><code class="hljs python">os.environ[<span class="hljs-string">&#x27;NCCL_SOCKET_IFNAME&#x27;</span>] = <span class="hljs-string">&#x27;enp2s0&#x27;</span>os.environ[<span class="hljs-string">&#x27;GLOO_SOCKET_IFNAME&#x27;</span>] = <span class="hljs-string">&#x27;enp2s0&#x27;</span></code></pre><h4 id="nn-DataParallel"><a href="#nn-DataParallel" class="headerlink" title="nn.DataParallel"></a>nn.DataParallel</h4><pre><code class="hljs python">gpus = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]torch.cuda.set_device(<span class="hljs-string">&#x27;cuda:&#123;&#125;&#x27;</span>.format(gpus[<span class="hljs-number">0</span>]))model = nn.DataParallel(model.to(device), device_ids=gpus, output_device=gpus[<span class="hljs-number">0</span>])</code></pre><h4 id="torch-distributed"><a href="#torch-distributed" class="headerlink" title="torch.distributed"></a>torch.distributed</h4><pre><code class="hljs python">parser = argparse.ArgumentParser()parser.add_argument(<span class="hljs-string">&#x27;--backend&#x27;</span>, type=str, default=<span class="hljs-string">&#x27;nccl&#x27;</span>, help=<span class="hljs-string">&#x27;Name of the backend to use.&#x27;</span>)parser.add_argument(<span class="hljs-string">&#x27;-i&#x27;</span>,                    <span class="hljs-string">&#x27;--init-method&#x27;</span>,                    type=str,                    default=<span class="hljs-string">&#x27;env://&#x27;</span>,                    help=<span class="hljs-string">&#x27;URL specifying how to initialize the package.&#x27;</span>)parser.add_argument(<span class="hljs-string">&#x27;-ws&#x27;</span>, <span class="hljs-string">&#x27;--world-size&#x27;</span>, type=int, default=<span class="hljs-number">1</span>, help=<span class="hljs-string">&#x27;Number of processes participating in the job.&#x27;</span>)parser.add_argument(<span class="hljs-string">&#x27;-r&#x27;</span>, <span class="hljs-string">&#x27;--rank&#x27;</span>, type=int, default=<span class="hljs-number">0</span>, help=<span class="hljs-string">&#x27;Rank of the current process.&#x27;</span>)args = parser.parse_args()</code></pre><pre><code class="hljs python">distributed.init_process_group(    backend=args.backend,    init_method=args.init_method,    world_size=args.world_size,    rank=args.rank,)</code></pre><pre><code class="hljs python">train_sampler = torch.utils.data.distributed.DistributedSampler(train_dataset)train_loader = torch.utils.data.DataLoader(train_dataset, batch_size=..., sampler=train_sampler)</code></pre><pre><code class="hljs python">model = nn.parallel.DistributedDataParallel(model)</code></pre><h4 id="torch-multiprocessing"><a href="#torch-multiprocessing" class="headerlink" title="ã€€torch.multiprocessing"></a>ã€€torch.multiprocessing</h4><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch.multiprocessing <span class="hljs-keyword">as</span> mpmp.spawn(main_worker, nprocs=<span class="hljs-number">4</span>, args=(<span class="hljs-number">4</span>, myargs))</code></pre><h4 id="APEX"><a href="#APEX" class="headerlink" title="APEX"></a>APEX</h4><pre><code class="hljs python"><span class="hljs-keyword">from</span> apex <span class="hljs-keyword">import</span> amp<span class="hljs-keyword">from</span> apex.parallel <span class="hljs-keyword">import</span> DistributedDataParallel</code></pre><pre><code class="hljs python">model, optimizer = amp.initialize(model, optimizer)model = DistributedDataParallel(model)<span class="hljs-keyword">with</span> amp.scale_loss(loss, optimizer) <span class="hljs-keyword">as</span> scaled_loss:   scaled_loss.backward()</code></pre><h4 id="Horovod"><a href="#Horovod" class="headerlink" title="Horovod"></a>Horovod</h4><pre><code class="hljs python"><span class="hljs-keyword">import</span> horovod.torch <span class="hljs-keyword">as</span> hvdhvd.local_rank()</code></pre><pre><code class="hljs python">hvd.init()</code></pre><pre><code class="hljs python">train_sampler = torch.utils.data.distributed.DistributedSampler(train_dataset)train_loader = torch.utils.data.DataLoader(train_dataset, batch_size=..., sampler=train_sampler)</code></pre><pre><code class="hljs reasonml">hvd.broadcast<span class="hljs-constructor">_parameters(<span class="hljs-params">model</span>.<span class="hljs-params">state_dict</span>()</span>, root_rank=<span class="hljs-number">0</span>)</code></pre><pre><code class="hljs python">hvd.DistributedOptimizer(optimizer, named_parameters=model.named_parameters(), compression=hvd.Compression.fp16)</code></pre>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pytorchåŠ é€Ÿ</title>
    <link href="/2019/05/17/pytorch%E5%8A%A0%E9%80%9F/"/>
    <url>/2019/05/17/pytorch%E5%8A%A0%E9%80%9F/</url>
    
    <content type="html"><![CDATA[<p>Pytorch åŠ é€Ÿæ–¹æ¡ˆ</p><a id="more"></a><h3 id="1-æ•°æ®"><a href="#1-æ•°æ®" class="headerlink" title="1. æ•°æ®"></a>1. æ•°æ®</h3><h5 id="0-dataloader"><a href="#0-dataloader" class="headerlink" title="(0) dataloader"></a>(0) dataloader</h5><ul><li>num_workersä¸batch_sizeè°ƒåˆ°åˆé€‚å€¼ï¼Œå¹¶éè¶Šå¤§è¶Šå¿«ï¼ˆæ³¨æ„åè€…ä¹Ÿå½±å“æ¨¡å‹æ€§èƒ½ï¼‰(éœ€è¦åœ¨å®éªŒä¸­æ‰¾åˆ°æœ€å¿«çš„å–å€¼)</li><li>eval/testæ—¶shuffle=False</li><li>å†…å­˜å¤Ÿå¤§çš„æƒ…å†µä¸‹ï¼Œdataloaderçš„<strong>pin_memory</strong>è®¾ä¸ºTrueã€‚å¯¹ç‰¹åˆ«å°çš„æ•°æ®é›†å¦‚ MNIST è®¾ç½® <code>pin_memory=False</code>  åè€Œæ›´å¿«ä¸€äº›ã€‚</li></ul><h5 id="1-é¢„å¤„ç†æé€Ÿ"><a href="#1-é¢„å¤„ç†æé€Ÿ" class="headerlink" title="(1) é¢„å¤„ç†æé€Ÿ"></a>(1) é¢„å¤„ç†æé€Ÿ</h5><ul><li>å°½é‡å‡å°‘æ¯æ¬¡è¯»å–æ•°æ®æ—¶çš„é¢„å¤„ç†æ“ä½œï¼Œå¯ä»¥è€ƒè™‘æŠŠä¸€äº›å›ºå®šçš„æ“ä½œï¼Œä¾‹å¦‚ resize ï¼Œäº‹å…ˆå¤„ç†å¥½ä¿å­˜ä¸‹æ¥ï¼Œè®­ç»ƒçš„æ—¶å€™ç›´æ¥æ‹¿æ¥ç”¨</li><li><p>Linuxä¸Šå°†é¢„å¤„ç†æ¬åˆ°GPUä¸ŠåŠ é€Ÿï¼š</p></li><li><ul><li><strong>NVIDIA/DALI</strong> ï¼š<a href="https://github.com/NVIDIA/DALI">https://github.com/NVIDIA/DALI</a></li><li><a href="https://github.com/tanglang96/DataLoaders_DALI">https://github.com/tanglang96/DataLoaders_DALI</a></li></ul></li><li><p>æ•°æ®é¢„å–ï¼šprefetch_generatorï¼ˆ<a href="https://zhuanlan.zhihu.com/p/80695364">æ–¹æ³•</a>ï¼‰è®©è¯»æ•°æ®çš„workerèƒ½åœ¨è¿ç®—æ—¶é¢„è¯»æ•°æ®ï¼Œè€Œé»˜è®¤æ˜¯æ•°æ®æ¸…ç©ºæ—¶æ‰è¯»</p></li></ul><h5 id="2-IO-æé€Ÿ"><a href="#2-IO-æé€Ÿ" class="headerlink" title="(2) IO æé€Ÿ"></a>(2) IO æé€Ÿ</h5><ul><li><p>ä½¿ç”¨æ›´å¿«çš„å›¾ç‰‡å¤„ç†ï¼š</p></li><li><ul><li><strong>opencv ä¸€èˆ¬è¦æ¯” PIL è¦å¿«</strong></li><li>å¯¹äºjpegè¯»å–ï¼Œå¯ä»¥å°è¯• <strong>jpeg4py</strong></li><li>å­˜ <strong>bmp</strong> å›¾ï¼ˆé™ä½è§£ç æ—¶é—´ï¼‰</li></ul></li><li><p><strong>å°å›¾æ‹¼èµ·æ¥å­˜æ”¾ï¼ˆé™ä½è¯»å–æ¬¡æ•°ï¼‰ï¼šå¯¹äºå¤§è§„æ¨¡çš„å°æ–‡ä»¶è¯»å–ï¼Œå»ºè®®è½¬æˆå•ç‹¬çš„æ–‡ä»¶ï¼Œå¯ä»¥é€‰æ‹©çš„æ ¼å¼å¯ä»¥è€ƒè™‘</strong>ï¼šTFRecordï¼ˆTensorflowï¼‰ã€recordIO(recordIO)ã€hdf5ã€ pthã€n5ã€lmdb ç­‰ç­‰ï¼ˆ<a href="https://github.com/Lyken17/Efficient-PyTorch#data-loaderï¼‰">https://github.com/Lyken17/Efficient-PyTorch#data-loaderï¼‰</a></p></li><li><ul><li><strong>TFRecord</strong>ï¼š<a href="https://github.com/vahidk/tfrecord">https://github.com/vahidk/tfrecord</a></li><li>å€ŸåŠ© <strong>lmdb æ•°æ®åº“æ ¼å¼</strong>ï¼š</li></ul></li><li><ul><li><ul><li><a href="https://github.com/Fangyh09/Image2LMDB">https://github.com/Fangyh09/Image2LMDB</a></li><li><a href="https://blog.csdn.net/P_LarT/article/details/103208405">https://blog.csdn.net/P_LarT/article/details/103208405</a></li><li><a href="https://github.com/lartpang/PySODToolBox/blob/master/ForBigDataset/ImageFolder2LMDB.py">https://github.com/lartpang/PySODToolBox/blob/master/ForBigDataset/ImageFolder2LMDB.py</a></li><li><a href="https://github.com/Lyken17/Efficient-PyTorch">https://github.com/Lyken17/Efficient-PyTorch</a></li></ul></li></ul></li></ul><h5 id="3-å€ŸåŠ©ç¡¬ä»¶"><a href="#3-å€ŸåŠ©ç¡¬ä»¶" class="headerlink" title="(3)ã€€å€ŸåŠ©ç¡¬ä»¶"></a>(3)ã€€å€ŸåŠ©ç¡¬ä»¶</h5><ul><li>å€ŸåŠ©å†…å­˜ï¼š<strong>ç›´æ¥è½½åˆ°å†…å­˜é‡Œé¢ï¼Œæˆ–è€…æŠŠæŠŠå†…å­˜æ˜ å°„æˆç£ç›˜å¥½äº†</strong></li><li>å€ŸåŠ©å›ºæ€ï¼šæŠŠè¯»å–é€Ÿåº¦æ…¢çš„æœºæ¢°ç¡¬ç›˜æ¢æˆ <strong>NVME å›ºæ€</strong>å§ï½</li></ul><h5 id="4-è®­ç»ƒç­–ç•¥"><a href="#4-è®­ç»ƒç­–ç•¥" class="headerlink" title="(4) è®­ç»ƒç­–ç•¥"></a>(4) è®­ç»ƒç­–ç•¥</h5><ul><li><p>åœ¨è®­ç»ƒä¸­ä½¿ç”¨<strong>ä½ç²¾åº¦ï¼ˆFP16 ç”šè‡³ INT8 ã€äºŒå€¼ç½‘ç»œã€ä¸‰å€¼ç½‘ç»œï¼‰è¡¨ç¤ºå–ä»£åŸæœ‰ç²¾åº¦ï¼ˆFP32ï¼‰è¡¨ç¤º</strong></p></li><li><ul><li>NVIDIA/Apexï¼š</li></ul></li><li><ul><li><ul><li><a href="https://blog.csdn.net/c9Yv2cf9I06K2A9E/article/details/100135729">https://blog.csdn.net/c9Yv2cf9I06K2A9E/article/details/100135729</a></li><li><a href="https://github.com/nvidia/apex">https://github.com/nvidia/apex</a></li></ul></li></ul></li><li><p>ä½¿ç”¨åˆ†å¸ƒå¼è®­ç»ƒã€€DDP æˆ–è€… horovod</p></li></ul><h5 id="5-ä»£ç å±‚é¢"><a href="#5-ä»£ç å±‚é¢" class="headerlink" title="(5) ä»£ç å±‚é¢"></a>(5) ä»£ç å±‚é¢</h5><ul><li><code>torch.backends.cudnn.benchmark = True</code></li><li>Do numpy-like operations on the GPU wherever you can</li><li>Free up memory using<code>del</code>     ç”¨<code>del</code>åŠæ—¶åˆ é™¤ä¸ç”¨çš„ä¸­é—´å˜é‡ï¼ŒèŠ‚çº¦GPUå­˜å‚¨ã€‚</li><li>Avoid unnecessary transfer of data from the GPU</li><li>Use pinned memory, and use non_blocking=False to parallelize data transfer and GPU number crunching</li></ul><h3 id="2-model"><a href="#2-model" class="headerlink" title="2. model"></a>2. model</h3><ol><li><p>ç”¨<strong>float16</strong>ä»£æ›¿é»˜è®¤çš„float32è¿ç®—ï¼ˆ<a href="https://link.zhihu.com/?target=https%3A//github.com/huggingface/transformers/blob/dad3c7a485b7ffc6fd2766f349e6ee845ecc2eee/examples/run_classifier.py">æ–¹æ³•å‚è€ƒ</a>ï¼Œæœç´¢â€fp16â€å¯ä»¥çœ‹åˆ°éœ€è¦ä¿®æ”¹ä¹‹å¤„ï¼ŒåŒ…æ‹¬modelã€optimizerã€backwardã€learning rateï¼‰</p></li><li><p><strong>ä¼˜åŒ–å™¨</strong>ä»¥åŠå¯¹åº”å‚æ•°çš„é€‰æ‹©ï¼Œå¦‚learning rateï¼Œä¸è¿‡å®ƒå¯¹æ€§èƒ½çš„å½±å“ä¼¼ä¹æ›´é‡è¦ã€å å‘ã€‘</p></li><li><p>å°‘ç”¨å¾ªç¯ï¼Œå¤šç”¨<strong>å‘é‡åŒ–</strong>æ“ä½œ</p></li><li><p>ç»å…¸æ“ä½œå°½é‡ç”¨åˆ«äººä¼˜åŒ–å¥½çš„<strong>åº“</strong>ï¼Œåˆ«è‡ªå·±å†™</p></li><li><p>æ•°æ®å¾ˆå¤šæ—¶å°‘ç”¨appendï¼Œè™½ç„¶ä½¿ç”¨å¾ˆæ–¹ä¾¿ï¼Œä¸è¿‡å®ƒæ¯æ¬¡éƒ½ä¼šé‡æ–°åˆ†é…ç©ºé—´ï¼Ÿæ‰€ä»¥æ•°æ®å¾ˆå¤§çš„è¯ï¼Œå…‰ä¸€æ¬¡appendå°±è¦å‡ ç§’ï¼ˆæµ‹è¿‡ï¼‰ï¼Œå¯ä»¥å…ˆåˆ†é…å¥½æ•´ä¸ªå®¹å™¨å¤§å°ï¼Œæ¯æ¬¡ç”¨ç´¢å¼•å»ä¿®æ”¹å†…å®¹ï¼Œè¿™æ ·ä¸€æ­¥åªè¦0.0xç§’</p></li><li><p>å›ºå®šå¯¹æ¨¡å‹å½±å“ä¸å¤§çš„éƒ¨åˆ†å‚æ•°ï¼Œè¿˜èƒ½èŠ‚çº¦æ˜¾å­˜ï¼Œå¯ä»¥ç”¨ detach() åˆ‡æ–­åå‘ä¼ æ’­ï¼Œæ³¨æ„è‹¥ä»…ä»…ç»™å˜é‡è®¾ç½® required_grad=False è¿˜æ˜¯ä¼šè®¡ç®—æ¢¯åº¦çš„</p></li><li><p>eval/test çš„æ—¶å€™ï¼ŒåŠ ä¸Š model.eval() å’Œ torch.no_grad()ï¼Œå‰è€…å›ºå®š batch-normalization å’Œ dropout ä½†æ˜¯ä¼šå½±å“æ€§èƒ½ï¼Œåè€…å…³é—­ autograd</p></li><li><p>æé«˜ç¨‹åº<strong>å¹¶è¡Œåº¦</strong>ï¼Œä¾‹å¦‚ æˆ‘æƒ³ train æ—¶å¯¹æ¯ä¸ª epoch éƒ½èƒ½ test ä¸€ä¸‹ä»¥è¿½è¸ªæ¨¡å‹æ€§èƒ½å˜åŒ–ï¼Œä½†æ˜¯ test æ—¶é—´æˆæœ¬å¤ªé«˜è¦ä¸€ä¸ªå°æ—¶ï¼Œæ‰€ä»¥å†™äº†ä¸ª socketï¼Œè®¾ä¸€ä¸ª127.0.0.1 çš„ç«¯å£ï¼Œæ¯æ¬¡ train å®Œä¸€ä¸ª epoch å°±å‘ä¸ªUDPè¿‡å»ï¼Œé‚£ä¸ªè¿›ç¨‹å°±å¯ä»¥è‡ªå·± testï¼ŒåŒæ—¶åŸè¿›ç¨‹å¯ä»¥ç»§ç»­ train ä¸‹ä¸€ä¸ª epochï¼ˆå¯¹ è¿™æ˜¯è‡ªå·±æƒ³çš„è¯¡å¼‚æ–¹æ³•hhhï¼‰</p></li><li><p>torch.backends.cudnn.benchmarkè®¾ä¸ºTrueï¼Œå¯ä»¥è®©cudnnæ ¹æ®å½“å‰è®­ç»ƒå„é¡¹configå¯»æ‰¾ä¼˜åŒ–ç®—æ³•ï¼Œä½†è¿™æœ¬èº«éœ€è¦æ—¶é—´ï¼Œæ‰€ä»¥input sizeåœ¨è®­ç»ƒæ—¶ä¼šé¢‘ç¹å˜åŒ–çš„è¯ï¼Œå»ºè®®è®¾ä¸ºFalse</p></li><li><p>ä½¿ç”¨<code>inplace</code>æ“ä½œå¯èŠ‚çº¦ GPU å­˜å‚¨ï¼Œå¦‚</p><pre><code class="hljs ini"><span class="hljs-attr">x</span> = torch.nn.functional.relu(x, inplace=<span class="hljs-literal">True</span>)</code></pre></li><li><p>å‡å°‘CPUå’ŒGPUä¹‹é—´çš„æ•°æ®ä¼ è¾“ã€‚ä¾‹å¦‚ï¼Œ å¦‚æœä½ æƒ³çŸ¥é“ä¸€ä¸ª epoch ä¸­æ¯ä¸ª mini-batch çš„ loss å’Œå‡†ç¡®ç‡ï¼Œå…ˆå°†å®ƒä»¬ç´¯ç§¯åœ¨ GPU ä¸­ç­‰ä¸€ä¸ª epoch ç»“æŸä¹‹åä¸€èµ·ä¼ è¾“å› CPU ä¼šæ¯”æ¯ä¸ª mini-batch éƒ½è¿›è¡Œä¸€æ¬¡ GPU åˆ° CPU çš„ä¼ è¾“æ›´å¿«ã€‚</p></li><li><p>ä½¿ç”¨åŠç²¾åº¦æµ®ç‚¹æ•°<code>half()</code>ä¼šæœ‰ä¸€å®šçš„é€Ÿåº¦æå‡ï¼Œå…·ä½“æ•ˆç‡ä¾èµ–äºGPUå‹å·ã€‚éœ€è¦å°å¿ƒæ•°å€¼ç²¾åº¦è¿‡ä½å¸¦æ¥çš„ç¨³å®šæ€§é—®é¢˜ã€‚æ—¶å¸¸ä½¿ç”¨ <code>assert tensor.size() == (N, D, H, W)</code>ä½œä¸ºè°ƒè¯•æ‰‹æ®µï¼Œç¡®ä¿å¼ é‡ç»´åº¦å’Œä½ è®¾æƒ³ä¸­ä¸€è‡´ã€‚</p></li><li><p>é™¤äº†æ ‡è®° y å¤–ï¼Œå°½é‡å°‘ä½¿ç”¨ä¸€ç»´å¼ é‡ï¼Œä½¿ç”¨n*1çš„äºŒç»´å¼ é‡ä»£æ›¿ï¼Œå¯ä»¥é¿å…ä¸€äº›æ„æƒ³ä¸åˆ°çš„ä¸€ç»´å¼ é‡è®¡ç®—ç»“æœã€‚</p></li><li><p>ç»Ÿè®¡ä»£ç å„éƒ¨åˆ†è€—æ—¶</p></li></ol><pre><code class="hljs python"><span class="hljs-keyword">with</span> torch.autograd.profiler.profile(enabled=<span class="hljs-literal">True</span>, use_cuda=<span class="hljs-literal">False</span>) <span class="hljs-keyword">as</span> profile:    ...    print(profile)</code></pre><p>æˆ–è€…åœ¨å‘½ä»¤è¡Œè¿è¡Œï¼š</p><pre><code class="hljs css"><span class="hljs-selector-tag">python</span> <span class="hljs-selector-tag">-m</span> <span class="hljs-selector-tag">torch</span><span class="hljs-selector-class">.utils</span><span class="hljs-selector-class">.bottleneck</span> <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.py</span></code></pre>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pytorché¡¹ç›®æ­å»º</title>
    <link href="/2019/05/17/pytorch%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/"/>
    <url>/2019/05/17/pytorch%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<p>pytorch æ­å»ºé¡¹ç›®çš„åŸºæœ¬æµç¨‹</p><a id="more"></a><h3 id="åŸºæœ¬å·¥ä½œæµç¨‹"><a href="#åŸºæœ¬å·¥ä½œæµç¨‹" class="headerlink" title="åŸºæœ¬å·¥ä½œæµç¨‹"></a>åŸºæœ¬å·¥ä½œæµç¨‹</h3><ol><li><p>ç›¸å…³å·¥ä½œè°ƒç ”:  <strong>è¯„ä»·æŒ‡æ ‡ã€æ•°æ®é›†ã€ç»å…¸è§£å†³æ–¹æ¡ˆã€å¾…è§£å†³é—®é¢˜å’Œå·²æœ‰æ–¹æ¡ˆçš„ä¸åŒã€ç²¾åº¦å’Œé€Ÿåº¦é¢„ä¼°ã€ç›¸å…³éš¾ç‚¹ ! </strong></p></li><li><p>æ•°æ®æ¢ç´¢å’Œæ–¹æ¡ˆç¡®å®š</p></li><li>ä¾æ¬¡ç¼–å†™æ¨¡å‹ models.pyã€æ•°æ®é›†è¯»å–æ¥å£ datasets.py ã€æŸå¤±å‡½æ•° losses.py ã€è¯„ä»·æŒ‡æ ‡ criterion.py</li><li>ç¼–å†™è®­ç»ƒè„šæœ¬(train.py)å’Œæµ‹è¯•è„šæœ¬(test.py)</li><li>è®­ç»ƒã€è°ƒè¯•å’Œæµ‹è¯„</li><li>æ¨¡å‹çš„éƒ¨ç½²</li></ol><p>æ³¨æ„ï¼Œä¸è¦å°†æ‰€æœ‰å±‚å’Œæ¨¡å‹æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚æœ€ä½³åšæ³•æ˜¯å°†æœ€ç»ˆç½‘ç»œåˆ†ç¦»ä¸ºå•ç‹¬çš„æ–‡ä»¶ï¼ˆnetworks.pyï¼‰ï¼Œå¹¶å°†å±‚ã€æŸè€—å’Œ ops ä¿å­˜åœ¨å„è‡ªçš„æ–‡ä»¶ï¼ˆlayers.pyã€losses.pyã€ops.pyï¼‰ä¸­ã€‚å®Œæˆçš„æ¨¡å‹ï¼ˆç”±ä¸€ä¸ªæˆ–å¤šä¸ªç½‘ç»œç»„æˆï¼‰åº”åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å¼•ç”¨ï¼Œæ–‡ä»¶åä¸º yolov3.pyã€dcgan.py è¿™æ ·ã€‚</p><h5 id="1-æ„å»ºç¥ç»ç½‘ç»œ"><a href="#1-æ„å»ºç¥ç»ç½‘ç»œ" class="headerlink" title="(1) æ„å»ºç¥ç»ç½‘ç»œ"></a>(1) æ„å»ºç¥ç»ç½‘ç»œ</h5><p>â€‹    è‡ªå®šä¹‰çš„ç½‘ç»œç»§æ‰¿è‡ªä¸€èˆ¬ç»§æ‰¿è‡ªã€€<code>nn.Module</code> ç±»ï¼Œã€€å¿…é¡»æœ‰ä¸€ä¸ª <code>forward</code> æ–¹æ³•æ¥å®ç°å„ä¸ªå±‚æˆ–æ“ä½œçš„ forward ä¼ é€’ï¼Œã€€</p><p>å¯¹äºå…·æœ‰<strong>å•ä¸ªè¾“å…¥</strong>å’Œ<strong>å•ä¸ªè¾“å‡º</strong>çš„ç®€å•ç½‘ç»œï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹æ¨¡å¼ï¼š</p><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConvBlock</span>(<span class="hljs-params">nn.Module</span>):</span>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span>    super(ConvBlock, self).__init__()    self.block = nn.Squential(       nn.Conv2d(...),       nn.ReLU(),       nn.BatchNorm2d(...)    )     <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">self, x</span>):</span>    <span class="hljs-keyword">return</span> self.block(x)<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleNetwork</span>(<span class="hljs-params">nn.Module</span>):</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, num_of_layers = <span class="hljs-number">15</span></span>):</span>        super(SimpleNetwork, self).__init__()        layers = list()        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(num_of_layers):            layers.append(..)        self.conv0 = nn.Sequential(*layers)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">self, x</span>):</span>        out = self.conv0(x)        <span class="hljs-keyword">return</span> out</code></pre><p>æˆ‘ä»¬å»ºè®®å°†ç½‘ç»œæ‹†åˆ†ä¸ºæ›´å°çš„<strong>å¯é‡ç”¨éƒ¨åˆ†</strong>ã€‚ç½‘ç»œç”±æ“ä½œæˆ–å…¶å®ƒç½‘ç»œæ¨¡å—ç»„æˆã€‚æŸå¤±å‡½æ•°ä¹Ÿæ˜¯ç¥ç»ç½‘ç»œçš„æ¨¡å—ï¼Œå› æ­¤å¯ä»¥ç›´æ¥é›†æˆåˆ°ç½‘ç»œä¸­ã€‚</p><h5 id="2-è‡ªå®šä¹‰æ•°æ®é›†"><a href="#2-è‡ªå®šä¹‰æ•°æ®é›†" class="headerlink" title="(2) è‡ªå®šä¹‰æ•°æ®é›†"></a>(2) è‡ªå®šä¹‰æ•°æ®é›†</h5><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomDataset</span>(<span class="hljs-params">Dataset</span>):</span>    <span class="hljs-string">&quot;&quot;&quot; CustomDataset. &quot;&quot;&quot;</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, root_dir=<span class="hljs-string">&#x27;./data&#x27;</span>, transform=None</span>):</span>        <span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-string">        &quot;&quot;&quot;</span>        self.root_dir = root_dir        self.transform = transform        self.train_data = ...        self.train_target = ...    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__len__</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-keyword">return</span> len(self.train_data)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__getitem__</span>(<span class="hljs-params">self, idx</span>):</span>        <span class="hljs-keyword">if</span> torch.is_tensor(idx):            idx = idx.tolist()        data = Image.open(self.train_data[idx])        target = Image.open(self.train_target[idx])        <span class="hljs-keyword">if</span> self.transform:            data, target = self.transform(data, target)        sample = &#123;<span class="hljs-string">&#x27;data&#x27;</span>: data, <span class="hljs-string">&#x27;high_img&#x27;</span>: target&#125;        <span class="hljs-keyword">return</span> sample</code></pre><h5 id="3-è‡ªå®šä¹‰æŸå¤±"><a href="#3-è‡ªå®šä¹‰æŸå¤±" class="headerlink" title="(3) è‡ªå®šä¹‰æŸå¤±"></a>(3) è‡ªå®šä¹‰æŸå¤±</h5><p>â€‹        è™½ç„¶ PyTorch å·²ç»æœ‰å¾ˆå¤šæ ‡å‡†çš„æŸå¤±å‡½æ•°ï¼Œä½†æœ‰æ—¶ä¹Ÿå¯èƒ½éœ€è¦åˆ›å»ºè‡ªå·±çš„æŸå¤±å‡½æ•°ã€‚ä¸ºæ­¤ï¼Œè¯·åˆ›å»ºå•ç‹¬çš„æ–‡ä»¶ <code>losses.py</code> å¹¶æ‰©å±• <code>nn.module</code> ç±»ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„æŸå¤±å‡½æ•°ï¼š</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomLoss</span>(<span class="hljs-params">nn.Module</span>):</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-string">&quot;&quot;&quot; CustomLoss&quot;&quot;&quot;</span>        super(CustomLoss, self).__init__()    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">self, x, y</span>):</span>        <span class="hljs-keyword">return</span> torch.mean(torch.square(x  - y))</code></pre><h5 id="4-æ¨èå¯ä»¥å‚è€ƒçš„ç”¨äºè®­ç»ƒæ¨¡å‹çš„ä»£ç ç»“æ„"><a href="#4-æ¨èå¯ä»¥å‚è€ƒçš„ç”¨äºè®­ç»ƒæ¨¡å‹çš„ä»£ç ç»“æ„" class="headerlink" title="(4) æ¨èå¯ä»¥å‚è€ƒçš„ç”¨äºè®­ç»ƒæ¨¡å‹çš„ä»£ç ç»“æ„"></a>(4) æ¨èå¯ä»¥å‚è€ƒçš„ç”¨äºè®­ç»ƒæ¨¡å‹çš„ä»£ç ç»“æ„</h5><pre><code class="hljs python"><span class="hljs-comment"># import statements</span><span class="hljs-keyword">import</span> torch<span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<span class="hljs-keyword">from</span> torch.utils <span class="hljs-keyword">import</span> data...<span class="hljs-comment"># set flags / seeds</span>torch.backends.cudnn.benchmark = <span class="hljs-literal">True</span>np.random.seed(<span class="hljs-number">1</span>)torch.manual_seed(<span class="hljs-number">1</span>)torch.cuda.manual_seed(<span class="hljs-number">1</span>)...  <span class="hljs-comment"># dataset</span>transform_train = ...trainform_text = ...train_dataset = CustomDataset(args.train_dataset, is_trainval = <span class="hljs-literal">True</span>, transform = transform_train) train_loader = torch.utils.data.DataLoader(train_dataset, batch_size=args.batch_size,                                           shuffle=<span class="hljs-literal">True</span>, num_workers=<span class="hljs-number">0</span>, drop_last=<span class="hljs-literal">False</span>) valid_dataset = CustomDataset(args.valid_dataset, is_trainval = <span class="hljs-literal">True</span>, transform = transform_test)  valid_loader = torch.utils.data.DataLoader(valid_dataset, batch_size=args.val_batch_size,                                            shuffle=<span class="hljs-literal">True</span>, num_workers=<span class="hljs-number">0</span>) <span class="hljs-comment"># model &amp; loss</span>net = CustomNet().to(device) criterion = ...  <span class="hljs-comment"># lr &amp; optimizer</span>optim = optim.SGD(model.parameters(), lr=args.init_lr, momentum=args.momentum, weight_decay=args.weight_decay)scheduler = torch.optim.lr_scheduler.MultiStepLR(optimizer, milestones=[<span class="hljs-number">50</span>, <span class="hljs-number">70</span>], gamma=<span class="hljs-number">0.1</span>)<span class="hljs-comment"># load resume</span><span class="hljs-keyword">if</span> args.resume:    <span class="hljs-keyword">if</span> os.path.isfile(args.resume):        print(<span class="hljs-string">&quot;=&gt; loading checkpoint &#x27;&#123;&#125;&#x27;&quot;</span>.format(args.resume))        checkpoint = torch.load(args.resume)        args.start_epoch = checkpoint[<span class="hljs-string">&#x27;epoch&#x27;</span>]        best_prec = checkpoint[<span class="hljs-string">&#x27;best_prec&#x27;</span>]        model.load_state_dict(checkpoint[<span class="hljs-string">&#x27;state_dict&#x27;</span>])        optimizer.load_state_dict(checkpoint[<span class="hljs-string">&#x27;optimizer&#x27;</span>])        print(<span class="hljs-string">&quot;=&gt; loaded checkpoint &#x27;&#123;&#125;&#x27; (epoch &#123;&#125;) Prec: &#123;:f&#125;&quot;</span>              .format(args.resume, checkpoint[<span class="hljs-string">&#x27;epoch&#x27;</span>], best_prec1))    <span class="hljs-keyword">else</span>:        print(<span class="hljs-string">&quot;=&gt; no checkpoint found at &#x27;&#123;&#125;&#x27;&quot;</span>.format(args.resume))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">train</span>(<span class="hljs-params">epoch</span>):</span>    model.train()ã€€<span class="hljs-comment"># åœ¨ã€€model(x)ã€€å‰éœ€è¦æ·»åŠ ã€€model.eval()ã€€æˆ–è€…ã€€model.eval()</span>    avg_loss = <span class="hljs-number">0.0</span>    train_acc = <span class="hljs-number">0.0</span>    <span class="hljs-keyword">for</span> batch_idx, batchdata <span class="hljs-keyword">in</span> enumerate(train_loader):        data, target = batchdata[<span class="hljs-string">&quot;data&quot;</span>], batchdata[<span class="hljs-string">&quot;target&quot;</span>] <span class="hljs-comment">#</span>        data, target = data.to(device), target.to(device)  <span class="hljs-comment">#</span>        <span class="hljs-comment"># åœ¨ loss.backward()ã€€å‰ç”¨ã€€optimizer.zero_grad()ã€€æ¸…é™¤ç´¯ç§¯æ¢¯åº¦</span>        optimizer.zero_grad() <span class="hljs-comment"># optimizer.zero_gradã€€ä¸ã€€model.zero_gradæ•ˆæœä¸€æ ·</span>        predict = model(data) <span class="hljs-comment"># </span>        loss = criterion(predict, target) <span class="hljs-comment">#</span>        avg_loss += loss.item() <span class="hljs-comment">#</span>        loss.backward()        optimizer.step()        print(<span class="hljs-string">&#x27;Train Epoch: &#123;&#125; [&#123;&#125;/&#123;&#125; (&#123;:.1f&#125;%)]\tLoss: &#123;:.6f&#125;&#x27;</span>.format(                epoch, batch_idx * len(data), len(train_loader.dataset),                <span class="hljs-number">100.</span> * batch_idx / len(train_loader), loss.item()))    <span class="hljs-keyword">if</span> (epoch + <span class="hljs-number">1</span>) %  args.save_interval == <span class="hljs-number">0</span>:        state = &#123; <span class="hljs-string">&#x27;epoch&#x27;</span>: epoch + <span class="hljs-number">1</span>,                   <span class="hljs-string">&#x27;state_dict&#x27;</span>: model.state_dict(),                   <span class="hljs-string">&#x27;best_prec&#x27;</span>: <span class="hljs-number">0.0</span>,                   <span class="hljs-string">&#x27;optimizer&#x27;</span>: optimizer.state_dict()&#125;        model_path = os.path.join(args.checkpoint_dir, <span class="hljs-string">&#x27;model_&#x27;</span> + str(epoch) + <span class="hljs-string">&#x27;.pth&#x27;</span>)        torch.save(state, model_path)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span>():</span>    model.eval()    test_loss = <span class="hljs-number">0</span>    <span class="hljs-keyword">for</span> batch_idx, batchdata <span class="hljs-keyword">in</span> enumerate(valid_loader):        data, target = batchdata[<span class="hljs-string">&quot;data&quot;</span>], batchdata[<span class="hljs-string">&quot;target&quot;</span>] <span class="hljs-comment">#</span>        data, target = data.to(device), target.to(device) <span class="hljs-comment">#</span>        predict = model(data) <span class="hljs-comment"># </span>        test_loss += criterion(predict, target) <span class="hljs-comment">#</span>        psnr = criterion(predict * <span class="hljs-number">255</span>, target * <span class="hljs-number">255</span>) <span class="hljs-comment">#</span>    test_loss /= len(valid_loader.dataset)    print(<span class="hljs-string">&#x27;\nTest set: Average loss: &#123;:.4f&#125;, loss:&#123;&#125;, PSNR: (&#123;:.1f&#125;)\n&#x27;</span>.format(        test_loss, test_loss / len(valid_loader.dataset), psnr / len(valid_loader.dataset)))    <span class="hljs-keyword">return</span> psnr / float(len(valid_loader.dataset))best_prec = <span class="hljs-number">0.0</span><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> range(args.start_epoch, args.epochs):    train(epoch)    scheduler.step()    print(print(optimizer.state_dict()[<span class="hljs-string">&#x27;param_groups&#x27;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;lr&#x27;</span>]))    current_prec = test()     is_best = current_prec &gt; best_prec <span class="hljs-comment">#ã€€æ›´æ”¹å¤§å°å†™ !</span>    best_prec = max(best_prec, best_prec) <span class="hljs-comment">#  max or min</span>    save_checkpoint(&#123;        <span class="hljs-string">&#x27;epoch&#x27;</span>: epoch + <span class="hljs-number">1</span>,        <span class="hljs-string">&#x27;state_dict&#x27;</span>: model.state_dict(),        <span class="hljs-string">&#x27;best_prec&#x27;</span>: best_prec,        <span class="hljs-string">&#x27;optimizer&#x27;</span>: optimizer.state_dict(),    &#125;, is_best, args.checkpoint_dir)</code></pre>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>é¢è¯•ç›¸å…³æ•´ç†</title>
    <link href="/2019/04/29/Interview-2019/"/>
    <url>/2019/04/29/Interview-2019/</url>
    
    <content type="html"><![CDATA[<p>é¢è¯•ä¸€äº›ç›¸å…³çš„æ„Ÿå—ç»å†æ•´ç†</p><a id="more"></a><p>â€‹    æŠ•äº†å¤§æ¦‚æœ‰åå®¶å…¬å¸çš„æ ·å­ï¼Œå›å¤å¹¶è¿‡å»é¢è¯•çš„å…¬å¸æœ‰äº”å®¶ã€‚åº”è¯¥ä¼šåœ¨è¿™å‡ å®¶ä¸­å†³å®šå§ã€‚é¢è¯•æŒºè€—è´¹æ—¶é—´çš„ï¼Œå¿ƒä¹Ÿç´¯ï¼Œå¾—å‡†å¤‡å¥½å¤šä¸œè¥¿ã€‚è¿™äº”å®¶å…¬å¸åšçš„ä¸œè¥¿éƒ½ä¸å¤§ç›¸åŒã€‚ä¸¤å®¶åšAI+æ•™è‚²ï¼Œä¸€å®¶AI+å®‰é˜²ï¼Œä¸€å®¶é¥æ„Ÿå›¾åƒå¤„ç†ï¼Œè¿˜æœ‰ä¸€å®¶ä¸æ˜ç¡®ä¸»è¦ä¸šåŠ¡ã€‚ä¸»è¦é¢è¯•çš„å²—ä½ä¸º<strong>è®¡ç®—æœºè§†è§‰/å›¾åƒå¤„ç†å²—ä½</strong>ã€‚é™¤äº†ä¸€å®¶æ²¡æœ‰ç»™å‡ºæ„å‘ï¼Œå…¶ä»–å…¬å¸é¢çš„éƒ½è¿˜ç®—å¯ä»¥ã€‚å…¶å®å¹¶ä¸å–œæ¬¢AIã€äººå·¥æ™ºèƒ½è¿™äº› Titleï¼Œ æ„Ÿè§‰æœ‰ç‚¹è™šæ— ç¼¥ç¼ˆï¼Œä¸ç€è¾¹é™…(å¯èƒ½èèµ„æ¯”è¾ƒå®¹æ˜“å§)ï¼Œæ„Ÿè§‰è®¡ç®—æœºè§†è§‰/æœºå™¨è§†è§‰/å›¾åƒå¤„ç†æ›´åŠ è´´åœ°æ°”ï¼Œä¹ŸçŸ¥é“æ–¹å‘å’Œç›®æ ‡ã€‚</p><p>â€‹    æ¯ä¸ªå…¬å¸çš„ä¸»è¦æµç¨‹ä¸å°½ç›¸åŒï¼Œé¢è¯•çš„å†…å®¹ä¹Ÿä¸å°½ç›¸åŒã€‚ï¼ˆå…¶å®æ„Ÿè§‰åº”å±Šç”Ÿå’Œæœ‰å·¥ä½œç»éªŒçš„äººçš„é¢è¯•å†…å®¹è¿˜æŒºä¸ä¸€æ ·çš„ã€‚å‰è€…åŸºç¡€æ¯”è¾ƒé‡è¦ï¼Œåè€…æ›´çœ‹é‡é¡¹ç›®ç»å†ï¼‰ã€‚</p><p>â€‹    å…ˆè¯´ä¸€ä¸‹å¤§ä½“çš„é¢è¯•æµç¨‹ï¼š<strong>æŠ•ç®€å†</strong> -&gt; <strong>HR å‘é€ç›¸åº”çš„é¢è¯•é€šçŸ¥</strong>  -&gt; <strong>æ‰¾åˆ°ç›¸åº”çš„é¢è¯•åœ°ç‚¹</strong> -&gt; <strong>å¡«å†™é¢è¯•åº”è˜è¡¨</strong>  â€”&gt; <strong>æŠ€æœ¯é¢è¯•(ä¸€é¢/äºŒé¢)</strong> -&gt; <strong>HR é¢è¯•</strong> -&gt; <strong>åç»­æ²Ÿé€šä»¥åŠofferäº‹å®œ</strong></p><h4 id="1-ä¸€äº›åŸºæœ¬çš„ç¤¼ä»ªå’Œç»†èŠ‚é—®é¢˜ï¼š"><a href="#1-ä¸€äº›åŸºæœ¬çš„ç¤¼ä»ªå’Œç»†èŠ‚é—®é¢˜ï¼š" class="headerlink" title="1. ä¸€äº›åŸºæœ¬çš„ç¤¼ä»ªå’Œç»†èŠ‚é—®é¢˜ï¼š"></a>1. ä¸€äº›åŸºæœ¬çš„ç¤¼ä»ªå’Œç»†èŠ‚é—®é¢˜ï¼š</h4><p>ï¼ˆ1ï¼‰ç€è£…ï¼šæŠ€æœ¯æ€§é¢è¯•ï¼Œä¹Ÿæ²¡å¿…è¦æ­£è£…ï¼Œå¹³å¸¸ç€è£…å°±å¯ä»¥ã€‚ç„¶åå¹²å‡€ï¼Œåˆ©è½å°±è¡Œã€‚é¢è¯•å‰å¯ä»¥æ´—ä¸ªå¤´å§ï¼Œä¸€æ˜¯çœ‹ç€èˆ’çˆ½ï¼Œå¦å¤–é†’é†’ç›¹ğŸ¤£</p><p>ï¼ˆ2ï¼‰æˆ‘é¢è¯•çš„æ—¶å€™æºå¸¦çš„ä¸œè¥¿ï¼šèƒŒåŒ… + mac + ä¸€åªä¸­æ€§ç¬” + å‡ å¼ A4ç™½çº¸ + ç®€å†ï¼ˆä¸€äº›è¯ä¹¦å¯å¸¦å¯ä¸å¸¦ï¼‰</p><p>ï¼ˆ3ï¼‰å…³äºåˆ°è¾¾çš„æ—¶é—´ï¼šæˆ‘ä¸€èˆ¬æå‰30åˆ†é’Ÿåˆ°è¾¾é¢è¯•åœ°ç‚¹ï¼Œæå‰20åˆ†é’Ÿä¸Šæ¥¼ã€‚ä¸€æ˜¯ é¢„ç•™ buffer ç»™å µè½¦/æ‰¾è·¯ç­‰äº‹æƒ…ã€‚äºŒæ˜¯å¡«ä¸ªè¡¨ä»€ä¹ˆçš„ã€‚(è¿™ä¸ªçœ‹ä¸ªäººä¹ æƒ¯ï¼Œä¹Ÿä¸æ™“å¾—å¯¹ä¸å¯¹ã€‚)</p><p>ï¼ˆ4ï¼‰è¯šå®ï¼Œ ä¸ä¼šçš„å°±è¯´ä¸ä¼šã€‚éƒ½æ˜¯ææŠ€æœ¯çš„ï¼Œä¹Ÿä¸ä¼šä¸ºéš¾å¤§å®¶ã€‚å¦å¤–åƒæˆ‘æœ‰æ®µè€ƒç ”çš„ç»å†ï¼Œæˆ‘ä¹Ÿéƒ½ç›´æ¥è¯´å‡ºæ¥äº†ã€‚ä¸ç®¡ä»–ä»¬æ€ä¹ˆæƒ³ã€‚</p><h4 id="2-é¢è¯•çš„ä½“éªŒï¼š"><a href="#2-é¢è¯•çš„ä½“éªŒï¼š" class="headerlink" title="2. é¢è¯•çš„ä½“éªŒï¼š"></a>2. é¢è¯•çš„ä½“éªŒï¼š</h4><p>A å²—ä½ï¼šç»™äº†ä¸€é“å®é™…å·¥ä½œä¸­åº”ç”¨åœºæ™¯å†™ä»£ç ã€‚ç„¶åé—®é¡¹ç›®ã€é—®çš„æŒºç»†è‡´çš„ã€‚ã€å†™å‡ºä»£ç å¾ˆé‡è¦ï¼Œ è¿™ä¸ä»…å†³å®šä½ èƒ½ä¸èƒ½æ¥ä¸‹æ¥äºŒé¢ï¼Œç”šè‡³å½±å“äºŒé¢çš„å°è±¡ã€‘</p><p>B å²—ä½ï¼šé—®é¡¹ç›®ï¼ŒæŒºç»†è‡´çš„ã€‚ è¿˜é—®äº†ä¸€äº›åŸºç¡€çš„CPPå’Œlinuxçš„å†…å®¹ã€‚ï¼ˆè¯¥å²—ä½é¢è¯•ä½“éªŒå¾ˆå·®ï¼Œä¸€æ–¹é¢æœ‰ç‚¹ä¸ºéš¾äººï¼Œæˆ‘éƒ½è¯´ä¸ä¼šäº†ï¼Œè¿˜ä¸€ç›´é—®ã€‚å¦å¤–ä¸€æ–¹é¢é—®äº†å¥½å¤šå’Œå²—ä½æ— å…³çš„çŸ¥è¯†ï¼‰</p><p>C å²—ä½ï¼šåšé¢˜ï¼Œå¯èƒ½é¢˜ç›®[linuxåŸºç¡€+æ·±åº¦å­¦ä¹ +Python/CPP]åšçš„æ¯”è¾ƒå¥½ã€‚ç„¶åé¡¹ç›®é—®äº†ååˆ†é’Ÿå°±å·®ä¸å¤šè¿‡äº†ã€‚ã€åšå‡ºé¢˜ç›®å¾ˆå…³é”®ã€‘</p><p>D å²—ä½ï¼šé—®é¡¹ç›®ï¼Œä¹‹åè¿‡äº†ä¸‰å¤©æ‰“ç”µè¯æŠ€æœ¯é¢ï¼ˆæ„Ÿè§‰é—®çš„æŒºç²—,å¯èƒ½é¢è¯•å®˜ä¸æ˜¯åšè¿™ä¸ªçš„ï¼Œå¯¹æˆ‘çš„é¡¹ç›®ä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥šï¼‰ã€‚</p><p>E å²—ä½ï¼šç›´æ¥é—®é¡¹ç›® + ä¸Šæœºå†™ä»£ç ã€‚ã€ä¸Šæœºå†™ä»£ç å¾ˆå…³é”®ã€‘</p><h4 id="3-é¢è¯•çš„æ”¶è·ä»¥åŠéœ€è¦åŠªåŠ›çš„åœ°æ–¹ï¼š"><a href="#3-é¢è¯•çš„æ”¶è·ä»¥åŠéœ€è¦åŠªåŠ›çš„åœ°æ–¹ï¼š" class="headerlink" title="3. é¢è¯•çš„æ”¶è·ä»¥åŠéœ€è¦åŠªåŠ›çš„åœ°æ–¹ï¼š"></a>3. é¢è¯•çš„æ”¶è·ä»¥åŠéœ€è¦åŠªåŠ›çš„åœ°æ–¹ï¼š</h4><p>ï¼ˆ0ï¼‰ç®€å†/è‡ªæˆ‘ä»‹ç»è¿˜æ˜¯è¦å‡†å¤‡å¥½çš„ï¼Œ æ„Ÿè§‰æŒºé‡è¦çš„ã€‚å…¶å®æˆ‘çš„å¹¶ä¸å¤§å¥½ï¼Œæ¯•ç«Ÿgapäº†ä¸€å¹´è€ƒç ”ï¼Œè¿˜æ²¡è€ƒä¸Š(sad)</p><p>ï¼ˆ1ï¼‰å†™ä»£ç å¾ˆå…³é”®ã€‚Pythonå’ŒC++éƒ½è¦ç†Ÿæ‚‰ï¼ŒC++ç”¨çš„å°‘äº†æœ‰ç‚¹ç”Ÿç–äº†ã€‚å¯¼è‡´Eå²—ä½çš„ç¿»è½¬åˆ—è¡¨éƒ½å¿˜äº†æ€ä¹ˆå†™äº†ã€‚(âŠ™ï¹âŠ™)b å‡†å¤‡æ—¶é—´æ¯”è¾ƒçŸ­ï¼Œä¹Ÿæ²¡æœ‰å»åˆ·é¢˜ï¼Œç›´æ¥ç¡¬ç€å¤´çš®å°±ä¸Šäº†ã€‚ã€‚</p><p>ï¼ˆ2ï¼‰é¡¹ç›®è¦è®°å¾—éå¸¸ä»”ç»†ï¼Œæ¯ä¸€ä¸ªç»†èŠ‚ï¼Œç”šè‡³ä¹‹å‰çš„ä»£ç éƒ½è¦è®°ä½</p><p>ï¼ˆ3ï¼‰å¸¸è§çš„é¢è¯•èŒƒå›´ï¼š</p><ul><li>é¡¹ç›®</li><li>(åˆ·é¢˜)å‰‘æŒ‡ offer + leetcode + codewars(Eé¢è¯•å®˜ç”¨çš„ï¼Œå“ˆå“ˆï¼Œå·å·å­¦æ¥çš„)</li><li>æœºå™¨å­¦ä¹  + æ·±åº¦å­¦ä¹  åŸºç¡€</li><li>å›¾åƒå¤„ç†åŸºç¡€çŸ¥è¯†</li></ul><p>ï¼ˆ4ï¼‰æœ‰ä¸¤ä¸‰å®¶å…¬å¸å¯¹ é«˜æ€§èƒ½è®¡ç®—å¾ˆæ„Ÿå…´è¶£ã€‚æˆ‘çŒœæµ‹æ˜¯åº”ä¸ºéƒ¨ç½²çš„æ—¶å€™DLå¤ªæ…¢å¯¼è‡´çš„ã€‚éœ€è¦è¿›è¡Œä¼˜åŒ–ã€‚å…¶ä¸­æœ‰ä¸€å®¶è¿˜é—®äº†caffe ä¸­å·ç§¯çš„å®ç°æ–¹æ¡ˆï¼šim2col + çŸ©é˜µä¹˜æ³•ã€‚è¿˜å¥½å½“å¹´çœ‹çœ‹ç™¾åº¦çš„MDL æ—¶å€™å»çœ‹äº†è¿™ä¸ªæºç ã€‚</p><p>â€‹     å…¶å®è¿™æ–¹é¢ä¹Ÿæ˜¯æˆ‘æŒºæ„Ÿå…´è¶£çš„ä¸€ä¸ªæ–¹é¢ï¼šå¸¸è§å¹¶è¡Œæ–¹æ¡ˆæœ‰ MPIã€OPENMPã€SIMDã€neonã€CUDA â€”&gt; éœ€è¦å¥½å¥½å­¦å­¦ ncnnï¼Œ çœ‹çœ‹äººå®¶æ€ä¹ˆå†™çš„DL interfaceã€‚</p><p>ï¼ˆ5ï¼‰blog å’Œ github è¿˜æ˜¯è¦å¥½å¥½æ•´æ•´çš„ï¼Œæ ‘ç«‹ä¸ªäººå“ç‰Œå¾ˆå…³é”®(Kaggleæ¯”èµ›ã€blogã€github)ï¼Œæœ‰å‡ ç¯‡blogæ˜¯æƒ³ç€å¥½å¥½å­¦ä¹ ä¸€ä¸‹çš„(å¿ƒæœ‰ä½™è€ŒåŠ›ä¸è¶³å‘€)ï¼š</p><ul><li><p>openmp</p></li><li><p>æœ€è¿‘çš„anchor freeçš„ç›®æ ‡æ£€æµ‹ç®—æ³•(è†œä¸€ä¸‹ densebox)</p></li><li><p>ncnn çš„ä¼˜åŒ–æ–¹æ¡ˆ</p></li></ul><p>ï¼ˆ6ï¼‰ æœ‰äº›é¢è¯•å®˜æ„Ÿè§‰çš„å‡ºæ¥ä¹Ÿä¸å¤§æ‡‚ä½ åšçš„ï¼Œå› æ­¤é¡¹ç›®ä¸­çš„å…±åŒçš„ä¸œè¥¿å°±è¦éå¸¸ç†Ÿæ‚‰ï¼Œæ¯”å¦‚ï¼š</p><p>â€‹      ç½‘ç»œä¸­çš„backboneã€ä¸€äº›è¡¡é‡æŒ‡æ ‡ã€lossè®¾è®¡ã€å‚æ•°è°ƒæ•´çš„è¿‡ç¨‹ã€ä¸€äº›æ£€æµ‹çš„æ–¹æ¡ˆï¼ˆSSD/YOLO/R-CNNã€anchor free or anchor basedï¼‰è¦ç†Ÿè®°ã€‚</p><p>ï¼ˆ7ï¼‰æœ‰äº›å…¬å¸è¿˜æ˜¯æŒºçœ‹é‡å®è·µèƒ½åŠ›çš„ï¼Œæ¯”å¦‚é—®äº† CMakeLists æ€ä¹ˆå†™ï¼Ÿ ncnnä¸­æ€ä¹ˆå®šä¹‰å±‚ï¼Ÿ æ€ä¹ˆä¼˜åŒ–ä»£ç ï¼Ÿæœ€åæ€ä¹ˆæäº¤æˆç»©çš„(åœ¨å…±æœ‰æ•°æ®é›†ä¸Šï¼Œæ¯”å¦‚lfwä¸Š)ï¼Ÿ</p><h4 id="4-å†™ä¸€ä¸‹å…¶ä»–çš„å§-åæ§½-ï¼š"><a href="#4-å†™ä¸€ä¸‹å…¶ä»–çš„å§-åæ§½-ï¼š" class="headerlink" title="4. å†™ä¸€ä¸‹å…¶ä»–çš„å§(åæ§½)ï¼š"></a>4. å†™ä¸€ä¸‹å…¶ä»–çš„å§(åæ§½)ï¼š</h4><p>ï¼ˆ1ï¼‰æœ‰äº›é¢è¯•é€šçŸ¥ä¸­éƒ½æ²¡æœ‰å†™æ˜åœ°ç‚¹? é‚£æ ‹æ¥¼? æ€ä¹ˆèµ°? â€”&gt; [æŸå…¬å¸å»åˆ°æ²¡æ‰¾åˆ°(ABCDEæ ‹/æ¥¼å±‚éƒ½æ²¡å†™)ï¼Œæ‰“äº†ä¸‰éç”µè¯æ‰æ¥é€š]</p><p>ï¼ˆ2ï¼‰æœ‰ä¸€å®¶å…¬å¸è¯´äº†ä¸¤ä¸ªå¤šå°æ—¶ï¼Œä¸€å£æ°´éƒ½æ²¡ç»™å–(æˆ‘é‚£ä¸ªæ¸´å‘€ï¼Œä»¥åå¯ä»¥è‡ªå·±å¸¦ä¸€ç“¶æ°´å§)</p><p>ï¼ˆ3ï¼‰æœ‰å®¶å…¬å¸æ‰”äº†ä¸€å¼ è¯•å·å°±èµ°äº†ï¼Œæˆ‘åŠä¸ªå°æ—¶å°±åšå®Œäº†ï¼Œä¸€ä¸ªåŠå°æ—¶ä¹‹åä»–æ‰å›æ¥(å…¶å®ä¹Ÿä¸æ˜¯ä»–ï¼Œå¦ä¸€ä¸ªé¢è¯•å®˜é¢çš„)ï¼ŒæœŸé—´å‡ºå»æ‰¾é¢è¯•å®˜ä¸¤æ¬¡æ²¡æ‰¾åˆ°ï¼Œä¸æ˜¯å‘ç°è¯¥å…¬å¸åŒäº‹åœ¨ç©æ‰‹æœºï¼Œå°±æ˜¯åœ¨èµ°å»ŠèŠå¤©ï¼Œ ç”šè€…è¿˜åœ¨æˆ‘åšé¢˜çš„é‚£ä¸ªå±‹é‡ŒåŠç†é“¶è¡Œå¡ï¼Œæˆ‘çœŸæ˜¯è§è¯†äº†ã€‚å¯¹è¯¥å…¬å¸å°è±¡æå…¶å·®ã€‚</p><p>â€‹    ã€æœ‰ä¸€å®¶åˆ›ä¸šå…¬å¸ç»™æˆ‘å°è±¡æŒºå¥½ï¼Œæ—©ä¸Šè¿˜ç»™æˆ‘å‘äº†é¢è¯•æé†’ï¼ŒHRè¿˜ä¸‹æ¥¼å»æ¥çš„æˆ‘ï¼Œè™½ç„¶æ²¡ç¢°åˆ°ã€‘</p><p>ï¼ˆ4ï¼‰é¢è¯•æ—¶ä¸è¦å®³æ€•(é¢å¤šäº†å°±å¥½äº†ï¼Œç°åœ¨é¢è¯•å¿ƒæƒ…å¾ˆè½»æ¾çš„)ï¼Œè¿›å…¬å¸ä¹‹åå°±æ˜¯åŒäº‹æˆ–è€…leaderï¼Œé¢è¯•å®˜ä¹Ÿä¸€èˆ¬ä¸ä¼šä¸ºéš¾é¢è¯•è€…çš„ã€‚æœ‰ä¸€å®¶å…¬å¸é¢è¯•å®˜åœ¨æˆ‘åšé¢˜æœŸé—´å¾ˆç»†å¿ƒçš„æŒ‡å¯¼åˆ«äººï¼Œç»™æˆ‘ç•™ä¸‹å¾ˆæ·±åˆ»çš„å°è±¡ã€‚</p><p>ï¼ˆ5ï¼‰é¢è¯•ä¹Ÿæ˜¯ä¸€ä¸ªåŒé€‰çš„è¿‡ç¨‹ï¼Œæ„Ÿè§‰ä¸å¥½çš„å…¬å¸å°½é‡ä¹Ÿä¸è¦å»ï¼Œå…å¾—æœ€åä¸æ¬¢è€Œæ•£ã€</p><p>ï¼ˆ6ï¼‰ä¹Ÿä¸è¦å®³æ€•è°ˆè–ªèµ„ï¼ŒæŒ‰è‡ªå·±èƒ½åŠ›è¦å³å¯ã€‚å¥½å§ï¼Œè¿™æ–¹é¢æˆ‘ä¸€ç›´ä¸åœ¨è¡Œã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>YOLO</title>
    <link href="/2019/04/23/YOLO/"/>
    <url>/2019/04/23/YOLO/</url>
    
    <content type="html"><![CDATA[<p>YOLO series: YOLO v1. YOLO v2 and. YOLO v3</p><a id="more"></a><h3 id="1-YOLO-v1"><a href="#1-YOLO-v1" class="headerlink" title="1. YOLO v1"></a>1. YOLO v1</h3><h4 id="æ ¸å¿ƒæ€æƒ³"><a href="#æ ¸å¿ƒæ€æƒ³" class="headerlink" title="æ ¸å¿ƒæ€æƒ³"></a>æ ¸å¿ƒæ€æƒ³</h4><p>ç›´æ¥åœ¨è¾“å‡ºå±‚å›å½’ bounding box çš„ä½ç½®å’Œ bounding boxæ‰€å±çš„ç±»åˆ«(æ•´å¼ å›¾ä½œä¸ºç½‘ç»œçš„è¾“å…¥ï¼ŒæŠŠ Object Detection çš„é—®é¢˜è½¬åŒ–æˆä¸€ä¸ª Regression é—®é¢˜)</p><h4 id="YOLO-v1-æµç¨‹"><a href="#YOLO-v1-æµç¨‹" class="headerlink" title="YOLO v1 æµç¨‹"></a>YOLO v1 æµç¨‹</h4><p><img src="/2019/04/23/YOLO/2.png" alt></p><ol><li><p>å°†å›¾ç‰‡Resizeæˆ448x448ï¼Œåˆ†æˆ7x7ä¸ªç½‘æ ¼(grid cell)ï¼ŒæŸä¸ªç‰©ä½“çš„ä¸­å¿ƒè½åœ¨è¿™ä¸ªç½‘æ ¼ä¸­æ­¤ç½‘æ ¼å°±è´Ÿè´£é¢„æµ‹è¿™ä¸ªç‰©ä½“ã€‚</p></li><li><p>æå–ç‰¹å¾å’Œé¢„æµ‹ï¼Œå·ç§¯éƒ¨åˆ†è´Ÿè´£æå–ç‰¹å¾ã€‚å…¨è¿æ¥éƒ¨åˆ†è´Ÿè´£é¢„æµ‹ï¼š</p><ul><li>ä¸¤ä¸ª ã€bounding box(bbox) + conï¬denceã€‘ (2x5)</li><li>20ä¸ªç‰©ä½“çš„æ¦‚ç‡ï¼ˆ20ï¼‰</li></ul><p>æ€»çš„è¾“å‡ºä¸º (7X7)X30 çš„ç»´åº¦ã€‚</p></li><li><p>è¿‡æ»¤bboxï¼ˆé€šè¿‡nmsï¼‰</p></li></ol><h4 id="YOLO-v2-ç»†èŠ‚"><a href="#YOLO-v2-ç»†èŠ‚" class="headerlink" title="YOLO v2 ç»†èŠ‚"></a>YOLO v2 ç»†èŠ‚</h4><ol><li><p>class-specific confidence scoreï¼š</p><p>class-specific confidence score æ˜¯ä¸‰é¡¹çš„æˆç»©ã€‚ç¬¬ä¸€é¡¹æ˜¯ bboxæ¯ä¸ªç½‘æ ¼é¢„æµ‹çš„ç±»åˆ«ä¿¡æ¯å³20ä¸ªç‰©ä½“çš„æ¦‚ç‡ï¼Œ ç¬¬äºŒé¡¹æ˜¯æ¯ä¸ª bbox çš„ç½®ä¿¡åº¦ï¼Œ ç¬¬ä¸‰é¡¹æ˜¯ ground truth å’Œ é¢„æµ‹æ¡†çš„ IOUã€‚å¾—åˆ°æ¯ä¸ªbboxçš„class-specific confidence scoreä»¥åï¼Œè®¾ç½®é˜ˆå€¼ï¼Œæ»¤æ‰å¾—åˆ†ä½çš„boxesï¼Œå¯¹ä¿ç•™çš„boxesè¿›è¡ŒNMSå¤„ç†ï¼Œå°±å¾—åˆ°æœ€ç»ˆçš„æ£€æµ‹ç»“æœ</p></li><li><p>æŸå¤±å‡½æ•°çš„è®¾è®¡ï¼š<br><img src="/2019/04/23/YOLO/1.png" alt></p></li></ol>]]></content>
    
    
    <categories>
      
      <category>åˆ†ç±»ã€æ£€æµ‹å’Œåˆ†å‰²</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>recent convolutions</title>
    <link href="/2019/04/21/recent-convolutions/"/>
    <url>/2019/04/21/recent-convolutions/</url>
    
    <content type="html"><![CDATA[<p>octave conv(octconv)ã€hetconvã€res2net</p><a id="more"></a><h3 id="1-octave-conv"><a href="#1-octave-conv" class="headerlink" title="1. octave conv"></a>1. octave conv</h3><h5 id="Paper"><a href="#Paper" class="headerlink" title="Paper:"></a>Paper:</h5><p>Drop an Octave: Reducing Spatial Redundancy in Convolutional Neural Networks with Octave Convolution</p><h5 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation:"></a>Motivation:</h5><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šï¼ˆaï¼‰è‡ªç„¶å›¾åƒå¯ä»¥è¢«åˆ†è§£ä¸ºé«˜é¢‘éƒ¨åˆ†å’Œä½é¢‘éƒ¨åˆ†ã€‚é«˜é¢‘åˆ†é‡è¡¨è¾¾ç»†èŠ‚ï¼Œä½é¢‘åˆ†é‡è¡¨è¾¾æ•´ä½“ã€‚å¾ˆæ˜¾ç„¶ï¼Œä½é¢‘åˆ†é‡æ˜¯å­˜åœ¨å†—ä½™çš„ï¼Œåœ¨ç¼–ç è¿‡ç¨‹ä¸­å¯ä»¥èŠ‚çœã€‚(b) å·ç§¯å±‚çš„è¾“å‡ºé€šé“ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå¯ä»¥è¢«åˆ†è§£ä¸ºä½é¢‘åˆ†é‡å’Œé«˜é¢‘åˆ†é‡å¹¶è¿›è¡Œé‡ç»„ã€‚ï¼ˆcï¼‰ä½œè€…å°†ä½é¢‘åˆ†é‡çš„é€šé“å¤§å°è®¾ç½®ä¸ºé«˜é¢‘åˆ†é‡é€šé“å¤§å°çš„ä¸€åŠï¼Œç”¨æ¥å‡å°‘å†—ä½™ã€‚(d) ä½é¢‘éƒ¨åˆ†å’Œé«˜é¢‘éƒ¨åˆ†å¯ä»¥å„è‡ªæ›´æ–°ï¼Œå¹¶è¿›è¡Œé€šé“ä¹‹é—´çš„äº¤æµã€‚</p><p><img src="/2019/04/21/recent-convolutions/1.png" alt></p><h5 id="mothods"><a href="#mothods" class="headerlink" title="mothods"></a>mothods</h5><p>ä½œè€…æå‡ºäº† conv çš„æ”¹è¿›ç‰ˆ OctConv ç”¨æ¥é™ä½ä½é¢‘éƒ¨åˆ†çš„å†—ä½™åº¦ã€‚ Octconv çš„ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="/2019/04/21/recent-convolutions/2.png" alt></p><p>å½“åœ¨ç¬¬ä¸€ä¸ª OctConv æ˜¯ $\alpha_{in} = 0$ï¼Œæ­¤æ—¶æ‰§è¡Œ â‘ â‘¡ ä¸¤ä¸ªæ“ä½œã€‚</p><pre><code class="hljs python"><span class="hljs-keyword">if</span> self.type == <span class="hljs-string">&#x27;first&#x27;</span>:    <span class="hljs-keyword">return</span> self.H2H(x), self.H2L(self.avg_pool(x))<span class="hljs-comment"># H2Hã€L2H å‡ä¸ºä¼ ç»Ÿå·ç§¯</span></code></pre><p>å½“åœ¨æœ€åä¸€ä¸ª OctConv ä¸­ $\alpha_{out} = 0$ï¼Œ æ­¤æ—¶æ‰§è¡Œ â‘ â‘¢ ä¸¤ä¸ªæ“ä½œã€‚</p><pre><code class="hljs python"><span class="hljs-keyword">if</span> self.type == <span class="hljs-string">&#x27;last&#x27;</span>:    hf, lf = x    <span class="hljs-keyword">return</span> self.H2H(hf) + self.L2H(self.upsample(lf))<span class="hljs-comment"># H2Hã€L2H å‡ä¸ºä¼ ç»Ÿå·ç§¯</span></code></pre><p>å½“å…¶ä»–æƒ…å†µæ—¶ï¼Œæ‰§è¡Œ â‘ â‘¡â‘¢â‘£å››ä¸ªæ“ä½œ</p><pre><code class="hljs python"><span class="hljs-keyword">else</span>ï¼š    hf, lf = x    <span class="hljs-keyword">return</span> self.H2H(hf) + self.upsample(self.L2H(lf)),            self.L2L(lf) + self.H2L(self.avg_pool(hf))<span class="hljs-comment"># L2Hã€L2Lã€H2Hã€H2L å‡ä¸ºä¼ ç»Ÿå·ç§¯</span></code></pre><p>octconv æ•´ä½“çš„å®ç°ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OctConv</span>(<span class="hljs-params">nn.Module</span>):</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, in_channels, out_channels, kernel_size, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>, </span></span><span class="hljs-function"><span class="hljs-params">             alpha_in=<span class="hljs-number">0.25</span>, alpha_out=<span class="hljs-number">0.25</span>, type=<span class="hljs-string">&#x27;normal&#x27;</span></span>):</span>        super(OctConv, self).__init__()        self.kernel_size = kernel_size        self.stride = stride        self.type = type        hf_in = int(in_channels * (<span class="hljs-number">1</span> - alpha_in))        hf_out = int(out_channels * (<span class="hljs-number">1</span> - alpha_out))        lf_in = in_channels - hf_in        lf_out = out_channels - hf_out        <span class="hljs-keyword">if</span> stride == <span class="hljs-number">2</span>:            self.downsample = nn.AvgPool2d(kernel_size=<span class="hljs-number">2</span>, stride=stride)        <span class="hljs-keyword">if</span> type == <span class="hljs-string">&#x27;first&#x27;</span>:            self.H2H = nn.Conv2d(in_channels, hf_out, kernel_size=kernel_size, stride=<span class="hljs-number">1</span>, padding=padding)            self.H2L = nn.Conv2d(in_channels, lf_out, kernel_size=kernel_size, stride=<span class="hljs-number">1</span>, padding=padding)            self.avg_pool = nn.AvgPool2d(kernel_size=<span class="hljs-number">2</span>, stride=<span class="hljs-number">2</span>)        <span class="hljs-keyword">elif</span> type == <span class="hljs-string">&#x27;last&#x27;</span>:            self.H2H = nn.Conv2d(hf_in, out_channels, kernel_size=kernel_size, padding=padding)            self.L2H = nn.Conv2d(lf_in, out_channels, kernel_size=kernel_size, padding=padding)            self.upsample = partial(F.interpolate, scale_factor=<span class="hljs-number">2</span>, mode=<span class="hljs-string">&quot;nearest&quot;</span>)        <span class="hljs-keyword">else</span>:            self.L2L = nn.Conv2d(lf_in, lf_out, kernel_size=kernel_size, stride=<span class="hljs-number">1</span>, padding=padding)            self.L2H = nn.Conv2d(lf_in, hf_out, kernel_size=kernel_size, stride=<span class="hljs-number">1</span>, padding=padding)            self.H2L = nn.Conv2d(hf_in, lf_out, kernel_size=kernel_size, stride=<span class="hljs-number">1</span>, padding=padding)            self.H2H = nn.Conv2d(hf_in, hf_out, kernel_size=kernel_size, stride=<span class="hljs-number">1</span>, padding=padding)            self.upsample = partial(F.interpolate, scale_factor=<span class="hljs-number">2</span>, mode=<span class="hljs-string">&quot;nearest&quot;</span>)            self.avg_pool = partial(F.avg_pool2d, kernel_size=<span class="hljs-number">2</span>, stride=<span class="hljs-number">2</span>)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">self, x</span>):</span>        <span class="hljs-keyword">if</span> self.type == <span class="hljs-string">&#x27;first&#x27;</span>:            <span class="hljs-keyword">if</span> self.stride == <span class="hljs-number">2</span>:                x = self.downsample(x)            <span class="hljs-keyword">return</span> self.H2H(x), self.H2L(self.avg_pool(x))        <span class="hljs-keyword">elif</span> self.type == <span class="hljs-string">&#x27;last&#x27;</span>:            hf, lf = x            <span class="hljs-keyword">if</span> self.stride == <span class="hljs-number">2</span>:                hf = self.downsample(hf)                <span class="hljs-keyword">return</span> self.H2H(hf) + self.L2H(lf)            <span class="hljs-keyword">else</span>:                <span class="hljs-keyword">return</span> self.H2H(hf) + self.L2H(self.upsample(lf))        <span class="hljs-keyword">else</span>:            hf, lf = x            <span class="hljs-keyword">if</span> self.stride == <span class="hljs-number">2</span>:                hf = self.downsample(hf)                <span class="hljs-keyword">return</span> self.H2H(hf) + self.L2H(lf), self.L2L(self.avg_pool(lf)) + self.H2L(self.avg_pool(hf))            <span class="hljs-keyword">else</span>:                <span class="hljs-keyword">return</span> self.H2H(hf) + self.upsample(self.L2H(lf)), self.L2L(lf) + self.H2L(self.avg_pool(hf))</code></pre><h3 id="2-res2net"><a href="#2-res2net" class="headerlink" title="2. res2net"></a>2. res2net</h3><h5 id="Paper-1"><a href="#Paper-1" class="headerlink" title="Paper:"></a>Paper:</h5><p>Res2Net: A New Multi-scale Backbone Architecture</p><h5 id="Methods"><a href="#Methods" class="headerlink" title="Methods:"></a>Methods:</h5><p>ä½œè€…æå‡ºäº†ä¸€ç§åœ¨æ›´åŠ ç»†ç²’åº¦(å·ç§¯å±‚)çš„å±‚é¢æå‡å¤šå°ºåº¦è¡¨è¾¾èƒ½åŠ›ã€‚å…¶åŸºæœ¬ç»“æ„å¦‚ä¸‹å›¾(b) æ‰€ç¤ºï¼š</p><p><img src="/2019/04/21/recent-convolutions/3.png" alt></p><p>ä¼ ç»Ÿçš„resnetç»“æ„å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä½œè€…åœ¨å…¶åŸºç¡€ä¸Šè¿›è¡Œæ”¹è¿›ï¼Œåœ¨ä¸å¢åŠ è®¡ç®—é‡çš„åŒæ—¶ï¼Œä½¿å…¶å…·å¤‡æ›´å¼ºçš„å¤šå°ºåº¦æå–èƒ½åŠ›ã€‚å¦‚ä¸Šå›¾ï¼ˆbï¼‰æ‰€ç¤ºï¼Œä½œè€…é‡‡ç”¨äº†æ›´å°çš„å·ç§¯ç»„æ¥æ›¿ä»£ bottleneck block é‡Œé¢çš„ 3x3 å·ç§¯ã€‚å…·ä½“æ“ä½œä¸ºï¼š</p><ul><li>é¦–å…ˆå°† 1x1 å·ç§¯åçš„ç‰¹å¾å›¾å‡åˆ†ä¸º s ä¸ªç‰¹å¾å›¾å­é›†ã€‚æ¯ä¸ªç‰¹å¾å›¾å­é›†çš„å¤§å°ç›¸åŒï¼Œä½†æ˜¯é€šé“æ•°æ˜¯è¾“å…¥ç‰¹å¾å›¾çš„ 1/sã€‚</li><li>å¯¹æ¯ä¸€ä¸ªç‰¹å¾å›¾å­é›† $X<em>i$ï¼Œæœ‰ä¸€ä¸ªå¯¹åº”çš„ 3x3 å·ç§¯ $K_i$ , å‡è®¾ $K_i$çš„è¾“å‡ºæ˜¯ $y_i$ã€‚æ¥ä¸‹æ¥æ¯ä¸ªç‰¹å¾å›¾å­é›† $X_i $ä¼šåŠ ä¸Š $K</em>{i-1}$ çš„è¾“å‡ºï¼Œç„¶åä¸€èµ·è¾“å…¥è¿› $K_i$ã€‚ä¸ºäº†åœ¨å¢å¤§ s çš„å€¼æ—¶å‡å°‘å‚æ•°é‡ï¼Œä½œè€…çœå»äº† $X_1$ çš„ 3x3 ç½‘ç»œã€‚å› æ­¤ï¼Œè¾“å‡º $y_i$ å¯ä»¥ç”¨å¦‚ä¸‹å…¬å¼è¡¨ç¤ºï¼š</li></ul><script type="math/tex; mode=display">y_i = \begin{equation}\begin{cases}x_i && i=1;\\K_i(x_i+y_{i-1}) && 1 < i \leq s.\end{cases}\end{equation}</script><p>æ ¹æ®å›¾(b)ï¼Œå¯ä»¥å‘ç°æ¯ä¸€ä¸ª $X_j (j&lt;=i)$ ä¸‹çš„ 3x3 å·ç§¯å¯ä»¥åˆ©ç”¨ä¹‹å‰æ‰€æœ‰çš„ç‰¹æ€§ä¿¡æ¯ï¼Œå®ƒçš„è¾“å‡ºä¼šæœ‰æ¯” $X_j$ æ›´å¤§çš„æ„Ÿå—é‡ã€‚å› æ­¤è¿™æ ·çš„ç»„åˆå¯ä»¥ä½¿ Res2Net çš„è¾“å‡ºæœ‰æ›´å¤šæ ·çš„æ„Ÿå—é‡ä¿¡æ¯ã€‚ä¸ºäº†æ›´å¥½çš„èåˆä¸åŒå°ºåº¦çš„ä¿¡æ¯ï¼Œä½œè€…å°†å®ƒä»¬çš„è¾“å‡ºæ‹¼æ¥èµ·æ¥ï¼Œç„¶åå†é€å…¥ 1x1 å·ç§¯ï¼Œå¦‚ä¸Šå›¾ï¼ˆbï¼‰æ‰€ç¤ºã€‚</p><p>res2Net module çš„å®ç°ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Res2NetBottleneck</span>(<span class="hljs-params">nn.Module</span>):</span>   expansion = <span class="hljs-number">4</span>   <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, in_channels, out_channels, downsample=None, stride=<span class="hljs-number">1</span>, scales=<span class="hljs-number">4</span>, groups=<span class="hljs-number">1</span>, se=False, norm_layer=None</span>):</span>       super(Res2NetBottleneck, self).__init__()       <span class="hljs-keyword">if</span> out_channels % scales != <span class="hljs-number">0</span>:           <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Planes must be divisible by scales&#x27;</span>)       <span class="hljs-keyword">if</span> norm_layer <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:           norm_layer = nn.BatchNorm2d                  <span class="hljs-comment"># Both self.conv2 and self.downsample layers downsample the input when stride != 1</span>       self.conv1 = conv1x1(in_channels, out_channels, stride)       self.bn1 = norm_layer(out_channels)       self.conv2 = nn.ModuleList([conv3x3(out_channels // scales, out_channels // scales, groups=groups) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(scales<span class="hljs-number">-1</span>)])       self.bn2 = nn.ModuleList([norm_layer(out_channels // scales) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(scales<span class="hljs-number">-1</span>)])       self.conv3 = conv1x1(out_channels, out_channels * self.expansion)       self.bn3 = norm_layer(out_channels * self.expansion)       self.relu = nn.ReLU(inplace=<span class="hljs-literal">True</span>)       self.downsample = downsample       self.stride = stride       self.scales = scales   <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">self, x</span>):</span>       identity = x              out = self.relu(self.bn1(self.conv1(x)))       xs = torch.chunk(out, self.scales, <span class="hljs-number">1</span>)       ys = []       <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> range(self.scales):           <span class="hljs-keyword">if</span> s == <span class="hljs-number">0</span>:               ys.append(xs[s])           <span class="hljs-keyword">elif</span> s == <span class="hljs-number">1</span>:               ys.append(self.relu(self.bn2[s<span class="hljs-number">-1</span>](self.conv2[s<span class="hljs-number">-1</span>](xs[s]))))           <span class="hljs-keyword">else</span>:               ys.append(self.relu(self.bn2[s<span class="hljs-number">-1</span>](self.conv2[s<span class="hljs-number">-1</span>](xs[s] + ys[<span class="hljs-number">-1</span>]))))       out = torch.cat(ys, <span class="hljs-number">1</span>)       out = self.bn3(self.conv3(out))              <span class="hljs-keyword">if</span> self.downsample <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:           identity = self.downsample(identity)       <span class="hljs-keyword">return</span> self.relu(out + identity)</code></pre><h3 id="3-Hetconv"><a href="#3-Hetconv" class="headerlink" title="3. Hetconv"></a>3. Hetconv</h3><h5 id="Paperï¼š"><a href="#Paperï¼š" class="headerlink" title="Paperï¼š"></a>Paperï¼š</h5><p>HetConv: Heterogeneous Kernel-Based Convolutions for Deep CNNs</p><h5 id="Methods-1"><a href="#Methods-1" class="headerlink" title="Methods:"></a>Methods:</h5><p>æœ¬æ–‡æå‡ºäº†ä¸€ç§é«˜æ•ˆçš„å¼‚æ„å·ç§¯è¿‡æ»¤å™¨(ä¸€äº›æ ¸çš„å¤§å°æ˜¯ 3x3ï¼Œ å…¶ä½™çš„æ˜¯1x1)ï¼Œç›¸è¾ƒäº mobilenetçš„åŸå§‹çš„ depthwise convï¼Œèƒ½åœ¨ä¸ç‰ºç‰²å‡†ç¡®åº¦çš„åŒæ—¶æå‡è¿™äº›æ¶æ„çš„æ•ˆç‡ã€‚å®ç°çš„æ–¹æ¡ˆå¾ˆç®€å•ï¼Œ å°†ä¼ ç»Ÿå·ç§¯è¿›è¡Œæ”¹è¿›ï¼Œå¯¹äºæŸä¸€ä¸ªå·ç§¯ï¼Œåªæœ‰1/pä¸ªé€šé“ ä½¿ç”¨ 3x3 çš„å·ç§¯ï¼Œå…¶ä½™å‡ä½¿ç”¨ 1x1å·ç§¯ï¼Œç„¶åå°†æ‰€æœ‰é€šé“ç›¸åŠ ï¼Œä½œä¸ºä¸€ä¸ªè¾“å‡ºé€šé“ã€‚</p><p>Hexconv module çš„å®ç°ä»£ç å¦‚ä¸‹æ‰€ç¤º</p><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HetConv</span>(<span class="hljs-params">nn.Module</span>):</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, in_channels, out_channels, p=<span class="hljs-number">2</span></span>):</span>        super(HetConv, self).__init__()        <span class="hljs-keyword">if</span> in_channels % groups != <span class="hljs-number">0</span>:            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;in_channels must be divisible by groups&#x27;</span>)        self.in_channels = in_channels        self.out_channels = out_channels        self.blocks = nn.ModuleList()        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(out_channels):            self.blocks.append(self._make_hetconv_layer(i, p))    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_make_hetconv_layer</span>(<span class="hljs-params">self, n, p</span>):</span>        layers = nn.ModuleList()        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(self.in_channels):            <span class="hljs-keyword">if</span> ((i - n) % (p)) == <span class="hljs-number">0</span>:                layers.append(nn.Conv2d(in_channels=<span class="hljs-number">1</span>, out_channels=<span class="hljs-number">1</span>, kernel_size=<span class="hljs-number">3</span>, padding=<span class="hljs-number">1</span>))            <span class="hljs-keyword">else</span>:                layers.append(nn.Conv2d(in_channels=<span class="hljs-number">1</span>, out_channels=<span class="hljs-number">1</span>, kernel_size=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>))        <span class="hljs-keyword">return</span> layers    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">self, x</span>):</span>        out = []        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, self.out_channels):            out_ = self.blocks[i][<span class="hljs-number">0</span>](x[:, <span class="hljs-number">0</span>: <span class="hljs-number">1</span>, :, :])            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, self.in_channels):               out_ += self.blocks[i][j](x[:, j:j + <span class="hljs-number">1</span>, :, :])            out.append(out_)        <span class="hljs-keyword">return</span> torch.cat(out, <span class="hljs-number">1</span>)</code></pre><h3 id="ä¸‰ç§å·ç§¯çš„æ„é€ æ–¹å¼æ€»ç»“ï¼š"><a href="#ä¸‰ç§å·ç§¯çš„æ„é€ æ–¹å¼æ€»ç»“ï¼š" class="headerlink" title="ä¸‰ç§å·ç§¯çš„æ„é€ æ–¹å¼æ€»ç»“ï¼š"></a>ä¸‰ç§å·ç§¯çš„æ„é€ æ–¹å¼æ€»ç»“ï¼š</h3><p><img src="/2019/04/21/recent-convolutions/4.png" alt></p><ol><li>ä¸‰ç§å·ç§¯å‡åœ¨è¾“å…¥é€šé“è¿›è¡Œæ”¹è¿›ï¼Œå‰ä¸¤ç§æ–¹æ¡ˆ(res2netã€octconv)éƒ½è¿›è¡Œäº†ç‰¹å¾é€šé“çš„èåˆã€‚ä½†æ˜¯ç¬¬ä¸€ç§æ–¹æ¡ˆå¯¹ç¡¬ä»¶å¹¶ä¸å‹å¥½(æ²¡æœ‰è¿›è¡Œè¯•éªŒçš„éªŒè¯)ã€‚ç¬¬ä¸‰ç§æ–¹æ¡ˆå¯ä»¥çœ‹åšæ˜¯ä¼ ç»Ÿå·ç§¯çš„æ”¹å–„ï¼Œå°†å…¶ä¸­çš„æŸäº›é€šé“è®¾ç½®ä¸º3x3ï¼Œå…¶ä»–é€šé“è®¾ç½®ä¸º1x1å·ç§¯ã€‚</li><li>å¸¸è§çš„å¤šå°ºåº¦çš„è·å–æ–¹å¼ï¼š<ul><li>ç»†ç²’åº¦å·ç§¯(res2netæ–¹å¼)</li><li>NIN(ä¾‹å¦‚ Inception æ ·å¼çš„å·ç§¯ä¹Ÿå¯ä»¥)</li><li>å¤šå°ºåº¦å›¾åƒè¾“å‡º(å›¾åƒé‡‘å­—å¡”)</li><li>ç‰¹å¾å¤šå°ºåº¦(èåˆå¤šä¸ªå°ºåº¦çš„ç‰¹å¾å›¾ï¼šFPNç½‘ç»œ)</li><li>ç©ºé—´é‡‘å­—å¡”æ± åŒ–(Spatial Pyramid Pooling)</li></ul></li></ol>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>receptive_size_and_anchor_design</title>
    <link href="/2019/04/21/receptive-size-and-anchor-design/"/>
    <url>/2019/04/21/receptive-size-and-anchor-design/</url>
    
    <content type="html"><![CDATA[<p>octave conv(octconv)ã€hetconvã€res2net</p><a id="more"></a><h3 id="1-æ„Ÿå—é‡çš„è®¡ç®—ï¼š"><a href="#1-æ„Ÿå—é‡çš„è®¡ç®—ï¼š" class="headerlink" title="1. æ„Ÿå—é‡çš„è®¡ç®—ï¼š"></a>1. æ„Ÿå—é‡çš„è®¡ç®—ï¼š</h3><pre><code class="hljs python"><span class="hljs-comment"># [kernel_size, stride, padding]</span>convnet =   [[<span class="hljs-number">11</span>,<span class="hljs-number">4</span>,<span class="hljs-number">0</span>], [<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>], [<span class="hljs-number">5</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>], [<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>], [<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>], [<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>], [<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>], [<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>]]layer_names = [<span class="hljs-string">&#x27;conv1&#x27;</span>,<span class="hljs-string">&#x27;pool1&#x27;</span>,<span class="hljs-string">&#x27;conv2&#x27;</span>,<span class="hljs-string">&#x27;pool2&#x27;</span>,<span class="hljs-string">&#x27;conv3&#x27;</span>,<span class="hljs-string">&#x27;conv4&#x27;</span>,<span class="hljs-string">&#x27;conv5&#x27;</span>,<span class="hljs-string">&#x27;pool5&#x27;</span>]input image: receptive size: <span class="hljs-number">1</span> conv1: receptive size: <span class="hljs-number">11</span>  pool1: receptive size: <span class="hljs-number">19</span>  conv2: receptive size: <span class="hljs-number">51</span>pool2: receptive size: <span class="hljs-number">67</span>conv3: receptive size: <span class="hljs-number">99</span>conv4: receptive size: <span class="hljs-number">131</span>conv5: receptive size: <span class="hljs-number">163</span>pool5: receptive size: <span class="hljs-number">195</span></code></pre><h5 id="1-åå‘æ¨å¯¼ï¼š"><a href="#1-åå‘æ¨å¯¼ï¼š" class="headerlink" title="(1) åå‘æ¨å¯¼ï¼š"></a>(1) <strong>åå‘æ¨å¯¼</strong>ï¼š</h5><ul><li>åˆå§‹(æœ€å) $feature map$ å±‚çš„æ„Ÿå—é‡æ˜¯1ã€‚</li><li>æ¯ç»è¿‡ä¸€å±‚ kernel<em>sizeä¸º k, æ­¥é•¿ä¸º sçš„å·ç§¯/æ± åŒ–å±‚ï¼Œæ„Ÿå—é‡ $r</em>{l} = r \times s + (k-s) = (r_{l+1} -1) \times s + k$ ã€‚</li><li>ç»è¿‡å¤šåˆ†æ”¯çš„è·¯å¾„ï¼ŒæŒ‰ç…§æ„Ÿå—é‡æœ€å¤§æ”¯è·¯è®¡ç®—ã€‚</li><li>ä¸ä¼šæ”¹å˜æ„Ÿå—é‡çš„æƒ…å†µ: conv1x1 s1ã€ReLUã€BNã€dropoutã€shotcutç­‰å…ƒç´ çº§æ“ä½œã€‚</li><li>ç»è¿‡FCå±‚å’ŒGobal Ave Pooling å±‚ï¼Œæ„Ÿå—é‡å°±æ˜¯æ•´ä¸ªè¾“å…¥å›¾åƒã€‚</li></ul><pre><code class="hljs angelscript">ä»¥ pool5 ä¸ºä¾‹ï¼šPool5: (<span class="hljs-number">1</span><span class="hljs-number">-1</span>)*<span class="hljs-number">2</span> + <span class="hljs-number">3</span> = <span class="hljs-number">3</span>Conv5: (<span class="hljs-number">3</span><span class="hljs-number">-1</span>)*<span class="hljs-number">1</span> + <span class="hljs-number">3</span> = <span class="hljs-number">5</span>Conv4: (<span class="hljs-number">5</span><span class="hljs-number">-1</span>)*<span class="hljs-number">1</span> + <span class="hljs-number">3</span> =  <span class="hljs-number">7</span>Conv3:(<span class="hljs-number">7</span><span class="hljs-number">-1</span>)*<span class="hljs-number">1</span> + <span class="hljs-number">3</span> = <span class="hljs-number">9</span>pool2: (<span class="hljs-number">9</span><span class="hljs-number">-1</span>)*<span class="hljs-number">2</span> + <span class="hljs-number">3</span> = <span class="hljs-number">19</span>Conv2: (<span class="hljs-number">19</span><span class="hljs-number">-1</span>)*<span class="hljs-number">1</span> + <span class="hljs-number">5</span>  = <span class="hljs-number">23</span>Pool1ï¼š (<span class="hljs-number">23</span><span class="hljs-number">-1</span>)*<span class="hljs-number">2</span> + <span class="hljs-number">3</span> = <span class="hljs-number">47</span>Conv1: (<span class="hljs-number">47</span><span class="hljs-number">-1</span>)*<span class="hljs-number">4</span> + <span class="hljs-number">11</span> = <span class="hljs-number">195</span></code></pre><h5 id="2-æ­£å‘æ¨å¯¼"><a href="#2-æ­£å‘æ¨å¯¼" class="headerlink" title="(2) æ­£å‘æ¨å¯¼"></a>(2) æ­£å‘æ¨å¯¼</h5><p>å’Œåå‘æ¨å¯¼ç›¸ä¼¼ï¼Œ $s_0 = 1$,  $feature_map$ çš„æ„Ÿå—é‡ä¸º1ã€‚</p><script type="math/tex; mode=display">\begin{eqnarray}&& r_{l+1} = r_l + (k-1) * s_l \\&& s_{l+1} = s_{l} * s \\\end{eqnarray}</script><pre><code class="hljs python">ä»¥ pool5 ä¸ºä¾‹ï¼šConv1: <span class="hljs-number">1</span> + (<span class="hljs-number">11</span><span class="hljs-number">-1</span>)*<span class="hljs-number">1</span> =  <span class="hljs-number">11</span>, s1=<span class="hljs-number">1</span>*<span class="hljs-number">4</span>=<span class="hljs-number">4</span>   <span class="hljs-comment"># [11,4,0]</span>Pool1: <span class="hljs-number">11</span> + (<span class="hljs-number">3</span><span class="hljs-number">-1</span>)*<span class="hljs-number">4</span> = <span class="hljs-number">19</span>, s2=<span class="hljs-number">4</span>*<span class="hljs-number">2</span>=<span class="hljs-number">8</span>   <span class="hljs-comment"># [3,2,0]</span>Conv2: <span class="hljs-number">19</span> + (<span class="hljs-number">5</span><span class="hljs-number">-1</span>)*<span class="hljs-number">8</span> = <span class="hljs-number">51</span>, s3=<span class="hljs-number">8</span>*<span class="hljs-number">1</span>=<span class="hljs-number">8</span>  <span class="hljs-comment"># [5,1,2]</span>pool2: <span class="hljs-number">51</span> + (<span class="hljs-number">3</span><span class="hljs-number">-1</span>)*<span class="hljs-number">8</span> = <span class="hljs-number">67</span>, s4=<span class="hljs-number">8</span>*<span class="hljs-number">2</span>=<span class="hljs-number">16</span> <span class="hljs-comment"># [3,2,0]</span>Conv3: <span class="hljs-number">67</span> + (<span class="hljs-number">3</span><span class="hljs-number">-1</span>)*<span class="hljs-number">16</span> = <span class="hljs-number">99</span>, s5=<span class="hljs-number">16</span>*<span class="hljs-number">1</span>=<span class="hljs-number">16</span>  <span class="hljs-comment"># [3ï¼Œ1ï¼Œ1]</span>Conv4: <span class="hljs-number">99</span> + (<span class="hljs-number">3</span><span class="hljs-number">-1</span>)*<span class="hljs-number">16</span> = <span class="hljs-number">131</span>ï¼Œ s6=<span class="hljs-number">16</span>*<span class="hljs-number">1</span>=<span class="hljs-number">16</span> <span class="hljs-comment"># [3ï¼Œ1ï¼Œ1]</span>Conv5: <span class="hljs-number">131</span> + (<span class="hljs-number">3</span><span class="hljs-number">-1</span>)*<span class="hljs-number">16</span> = <span class="hljs-number">163</span>, s7=<span class="hljs-number">16</span>*<span class="hljs-number">1</span>=<span class="hljs-number">16</span> <span class="hljs-comment"># [3, 1, 1]</span>Pool5: <span class="hljs-number">163</span> + (<span class="hljs-number">3</span><span class="hljs-number">-1</span>)*<span class="hljs-number">16</span> = <span class="hljs-number">195</span>, s8=<span class="hljs-number">16</span>*<span class="hljs-number">2</span>=<span class="hljs-number">32</span> <span class="hljs-comment"># [3, 2, 0]</span></code></pre><p>[<a href="https://medium.com/mlreview/a-guide-to-receptive-field-arithmetic-for-convolutional-neural-networks-e0f514068807">https://medium.com/mlreview/a-guide-to-receptive-field-arithmetic-for-convolutional-neural-networks-e0f514068807</a>]</p><p>[<a href="https://fomoro.com/projects/project/receptive-field-calculator">https://fomoro.com/projects/project/receptive-field-calculator</a>]</p><h3 id="2-å·ç§¯çš„æœ‰æ•ˆæ„Ÿå—é‡"><a href="#2-å·ç§¯çš„æœ‰æ•ˆæ„Ÿå—é‡" class="headerlink" title="2. å·ç§¯çš„æœ‰æ•ˆæ„Ÿå—é‡"></a>2. å·ç§¯çš„æœ‰æ•ˆæ„Ÿå—é‡</h3><p>ä¸Šæ–‡æ‰€è¿°çš„æ˜¯ç†è®ºæ„Ÿå—é‡ï¼Œè€Œç‰¹å¾çš„æœ‰æ•ˆæ„Ÿå—é‡ï¼ˆå®é™…èµ·ä½œç”¨çš„æ„Ÿå—é‡ï¼‰å®é™…ä¸Šæ˜¯è¿œå°äºç†è®ºæ„Ÿå—é‡çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å…·ä½“æ•°å­¦åˆ†ææ¯”è¾ƒå¤æ‚ï¼Œä¸å†èµ˜è¿°ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥å‚è€ƒè®ºæ–‡ [Understanding the Effective Receptive Field in Deep Convolutional Neural Networks]ã€‚</p><p><img src="/2019/04/21/receptive-size-and-anchor-design/effective_receptive.jpg" alt="æœ‰æ•ˆæ„Ÿå—é‡ç¤ºä¾‹"></p><p>â€‹    ä¸‹é¢æˆ‘ä»ç›´è§‚ä¸Šè§£é‡Šä¸€ä¸‹æœ‰æ•ˆæ„Ÿå—é‡èƒŒåçš„åŸå› ã€‚ä»¥ä¸€ä¸ªä¸¤å±‚ <img src="https://www.zhihu.com/equation?tex=kernel%5C_size%3D3" alt="kernel\_size=3">ï¼Œ <img src="https://www.zhihu.com/equation?tex=stride%3D1" alt="stride=1">çš„ç½‘ç»œä¸ºä¾‹ï¼Œè¯¥ç½‘ç»œçš„ç†è®ºæ„Ÿå—é‡ä¸º5ï¼Œè®¡ç®—æµç¨‹å¯ä»¥å‚åŠ ä¸‹å›¾ã€‚å…¶ä¸­ <img src="https://www.zhihu.com/equation?tex=x" alt="x"> ä¸ºè¾“å…¥ï¼Œ <img src="https://www.zhihu.com/equation?tex=w" alt="w"> ä¸ºå·ç§¯æƒé‡ï¼Œ <img src="https://www.zhihu.com/equation?tex=o" alt="o"> ä¸ºç»è¿‡å·ç§¯åçš„è¾“å‡ºç‰¹å¾ã€‚</p><p>â€‹    å¾ˆå®¹æ˜“å¯ä»¥å‘ç°ï¼Œ <img src="https://www.zhihu.com/equation?tex=x_%7B1%2C1%7D" alt="x_{1,1}"> åªå½±å“ç¬¬ä¸€å±‚feature mapä¸­çš„ <img src="https://www.zhihu.com/equation?tex=o_%7B1%2C1%7D%5E1" alt="o_{1,1}^1"> ï¼›è€Œ <img src="https://www.zhihu.com/equation?tex=x_%7B3%2C3%7D" alt="x_{3,3}"> ä¼šå½±å“ç¬¬ä¸€å±‚feature mapä¸­çš„æ‰€æœ‰ç‰¹å¾ï¼Œå³ <img src="https://www.zhihu.com/equation?tex=o_%7B1%2C1%7D%5E1%2Co_%7B1%2C2%7D%5E1%2Co_%7B1%2C3%7D%5E1%2Co_%7B2%2C1%7D%5E1%2Co_%7B2%2C2%7D%5E1%2Co_%7B2%2C3%7D%5E1%2Co_%7B3%2C1%7D%5E1%2Co_%7B3%2C2%7D%5E1%2Co_%7B3%2C3%7D%5E1" alt="o_{1,1}^1,o_{1,2}^1,o_{1,3}^1,o_{2,1}^1,o_{2,2}^1,o_{2,3}^1,o_{3,1}^1,o_{3,2}^1,o_{3,3}^1"> ã€‚ç¬¬ä¸€å±‚çš„è¾“å‡ºå…¨éƒ¨ä¼šå½±å“ç¬¬äºŒå±‚çš„ <img src="https://www.zhihu.com/equation?tex=o_%7B1%2C1%7D%5E2" alt="o_{1,1}^2"> ã€‚äºæ˜¯ <img src="https://www.zhihu.com/equation?tex=x_%7B1%2C1%7D" alt="x_{1,1}"> åªèƒ½é€šè¿‡ <img src="https://www.zhihu.com/equation?tex=o_%7B1%2C1%7D%5E1" alt="o_{1,1}^1"> æ¥å½±å“ <img src="https://www.zhihu.com/equation?tex=o_%7B1%2C1%7D%5E2" alt="o_{1,1}^2"> ï¼›è€Œ <img src="https://www.zhihu.com/equation?tex=x_%7B3%2C3%7D" alt="x_{3,3}"> èƒ½é€šè¿‡ <img src="https://www.zhihu.com/equation?tex=o_%7B1%2C1%7D%5E1%2Co_%7B1%2C2%7D%5E1%2Co_%7B1%2C3%7D%5E1%2Co_%7B2%2C1%7D%5E1%2Co_%7B2%2C2%7D%5E1%2Co_%7B2%2C3%7D%5E1%2Co_%7B3%2C1%7D%5E1%2Co_%7B3%2C2%7D%5E1%2Co_%7B3%2C3%7D%5E1" alt="o_{1,1}^1,o_{1,2}^1,o_{1,3}^1,o_{2,1}^1,o_{2,2}^1,o_{2,3}^1,o_{3,1}^1,o_{3,2}^1,o_{3,3}^1"> æ¥å½±å“ <img src="https://www.zhihu.com/equation?tex=o_%7B1%2C1%7D%5E2" alt="o_{1,1}^2"> ã€‚æ˜¾è€Œæ˜“è§ï¼Œè™½ç„¶ <img src="https://www.zhihu.com/equation?tex=x_%7B1%2C1%7D" alt="x_{1,1}"> å’Œ <img src="https://www.zhihu.com/equation?tex=x_%7B3%2C3%7D" alt="x_{3,3}"> éƒ½ä½äºç¬¬äºŒå±‚ç‰¹å¾æ„Ÿå—é‡å†…ï¼Œä½†æ˜¯äºŒè€…å¯¹æœ€åçš„ç‰¹å¾ <img src="https://www.zhihu.com/equation?tex=o_%7B1%2C1%7D%5E2" alt="o_{1,1}^2"> çš„å½±å“å´å¤§ä¸ç›¸åŒï¼Œè¾“å…¥ä¸­è¶Šé æ„Ÿå—é‡ä¸­é—´çš„å…ƒç´ å¯¹ç‰¹å¾çš„è´¡çŒ®è¶Šå¤§ã€‚</p><p><img src="/2019/04/21/receptive-size-and-anchor-design/123.png" alt></p><h3 id="3-anchor-è®¾è®¡åŸåˆ™ï¼š"><a href="#3-anchor-è®¾è®¡åŸåˆ™ï¼š" class="headerlink" title="3. anchor è®¾è®¡åŸåˆ™ï¼š"></a>3. anchor è®¾è®¡åŸåˆ™ï¼š</h3><p>anchorçš„æœ¬è´¨æ˜¯ç‰¹å¾å±‚çš„mapï¼Œè¿™å’Œä¼ ç»Ÿcvä¸­çš„æ»‘åŠ¨çª—å£å¹¶æ— äºŒè‡´ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç”Ÿæˆæ›´å¥½çš„çª—å£å»åŒ¹é…bboxã€‚faster rcnn æ˜¯é€šè¿‡CNN æ¥è‡ªåŠ¨ç”Ÿæˆ anchorï¼Œåˆ©ç”¨äº† CNN è‡ªåŠ¨æå–ç‰¹å¾çš„èƒ½åŠ›ã€‚</p><p>anchor è®¾è®¡åŸåˆ™ï¼š</p><p>(1) anchor çš„å°ºå¯¸ã€é•¿å®½æ¯”ã€ä½ç½®éƒ½åº”è¯¥ match æºæ•°æ®ä¸­çš„bboxã€‚ä¸€ç§æ–¹æ³•æ˜¯é’ˆå¯¹ç‰¹å®šæ•°æ®é›†è®¾è®¡anchorï¼Œå¦‚YOLOv2ä¸­çš„èšç±»ï¼Œå’Œè¿‘æœŸæœ‰è®ºæ–‡CNNè®­ç»ƒanchorçš„è®¾ç½®ï¼Œè¿™äº›æ–¹æ³•æˆ–è®¸æ›´é€‚åˆæŸä¸€æ•°æ®é›†ï¼Œä½†ä¹Ÿå¯èƒ½å½±å“æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼Œæ¢ä¸€ä¸ªåº“æ˜¯å¦ä¾ç„¶å¤Ÿç”¨ã€‚</p><p>(2) anchor çš„ size å¿…é¡»å°äºæ„Ÿå—é‡</p><p>(3) ä¸åŒsizeçš„anchoråº”å½“å…·æœ‰ç›¸åŒçš„ç©ºé—´å¯†åº¦åˆ†å¸ƒã€‚å¯†åº¦ä¸€è‡´çš„è¯ï¼Œè¦æ±‚ anchor/stride ä¸ºä¸€ä¸ªå®šå€¼ã€‚</p><p>ä¸‹é¢ä»¥äººè„¸æ£€æµ‹ä¸ºä¾‹ï¼Œæ¥åˆ†æ anchor çš„è®¾è®¡ï¼š</p><p>ï¼ˆ1ï¼‰MSFD ä¸­é€šè¿‡åˆ†æ WIDER Face ä¸­äººè„¸çš„èŒƒå›´ï¼Œè¿›è€Œå°† anchor çš„å°ºå¯¸è®¾å®šä¸º </p><p>16/32/64/128/256/512 è¿™äº›èŒƒå›´ï¼Œä»è€Œè¦†ç›–ä¸åŒå°ºå¯¸çš„äººè„¸ã€‚anchorsâ€™ aspect ratio åˆ™è®¾å®šä¸º1: 1.5 ã€‚è¿™æ˜¯è€ƒè™‘åˆ°äººè„¸çš„å½¢çŠ¶å®½é«˜æ¯”ä¸º 1.5 è¿™ä¸€äº‹å®ã€‚</p><p>(2) S3FD ä¸­æå‡ºçš„ä¸¤æ¡è®¾è®¡åŸåˆ™ã€‚æˆ‘ä»¬çœ‹åˆ° anchor å°äºæ„Ÿå—é‡ï¼Œå¤§çº¦ä¸ºæ„Ÿå—é‡çš„ 1/4ï¼Œ stride åˆ™å‡ä¸º anchor çš„ 1/4ã€‚è¿™ä¿è¯äº†anchor çš„å¯†åº¦ä¸€è‡´ã€‚</p><p><img src="/2019/04/21/receptive-size-and-anchor-design/rf.png" alt></p><p>æˆ‘ä»¬æ¥çœ‹Faceboxesä¸­çš„anchor è®¾è®¡ï¼š</p><p><img src="/2019/04/21/receptive-size-and-anchor-design/anchor.png" alt></p><p>è¿™é‡Œ 32 å’Œ 64 çš„anchor å¯†åº¦ä¸º1å’Œ2ï¼Œå°äºå…¶ä»–çš„å¯†åº¦4ï¼Œæ‰€ä»¥é€šè¿‡å¯¹ 32 å¤åˆ¶4æ¬¡ï¼Œå¯¹64 å¤åˆ¶ä¸¤æ¬¡æ¥ä½¿anchor å¯†åº¦ä¸€è‡´ã€‚</p><p>[1]SSD:Single Shot MultiBox Detector</p><p>[2] YOLOv3: An Incremental Improvement</p><p>[3]FPN: feature pyramid networks for object detection </p><p>[4] A practical theory for designing very deep convolutional neural networks</p><p>[5] S3FD: Single Shot Scale-invariant Face Detector</p><p>[6] FaceBoxes: A CPU Real-time Face Detector with High Accuracy</p><p>[7] <a href="https://medium.com/@andersasac/anchor-boxes-the-key-to-quality-object-detection-ddf9d612d4f9">https://medium.com/@andersasac/anchor-boxes-the-key-to-quality-object-detection-ddf9d612d4f9</a></p><p>[8] <a href="https://www.reddit.com/r/MachineLearning/comments/7giwk1/d_is_anchor_necessary_for_object_detection/">https://www.reddit.com/r/MachineLearning/comments/7giwk1/d_is_anchor_necessary_for_object_detection/</a></p><p>[9] <a href="https://zhuanlan.zhihu.com/p/55824651">https://zhuanlan.zhihu.com/p/55824651</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>GCN</title>
    <link href="/2019/04/20/GCN/"/>
    <url>/2019/04/20/GCN/</url>
    
    <content type="html"><![CDATA[<p>GCN tutorial</p><a id="more"></a><h4 id="1-åŸºæœ¬çš„ä¼ æ’­è§„åˆ™"><a href="#1-åŸºæœ¬çš„ä¼ æ’­è§„åˆ™" class="headerlink" title="1. åŸºæœ¬çš„ä¼ æ’­è§„åˆ™"></a>1. åŸºæœ¬çš„ä¼ æ’­è§„åˆ™</h4><p><img src="/2019/04/20/GCN/1.png" alt></p><p>åœ¨å¼€å§‹å‰å…ˆè¯´æ˜å‡ ä¸ªç¬¦å·çš„å«ä¹‰ï¼š</p><ol><li>$N = 1,2,3,â€¦,n$ ä»£è¡¨æ‰€æœ‰èŠ‚ç‚¹ã€‚</li><li>$X$ ä»£è¡¨æ‰€æœ‰èŠ‚ç‚¹çš„ç‰¹å¾ï¼Œ å…¶ä¸­  $X_i$ ä»£è¡¨èŠ‚ç‚¹ $i$ çš„ç‰¹å¾ã€‚</li><li>$A$  ä»£è¡¨é‚»æ¥çŸ©é˜µï¼Œå…¶ä¸­ $A_{ij}$ ä»£è¡¨èŠ‚ç‚¹ $i$ å’Œ èŠ‚ç‚¹ $j$ ä¹‹é—´çš„è¾¹çš„æƒï¼Œ å¦‚æœæ— æƒå›¾åˆ™ä¸º 0 æˆ–è€… 1ã€‚</li></ol><h5 id="1-ç®€å•ä¼ æ’­ï¼ˆå¹³å‡ï¼‰ï¼š"><a href="#1-ç®€å•ä¼ æ’­ï¼ˆå¹³å‡ï¼‰ï¼š" class="headerlink" title="1. ç®€å•ä¼ æ’­ï¼ˆå¹³å‡ï¼‰ï¼š"></a>1. ç®€å•ä¼ æ’­ï¼ˆå¹³å‡ï¼‰ï¼š</h5><script type="math/tex; mode=display">f(Xï¼ŒA) = AX</script><p>ç®€å•ä¼ æ’­çš„é—®é¢˜ï¼š</p><ul><li>èŠ‚ç‚¹çš„èšåˆè¡¨å¾ä¸åŒ…å«å®ƒè‡ªå·±çš„ç‰¹å¾ï¼</li><li>åº¦å¤§çš„èŠ‚ç‚¹åœ¨å…¶ç‰¹å¾è¡¨å¾ä¸­å°†å…·æœ‰è¾ƒå¤§çš„å€¼ï¼Œåº¦å°çš„èŠ‚ç‚¹å°†å…·æœ‰è¾ƒå°çš„å€¼ã€‚</li></ul><h5 id="2-å¢åŠ è‡ªç¯"><a href="#2-å¢åŠ è‡ªç¯" class="headerlink" title="2. å¢åŠ è‡ªç¯"></a>2. å¢åŠ è‡ªç¯</h5><script type="math/tex; mode=display">f(Xï¼ŒA) = (A+I)X</script><h5 id="3-ç‰¹å¾å½’ä¸€åŒ–å¤„ç†"><a href="#3-ç‰¹å¾å½’ä¸€åŒ–å¤„ç†" class="headerlink" title="3. ç‰¹å¾å½’ä¸€åŒ–å¤„ç†"></a>3. ç‰¹å¾å½’ä¸€åŒ–å¤„ç†</h5><script type="math/tex; mode=display">f(Xï¼ŒA) =  D^{-1}(A+I)X</script><h5 id="4-å¯¹ç§°å½’ä¸€åŒ–å¤„ç†"><a href="#4-å¯¹ç§°å½’ä¸€åŒ–å¤„ç†" class="headerlink" title="4. å¯¹ç§°å½’ä¸€åŒ–å¤„ç†"></a>4. å¯¹ç§°å½’ä¸€åŒ–å¤„ç†</h5><script type="math/tex; mode=display">f(Xï¼ŒA) = D^{-0.5}(A+I)D^{-0.5}X</script><h5 id="5-å¢åŠ æƒé‡"><a href="#5-å¢åŠ æƒé‡" class="headerlink" title="5. å¢åŠ æƒé‡"></a>5. å¢åŠ æƒé‡</h5><script type="math/tex; mode=display">f(Xï¼ŒA) = D^{-0.5}(A+I)D^{-0.5}X W</script><h5 id="6-æ·»åŠ -æ¿€æ´»å‡½æ•°"><a href="#6-æ·»åŠ -æ¿€æ´»å‡½æ•°" class="headerlink" title="6. æ·»åŠ  æ¿€æ´»å‡½æ•°"></a>6. æ·»åŠ  æ¿€æ´»å‡½æ•°</h5><script type="math/tex; mode=display">f(Xï¼ŒA) = \sigma (D^{-0.5}(A+I)D^{-0.5}XW)</script><h4 id="2-GCN-å¯ä»¥åšä»€ä¹ˆï¼Ÿ"><a href="#2-GCN-å¯ä»¥åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="2. GCN å¯ä»¥åšä»€ä¹ˆï¼Ÿ"></a>2. GCN å¯ä»¥åšä»€ä¹ˆï¼Ÿ</h4><h5 id="ï¼ˆ1ï¼‰-ç»“ç‚¹åˆ†ç±»ï¼ˆNode-classificationï¼‰"><a href="#ï¼ˆ1ï¼‰-ç»“ç‚¹åˆ†ç±»ï¼ˆNode-classificationï¼‰" class="headerlink" title="ï¼ˆ1ï¼‰ ç»“ç‚¹åˆ†ç±»ï¼ˆNode classificationï¼‰"></a>ï¼ˆ1ï¼‰ ç»“ç‚¹åˆ†ç±»ï¼ˆNode classificationï¼‰</h5><h5 id="ï¼ˆ2ï¼‰-å›¾åˆ†ç±»ï¼ˆGraph-classificationï¼‰"><a href="#ï¼ˆ2ï¼‰-å›¾åˆ†ç±»ï¼ˆGraph-classificationï¼‰" class="headerlink" title="ï¼ˆ2ï¼‰ å›¾åˆ†ç±»ï¼ˆGraph classificationï¼‰"></a>ï¼ˆ2ï¼‰ å›¾åˆ†ç±»ï¼ˆGraph classificationï¼‰</h5><h5 id="ï¼ˆ3ï¼‰è¿æ¥é¢„æµ‹ï¼ˆLink-prediction-ï¼‰"><a href="#ï¼ˆ3ï¼‰è¿æ¥é¢„æµ‹ï¼ˆLink-prediction-ï¼‰" class="headerlink" title="ï¼ˆ3ï¼‰è¿æ¥é¢„æµ‹ï¼ˆLink prediction ï¼‰"></a>ï¼ˆ3ï¼‰è¿æ¥é¢„æµ‹ï¼ˆLink prediction ï¼‰</h5><p><img src="/2019/04/20/GCN/2.png" alt></p><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ol><li><a href="https://tkipf.github.io/graph-convolutional-networks">https://tkipf.github.io/graph-convolutional-networks</a></li><li></li></ol>]]></content>
    
    
    <categories>
      
      <category>æ¢ç´¢</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>awesome-face</title>
    <link href="/2019/04/18/awesome-face/"/>
    <url>/2019/04/18/awesome-face/</url>
    
    <content type="html"><![CDATA[<p>my GitHub project awesome-face: face algorithmã€source codeã€datasetsã€conf/workshop/trans</p><a id="more"></a><h1 id="awesome-face"><a href="#awesome-face" class="headerlink" title="awesome-face"></a>awesome-face</h1><p>ğŸ”¥  face releated algorithm, datasets and papers  ğŸ¤”</p><h2 id="ğŸ“-Paper-Algorithm"><a href="#ğŸ“-Paper-Algorithm" class="headerlink" title="ğŸ“ Paper / Algorithm"></a>ğŸ“ Paper / Algorithm</h2><h4 id="2D-Face-Recognition"><a href="#2D-Face-Recognition" class="headerlink" title="2D- Face Recognition"></a>2D- Face Recognition</h4><p><img src="/2019/04/18/awesome-face/face_reg.png" alt="2d_face_reg"></p><p><strong>[1] DeepID1</strong>  <a href="https://www.cv-foundation.org/openaccess/content_cvpr_2014/papers/Sun_Deep_Learning_Face_2014_CVPR_paper.pdf"><strong>[paper]</strong></a> </p><p>Deep Learning Face Representation from Predicting 10,000 Classes</p><p><strong>[2] DeepID2</strong>  <a href="https://arxiv.org/abs/1406.4773"><strong>[paper]</strong></a> </p><p>Deep Learning Face Representation by Joint Identification-Verification</p><p><strong>[3] DeepID2+</strong>  <a href="https://arxiv.org/abs/1412.1265"><strong>[paper]</strong></a></p><p>Deeply learned face representations are sparse, selective, and robust</p><p><strong>[4] DeepIDv3</strong>  <a href="https://arxiv.org/abs/1502.00873"><strong>[paper]</strong></a> </p><p>DeepID3: Face Recognition with Very Deep Neural Networks</p><p><strong>[5] Deep Face</strong> <a href="https://www.robots.ox.ac.uk/~vgg/publications/2015/Parkhi15/parkhi15.pdf"><strong>[paper]</strong></a> </p><p>Deep Face Recognition</p><p><strong>[6] Center Loss</strong> <a href="http://ydwen.github.io/papers/WenECCV16.pdf"><strong>[paper]</strong></a>    <a href="https://github.com/ydwen/caffe-face"><strong>[code]</strong></a></p><p>A Discriminative Feature Learning Approach for Deep Face Recognition</p><p><strong>[7]Marginal loss</strong> <a href="https://www.computer.org/csdl/proceedings-article/cvprw/2017/0733c006/12OmNzayNCT"><strong>[paper]</strong></a></p><p>Marginal loss for deep face recognition</p><p><strong>[8] Range Loss</strong><a href="https://arxiv.org/abs/1611.08976"><strong>[paper]</strong></a> </p><p>Range Loss for Deep Face Recognition with Long-tail</p><p><strong>[9]Contrastive Loss</strong> <a href="https://arxiv.org/abs/1406.4773"><strong>[paper]</strong></a></p><p>Deep learning face representation by joint identification-verification</p><p><strong>[10] FaceNet</strong>   <a href="https://arxiv.org/abs/1503.03832"><strong>[paper]</strong></a>   <a href="https://github.com/davidsandberg/facenet">[<strong>third-party implemention</strong>]</a></p><p>FaceNet: A Unified Embedding for Face Recognition and Clustering</p><p><strong>[11] NormFace</strong>  <a href="https://arxiv.org/pdf/1704.06369.pdf"><strong>[paper]</strong></a>    <a href="https://github.com/happynear/NormFace"><strong>[code]</strong></a></p><p>NormFace: L2 Hypersphere Embedding for Face Verification</p><p><strong>[12] COCO Loss:</strong>    <a href="https://arxiv.org/pdf/1710.00870.pdf"><strong>[paper]</strong></a>   <a href="https://github.com/sciencefans/coco_loss">[<strong>code</strong>]</a></p><p>Rethinking Feature Discrimination and Polymerization for Large-scale Recognition</p><p><strong>[13] Large-Margin Softmax Loss</strong>  <a href="https://arxiv.org/pdf/1612.02295.pdf"><strong>[paper]</strong></a>  <a href="https://github.com/wy1iu/LargeMargin_Softmax_Loss">[<strong>code</strong>]</a></p><p>Large-Margin Softmax Loss for Convolutional Neural Networks(L-Softmax loss)</p><p><strong>[14]SphereFaceï¼š</strong>  <strong>A-Softmax</strong>   <a href="https://arxiv.org/abs/1704.08063"><strong>[paper]</strong></a>  <a href="https://github.com/wy1iu/sphereface">[<strong>code</strong>]</a></p><p>SphereFace: Deep Hypersphere Embedding for Face Recognition</p><p><strong>[15]AM-Softmax/cosFace</strong>     <a href="https://arxiv.org/pdf/1801.05599.pdf"><strong>[paper AM-Softmax]</strong></a>       <a href="https://arxiv.org/pdf/1801.09414.pdf"><strong>[paper cosFace]</strong></a>        <a href="https://github.com/happynear/AMSoftmax">[<strong>AM-softmax code</strong>]</a></p><p>AM : Additive Margin Softmax for Face Verification</p><p>CosFace: Large Margin Cosine Loss for Deep Face Recognition(Tencent AI Lab)</p><p><strong>[16] ArcFace:</strong>  <a href="https://arxiv.org/pdf/1801.07698.pdf"><strong>[paper]</strong></a>  <a href="https://github.com/deepinsight/insightface"><strong>[code]</strong></a></p><p>ArcFace: Additive Angular Margin Loss for Deep Face Recognition</p><p><img src="/2019/04/18/awesome-face/cos_loss.png" alt="cos_loss"></p><h4 id="Face-Detection"><a href="#Face-Detection" class="headerlink" title="Face Detection"></a>Face Detection</h4><p><img src="/2019/04/18/awesome-face/face_detection.png" alt></p><p><strong>[1] Cascade CNN</strong>  <a href="https://ieeexplore.ieee.org/document/7299170/"><strong>[paper]</strong></a>   <a href="https://github.com/anson0910/CNN_face_detection"><strong>[code]</strong></a>    </p><p>A Convolutional Neural Network Cascade for Face Detection</p><p><strong>[2] MTCNN</strong>   <a href="https://kpzhang93.github.io/MTCNN_face_detection_alignment/"><strong>[Paper]</strong></a>    <a href="https://github.com/kpzhang93/MTCNN_face_detection_alignment"><strong>[code]</strong></a>  </p><p>Joint Face Detection and Alignment using Multi-task Cascaded Convolutional Networks</p><p><strong>[3] ICC - CNN</strong>  <a href="https://ieeexplore.ieee.org/document/8237606"><strong>[paper]</strong></a></p><p>Detecting Faces Using Inside Cascaded Contextual CNN</p><p><strong>[4] Face R-CNN</strong>  <a href="https://arxiv.org/pdf/1706.01061.pdf"><strong>[Paper]</strong></a></p><p>Face R-CNN</p><p><strong>[5] Deep-IR</strong><a href="https://arxiv.org/abs/1701.08289"><strong>[Paper]</strong></a></p><p>Face Detection using Deep Learning: An Improved Faster RCNN Approach</p><p><strong>[6] SSH</strong>     <a href="https://arxiv.org/pdf/1708.03979.pdf"><strong>[paper]</strong></a>    <a href="https://github.com/mahyarnajibi/SSH"><strong>[code]</strong></a></p><p>SSH: Single Stage Headless Face Detector</p><p><strong>[7] S3FD</strong>   <a href="https://arxiv.org/abs/1708.05237"><strong>[paper]</strong></a></p><p>Single Shot Scale-invariant Face Detector</p><p><strong>[8] FaceBoxes</strong> <a href="https://arxiv.org/pdf/1708.05234.pdf"><strong>[paper]</strong></a>     <a href="https://github.com/sfzhang15/FaceBoxes"><strong>[code]</strong></a></p><p>Faceboxes: A CPU Real-time Face Detector with High Accuracy</p><p><strong>[9] Scaleface</strong>     <a href="http://cn.arxiv.org/abs/1706.02863"><strong>[paper]</strong></a></p><p>Face Detection through Scale-Friendly Deep Convolutional Networks</p><p><strong>[10] HR</strong>  <a href="https://arxiv.org/abs/1612.04402"><strong>[paper]</strong></a>  <a href="https://github.com/peiyunh/tiny"><strong>[code]</strong></a></p><p>Finding Tiny Faces</p><p><strong>[11] FAN</strong>   <a href="https://arxiv.org/abs/1712.00721"><strong>[paper]</strong></a></p><p>Feature Agglomeration Networks for Single Stage Face Detection.</p><p><strong>[12] PyramidBox</strong>    <a href="https://arxiv.org/abs/1803.07737?context=cs"><strong>[paper]</strong></a> <a href="https://github.com/PaddlePaddle/models/blob/develop/fluid/PaddleCV/face_detection/README_cn.md"><strong>[code]</strong></a></p><p>PyramidBox: A Context-assisted Single Shot Face Detector</p><p><strong>[13] SRN</strong>     <a href="https://arxiv.org/abs/1809.02693"><strong>[paper]</strong></a> </p><p>Selective Refinement Network for High Performance Face Detection.</p><p><strong>[14] DSFD</strong>  <a href="https://arxiv.org/abs/1810.10220"><strong>[paper]</strong></a></p><p>DSFD: Dual Shot Face Detector</p><p><strong>[15] VIM FD</strong> <a href="https://arxiv.org/abs/1901.02350"><strong>[paper]</strong></a></p><p>Robust and High Performance Face Detector</p><p><strong>[16] ISRN</strong>  <a href="https://arxiv.org/abs/1901.06651"><strong>[paper]</strong></a></p><p>Improved Selective Refinement Network for Face Detection</p><h4 id="Face-Alignment"><a href="#Face-Alignment" class="headerlink" title="Face Alignment"></a>Face Alignment</h4><ul><li><a href="https://arxiv.org/abs/1805.10483">Look at Boundary: A Boundary-Aware Face Alignment Algorithm</a>[Wayne Wu al., 2018]</li><li><a href="https://arxiv.org/pdf/1902.10859.pdf">PFLD: A Practical Facial Landmark Detector</a>[Xiaojie Guo al., 2019]</li></ul><h2 id="âš™-Open-source-lib"><a href="#âš™-Open-source-lib" class="headerlink" title="âš™ Open source lib"></a>âš™ Open source lib</h2><h4 id="face-recognition"><a href="#face-recognition" class="headerlink" title="face recognition"></a>face recognition</h4><ul><li><p><a href="https://github.com/ZhaoJ9014/face.evoLVe.PyTorch">face.evoLVe.</a></p></li><li><p><a href="https://github.com/grib0ed0v/face_recognition.pytorch">face_recognition.pytorch</a></p></li><li><a href="https://github.com/deepinsight/insightface">insightface</a></li></ul><h4 id="face-detection"><a href="#face-detection" class="headerlink" title="face detection"></a>face detection</h4><ul><li><a href="https://github.com/ShiqiYu/libfacedetection">libfaccedetection</a></li></ul><h2 id="ğŸ“¦-Datasets"><a href="#ğŸ“¦-Datasets" class="headerlink" title="ğŸ“¦ Datasets"></a>ğŸ“¦ Datasets</h2><h4 id="2D-Face-Recognition-1"><a href="#2D-Face-Recognition-1" class="headerlink" title="2D Face Recognition"></a>2D Face Recognition</h4><div class="table-container"><table><thead><tr><th>Datasets</th><th>Description</th><th>Links</th><th>Publish Time</th></tr></thead><tbody><tr><td><strong>CASIA-WebFace</strong></td><td><strong>10,575</strong> subjects and <strong>494,414</strong> images</td><td><a href="http://www.cbsr.ia.ac.cn/english/CASIA-WebFace-Database.html">Download</a></td><td>2014</td></tr><tr><td><strong>MegaFace</strong>ğŸ…</td><td><strong>1 million</strong> faces, <strong>690K</strong> identities</td><td><a href="http://megaface.cs.washington.edu/">Download</a></td><td>2016</td></tr><tr><td><strong>MS-Celeb-1M</strong>ğŸ…</td><td>about <strong>10M</strong> images for <strong>100K</strong> celebrities   Concrete measurement to evaluate the performance of recognizing one million celebrities</td><td><a href="http://www.msceleb.org">Download</a></td><td>2016</td></tr><tr><td><strong>LFW</strong>ğŸ…</td><td><strong>13,000</strong> images of faces collected from the web. Each face has been labeled with the name of the person pictured.  <strong>1680</strong> of the people pictured have two or more distinct photos in the data set.</td><td><a href="http://vis-www.cs.umass.edu/lfw/">Download</a></td><td>2007</td></tr><tr><td><strong>VGG Face2</strong>ğŸ…</td><td>The dataset contains <strong>3.31 million</strong> images of <strong>9131</strong> subjects (identities), with an average of 362.6 images for each subject.</td><td><a href="http://www.robots.ox.ac.uk/~vgg/data/vgg_face2/">Download</a></td><td>2017</td></tr><tr><td><strong>UMDFaces Dataset-image</strong></td><td><strong>367,888 face annotations</strong> for <strong>8,277 subjects.</strong></td><td><a href="http://www.umdfaces.io">Download</a></td><td>2016</td></tr><tr><td><strong>Trillion Pairs</strong>ğŸ…</td><td>Train: <strong>MS-Celeb-1M-v1c</strong> &amp;  <strong>Asian-Celeb</strong> Test: <strong>ELFW&amp;DELFW</strong></td><td><a href="http://trillionpairs.deepglint.com/overview">Download</a></td><td>2018</td></tr><tr><td><strong>FaceScrub</strong></td><td>It comprises a total of <strong>106,863</strong> face images of male and female <strong>530</strong> celebrities, with about <strong>200 images per person</strong>.</td><td><a href="http://vintage.winklerbros.net/facescrub.html">Download</a></td><td>2014</td></tr><tr><td><strong>Mut1ny</strong>ğŸ…</td><td>head/face segmentation dataset contains over 17.3k labeled images</td><td><a href="http://www.mut1ny.com/face-headsegmentation-dataset">Download</a></td><td>2018</td></tr><tr><td><strong>IMDB-Face</strong></td><td>The dataset contains about 1.7 million faces, 59k identities, which is manually cleaned from 2.0 million raw images.</td><td><a href="https://github.com/fwang91/IMDb-Face">Download</a></td><td>2018</td></tr></tbody></table></div><h4 id="video-face-recognition"><a href="#video-face-recognition" class="headerlink" title="video face recognition"></a>video face recognition</h4><div class="table-container"><table><thead><tr><th>Datasets</th><th>Description</th><th>Links</th><th>Publish Time</th></tr></thead><tbody><tr><td><strong>YouTube Face</strong>ğŸ…</td><td>The data set contains <strong>3,425</strong> videos of <strong>1,595</strong> different people.</td><td><a href="http://www.cs.tau.ac.il/%7Ewolf/ytfaces/">Download</a></td><td>2011</td></tr><tr><td><strong>UMDFaces Dataset-video</strong>ğŸ…</td><td>Over <strong>3.7 million</strong> annotated video frames from over <strong>22,000</strong> videos of <strong>3100 subjects.</strong></td><td><a href="http://www.umdfaces.io">Download</a></td><td>2017</td></tr><tr><td><strong>PaSC</strong></td><td>The challenge includes 9,376 still images and 2,802 videos of 293 people.</td><td><a href="https://www.nist.gov/programs-projects/point-and-shoot-face-recognition-challenge-pasc">Download</a></td><td>2013</td></tr><tr><td><strong>YTC</strong></td><td>The data consists of two parts: video clips (1910 sequences of 47 subjects) and initialization data(initial frame face bounding boxes, manually marked).</td><td><a href="http://seqamlab.com/youtube-celebrities-face-tracking-and-recognition-dataset/">Download</a></td><td>2008</td></tr><tr><td><strong>iQIYI-VID</strong>ğŸ…</td><td>The iQIYI-VID dataset <strong>contains 500,000 videos clips of 5,000 celebrities, adding up to 1000 hours</strong>. This dataset supplies multi-modal cues, including face, cloth, voice, gait, and subtitles, for character identification.</td><td><a href="http://challenge.ai.iqiyi.com/detail?raceId=5b1129e42a360316a898ff4f">Download</a></td><td>2018</td></tr></tbody></table></div><h4 id="3D-face-recognition"><a href="#3D-face-recognition" class="headerlink" title="3D face recognition"></a>3D face recognition</h4><div class="table-container"><table><thead><tr><th>Datasets</th><th>Description</th><th>Links</th><th>Publish Time</th></tr></thead><tbody><tr><td><strong>Bosphorus</strong>ğŸ…</td><td>105 subjects and 4666 faces 2D &amp; 3D face data</td><td><a href="http://bosphorus.ee.boun.edu.tr/default.aspx">Download</a></td><td>2008</td></tr><tr><td><strong>BD-3DFE</strong></td><td>Analyzing <strong>Facial Expressions</strong> in <strong>3D</strong> Space</td><td><a href="http://www.cs.binghamton.edu/~lijun/Research/3DFE/3DFE_Analysis.html">Download</a></td><td>2006</td></tr><tr><td><strong>ND-2006</strong></td><td>422 subjects and 9443 faces 3D Face Recognition</td><td><a href="https://sites.google.com/a/nd.edu/public-cvrl/data-sets">Download</a></td><td>2006</td></tr><tr><td><strong>FRGC V2.0</strong></td><td>466 subjects and 4007 of 3D Face, Visible Face Images</td><td><a href="https://sites.google.com/a/nd.edu/public-cvrl/data-sets">Download</a></td><td>2005</td></tr><tr><td><strong>B3D(AC)^2</strong></td><td><strong>1000</strong> high quality, dynamic <strong>3D scans</strong> of faces, recorded while pronouncing a set of English sentences.</td><td><a href="http://www.vision.ee.ethz.ch/datasets/b3dac2.en.html">Download</a></td><td>2010</td></tr></tbody></table></div><h4 id="Anti-spoofing"><a href="#Anti-spoofing" class="headerlink" title="Anti-spoofing"></a>Anti-spoofing</h4><div class="table-container"><table><thead><tr><th>Datasets</th><th style="text-align:center"># of subj. / # of sess.</th><th>Links</th><th>Year</th><th>Spoof attacks attacks</th><th>Publish Time</th></tr></thead><tbody><tr><td><strong>NUAA</strong></td><td style="text-align:center">15/3</td><td><a href="http://parnec.nuaa.edu.cn/xtan/data/nuaaimposterdb.html">Download</a></td><td>2010</td><td><strong>Print</strong></td><td>2010</td></tr><tr><td><strong>CASIA-MFSD</strong></td><td style="text-align:center">50/3</td><td>Download(link failed)</td><td>2012</td><td><strong>Print, Replay</strong></td><td>2012</td></tr><tr><td><strong>Replay-Attack</strong></td><td style="text-align:center">50/1</td><td><a href="https://www.idiap.ch/dataset/replayattack">Download</a></td><td>2012</td><td><strong>Print, 2 Replay</strong></td><td>2012</td></tr><tr><td><strong>MSU-MFSD</strong></td><td style="text-align:center">35/1</td><td><a href="https://www.cse.msu.edu/rgroups/biometrics/Publications/Databases/MSUMobileFaceSpoofing/index.htm">Download</a></td><td>2015</td><td><strong>Print, 2 Replay</strong></td><td>2015</td></tr><tr><td><strong>MSU-USSA</strong></td><td style="text-align:center">1140/1</td><td><a href="http://biometrics.cse.msu.edu/Publications/Databases/MSU_USSA/">Download</a></td><td>2016</td><td><strong>2 Print, 6 Replay</strong></td><td>2016</td></tr><tr><td><strong>Oulu-NPU</strong></td><td style="text-align:center">55/3</td><td><a href="https://sites.google.com/site/oulunpudatabase/">Download</a></td><td>2017</td><td><strong>2 Print, 6 Replay</strong></td><td>2017</td></tr><tr><td><strong>Siw</strong></td><td style="text-align:center">165/4</td><td><a href="http://cvlab.cse.msu.edu/spoof-in-the-wild-siw-face-anti-spoofing-database.html">Download</a></td><td>2018</td><td><strong>2 Print, 4 Replay</strong></td><td>2018</td></tr></tbody></table></div><h4 id="cross-age-and-cross-pose"><a href="#cross-age-and-cross-pose" class="headerlink" title="cross age and cross pose"></a>cross age and cross pose</h4><div class="table-container"><table><thead><tr><th>Datasets</th><th style="text-align:left">Description</th><th>Links</th><th>Publish Time</th></tr></thead><tbody><tr><td><strong>CACD2000</strong></td><td style="text-align:left">The dataset contains more than 160,000 images of 2,000 celebrities with <strong>age ranging from 16 to 62</strong>.</td><td><a href="http://bcsiriuschen.github.io/CARC/">Download</a></td><td>2014</td></tr><tr><td><strong>FGNet</strong></td><td style="text-align:left">The dataset contains more than 1002 images of 82 people with <strong>age ranging from 0 to 69</strong>.</td><td><a href="http://www-prima.inrialpes.fr/FGnet/html/benchmarks.html">Download</a></td><td>2000</td></tr><tr><td><strong>MPRPH</strong></td><td style="text-align:left">The MORPH database contains <strong>55,000</strong> images of more than <strong>13,000</strong> people within the age ranges of <strong>16</strong> to <strong>77</strong></td><td><a href="http://www.faceaginggroup.com/morph/">Download</a></td><td>2016</td></tr><tr><td><strong>CPLFW</strong></td><td style="text-align:left">we construct a Cross-Pose LFW (CPLFW) which deliberately searches and selects <strong>3,000 positive face pairs</strong> with <strong>pose difference</strong> to add pose variation to intra-class variance.</td><td><a href="http://www.whdeng.cn/cplfw/index.html">Download</a></td><td>2017</td></tr><tr><td><strong>CALFW</strong></td><td style="text-align:left">Thereby we construct a Cross-Age LFW (CALFW) which deliberately searches and selects <strong>3,000 positive face pairs</strong> with <strong>age gaps</strong> to add aging process intra-class variance.</td><td><a href="http://www.whdeng.cn/calfw/index.html">Download</a></td><td>2017</td></tr></tbody></table></div><h4 id="Face-Detection-1"><a href="#Face-Detection-1" class="headerlink" title="Face Detection"></a>Face Detection</h4><div class="table-container"><table><thead><tr><th>Datasets</th><th>Description</th><th>Links</th><th>Publish Time</th></tr></thead><tbody><tr><td><strong>FDDB</strong>ğŸ…</td><td><strong>5171</strong> faces in a set of <strong>2845</strong> images</td><td><a href="http://vis-www.cs.umass.edu/fddb/index.html">Download</a></td><td>2010</td></tr><tr><td><strong>Wider-face</strong> ğŸ…</td><td><strong>32,203</strong> images and label <strong>393,703</strong> faces with a high degree of variability in scale, pose and occlusion, organized based on <strong>61</strong> event classes</td><td><a href="http://mmlab.ie.cuhk.edu.hk/projects/WIDERFace/">Download</a></td><td>2015</td></tr><tr><td><strong>AFW</strong></td><td>AFW dataset is built using Flickr images. It has <strong>205</strong> images with <strong>473</strong> labeled faces. For each face, annotations include a rectangular <strong>bounding box</strong>, <strong>6 landmarks</strong> and the <strong>pose angles</strong>.</td><td><a href="http://www.ics.uci.edu/~xzhu/face/">Download</a></td><td>2013</td></tr><tr><td><strong>MALF</strong></td><td>MALF is the first face detection dataset that supports fine-gained evaluation. MALF consists of <strong>5,250</strong> images and <strong>11,931</strong> faces.</td><td><a href="http://www.cbsr.ia.ac.cn/faceevaluation/">Download</a></td><td>2015</td></tr></tbody></table></div><h4 id="Face-Attributes"><a href="#Face-Attributes" class="headerlink" title="Face Attributes"></a>Face Attributes</h4><div class="table-container"><table><thead><tr><th>Datasets</th><th>Description</th><th>Links</th><th>Key features</th><th>Publish Time</th></tr></thead><tbody><tr><td><strong>CelebA</strong></td><td><strong>10,177</strong> number of <strong>identities</strong>,  <strong>202,599</strong> number of <strong>face images</strong>, and  <strong>5 landmark locations</strong>, <strong>40 binary attributes</strong> annotations per image.</td><td><a href="http://mmlab.ie.cuhk.edu.hk/projects/CelebA.html">Download</a></td><td><strong>attribute &amp; landmark</strong></td><td>2015</td></tr><tr><td><strong>IMDB-WIKI</strong></td><td>500k+ face images with <strong>age</strong> and <strong>gender</strong> labels</td><td><a href="https://data.vision.ee.ethz.ch/cvl/rrothe/imdb-wiki/">Download</a></td><td><strong>age &amp; gender</strong></td><td>2015</td></tr><tr><td><strong>Adience</strong></td><td>Unfiltered faces for <strong>gender</strong> and <strong>age</strong> classification</td><td><a href="http://www.openu.ac.il/home/hassner/Adience/data.html">Download</a></td><td><strong>age &amp; gender</strong></td><td>2014</td></tr><tr><td><strong>WFLW</strong>ğŸ…</td><td>WFLW contains <strong>10000 faces</strong> (7500 for training and 2500 for testing) with <strong>98 fully manual annotated landmarks</strong>.</td><td><a href="https://wywu.github.io/projects/LAB/WFLW.html">Download</a></td><td><strong>landmarks</strong></td><td>2018</td></tr><tr><td><strong>Caltech10k Web Faces</strong></td><td>The dataset has 10,524 human faces of various resolutions and in <strong>different settings</strong></td><td><a href="http://www.vision.caltech.edu/Image_Datasets/Caltech_10K_WebFaces/#Description">Download</a></td><td><strong>landmarks</strong></td><td>2005</td></tr><tr><td><strong>EmotioNet</strong></td><td>The EmotioNet database includes<strong>950,000 images</strong> with <strong>annotated AUs</strong>.  A <strong>subset</strong> of the images in the EmotioNet database correspond to <strong>basic and compound emotions.</strong></td><td><a href="http://cbcsl.ece.ohio-state.edu/EmotionNetChallenge/index.html#overview">Download</a></td><td><strong>AU and Emotion</strong></td><td>2017</td></tr><tr><td><strong>RAF( Real-world Affective Faces)</strong></td><td><strong>29672</strong> number of <strong>real-world images</strong>,  including <strong>7</strong> classes of basic emotions and <strong>12</strong> classes of compound emotions,  <strong>5 accurate landmark locations</strong>,  <strong>37 automatic landmark locations</strong>, <strong>race, age range</strong> and  <strong>gender</strong> <strong>attributes</strong> annotations per image</td><td><a href="http://www.whdeng.cn/RAF/model1.html">Download</a></td><td><strong>Emotionsã€landmarkã€raceã€age and gender</strong></td><td>2017</td></tr></tbody></table></div><h4 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h4><div class="table-container"><table><thead><tr><th>Datasets</th><th>Description</th><th>Links</th><th>Publish Time</th></tr></thead><tbody><tr><td><strong>IJB C/B/A</strong>ğŸ…</td><td>IJB C/B/A is currently running <strong>three challenges</strong> related to  <strong>face detection, verification, identification, and identity clustering.</strong></td><td><a href="https://www.nist.gov/programs-projects/face-challenges">Download</a></td><td>2015</td></tr><tr><td><strong>MOBIO</strong></td><td><strong>bi-modal</strong> (<strong>audio</strong> and <strong>video</strong>) data taken from 152 people.</td><td><a href="https://www.idiap.ch/dataset/mobio">Download</a></td><td>2012</td></tr><tr><td><strong>BANCA</strong></td><td>The BANCA database was captured in four European languages in <strong>two modalities</strong> (<strong>face</strong> and <strong>voice</strong>).</td><td><a href="http://www.ee.surrey.ac.uk/CVSSP/banca/">Download</a></td><td>2014</td></tr><tr><td><strong>3D Mask Attack</strong></td><td><strong>76500</strong> frames of <strong>17</strong> persons using Kinect RGBD with eye positions (Sebastien Marcel).</td><td><a href="https://www.idiap.ch/dataset/3dmad">Download</a></td><td>2013</td></tr><tr><td><strong>WebCaricature</strong></td><td><strong>6042</strong> <strong>caricatures</strong> and <strong>5974 photographs</strong> from <strong>252 persons</strong> collected from the web</td><td><a href="https://cs.nju.edu.cn/rl/WebCaricature.htm">Download</a></td><td>2018</td></tr></tbody></table></div><h2 id="ğŸ -Research-home-conf-amp-workshop-amp-trans"><a href="#ğŸ -Research-home-conf-amp-workshop-amp-trans" class="headerlink" title="ğŸ  Research home(conf &amp; workshop &amp; trans)"></a>ğŸ  Research home(conf &amp; workshop &amp; trans)</h2><p><img src="/2019/04/18/awesome-face/research_home.png" alt></p><p><strong>ICCV</strong>: <a href="http://iccv2019.thecvf.com">IEEE International Conference on Computer Vision</a></p><p><strong>CVPR</strong>: <a href="http://cvpr2018.thecvf.com/">IEEE Conference on Computer Vision and Pattern Recognition</a></p><p><strong>ECCV</strong>: <a href="https://eccv2018.org">European Conference on Computer Vision</a></p><p><strong>FG</strong>: <a href="http://dblp.uni-trier.de/db/conf/fgr/">IEEE International Conference on Automatic Face and Gesture Recognition</a></p><p><strong>BMVC:</strong> <a href="http://www.bmva.org/bmvc/?id=bmvc">The British Machine Vision Conference</a></p><p><strong>IJCB[ICB+BTAS]</strong>:International Joint Conference on Biometrics</p><ul><li><p><strong>ICB</strong>: <a href="http://icb2018.org">International Conference on Biometrics</a></p></li><li><p><strong>BTAS</strong>: <a href="https://www.isi.edu/events/btas2018/home">IEEE International Conference on Biometrics: Theory, Applications and Systems</a></p></li></ul><p><strong>AMFG</strong>: IEEE workshop on Analysis and Modeling of Faces and Gestures</p><p><strong>CVPR Workshop on Biometrics</strong></p><p><strong>TPAMI:</strong> <a href="https://ieeexplore.ieee.org/xpl/RecentIssue.jsp?punumber=34">IEEE Transactions on Pattern Analysis and Machine Intelligence</a></p><p><strong>IJCV:</strong> <a href="https://link.springer.com/journal/11263">International Journal of Computer Vision</a> </p><p><strong>TIP:</strong> <a href="https://ieeexplore.ieee.org/xpl/RecentIssue.jsp?punumber=83">IEEE Transactions on Image Processing</a></p><p><strong>TIFS:</strong> <a href="IEEE Transactions on Information Forensics and Security">IEEE Transactions on Information Forensics and Security</a></p><p><strong>PR:</strong> <a href="https://www.journals.elsevier.com/pattern-recognition/">Pattern Recognition</a></p><h2 id="ğŸ·-References"><a href="#ğŸ·-References" class="headerlink" title="ğŸ· References:"></a>ğŸ· References:</h2><p>[1] <a href="https://github.com/RiweiChen/DeepFace/tree/master/FaceDataset">https://github.com/RiweiChen/DeepFace/tree/master/FaceDataset</a></p><p>[2] <a href="https://www.zhihu.com/question/33505655?sort=created">https://www.zhihu.com/question/33505655?sort=created</a></p><p>[3] <a href="https://github.com/betars/Face-Resources">https://github.com/betars/Face-Resources</a></p><p>[4] <a href="https://zhuanlan.zhihu.com/p/33288325">https://zhuanlan.zhihu.com/p/33288325</a></p><p>[5] <a href="https://github.com/L706077/DNN-Face-Recognition-Papers">https://github.com/L706077/DNN-Face-Recognition-Papers</a></p><p>[6] <a href="https://www.zhihu.com/question/67919300">https://www.zhihu.com/question/67919300</a></p><p>[7] <a href="https://jackietseng.github.io/conference_call_for_paper/2018-2019-conferences.html">https://jackietseng.github.io/conference_call_for_paper/2018-2019-conferences.html</a></p><p>[8]<a href="http://history.ccf.org.cn/sites/ccf/biaodan.jsp?contentId=2903940690839">http://history.ccf.org.cn/sites/ccf/biaodan.jsp?contentId=2903940690839</a></p><p>[9]<a href="http://mmlab.ie.cuhk.edu.hk/projects/WIDERFace/WiderFace_Results.html">http://mmlab.ie.cuhk.edu.hk/projects/WIDERFace/WiderFace_Results.html</a></p>]]></content>
    
    
    <categories>
      
      <category>Face</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pytorchå¸¸è§å·¥å…·ç®±</title>
    <link href="/2019/04/17/pytorch%E5%B8%B8%E8%A7%81%E5%B7%A5%E5%85%B7%E7%AE%B1/"/>
    <url>/2019/04/17/pytorch%E5%B8%B8%E8%A7%81%E5%B7%A5%E5%85%B7%E7%AE%B1/</url>
    
    <content type="html"><![CDATA[<p>æ”¶é›†æ•´ç†äº†ä¸€äº›å¸¸è§çš„å¯ä»¥ç”¨åˆ°çš„æ·±åº¦å­¦ä¹ ç½‘å€ã€å·¥å…·</p><a id="more"></a><h3 id="1-é¢„è®­ç»ƒæ¨¡å‹"><a href="#1-é¢„è®­ç»ƒæ¨¡å‹" class="headerlink" title="1. é¢„è®­ç»ƒæ¨¡å‹"></a>1. é¢„è®­ç»ƒæ¨¡å‹</h3><p><a href="https://github.com/Cadene/pretrained-models.pytorch">https://github.com/Cadene/pretrained-models.pytorch</a></p><p><a href="https://github.com/rwightman/pytorch-image-models">https://github.com/rwightman/pytorch-image-models</a></p><p><a href="https://github.com/welkin-feng/ComputerVision">https://github.com/welkin-feng/ComputerVision</a></p><h3 id="2-æ•°æ®å¢å¼º"><a href="#2-æ•°æ®å¢å¼º" class="headerlink" title="2. æ•°æ®å¢å¼º"></a>2. æ•°æ®å¢å¼º</h3><p><a href="https://github.com/albumentations-team/albumentations">https://github.com/albumentations-team/albumentations</a></p><h3 id="3-æ ‡è®°å·¥å…·"><a href="#3-æ ‡è®°å·¥å…·" class="headerlink" title="3. æ ‡è®°å·¥å…·"></a>3. æ ‡è®°å·¥å…·</h3><p><a href="https://github.com/wkentaro/labelme"><strong>Labelme:</strong></a> Image Polygonal Annotation with Python</p><p><a href="https://github.com/tzutalin/labelImg"><strong>LabelImg</strong></a>ï¼šLabelImg is a graphical image annotation tool and label object bounding boxes in images</p><h3 id="4-æ•°æ®é›†æŸ¥æ‰¾"><a href="#4-æ•°æ®é›†æŸ¥æ‰¾" class="headerlink" title="4. æ•°æ®é›†æŸ¥æ‰¾"></a>4. æ•°æ®é›†æŸ¥æ‰¾</h3><p><strong>! ! !  You can find datasets in Paper Beachmark</strong></p><p><a href="https://www.kaggle.com/"><strong>Kaggle</strong></a></p><p><a href="https://toolbox.google.com/datasetsearch"><strong>Google Datasets Search Engine</strong></a></p><p><a href="https://msropendata.com/"><strong>Microsoft Datasets</strong></a></p><p><a href="https://www.visualdata.io/"><strong>Computer Vision Datasets</strong></a></p><p><a href="https://github.com/awesomedata/awesome-public-datasets"><strong>Github awesomedata</strong></a></p><p><a href="https://archive.ics.uci.edu/ml/datasets.html"><strong>UCI Machine Learning Repository.</strong></a></p><p><a href="https://registry.opendata.aws/"><strong>Amazon Datasets</strong></a></p><p><strong>Government Datasets:</strong> <a href="https://data.europa.eu/euodp/data/dataset"><strong>EU</strong></a> <a href="https://www.data.gov/"><strong>US</strong></a> <a href="https://catalogue.data.govt.nz/dataset"><strong>NZL</strong></a> <a href="https://data.gov.in/"><strong>IND</strong></a></p><h3 id="5-æ¨¡å‹åˆ†æå·¥å…·"><a href="#5-æ¨¡å‹åˆ†æå·¥å…·" class="headerlink" title="5. æ¨¡å‹åˆ†æå·¥å…·"></a>5. æ¨¡å‹åˆ†æå·¥å…·</h3><h5 id="1-å·ç§¯å±‚è¾“å‡ºå¤§å°è®¡ç®—"><a href="#1-å·ç§¯å±‚è¾“å‡ºå¤§å°è®¡ç®—" class="headerlink" title="(1) å·ç§¯å±‚è¾“å‡ºå¤§å°è®¡ç®—"></a>(1) å·ç§¯å±‚è¾“å‡ºå¤§å°è®¡ç®—</h5><h5 id="https-ezyang-github-io-convolution-visualizer-index-html"><a href="#https-ezyang-github-io-convolution-visualizer-index-html" class="headerlink" title="https://ezyang.github.io/convolution-visualizer/index.html"></a><a href="https://ezyang.github.io/convolution-visualizer/index.html">https://ezyang.github.io/convolution-visualizer/index.html</a></h5><h5 id="2-è®¡ç®—æ¨¡å‹å‚æ•°é‡"><a href="#2-è®¡ç®—æ¨¡å‹å‚æ•°é‡" class="headerlink" title="(2) è®¡ç®—æ¨¡å‹å‚æ•°é‡"></a>(2) è®¡ç®—æ¨¡å‹å‚æ•°é‡</h5><p><a href="https://github.com/sksq96/pytorch-summary">https://github.com/sksq96/pytorch-summary</a></p><h5 id="3-æ¨¡å‹å¯è§†åŒ–å·¥å…·"><a href="#3-æ¨¡å‹å¯è§†åŒ–å·¥å…·" class="headerlink" title="(3) æ¨¡å‹å¯è§†åŒ–å·¥å…·"></a>(3) æ¨¡å‹å¯è§†åŒ–å·¥å…·</h5><p><a href="https://github.com/lutzroeder/Netron"><strong>Netron:</strong></a> now supports <strong>ONNX</strong>, <strong>Keras</strong>, <strong>CoreML</strong>, <strong>Caffe2</strong>, <strong>Mxnet</strong>, <strong>Pytorch</strong> and <strong>Tensorflow</strong>.</p><p><a href="https://github.com/szagoruyko/pytorchviz"><strong>Graphviz:</strong></a> <strong>Pytorch</strong></p><h3 id="6-å¯è§†åŒ–å·¥å…·"><a href="#6-å¯è§†åŒ–å·¥å…·" class="headerlink" title="6. å¯è§†åŒ–å·¥å…·"></a>6. å¯è§†åŒ–å·¥å…·</h3><p><a href="https://github.com/facebookresearch/visdom">visdom</a></p><pre><code class="hljs python"><span class="hljs-comment"># Example using Visdom.</span>vis = visdom.Visdom(env=<span class="hljs-string">&#x27;Learning curve&#x27;</span>, use_incoming_socket=<span class="hljs-literal">False</span>)<span class="hljs-keyword">assert</span> self._visdom.check_connection()self._visdom.close()options = collections.namedtuple(<span class="hljs-string">&#x27;Options&#x27;</span>, [<span class="hljs-string">&#x27;loss&#x27;</span>, <span class="hljs-string">&#x27;acc&#x27;</span>, <span class="hljs-string">&#x27;lr&#x27;</span>])(    loss=&#123;<span class="hljs-string">&#x27;xlabel&#x27;</span>: <span class="hljs-string">&#x27;Epoch&#x27;</span>, <span class="hljs-string">&#x27;ylabel&#x27;</span>: <span class="hljs-string">&#x27;Loss&#x27;</span>, <span class="hljs-string">&#x27;showlegend&#x27;</span>: <span class="hljs-literal">True</span>&#125;,    acc=&#123;<span class="hljs-string">&#x27;xlabel&#x27;</span>: <span class="hljs-string">&#x27;Epoch&#x27;</span>, <span class="hljs-string">&#x27;ylabel&#x27;</span>: <span class="hljs-string">&#x27;Accuracy&#x27;</span>, <span class="hljs-string">&#x27;showlegend&#x27;</span>: <span class="hljs-literal">True</span>&#125;,    lr=&#123;<span class="hljs-string">&#x27;xlabel&#x27;</span>: <span class="hljs-string">&#x27;Epoch&#x27;</span>, <span class="hljs-string">&#x27;ylabel&#x27;</span>: <span class="hljs-string">&#x27;Learning rate&#x27;</span>, <span class="hljs-string">&#x27;showlegend&#x27;</span>: <span class="hljs-literal">True</span>&#125;)<span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> epoch(<span class="hljs-number">80</span>):    tran(...)    val(...)    vis.line(X=torch.Tensor([t + <span class="hljs-number">1</span>]), Y=torch.Tensor([train_loss]),             name=<span class="hljs-string">&#x27;train&#x27;</span>, win=<span class="hljs-string">&#x27;Loss&#x27;</span>, update=<span class="hljs-string">&#x27;append&#x27;</span>, opts=options.loss)    vis.line(X=torch.Tensor([t + <span class="hljs-number">1</span>]), Y=torch.Tensor([val_loss]),             name=<span class="hljs-string">&#x27;val&#x27;</span>, win=<span class="hljs-string">&#x27;Loss&#x27;</span>, update=<span class="hljs-string">&#x27;append&#x27;</span>, opts=options.loss)    vis.line(X=torch.Tensor([t + <span class="hljs-number">1</span>]), Y=torch.Tensor([train_acc]),             name=<span class="hljs-string">&#x27;train&#x27;</span>, win=<span class="hljs-string">&#x27;Accuracy&#x27;</span>, update=<span class="hljs-string">&#x27;append&#x27;</span>, opts=options.acc)    vis.line(X=torch.Tensor([t + <span class="hljs-number">1</span>]), Y=torch.Tensor([val_acc]),             name=<span class="hljs-string">&#x27;val&#x27;</span>, win=<span class="hljs-string">&#x27;Accuracy&#x27;</span>, update=<span class="hljs-string">&#x27;append&#x27;</span>, opts=options.acc)    vis.line(X=torch.Tensor([t + <span class="hljs-number">1</span>]), Y=torch.Tensor([lr]),             win=<span class="hljs-string">&#x27;Learning rate&#x27;</span>, update=<span class="hljs-string">&#x27;append&#x27;</span>, opts=options.lr)</code></pre><p><a href="https://pytorch.org/docs/stable/tensorboard.html">Tensorboard</a></p><ul><li><strong>acc / loss</strong></li></ul><pre><code class="hljs python"><span class="hljs-keyword">from</span> tensorboard <span class="hljs-keyword">import</span> SummaryWriterwriter = SummaryWriter()<span class="hljs-keyword">for</span> n_iter <span class="hljs-keyword">in</span> range(<span class="hljs-number">100</span>):    dummy_s1 = torch.rand(<span class="hljs-number">1</span>)    writer.add_scalar(<span class="hljs-string">&#x27;data/scalar1&#x27;</span>, dummy_s1[<span class="hljs-number">0</span>], n_iter)writer.close()</code></pre><ul><li><strong>img</strong></li></ul><pre><code class="hljs python"><span class="hljs-keyword">from</span> tensorboard <span class="hljs-keyword">import</span> SummaryWriter<span class="hljs-keyword">import</span> torchvision.utils <span class="hljs-keyword">as</span> vutilswriter = SummaryWriter()<span class="hljs-keyword">if</span> n_iter % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>:    x = vutils.make_grid(dummy_img, normalize=<span class="hljs-literal">True</span>, scale_each=<span class="hljs-literal">True</span>)    writer.add_image(<span class="hljs-string">&#x27;Image&#x27;</span>, x, n_iter)writer.close()</code></pre><ul><li>åœ¨ä¸€å¼ å›¾ä¸­åŠ å…¥ä¸¤æ¡æ›²çº¿</li></ul><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">100</span>):    writer.add_scalars(<span class="hljs-string">&#x27;run_14h&#x27;</span>, &#123;<span class="hljs-string">&#x27;xsinx&#x27;</span>:i*np.sin(i/r),                                    <span class="hljs-string">&#x27;xcosx&#x27;</span>:i*np.cos(i/r),                                    <span class="hljs-string">&#x27;tanx&#x27;</span>: np.tan(i/r)&#125;, i)</code></pre><h3 id="7-Pytorch-åŠ é€Ÿ"><a href="#7-Pytorch-åŠ é€Ÿ" class="headerlink" title="7. Pytorch åŠ é€Ÿ"></a>7. Pytorch åŠ é€Ÿ</h3><p><strong>NVIDIA/DLAI:</strong> <a href="https://github.com/NVIDIA/DALI">https://github.com/NVIDIA/DALI</a></p><p><strong>Efficient-Pytorch:</strong> <a href="https://github.com/Lyken17/Efficient-PyTorch">https://github.com/Lyken17/Efficient-PyTorch</a></p><p><strong>NVIDIA/APEX:</strong> <a href="https://github.com/nvidia/apex">https://github.com/nvidia/apex</a></p><h3 id="8-æ€§èƒ½åˆ†æå·¥å…·"><a href="#8-æ€§èƒ½åˆ†æå·¥å…·" class="headerlink" title="8. æ€§èƒ½åˆ†æå·¥å…·"></a>8. æ€§èƒ½åˆ†æå·¥å…·</h3><ul><li>nvidia-smi</li><li>htop</li><li>iotop</li><li>nvtop</li><li>py-spy</li><li>strace</li></ul><h3 id="9-æ·±åº¦å­¦ä¹ ç»˜å›¾"><a href="#9-æ·±åº¦å­¦ä¹ ç»˜å›¾" class="headerlink" title="9. æ·±åº¦å­¦ä¹ ç»˜å›¾"></a>9. æ·±åº¦å­¦ä¹ ç»˜å›¾</h3><ul><li><a href="https://github.com/dair-ai/ml-visuals"><strong>ML Visuals</strong></a></li><li><a href="https://github.com/HarisIqbal88/PlotNeuralNet"><strong>PlotNeuralNet</strong></a></li></ul><h3 id="10-å…¶ä»–è¾…åŠ©å·¥å…·"><a href="#10-å…¶ä»–è¾…åŠ©å·¥å…·" class="headerlink" title="10. å…¶ä»–è¾…åŠ©å·¥å…·"></a>10. å…¶ä»–è¾…åŠ©å·¥å…·</h3><ul><li><strong>byobu</strong></li><li><strong>screen</strong></li></ul>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>lightweight-cnn-architecture-design</title>
    <link href="/2019/04/15/lightweight-cnn-architecture-design/"/>
    <url>/2019/04/15/lightweight-cnn-architecture-design/</url>
    
    <content type="html"><![CDATA[<p>å¸¸è§çš„ç§»åŠ¨ç«¯æ¨¡å‹ï¼šmobilenet ç³»åˆ—å’Œ shufflenet ç³»åˆ—</p><a id="more"></a><h4 id="1-Mobilenet-v1"><a href="#1-Mobilenet-v1" class="headerlink" title="1. Mobilenet v1"></a>1. Mobilenet v1</h4><p>MobileNetæ¨¡å‹çš„æ ¸å¿ƒå°±æ˜¯<strong>å°†åŸæœ¬æ ‡å‡†çš„å·ç§¯æ“ä½œå› å¼åˆ†è§£æˆä¸€ä¸ªdepthwise convolutionå’Œä¸€ä¸ª1*1çš„å·ç§¯ï¼ˆæ–‡ä¸­å«pointwise convolutionï¼‰æ“ä½œã€‚ç®€å•è®²å°±æ˜¯å°†åŸæ¥ä¸€ä¸ªå·ç§¯å±‚åˆ†æˆä¸¤ä¸ªå·ç§¯å±‚ï¼Œå…¶ä¸­å‰é¢ä¸€ä¸ªå·ç§¯å±‚çš„æ¯ä¸ªfilteréƒ½åªè·Ÿinputçš„æ¯ä¸ªchannelè¿›è¡Œå·ç§¯ï¼Œç„¶ååé¢ä¸€ä¸ªå·ç§¯å±‚åˆ™è´Ÿè´£combiningï¼Œå³å°†ä¸Šä¸€å±‚å·ç§¯çš„ç»“æœè¿›è¡Œåˆå¹¶ã€‚ </strong></p><h5 id="å…·ä½“å®ç°ï¼š"><a href="#å…·ä½“å®ç°ï¼š" class="headerlink" title="å…·ä½“å®ç°ï¼š"></a>å…·ä½“å®ç°ï¼š</h5><p>(1) ä¼ ç»Ÿçš„å·ç§¯è®¡ç®—ï¼šå‡è®¾Mè¡¨ç¤ºinputçš„channelä¸ªæ•°ï¼ŒNè¡¨ç¤ºoutputçš„channelä¸ªæ•°ï¼ˆä¹Ÿæ˜¯æœ¬å±‚çš„å·ç§¯æ ¸ä¸ªæ•°ï¼‰ã€‚å› æ­¤å¦‚æœå‡è®¾å·ç§¯æ ¸å¤§å°æ˜¯<code>DK*DK*M*N</code>ï¼Œè¾“å‡ºæ˜¯<code>DF*DF*N</code>ï¼Œé‚£ä¹ˆæ ‡å‡†å·ç§¯çš„è®¡ç®—é‡æ˜¯<code>DK*DK*M*N*DF*DF</code>ã€‚å¦‚ä¸‹å›¾(a)æ‰€ç¤ºã€‚</p><p><img src="/2019/04/15/lightweight-cnn-architecture-design/1.png" alt="å°†åŸæœ¬çš„å·ç§¯æ“ä½œè¿›è¡Œå› å¼åˆ†è§£"></p><ul><li><p>é¦–å…ˆä½¿ç”¨<code>M</code>ä¸ª<code>Dk*Dk</code>çš„å·ç§¯æ ¸å¯¹è¾“å…¥(<code>M*DF*DF</code>)è¿›è¡Œå·ç§¯,è¿™é‡Œè¦æ³¨æ„çš„æ˜¯æ¯ä¸ªfilteråªè·Ÿè¾“å…¥çš„ä¸€ä¸ªé€šé“è¿›è¡Œå·ç§¯(ä¹Ÿå°±æ˜¯è¯´ï¼Œå·ç§¯æ ¸çš„é€šé“æ•°ä¸º1)ï¼Œå°†ä¸åŒå·ç§¯æ ¸çš„ç»“æœè¿›è¡Œç»„åˆï¼Œå¯ä»¥å¾—åˆ°å¤§å°ä¸ºï¼š<code>M*DF*DF</code>çš„è¾“å‡ºã€‚å…¶è®¡ç®—é‡ä¸º <code>M*DK*DK*DF*DF</code>ã€‚(è¿™é‡Œä½¿ç”¨çš„3*3çš„å·ç§¯æ ¸ï¼Œpaddingä¸º1)ã€‚å¦‚ä¸Šå›¾(b)æ‰€ç¤ºã€‚</p></li><li><p>ç¬¬äºŒæ­¥æ˜¯å¯¹ä¹‹å‰çš„<code>M*DF*DF</code> çš„è¾“å‡ºè¿›è¡Œå·ç§¯ï¼Œå·ç§¯æ ¸ä¸ºNä¸ª<code>1*1*M</code> çš„å·ç§¯ï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°å¤§å°<code>N*DF*DF</code> çš„è¾“å‡ºã€‚å…¶è®¡ç®—é‡ä¸º<code>1*1*N*M*DF*DF</code>ã€‚å¦‚ä¸Šå›¾(c)æ‰€ç¤ºã€‚</p></li></ul><p>æ‰€ä»¥å…¶æ€»çš„è®¡ç®—é‡ç›¸æ¯”ä¼ ç»Ÿçš„å·ç§¯è®¡ç®—å‡å°‘äº†ï¼š</p><p><img src="/2019/04/15/lightweight-cnn-architecture-design/2.png" alt></p><p>ï¼ˆ2ï¼‰æ ‡å‡†å·ç§¯ï¼ˆå·¦è¾¹ï¼‰å’Œå› å¼åˆ†è§£åçš„å·ç§¯ï¼ˆå³è¾¹ï¼‰çš„å·®åˆ«å¦‚ä¸‹æ‰€ç¤ºã€‚æ³¨æ„åˆ°å·ç§¯æ“ä½œåéƒ½ä¼šè·Ÿä¸€ä¸ªBatchnormå’ŒReLUæ“ä½œã€‚</p><p><img src="/2019/04/15/lightweight-cnn-architecture-design/3.png" alt></p><h4 id="2-Shufflenet-v1"><a href="#2-Shufflenet-v1" class="headerlink" title="2. Shufflenet v1"></a>2. Shufflenet v1</h4><p>Shufflenet v1 ä¸»è¦é‡‡ç”¨<strong>channel shuffleã€pointwise group convolutionså’Œdepthwise convolutionæ¥ä¿®æ”¹åŸæ¥çš„ResNetå•å…ƒ</strong>ã€‚ä»è€Œå¤§å¹…åº¦é™ä½æ·±åº¦ç½‘ç»œè®¡ç®—é‡ã€‚</p><ul><li>channel shuffleï¼šä¸åŒgroupçš„é€šé“è¿›è¡Œç»„åˆã€‚</li><li>pointwise group convolutionsï¼šå¸¦æœ‰ group çš„ 1 * 1 å·ç§¯ã€‚</li><li>depthwise convolutionsï¼šgroup ç­‰äºé€šé“æ•°çš„ç»„å·ç§¯ã€‚</li></ul><h5 id="å…·ä½“å®ç°ï¼š-1"><a href="#å…·ä½“å®ç°ï¼š-1" class="headerlink" title="å…·ä½“å®ç°ï¼š"></a>å…·ä½“å®ç°ï¼š</h5><p>ï¼ˆ1ï¼‰a å›¾æ˜¯ä¸€ä¸ªå¸¦æœ‰ depthwise convolution çš„resnet ç»“æœï¼Œæ‰€è°“çš„ depthwise convolution å¯ä»¥å‚è§[Mobilenet]</p><p>ï¼ˆ2ï¼‰a å›¾ â€”&gt; b å›¾ï¼Œç”¨å¸¦groupçš„ 1 <em> 1å·ç§¯(2ä¸ª)ä»£æ›¿åŸæ¥çš„1 </em> 1å·ç§¯ï¼ŒåŒæ—¶æ·»åŠ ä¸€ä¸ªchannel shuffle æ“ä½œã€‚</p><p>ï¼ˆ3ï¼‰b å›¾ â€”&gt; c å›¾ï¼Œæ·»åŠ äº†ä¸€ä¸ªæ­¥é•¿ä¸º2çš„ Average poolingï¼Œå°†Resnetæœ€åçš„Addæ“ä½œcæ”¹ä¸ºconcatæ“ä½œï¼Œä¹Ÿå°±æ˜¯æŒ‰channelåˆå¹¶ï¼Œç±»ä¼¼googleNetçš„Inceptionæ“ä½œã€‚</p><p><img src="/2019/04/15/lightweight-cnn-architecture-design/5.png" alt></p><h4 id="3-Mobilenet-V2"><a href="#3-Mobilenet-V2" class="headerlink" title="3. Mobilenet V2"></a>3. Mobilenet V2</h4><h5 id="å…·ä½“å®ç°ï¼š-2"><a href="#å…·ä½“å®ç°ï¼š-2" class="headerlink" title="å…·ä½“å®ç°ï¼š"></a>å…·ä½“å®ç°ï¼š</h5><p>(1) <strong>æ·»åŠ  residual connection</strong>ã€‚</p><p>(2) <strong>é€šè¿‡1x1å·ç§¯å…ˆæå‡é€šé“æ•°ï¼Œå†é€šè¿‡depthwiseçš„3x3ç©ºé—´å·ç§¯ï¼Œå†ç”¨1x1å·ç§¯é™ä½ç»´åº¦ã€‚ä½œè€…ç§°ä¹‹ä¸ºInverted residual blockï¼Œä¸¤è¾¹çª„ä¸­é—´å®½ï¼ŒåƒæŸ³å¶ï¼Œä»…ç”¨è¾ƒå°çš„è®¡ç®—é‡å°±èƒ½å¾—åˆ°è¾ƒå¥½çš„æ€§èƒ½</strong>ã€‚</p><p>(3) <strong>ä½¿ç”¨ReLU6æ›¿æ¢ä¼ ç»Ÿçš„ReLU6ã€‚æœ€åè¾“å‡ºçš„ReLU6å»æ‰ï¼Œç›´æ¥çº¿æ€§è¾“å‡º</strong>ã€‚</p><p>å¦‚ä¸‹å›¾æ˜¯ mobilenet v1ä¸ mobilenet v2 çš„å¯¹æ¯”å›¾ã€‚ä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼š</p><ul><li>v2åœ¨åŸæœ‰çš„dwä¹‹å‰åŠ äº†ä¸€ä¸ªpwä¸“é—¨ç”¨æ¥å‡ç»´ã€‚è¿™ä¹ˆåšæ˜¯å› ä¸ºä¸èƒ½æ”¹å˜é€šé“æ•°é‡ï¼Œå…ˆåŠ pwå‡ç»´åï¼Œdwå°±èƒ½åœ¨é«˜ç»´æç‰¹å¾äº†ã€‚</li><li>v2æŠŠåŸæœ¬dwä¹‹åç”¨æ¥é™ç»´çš„pwåçš„æ¿€æ´»å‡½æ•°ç»™å»æ‰äº†ã€‚è¿™ä¹ˆåšæ˜¯å› ä¸ºä»–è®¤ä¸ºéçº¿æ€§åœ¨é«˜ç»´æœ‰ç›Šå¤„ï¼Œä½†åœ¨ä½ç»´ï¼ˆä¾‹å¦‚pwé™ç»´åçš„ç©ºé—´ï¼‰ä¸å¦‚çº¿æ€§å¥½ã€‚</li></ul><p><img src="/2019/04/15/lightweight-cnn-architecture-design/8.png" alt></p><p>å¦‚ä¸‹å›¾æ˜¯ Resnet ä¸ mobilenet v2 çš„å¯¹æ¯”å›¾ã€‚å¯ä»¥çœ‹åˆ°ä¸¤è€…çš„ç»“æœå¾ˆç›¸ä¼¼ã€‚ä¸è¿‡ResNetæ˜¯å…ˆé™ç»´ï¼ˆ0.25å€ï¼‰ã€æç‰¹å¾ã€å†å‡ç»´ã€‚è€Œv2åˆ™æ˜¯å…ˆå‡ç»´ï¼ˆ6å€ï¼‰ã€æç‰¹å¾ã€å†é™ç»´ã€‚å¦å¤–v2ä¹Ÿç”¨DWä»£æ›¿äº†æ ‡å‡†å·ç§¯æ¥åšç‰¹å¾æå–ã€‚</p><p>æ³¨ï¼šç¤ºæ„è¡¨è¾¾å¼çœç•¥äº†Shortcutã€‚</p><p><img src="/2019/04/15/lightweight-cnn-architecture-design/7.png" alt></p><h4 id="4-shufflenet-V2"><a href="#4-shufflenet-V2" class="headerlink" title="4. shufflenet V2"></a>4. shufflenet V2</h4><h5 id="å…·ä½“å®ç°ï¼š-3"><a href="#å…·ä½“å®ç°ï¼š-3" class="headerlink" title="å…·ä½“å®ç°ï¼š"></a>å…·ä½“å®ç°ï¼š</h5><p><strong>(1) åŸºæœ¬å•å…ƒ</strong></p><p>å¦‚ä¸‹å·¦å›¾æ‰€ç¤º</p><p>(1) åœ¨æ¯ä¸ªå•å…ƒçš„å¼€å§‹ï¼Œ<code>c</code> ç‰¹å¾é€šé“çš„è¾“å…¥è¢«åˆ†ä¸ºä¸¤æ”¯ï¼Œåˆ†åˆ«å¸¦æœ‰ <code>câˆ’c&#39;</code> å’Œ <code>c&#39;</code>ä¸ªé€šé“ã€‚</p><p>(2)  ä¸€ä¸ªåˆ†æ”¯ä»ç„¶ä¿æŒä¸å˜ã€‚å¦ä¸€ä¸ªåˆ†æ”¯ç”±ä¸‰ä¸ªå·ç§¯ç»„æˆï¼Œä»¤è¾“å…¥å’Œè¾“å‡ºé€šé“ç›¸åŒã€‚ä¸ ShuffleNet V1 ä¸åŒçš„æ˜¯ï¼Œä¸¤ä¸ª 1Ã—1 å·ç§¯ä¸å†æ˜¯ç»„å·ç§¯ã€‚æ˜¯å› ä¸ºåˆ†å‰²æ“ä½œå·²ç»äº§ç”Ÿäº†ä¸¤ä¸ªç»„ã€‚</p><p>(3) å·ç§¯ä¹‹åï¼ŒæŠŠä¸¤ä¸ªåˆ†æ”¯æ‹¼æ¥èµ·æ¥ï¼Œä»è€Œé€šé“æ•°é‡ä¿æŒä¸å˜ã€‚</p><p>(4) ç„¶åè¿›è¡Œä¸ ShuffleNet V1 ç›¸åŒçš„ã€ŒChannel Shuï¬„eã€æ“ä½œæ¥ä¿è¯ä¸¤ä¸ªåˆ†æ”¯é—´èƒ½è¿›è¡Œä¿¡æ¯äº¤æµã€‚ã€ŒShuffleã€ä¹‹åï¼Œä¸‹ä¸€ä¸ªå•å…ƒå¼€å§‹è¿ç®—ã€‚</p><p>æ³¨æ„ï¼Œ! Shuï¬„eNet V1 [15] ä¸­çš„ã€ŒåŠ æ³•ã€æ“ä½œä¸å†å­˜åœ¨ã€‚! åƒ ReLU å’Œæ·±åº¦å·ç§¯è¿™æ ·çš„æ“ä½œåªå­˜åœ¨ä¸€ä¸ªåˆ†æ”¯ä¸­ã€‚å¦å¤–ï¼Œ! ä¸‰ä¸ªè¿ç»­çš„æ“ä½œã€Œæ‹¼æ¥ã€ã€ã€ŒChannel Shuï¬„eã€å’Œã€Œé€šé“åˆ†å‰²ã€åˆå¹¶æˆä¸€ä¸ªæ“ä½œã€‚</p><p><strong>ç©ºé—´ä¸‹é‡‡æ ·å•å…ƒï¼š</strong></p><p>å¯¹äºç©ºé—´ä¸‹é‡‡æ ·ï¼Œè¯¥å•å…ƒç»è¿‡ç¨å¾®ä¿®æ”¹ï¼Œè¯¦è§ä¸‹å›¾å³ï¼Œ é€šé“åˆ†å‰²è¿ç®—è¢«ç§»é™¤ã€‚å› æ­¤ï¼Œè¾“å‡ºé€šé“æ•°é‡ç¿»äº†ä¸€å€ã€‚</p><p><img src="/2019/04/15/lightweight-cnn-architecture-design/9.png" alt></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>äººè„¸è¯†åˆ«æŸå¤±å‡½æ•°</title>
    <link href="/2019/04/15/Face-recog-loss-fun/"/>
    <url>/2019/04/15/Face-recog-loss-fun/</url>
    
    <content type="html"><![CDATA[<p>å¸¸è§çš„æŸå¤±å‡½æ•°ä¸€è§ˆ:ä»softmax loss åˆ° triplet loss å†åˆ°å„ç§ softmax æ”¹å‹ã€‚</p><a id="more"></a><h4 id="softmax-loss"><a href="#softmax-loss" class="headerlink" title="softmax loss"></a>softmax loss</h4><p>softmaxæ˜¯æœ€å¸¸è§çš„äººè„¸è¯†åˆ«å‡½æ•°ã€‚softmax å‡½æ•°å°†äººè„¸è¯†åˆ«é—®é¢˜çœ‹åšä¸€ä¸ªç»å…¸çš„åˆ†ç±»é—®é¢˜ã€‚</p><script type="math/tex; mode=display">L_{softmax} = -\frac{1}{N}\sum_{i=1}^{N} log \frac{e^{W^T_{y_i}x_i+b_{y_i}}}{\sum_{j=1}^{k}e^{W^T_jx_i+b_j}}</script><p>å…¬å¼ä¸­ N æ˜¯ batch size çš„å¤§å°ï¼Œkæ˜¯ç±»åˆ«æ•°ç›®ã€‚</p><h4 id="Triplet-loss"><a href="#Triplet-loss" class="headerlink" title="Triplet loss"></a>Triplet loss</h4><p>â€‹        Triplet loss é‡‡ç”¨ä¸‰å…ƒç»„è¿›è¡Œè®­ç»ƒï¼Œæ‰€è°“çš„ä¸‰å…ƒç»„å°±æ˜¯ä¸‰ä¸ªæ ·ä¾‹ï¼Œå¦‚(anchor, pos, neg)ï¼Œå…¶ä¸­ï¼Œxå’Œpæ˜¯åŒä¸€ç±»ï¼Œxå’Œnæ˜¯ä¸åŒç±»ã€‚é‚£ä¹ˆå­¦ä¹ çš„è¿‡ç¨‹å°±æ˜¯å­¦åˆ°ä¸€ç§è¡¨ç¤ºï¼Œå¯¹äºå°½å¯èƒ½å¤šçš„ä¸‰å…ƒç»„ï¼Œä½¿å¾—anchorå’Œposçš„è·ç¦»ï¼Œå°äºanchorå’Œnegçš„è·ç¦»ã€‚</p><p><img src="/2019/04/15/Face-recog-loss-fun/triplet.png" alt></p><script type="math/tex; mode=display">||x_i^a - x_i^p||^2_2 +m < ||x_i^a-x_i^n||_2^2</script><h4 id="center-loss"><a href="#center-loss" class="headerlink" title="center loss"></a>center loss</h4><p>â€‹       center lossçš„æ ¸å¿ƒæ˜¯ï¼šä¸ºæ¯ä¸€ä¸ªç±»åˆ«æä¾›ä¸€ä¸ªç±»åˆ«ä¸­å¿ƒï¼Œæœ€å°åŒ–æ¯ä¸ªæ ·æœ¬ä¸è¯¥ä¸­å¿ƒçš„è·ç¦»ï¼Œä»è€Œå‡å°ç±»å†…å·®è·ã€‚center loss ç”±ä¸¤é¡¹æ„æˆï¼Œç¬¬ä¸€é¡¹æ˜¯ä¼ ç»Ÿçš„ softmax lossï¼Œ ç¬¬äºŒé¡¹æ˜¯æ ·æœ¬åˆ°ç±»ä¸­å¿ƒçš„è·ç¦»ã€‚</p><script type="math/tex; mode=display">L_{center} = -\frac{1}{N}\sum_{i=1}^{N} log \frac{e^{W^T_{y_i}x_i+b_{y_i}}}{\sum_{j=1}^{k}e^{W^T_jx_i+b_j}} + \frac{\lambda}{2}\sum_{i=1}^N||x_i-c_{y_i}||^2_2</script><p><img src="/2019/04/15/Face-recog-loss-fun/center loss.png" alt></p><h4 id="L-softmax"><a href="#L-softmax" class="headerlink" title="L-softmax"></a>L-softmax</h4><p>è€ƒè™‘ä¸€ä¸ªä¸¤åˆ†ç±»é—®é¢˜ã€‚åŸå§‹çš„Softmaxçš„ç›®çš„æ˜¯ä½¿å¾—  $W_1^Tx &gt; W_2^Tx$ï¼Œ å³ $||W_1||||x||cos(\theta_1) &gt; ||W_1||||x||cos(\theta_2)$ï¼Œåœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼ŒL-softmax(Large-margin softmax) å¸Œæœ›å¯ä»¥é€šè¿‡å¢åŠ ä¸€ä¸ªæ­£æ•´æ•°å˜é‡mï¼Œä½¿å¾—äº§ç”Ÿçš„å†³ç­–è¾¹ç•Œå¯ä»¥æ›´åŠ ä¸¥æ ¼åœ°çº¦æŸä¸Šè¿°ä¸ç­‰å¼ï¼Œè®©ç±»å†…çš„é—´è·æ›´åŠ çš„ç´§å‡‘ï¼Œç±»é—´çš„é—´è·æ›´åŠ å…·æœ‰åŒºåˆ†æ€§ã€‚</p><script type="math/tex; mode=display">L_{l-softmax} = -\frac{1}{N}\sum_{i=1}^N log(\frac{e^{||W_{yi}||||x_i||\psi{(\theta_{y_i})}}}{e^{||W_{yi}||||x_i||\psi{(\theta_{y_i})}} + \sum_{j=1, j\neq y_i}^k{e^{||W_j||||x_i||cos(\theta_j)}}})</script><p>å…¶ä¸­,</p><script type="math/tex; mode=display">\psi(\theta) = \begin{equation}  \left\{      \begin{array}{**lr**}     cos(m\theta), 0 \leq \theta \leq \frac{\pi}{m}\\     D(\theta) ,  \frac{\pi}{m}\leq \theta \leq \pi \\        \end{array}  \right. \end{equation}</script><p>coså‡½æ•°åœ¨(0,Ï€)å†…æ˜¯å•è°ƒé€’å‡çš„ï¼Œä¹˜ä¸Šæ­£æ•´æ•°måå†…ç§¯ä¼šå‡å°ï¼Œè¿™æ ·å¯ä»¥åŠ å¤§ç±»é—´çš„å·®åˆ«ã€‚é€šè¿‡æ§åˆ¶mçš„å¤§å°ï¼Œè°ƒæ•´ç±»é—´è·ç¦»ã€‚mè¶Šå¤§ï¼Œç±»é—´è·ç¦»å°±è¶Šå¤§ï¼Œç±»å†…æ›´åŠ ç´§å‡‘ã€‚</p><p><img src="/2019/04/15/Face-recog-loss-fun/lms.png" alt></p><h4 id="sphereface-A-softmax"><a href="#sphereface-A-softmax" class="headerlink" title="sphereface(A-softmax)"></a>sphereface(A-softmax)</h4><p>SphereFaceæ˜¯åœ¨ softmax çš„åŸºç¡€ä¸Šå°†æƒé‡å½’ä¸€åŒ–ï¼Œå³å¼ $||W||=1, b=0$  ã€‚å®ƒä¸å‰é¢æåˆ°çš„L-sofrmaxæœ€å¤§çš„åŒºåˆ«åœ¨äºSphereFaceå°†Wæƒé‡å½’ä¸€åŒ–äº†ã€‚L-Softmaxä¼šåŒæ—¶ä»è§’åº¦å’Œæƒé‡é•¿åº¦ä¸ŠåŒºåˆ†ä¸åŒç±»åˆ«ï¼Œè€ŒSphereFaceåªä»è§’åº¦ä¸Šå»åŒºåˆ†ä¸åŒç±»åˆ«ã€‚</p><script type="math/tex; mode=display">L_{A-softmax} = -\frac{1}{N}\sum_{i=1}^{N}log(\frac{e^{||x_i||\psi(\theta_{y_i})}}{e^{||x_i||\psi(\theta_{y_i})} + \sum_{j=1, j \neq y_i}^k{e^{||x_i||cos\theta_j}}})</script><h4 id="cosface"><a href="#cosface" class="headerlink" title="cosface"></a>cosface</h4><p>cosFaceçš„æ€æƒ³å’ŒsphereFace( A-softmax)çš„æ€æƒ³æ¥è¿‘ï¼Œå…¶ä¸­ä¸»è¦åšäº†ä»¥ä¸‹ä¸‰ç‚¹çš„æ”¹è¿›ï¼š</p><ul><li>lossçš„å½¢å¼åšäº†ç¨å¾®çš„æ”¹å˜ï¼Œå°†è¶…å‚æ•°mç”±ä¹˜æ³•è¿ç®—å˜æˆäº†å‡æ³•è¿ç®—</li><li>ä¸ä»…å¯¹æƒé‡è¿›è¡Œäº†æ­£åˆ™åŒ–ï¼Œè¿˜å¯¹ç‰¹å¾è¿›è¡Œäº†æ­£åˆ™åŒ–</li><li>å†ä¹˜ä¸Šä¸€ä¸ª s å‚æ•°ï¼Œå½“è¶…çƒé¢è¿‡å°æ—¶ï¼Œåˆ†ç±»æ˜ å°„åˆ°è¶…çƒé¢ä¸Šä¸å¥½åˆ†ç±»ï¼Œè¿™ä¸ª s å‚æ•°å¯ä»¥æ‰©å¤§è¶…çƒé¢ä½“ç§¯ï¼Œå¸®åŠ©åˆ†ç±»</li></ul><script type="math/tex; mode=display">L_{cos} = -\frac{1}{N} \sum_{i=1}^{N} log(\frac{e^{s(cos(\theta_{yi})-m)}}{e^{s(cos(\theta_{yi})-m)}+\sum_{j=1, j\neq y_i}^k e^{scos \theta_j}})</script><h4 id="arcface"><a href="#arcface" class="headerlink" title="arcface"></a>arcface</h4><p>arcfaceçš„æ€æƒ³å’Œcosfaceç±»ä¼¼ï¼Œä¸»è¦åŒºåˆ«æ˜¯å°†mæ”¾å…¥äº†cosä¸­ï¼Œè§’åº¦è·ç¦»æ¯”ä½™å¼¦è·ç¦»å¯¹è§’åº¦çš„å½±å“æ›´åŠ ç›´æ¥:</p><script type="math/tex; mode=display">L_{arc} = -\frac{1}{N} \sum_{i=1}^{N} log(\frac{e^{s(cos(\theta_{yi}+m))}}{e^{s(cos(\theta_{yi}+m))}+\sum_{j=1,j\neq y_i}^k e^{scos\theta_j}})</script><p>arcface äººè„¸è¯†åˆ«æµç¨‹å›¾ï¼š</p><p><img src="/2019/04/15/Face-recog-loss-fun/flowchart.png" alt></p><p>ä¸åŒæŸå¤±å‡½æ•°çš„åˆ†ç±»è¾¹ç•Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/2019/04/15/Face-recog-loss-fun/cos_loss.png" alt></p>]]></content>
    
    
    <categories>
      
      <category>Face</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Face-Detection-Solution</title>
    <link href="/2019/04/13/Face-Detection-Solution/"/>
    <url>/2019/04/13/Face-Detection-Solution/</url>
    
    <content type="html"><![CDATA[<p>Face Detection äººè„¸æ£€æµ‹è®¾è®¡æ–¹æ¡ˆ</p><a id="more"></a><h4 id="1-æ•´ä½“ç½‘ç»œæ¶æ„è®¾è®¡"><a href="#1-æ•´ä½“ç½‘ç»œæ¶æ„è®¾è®¡" class="headerlink" title="1. æ•´ä½“ç½‘ç»œæ¶æ„è®¾è®¡"></a>1. æ•´ä½“ç½‘ç»œæ¶æ„è®¾è®¡</h4><p><strong>DSFD</strong>ï¼šResNet101, DPNâˆ’98, SE-ResNeXt101 32Ã—4dã€<strong>ResNet152</strong>ã€SE-ResNet101ï¼ˆSSD æ¶æ„ã€æœªè¿›è¡Œä¸Šä¸‹å±‚çš„èåˆï¼‰</p><p><strong>Faceboxes</strong>ï¼š(conv+CReLU+pool)<em>2 + inception </em> 3 + conv * 4ï¼ˆSSD æ¶æ„ã€æœªè¿›è¡Œä¸Šä¸‹å±‚çš„èåˆï¼‰</p><p><strong>PymaridBox</strong>ï¼šVGG16ï¼ˆLFPNæ¶æ„ï¼‰</p><p><strong>VIM-FD</strong> ï¼š densenet121 ï¼ˆSSD+attentionï¼šSTR+STCï¼‰</p><p><strong>S3FD</strong>ï¼šVGG16 ï¼ˆSSD + normï¼‰</p><p><strong>SSH</strong>: vgg16</p><p><strong>Scale Face</strong>ï¼šResnet 50</p><p><strong>smallhardface</strong>ï¼šVGG16 ï¼ˆone shotã€ç›´é€šå¼æ¶æ„ï¼šèƒ½å®ç°è¿™ä¸ªæ€§èƒ½ç®€ç›´æœ‰ç‚¹ä¸å¯æ€è®®ï¼ å€¼å¾—ç ”ç©¶çš„æ¶æ„ï¼‰</p><p><strong>SRN</strong>ï¼šcombining DRN with Root-ResNet-18 to have a training speed/accuracy trade-off backbone for SRN</p><p>(æ¯”è¾ƒæ–°çš„æ¶æ„ã€å€¼å¾—ç ”ç©¶ä¸€ä¸‹ï¼šSTR+STC)</p><p><strong>MSFD</strong>ï¼šVGG 16ï¼ˆä¸Šä¸­ä¸‹ä¸‰å±‚èåˆæœºåˆ¶ï¼‰</p><p><strong>å¯¹äºä¸»å¹²æ¶æ„ï¼Œé€šå¸¸é€‰æ‹© vgg16 æˆ–è€… resnet50/101, å¦‚æœè¿½æ±‚è½»é‡çº§å¯ä»¥ä½¿ç”¨ mobilenetv2 or shufflenet v2ã€‚</strong></p><h4 id="2-å¦‚ä½•è®¾è®¡å¤šå°ºåº¦ç‰¹å¾"><a href="#2-å¦‚ä½•è®¾è®¡å¤šå°ºåº¦ç‰¹å¾" class="headerlink" title="2. å¦‚ä½•è®¾è®¡å¤šå°ºåº¦ç‰¹å¾"></a>2. å¦‚ä½•è®¾è®¡å¤šå°ºåº¦ç‰¹å¾</h4><p>å¸¸è§çš„å¤šå°ºåº¦çš„è®¾è®¡æ–¹æ¡ˆï¼š</p><p>ï¼ˆaï¼‰å›¾åƒé‡‘å­—å¡”ï¼Œå³å°†å›¾åƒåšæˆä¸åŒçš„scaleï¼Œç„¶åä¸åŒscaleçš„å›¾åƒç”Ÿæˆå¯¹åº”çš„ä¸åŒscaleçš„ç‰¹å¾ã€‚è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹åœ¨äºå¢åŠ äº†æ—¶é—´æˆæœ¬ã€‚æœ‰äº›ç®—æ³•ä¼šåœ¨æµ‹è¯•æ—¶å€™é‡‡ç”¨å›¾åƒé‡‘å­—å¡”ã€‚ </p><p>ï¼ˆbï¼‰åƒSPP netï¼ŒFast RCNNï¼ŒFaster RCNNæ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œå³ä»…é‡‡ç”¨ç½‘ç»œæœ€åä¸€å±‚çš„ç‰¹å¾ã€‚ </p><p>ï¼ˆcï¼‰åƒSSDï¼ˆSingle Shot Detectorï¼‰é‡‡ç”¨è¿™ç§å¤šå°ºåº¦ç‰¹å¾èåˆçš„æ–¹å¼ï¼Œæ²¡æœ‰ä¸Šé‡‡æ ·è¿‡ç¨‹ï¼Œå³ä»ç½‘ç»œä¸åŒå±‚æŠ½å–ä¸åŒå°ºåº¦çš„ç‰¹å¾åšé¢„æµ‹ï¼Œè¿™ç§æ–¹å¼ä¸ä¼šå¢åŠ é¢å¤–çš„è®¡ç®—é‡ã€‚ä½œè€…è®¤ä¸ºSSDç®—æ³•ä¸­æ²¡æœ‰ç”¨åˆ°è¶³å¤Ÿä½å±‚çš„ç‰¹å¾ï¼ˆåœ¨SSDä¸­ï¼Œæœ€ä½å±‚çš„ç‰¹å¾æ˜¯VGGç½‘ç»œçš„conv4_3ï¼‰ï¼Œè€Œåœ¨ä½œè€…çœ‹æ¥è¶³å¤Ÿä½å±‚çš„ç‰¹å¾å¯¹äºæ£€æµ‹å°ç‰©ä½“æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚ </p><p>ï¼ˆdï¼‰æœ¬æ–‡ä½œè€…æ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œé¡¶å±‚ç‰¹å¾é€šè¿‡ä¸Šé‡‡æ ·å’Œä½å±‚ç‰¹å¾åšèåˆï¼Œè€Œä¸”æ¯å±‚éƒ½æ˜¯ç‹¬ç«‹é¢„æµ‹çš„ã€‚</p><p><img src="/2019/04/13/Face-Detection-Solution/2.png" alt></p><p><strong>è¿›å…¥ 2018å¹´ä»¥æ¥ï¼Œå¤§éƒ¨åˆ†ç½‘ç»œå‡é‡‡ç”¨ FPN ç½‘ç»œç»“æ„çš„å½¢å¼ï¼Œèåˆå¤šä¸ªç‰¹å¾å±‚è¿›è¡Œæ£€æµ‹ã€‚æœ‰æ—¶å€™ä¼šæ­é…ä¸€ä¸ªç‹¬ç‰¹è®¾è®¡çš„ç½‘ç»œï¼Œæ¯”å¦‚SRN çš„ STR_STC ç»“æ„ã€MSFD çš„ä¸‰å±‚èåˆæœºåˆ¶ã€DSFD çš„ Two-shot ç»“æ„ã€‚éƒ½è¿›è¡Œäº†ä¸åŒç¨‹åº¦çš„åˆ›æ–°ã€‚</strong></p><h4 id="3-Loss-è®¾è®¡"><a href="#3-Loss-è®¾è®¡" class="headerlink" title="3. Loss è®¾è®¡"></a>3. Loss è®¾è®¡</h4><h5 id="ï¼ˆ1ï¼‰smooth-l1-loss"><a href="#ï¼ˆ1ï¼‰smooth-l1-loss" class="headerlink" title="ï¼ˆ1ï¼‰smooth l1  loss"></a>ï¼ˆ1ï¼‰smooth l1  loss</h5><p>Smooth l1 loss çš„å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p><script type="math/tex; mode=display">smooth_{L_1}(x) = \begin{equation}  \left\{      \begin{array}{**lr**}      0.5 x^2,  if |x| < 1  \\      |x|-0.5,  otherwise \\        \end{array}  \right.  \end{equation}</script><h5 id="ï¼ˆ2ï¼‰focal-loss"><a href="#ï¼ˆ2ï¼‰focal-loss" class="headerlink" title="ï¼ˆ2ï¼‰focal loss"></a>ï¼ˆ2ï¼‰focal loss</h5><script type="math/tex; mode=display">L_{focol\ loss} = \begin{equation}  \left\{      \begin{array}{**lr**}      -(1-y')^\gamma logy',  y=1 \\      -y'^\gamma log(1-y'),  y=0 \\        \end{array}  \right.  \end{equation}</script><h4 id="4-anchor-è®¾è®¡"><a href="#4-anchor-è®¾è®¡" class="headerlink" title="4. anchor è®¾è®¡"></a>4. anchor è®¾è®¡</h4><p><strong>anchor è®¾è®¡çš„ä¸‰ä¸ªåŸåˆ™ï¼š</strong><br><strong>(1) anchor çš„å°ºå¯¸ã€é•¿å®½æ¯”ã€ä½ç½®éƒ½åº”è¯¥ match æºæ•°æ®ä¸­çš„bboxã€‚ä¸€ç§æ–¹æ³•æ˜¯é’ˆå¯¹ç‰¹å®šæ•°æ®é›†è®¾è®¡anchorï¼Œå¦‚YOLOv2ä¸­çš„èšç±»ï¼Œå’Œè¿‘æœŸæœ‰è®ºæ–‡CNNè®­ç»ƒanchorçš„è®¾ç½®ï¼Œè¿™äº›æ–¹æ³•æˆ–è®¸æ›´é€‚åˆæŸä¸€æ•°æ®é›†ï¼Œä½†ä¹Ÿå¯èƒ½å½±å“æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼Œæ¢ä¸€ä¸ªåº“æ˜¯å¦ä¾ç„¶å¤Ÿç”¨ã€‚</strong><br><strong>(2) anchorçš„size å¿…é¡»å°äºæ„Ÿå—é‡</strong><br><strong>(3) ä¸åŒsizeçš„anchoråº”å½“å…·æœ‰ç›¸åŒçš„ç©ºé—´å¯†åº¦åˆ†å¸ƒã€‚å¯†åº¦ä¸€è‡´çš„è¯ï¼Œè¦æ±‚ anchor/stride ä¸ºä¸€ä¸ªå®šå€¼ã€‚</strong></p><h4 id="5-æ•°æ®å¢å¼ºç­–ç•¥"><a href="#5-æ•°æ®å¢å¼ºç­–ç•¥" class="headerlink" title="5. æ•°æ®å¢å¼ºç­–ç•¥:"></a>5. æ•°æ®å¢å¼ºç­–ç•¥:</h4><p><strong>S3FD</strong>ï¼šColor distortã€Random cropã€Horizontal flip</p><p><strong>Faceboxes</strong>ï¼šColor distortã€Random cropã€Horizontal flipã€Scale transformationã€Face-box filter</p><p><strong>SRN</strong>ï¼šphotometric distortions<strong>, </strong>randomly expanding by zero-padding operation<strong>, </strong>randomly cropping patches<strong>ã€ </strong>data-anchor-sampling in PyramidBox</p><p><strong>Pyramid box</strong>ï¼š color distort, random crop and horizontal flip.data-anchor-sampling</p><p><strong>VIMFD</strong>: data-anchor-sampling method in PyramidBox</p><p><strong>Small hard face</strong>: random cropping,photometric distortion</p><p><strong>Tiny face</strong>: resize</p><p><strong>æœ€å¸¸è§çš„å‡ ç§æ–¹æ¡ˆæ˜¯ï¼šColor distortã€Random crop(resize)ã€Horizontal flipã€data-anchor-sampling method in PyramidBox </strong></p><p>å…¶ä»–å€¼å¾—å€Ÿé‰´çš„æ•°æ®å¢å¼ºç­–ç•¥:</p><p>[1] SSD &amp; YOLO v3 ç›¸å…³æ•°æ®å¢å¼º</p><p>[2] <a href="https://github.com/maozezhong/CV_ToolBox/blob/master/DataAugForObjectDetection/DataAugmentForObejctDetection.py">https://github.com/maozezhong/CV_ToolBox/blob/master/DataAugForObjectDetection/DataAugmentForObejctDetection.py</a></p><p>[3] torchvision</p><p>[4] <a href="https://github.com/dmlc/gluon-cv?files=1">mxnetï¼šBag of Freebies for Training Object Detection Neural Networks</a></p><h4 id="6-æ·±åº¦å­¦ä¹ äººè„¸æ£€æµ‹æ–¹æ¡ˆçš„å‘å±•"><a href="#6-æ·±åº¦å­¦ä¹ äººè„¸æ£€æµ‹æ–¹æ¡ˆçš„å‘å±•" class="headerlink" title="6. æ·±åº¦å­¦ä¹ äººè„¸æ£€æµ‹æ–¹æ¡ˆçš„å‘å±•"></a>6. æ·±åº¦å­¦ä¹ äººè„¸æ£€æµ‹æ–¹æ¡ˆçš„å‘å±•</h4><p><img src="/2019/04/13/Face-Detection-Solution/face_detection.png" alt="Face Detection"></p><h4 id="7-å¸¸è§æ•°æ®é›†"><a href="#7-å¸¸è§æ•°æ®é›†" class="headerlink" title="7. å¸¸è§æ•°æ®é›†"></a>7. å¸¸è§æ•°æ®é›†</h4><ul><li><p>FDDB</p></li><li><p>Wider-Face</p></li><li><p>PASCAL</p></li><li><p>AFW</p></li></ul><p><strong>ç›¸æ¯”è€Œè¨€ï¼šWIDER-FACE æ›´åŠ æƒå¨ã€FDDB æ¬¡ä¹‹ï¼ŒPASCALå’ŒAFW éƒ½æ˜¯æ¯”è¾ƒå°çš„æ•°æ®é›†ï¼ŒåŸºæœ¬å¯ä»¥å¿½ç•¥ã€‚</strong></p>]]></content>
    
    
    <categories>
      
      <category>Face</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>FaceBoxes</title>
    <link href="/2019/04/13/FaceBoxes/"/>
    <url>/2019/04/13/FaceBoxes/</url>
    
    <content type="html"><![CDATA[<p>FaceBoxes: A CPU Real-time Face Detector with High Accuracy</p><a id="more"></a><h3 id="FaceBoxes-A-CPU-Real-time-Face-Detector-with-High-Accuracy"><a href="#FaceBoxes-A-CPU-Real-time-Face-Detector-with-High-Accuracy" class="headerlink" title="FaceBoxes: A CPU Real-time Face Detector with High Accuracy"></a>FaceBoxes: A CPU Real-time Face Detector with High Accuracy</h3><p>è®ºæ–‡é˜…è¯»ï¼šFaceBoxes: A CPU Real-time Face Detector with High Accuracy</p><p>æ–‡ç« ï¼š <a href="http://cn.arxiv.org/abs/1708.05234">http://cn.arxiv.org/abs/1708.05234</a></p><h4 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h4><p>2ä¸ªæŒ‘æˆ˜ï¼š</p><p>1) åœ¨æ‚ä¹±èƒŒæ™¯ä¸‹äººè„¸è§†è§’å¤§çš„å˜åŒ–éœ€è¦äººè„¸æ£€æµ‹å™¨ç²¾å‡†çš„è§£å†³å¤æ‚äººè„¸å’Œéäººè„¸çš„åˆ†ç±»é—®é¢˜ã€‚</p><p>2) è¾ƒå¤§çš„æœç´¢ç©ºé—´å’Œäººè„¸å°ºå¯¸è¿›ä¸€æ­¥å¢åŠ äº†æ—¶é—´æ•ˆç‡çš„éœ€è¦ã€‚</p><p>â€‹        ä¼ ç»Ÿæ–¹æ³•æ•ˆç‡é«˜ä½†åœ¨äººè„¸å¤§çš„è§†è§’å˜åŒ–ä¸‹ç²¾åº¦ä¸å¤Ÿï¼ŒåŸºäºCNNçš„æ–¹æ³•ç²¾åº¦é«˜ä½†é€Ÿåº¦å¾ˆæ…¢ã€‚å—åˆ°Faster R-CNNçš„RPNä»¥åŠSSDä¸­å¤šå°ºåº¦æœºåˆ¶çš„å¯å‘ï¼Œä¾¿æœ‰äº†è¿™ç¯‡å¯ä»¥åœ¨CPUä¸Šå®æ—¶è·‘çš„FaceBoxesã€‚</p><h4 id="FaceBoxes"><a href="#FaceBoxes" class="headerlink" title="FaceBoxes"></a>FaceBoxes</h4><p><strong>ï¼ˆ1ï¼‰RDCLï¼šRapidly Digested Convolutional Layers, åŠ é€Ÿè®¡ç®—</strong></p><p>â€‹    ç¼©å°è¾“å…¥çš„ç©ºé—´å¤§å°ï¼šä¸ºäº†å¿«é€Ÿå‡å°è¾“å…¥çš„ç©ºé—´å°ºåº¦å¤§å°ï¼Œåœ¨å·ç§¯æ ¸æ± åŒ–ä¸Šä½¿ç”¨äº†ä¸€ç³»åˆ—çš„å¤§çš„stride,åœ¨Conv1,Pool1,Conv2,Pool2ä¸Šstrideåˆ†åˆ«æ˜¯4,2,2,2,RDCLçš„strideä¸€å…±æ˜¯32ï¼Œæ„å‘³ç€è¾“å…¥çš„å°ºåº¦å¤§å°è¢«å¿«é€Ÿå‡å°äº†32å€ã€‚è¿™é‡Œæ˜¯åŒºåˆ«äºYOLO v3 çš„å…³é”®ï¼Œ YOLO v3 æ•´ä½“ä¸‹é™äº†32å€ï¼Œè¿™é‡Œä»…ä»…åœ¨ RDCL éƒ¨åˆ†å°±ä¸‹é™äº†32å€ï¼Œå‚æ•°é‡æ˜¯å°‘äº†å¾ˆå¤šï¼Œå¯ä»¥åŠ å¿«é€Ÿåº¦ï¼Œè¿™ä¸ªç‚¹è¿˜æ˜¯å€¼å¾—å€Ÿé‰´çš„</p><ul><li><p>é€‰æ‹©åˆé€‚çš„kernel sizeï¼šä¸€ä¸ªç½‘ç»œå¼€å§‹çš„ä¸€äº›å±‚çš„kernel sizeåº”è¯¥æ¯”è¾ƒå°ä»¥ç”¨æ¥åŠ é€Ÿï¼ŒåŒæ—¶ä¹Ÿåº”è¯¥è¶³å¤Ÿå¤§ç”¨ä»¥å‡è½»ç©ºé—´å¤§å°å‡å°å¸¦æ¥çš„ä¿¡æ¯æŸå¤±ã€‚Conv1,Conv2å’Œæ‰€æœ‰çš„Poolåˆ†åˆ«é€‰å–7x7, 5x5, 3x3çš„kernel sizeã€‚</p></li><li><p>å‡å°‘è¾“å‡ºé€šé“æ•°ï¼šä½¿ç”¨C.ReLUæ¥å¢åŠ è¾“å‡ºé€šé“æ•°ï¼Œæ¯”ä½¿ç”¨å·ç§¯å¢åŠ é€šé“æ•°éœ€è¦çš„å‚æ•°é‡æ›´å°‘ã€‚</p></li></ul><p><strong>ï¼ˆ2ï¼‰MSCLï¼šMultiple Scale Convolutional Layers,ä¸°å¯Œæ„Ÿå—é‡ï¼Œä½¿ä¸åŒå±‚çš„anchorç¦»æ•£åŒ–ä»¥å¤„ç†å¤šå°ºåº¦äººè„¸</strong></p><p>ã€€ã€€å°†RPNä½œä¸ºä¸€ä¸ªäººè„¸æ£€æµ‹å™¨ï¼Œä¸èƒ½è·å–å¾ˆå¥½çš„æ€§èƒ½æœ‰ä»¥ä¸‹ä¸¤ä¸ªåŸå› ï¼š(1) RPNä¸­çš„anchoråªå’Œæœ€åä¸€ä¸ªå·ç§¯å±‚ç›¸å…³ï¼Œå…¶ä¸­çš„ç‰¹å¾å’Œåˆ†è¾¨ç‡åœ¨å¤„ç†äººè„¸å˜åŒ–ä¸Šå¤ªå¼±ã€‚(2) anchorç›¸åº”çš„å±‚ä½¿ç”¨ä¸€ç³»åˆ—ä¸åŒçš„å°ºåº¦æ¥æ£€æµ‹äººè„¸ï¼Œä½†åªæœ‰å•ä¸€çš„æ„Ÿå—é‡ï¼Œä¸èƒ½åŒ¹é…ä¸åŒå°ºåº¦çš„äººè„¸ã€‚</p><p>ã€€ã€€ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯¹MSCLä»ä»¥ä¸‹ä¸¤ä¸ªè§’åº¦å»è®¾è®¡ï¼š</p><p>ã€€ã€€Multi-scale design along the dimension of network depth.å¦‚ä¸‹å›¾ï¼Œanchoråœ¨å¤šå°ºåº¦çš„feature mapä¸Šé¢å–ï¼Œç±»ä¼¼SSDã€‚</p><p><img src="/2019/04/13/FaceBoxes/1.png" alt="img"></p><p>Multi-scale design along the dimension of network width.ä½¿ç”¨inceptionæ¨¡å—ï¼Œå†…éƒ¨ä½¿ç”¨ä¸åŒå¤§å°çš„å·ç§¯æ ¸ï¼Œå¯ä»¥æ•è·åˆ°æ›´å¤šçš„å°ºåº¦ä¿¡æ¯ã€‚</p><p><strong>ï¼ˆ3ï¼‰Anchor densification strategyï¼š</strong></p><p> Inceptionçš„anchorå°ºåº¦ä¸º32<em>32,64</em>64,128<em>128,Conv3_2ã€Conv4_2çš„å°ºåº¦åˆ†åˆ«ä¸º256</em>256å’Œ512<em>512ã€‚æ¯”å¦‚Conv3_2çš„strideæ˜¯64ã€anchorå¤§å°ä¸º256</em>256ï¼Œè¡¨ç¤ºå¯¹åº”è¾“å…¥å›¾ç‰‡æ¯64åƒç´ å¤§å°æœ‰ä¸€ä¸ª256*256çš„anchorã€‚</p><p><img src="/2019/04/13/FaceBoxes/2.png" alt="img"></p><p>â€‹    æˆ‘ä»¬å®šä¹‰ anchorå¯†åº¦ä¸ºï¼šAdensity = Ascale/Aintervalã€‚Ascaleè¡¨ç¤ºanchorçš„å°ºåº¦ï¼ŒAintervalè¡¨ç¤ºanchoré—´éš”ã€‚</p><p>â€‹    æ˜¾ç„¶åœ¨ä¸åŒå°ºåº¦ä¸Šanchorçš„å¯†åº¦ä¸å‡è¡¡ã€‚ç›¸æ¯”å¤§çš„anchorï¼ˆ128-256-512ï¼‰ï¼Œå°çš„anchorï¼ˆ32å’Œ64ï¼‰è¿‡äºç¨€ç–ï¼Œå°†ä¼šå¯¼è‡´åœ¨å°è„¸æ£€æµ‹ä¸­ä½çš„å¬å›ç‡ã€‚</p><p>ä¸ºè§£å†³ä¸å‡è¡¡é—®é¢˜ï¼Œæ­¤å¤„æå‡ºæ–°çš„anchorç­–ç•¥ã€‚ä¸ºäº†åŠ å¤§ä¸€ç§anchorçš„å¯†åº¦ï¼Œåœ¨ä¸€ä¸ªæ„Ÿå—é‡çš„ä¸­å¿ƒå‡åŒ€çš„å †å n^2 ä¸ªanchorï¼ˆæœ¬æ¥æ˜¯1ä¸ªï¼‰ç”¨æ¥é¢„æµ‹ã€‚æ–‡ç« é‡Œå¯¹32<em>32çš„anchoråšäº†4å€ï¼Œå¯¹64</em>64çš„anchoråšäº†2å€ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯ä¸åŒå°ºåº¦çš„anchoræœ‰ç›¸åŒçš„å¯†åº¦ã€‚</p><p><img src="/2019/04/13/FaceBoxes/3.png" alt="img"></p><h4 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h4><h5 id="1-Training-dataset"><a href="#1-Training-dataset" class="headerlink" title="1. Training dataset:"></a>1. Training dataset:</h5><p>â€‹    WIDER FACEçš„å­é›†ï¼Œ12880ä¸ªå›¾ç‰‡ã€‚</p><p><strong>ï¼ˆ1ï¼‰Data augmentation:</strong></p><ul><li><p>Color distorition:æ ¹æ®<a href="https://arxiv.org/ftp/arxiv/papers/1312/1312.5402.pdf">ã€ŠSome Improvements on Deep Convolutional Neural Network Based Image Classificationã€‹</a></p></li><li><p>Random cropping: ä»åŸå›¾ä¸­éšæœºè£å‰ª5ä¸ªæ–¹å—patch:ä¸€ä¸ªæœ€å¤§æ–¹å—ï¼Œå…¶ä»–çš„åˆ†åˆ«åœ¨èŒƒå›´[0.3, 1]ä¹‹äºåŸå›¾å°ºå¯¸ã€‚</p></li><li><p>Scale transformation:å°†éšæœºè£å‰ªåçš„æ–¹å—patchç»™resizeåˆ°1024*1024.</p></li><li><p>Horizontal flipping: 0.5çš„æ¦‚ç‡ç¿»è½¬ã€‚</p></li><li><p>Face-box filter: å¦‚æœface boxçš„ä¸­å¿ƒåœ¨å¤„ç†åçš„å›¾ç‰‡ä¸Šï¼Œåˆ™ä¿æŒå…¶é‡å ï¼Œç„¶åå°†é«˜æˆ–å®½å°äº20åƒç´ çš„face boxè¿‡æ»¤å‡ºæ¥ã€‚</p></li></ul><p><strong>ï¼ˆ2ï¼‰Matching strategy:</strong></p><p>â€‹    åœ¨è®­ç»ƒæ—¶éœ€è¦åˆ¤æ–­å“ªä¸ªanchoræ˜¯å’Œå“ªä¸ªface bounding boxç›¸å…³çš„ã€‚é¦–å…ˆä½¿ç”¨jaccard overlapå°†æ¯ä¸ªè„¸å’Œanchorå¯¹åº”èµ·æ¥ï¼Œç„¶åå¯¹anchorå’Œä»»æ„è„¸jaccard overlapé«˜äºé˜ˆå€¼ï¼ˆ0.35ï¼‰çš„åŒ¹é…èµ·æ¥ã€‚</p><p><strong>ï¼ˆ3ï¼‰Loss function:</strong></p><p>â€‹    å’ŒFaster R-CNNä¸­çš„RPNç”¨åŒæ ·çš„loss,ä¸€ä¸ª2åˆ†ç±»çš„softmax lossç”¨æ¥åšåˆ†ç±»ï¼Œsmooth L1ç”¨æ¥åšå›å½’ã€‚</p><p><strong>ï¼ˆ4ï¼‰Hard negative mining:</strong></p><p>åœ¨anchoråŒ¹é…åï¼Œå¤§å¤šæ•°anchoréƒ½æ˜¯è´Ÿæ ·æœ¬ï¼Œå¯¼è‡´æ­£æ ·æœ¬å’Œè´Ÿæ ·æœ¬ä¸¥é‡ä¸å‡è¡¡ã€‚ä¸ºäº†æ›´å¿«æ›´ç¨³å®šçš„è®­ç»ƒï¼Œå°†ä»–ä»¬æŒ‰ç…§losså€¼æ’åºå¹¶é€‰å–æœ€é«˜çš„å‡ ä¸ªï¼Œä¿è¯æ­£æ ·æœ¬å’Œè´Ÿæ ·æœ¬çš„æ¯”ä¾‹æœ€é«˜ä¸è¶…è¿‡3:1.</p><p><strong>ï¼ˆ5ï¼‰Other implementation details:</strong></p><p>â€‹    Xavieréšæœºåˆå§‹åŒ–ã€ä¼˜åŒ–å™¨SGDã€momentum:0.9ã€weight decay:5e-4ï¼Œbatch size:32ï¼Œè¿­ä»£æœ€å¤§æ¬¡æ•°:120kï¼Œåˆå§‹80kè¿­ä»£learning rate:1e-3ï¼Œ80-100kè¿­ä»£ç”¨1e-4ï¼Œ,100-120kè¿­ä»£ç”¨1e-5ï¼Œä½¿ç”¨caffeå®ç°ã€‚</p><h4 id="Experiments"><a href="#Experiments" class="headerlink" title="Experiments"></a>Experiments</h4><p><img src="/2019/04/13/FaceBoxes/4.png" alt="img"></p><p><strong>(2) Model analysis</strong></p><p>â€‹    FDDBç›¸æ¯” AFW å’Œ PASCAL face è¾ƒä¸ºå›°éš¾ï¼Œå› æ­¤è¿™é‡Œåœ¨FDDBä¸Šä½œåˆ†æã€‚</p><p><strong>(2) Ablative Setting:</strong></p><p>1) å»æ‰ anchor densification strategy. =&gt; Anchor densification strategy is crucial.  è¿™ç§ anchor ç­–ç•¥ä¹Ÿæå‡äº†å¤§çº¦1ä¸ªç™¾åˆ†ç‚¹</p><p>2)æŠŠ MSCL æ›¿æ¢ä¸ºä¸‰å±‚å·ç§¯ï¼Œå…¶å¤§å°éƒ½ä¸º3*3ï¼Œè¾“å‡ºæ•°éƒ½å’ŒMSCLä¸­å‰ä¸‰ä¸ªInceptionçš„ä¿æŒä¸€è‡´. åŒæ—¶ï¼ŒæŠŠanchoråªå’Œæœ€åä¸€å±‚å·ç§¯å…³è”ã€‚ =&gt; MSCL is better.  ç¨å¾®æ…¢äº† 1ç‚¹ï¼Œä½†æ˜¯ç²¾åº¦æé«˜äº†ä¸€ä¸ªç‚¹ï¼ˆï¼FPN å·²ç»æˆä¸ºç°æœ‰ç½‘ç»œéƒ½å€Ÿé‰´çš„ä¸€ç‚¹ï¼‰</p><p>3)æŠŠRDCLä¸­çš„C.ReLUæ›¿æ¢ä¸ºReLUã€‚=&gt; RDCL is efficient and accuracy-preserving. ä¸æ”¹å˜ç²¾ç¡®åº¦çš„æƒ…å†µä¸‹ï¼Œ æå‡äº†å¤§çº¦ 1/3 çš„é€Ÿåº¦</p><p><img src="/2019/04/13/FaceBoxes/5.png" alt="img"></p><p><strong>(3) å®éªŒç»“æœ:</strong></p><p>AFW:</p><p><img src="/2019/04/13/FaceBoxes/6.png" alt="img"></p><p>PASCAL face:</p><p><img src="/2019/04/13/FaceBoxes/7.png" alt="img"></p><p>FDDB:</p><p><img src="/2019/04/13/FaceBoxes/8.png" alt="img"></p><h4 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h4><ul><li>å¤§å·ç§¯å¿«é€Ÿé™ä½è¿ç®—é‡ + CReLU</li><li>anchor é‡‡æ ·æœºåˆ¶</li><li>å¤šå°ºåº¦ç‰¹å¾èåˆ</li></ul>]]></content>
    
    
    <categories>
      
      <category>Face</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>MTCNN</title>
    <link href="/2019/04/13/MTCNN/"/>
    <url>/2019/04/13/MTCNN/</url>
    
    <content type="html"><![CDATA[<p>è®ºæ–‡é˜…è¯»: MTCNN  Joint Face Detection and Alignment using Multi-task Cascaded Convolutional Networks</p><a id="more"></a><h4 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h4><p>â€‹    ç›¸æ¯”äºR-CNNç³»åˆ—é€šç”¨æ£€æµ‹æ–¹æ³•ï¼Œæœ¬æ–‡æ›´åŠ é’ˆå¯¹äººè„¸æ£€æµ‹è¿™ä¸€ä¸“é—¨çš„ä»»åŠ¡ï¼Œé€Ÿåº¦å’Œç²¾åº¦éƒ½æœ‰è¶³å¤Ÿçš„æå‡ã€‚R-CNNï¼ŒFast R-CNNï¼ŒFasterR-CNNè¿™ä¸€ç³»åˆ—çš„æ–¹æ³•ä¸æ˜¯ä¸€ç¯‡åšå®¢èƒ½è®²æ¸…æ¥šçš„ï¼Œæœ‰å…´è¶£å¯ä»¥æ‰¾ç›¸å…³è®ºæ–‡é˜…è¯»ã€‚ç±»ä¼¼äºTCDCNï¼Œ<strong>æœ¬æ–‡æå‡ºäº†ä¸€ç§ Multi-taskçš„äººè„¸æ£€æµ‹æ¡†æ¶ï¼Œå°†äººè„¸æ£€æµ‹å’Œäººè„¸ç‰¹å¾ç‚¹æ£€æµ‹åŒæ—¶è¿›è¡Œã€‚è®ºæ–‡ä½¿ç”¨3ä¸ªCNNçº§è”çš„æ–¹å¼ï¼Œå’ŒViola-Jonesç±»ä¼¼ï¼Œå®ç°äº†coarse-to-fineçš„ç®—æ³•ç»“æ„</strong>ã€‚</p><h4 id="2-æ¡†æ¶"><a href="#2-æ¡†æ¶" class="headerlink" title="2. æ¡†æ¶"></a>2. æ¡†æ¶</h4><p><strong>ï¼ˆ1ï¼‰.ç®—æ³•æµç¨‹</strong></p><p><img src="/2019/04/13/MTCNN/1.jpg" alt="algorithm flow"></p><p><strong>å½“ç»™å®šä¸€å¼ ç…§ç‰‡çš„æ—¶å€™ï¼Œå°†å…¶ç¼©æ”¾åˆ°ä¸åŒå°ºåº¦å½¢æˆå›¾åƒé‡‘å­—å¡”ï¼Œä»¥è¾¾åˆ°å°ºåº¦ä¸å˜ã€‚</strong></p><p><strong>Stage 1ï¼šä½¿ç”¨P-Netæ˜¯ä¸€ä¸ªå…¨å·ç§¯ç½‘ç»œï¼Œç”¨æ¥ç”Ÿæˆå€™é€‰çª—å’Œè¾¹æ¡†å›å½’å‘é‡(bounding box regression vectors)ã€‚ä½¿ç”¨Bounding box regressionçš„æ–¹æ³•æ¥æ ¡æ­£è¿™äº›å€™é€‰çª—ï¼Œä½¿ç”¨éæå¤§å€¼æŠ‘åˆ¶ï¼ˆNMSï¼‰åˆå¹¶é‡å çš„å€™é€‰æ¡†ã€‚å…¨å·ç§¯ç½‘ç»œå’ŒFaster R-CNNä¸­çš„RPNä¸€è„‰ç›¸æ‰¿ã€‚</strong></p><p><strong>Stage 2ï¼šä½¿ç”¨N-Netæ”¹å–„å€™é€‰çª—ã€‚å°†é€šè¿‡P-Netçš„å€™é€‰çª—è¾“å…¥R-Netä¸­ï¼Œæ‹’ç»æ‰å¤§éƒ¨åˆ†falseçš„çª—å£ï¼Œç»§ç»­ä½¿ç”¨Bounding box regressionå’ŒNMSåˆå¹¶ã€‚</strong></p><p><strong>Stage 3ï¼šæœ€åä½¿ç”¨O-Netè¾“å‡ºæœ€ç»ˆçš„äººè„¸æ¡†å’Œç‰¹å¾ç‚¹ä½ç½®ã€‚å’Œç¬¬äºŒæ­¥ç±»ä¼¼ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯ç”Ÿæˆ5ä¸ªç‰¹å¾ç‚¹ä½ç½®ã€‚</strong></p><p><strong>ï¼ˆ2ï¼‰CNNç»“æ„</strong></p><p>æœ¬æ–‡ä½¿ç”¨ä¸‰ä¸ªCNNï¼Œç»“æ„å¦‚å›¾ï¼š</p><p><img src="/2019/04/13/MTCNN/2.png" alt="MTCNN"></p><p><strong>ï¼ˆ3ï¼‰.è®­ç»ƒ</strong></p><p>è¿™ä¸ªç®—æ³•éœ€è¦å®ç°ä¸‰ä¸ªä»»åŠ¡çš„å­¦ä¹ ï¼šäººè„¸éäººè„¸çš„åˆ†ç±»ï¼Œbounding box regressionå’Œäººè„¸ç‰¹å¾ç‚¹å®šä½ã€‚</p><p>(1)äººè„¸æ£€æµ‹</p><p>è¿™å°±æ˜¯ä¸€ä¸ªåˆ†ç±»ä»»åŠ¡ï¼Œä½¿ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°å³å¯ï¼š</p><script type="math/tex; mode=display">L_i^{det} = -(y_i^{det}log(p_i)+(1-y_i^{det})(1-log(p_i)))</script><p>(2)Bounding box regression</p><p>è¿™æ˜¯ä¸€ä¸ªå›å½’é—®é¢˜ï¼Œä½¿ç”¨å¹³æ–¹å’ŒæŸå¤±å‡½æ•°ï¼š</p><script type="math/tex; mode=display">L_i^{box} = || y_i^{box} - y_i^{box} ||_2^2</script><p>(3)äººè„¸ç‰¹å¾ç‚¹å®šä½</p><p>è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå›å½’é—®é¢˜ï¼Œç›®æ ‡æ˜¯5ä¸ªç‰¹å¾ç‚¹ä¸æ ‡å®šå¥½çš„æ•°æ®çš„å¹³æ–¹å’ŒæŸå¤±ï¼š</p><script type="math/tex; mode=display">L_i^{Landmark} = ||y_i^{landmark} - y_i^{landmark}||</script><p><strong>(4)å¤šä»»åŠ¡è®­ç»ƒ</strong></p><p>ä¸æ˜¯æ¯ä¸ªsampleéƒ½è¦ä½¿ç”¨è¿™ä¸‰ç§æŸå¤±å‡½æ•°çš„ï¼Œæ¯”å¦‚å¯¹äºèƒŒæ™¯åªéœ€è¦è®¡ç®—$L^{det}_i$ï¼Œä¸éœ€è¦è®¡ç®—åˆ«çš„æŸå¤±ï¼Œè¿™æ ·å°±éœ€è¦å¼•å…¥ä¸€ä¸ªæŒ‡ç¤ºå€¼æŒ‡ç¤ºæ ·æœ¬æ˜¯å¦éœ€è¦è®¡ç®—æŸä¸€é¡¹æŸå¤±ã€‚æœ€ç»ˆçš„è®­ç»ƒç›®æ ‡å‡½æ•°æ˜¯ï¼š</p><script type="math/tex; mode=display">min\sum_{i=1}^{N} \sum_{j \in \{det,box,landmark\}} \alpha_j\beta_i^jL_i^j</script><p>Næ˜¯è®­ç»ƒæ ·æœ¬çš„æ•°é‡ï¼Œ$\alpha<em>j$è¡¨ç¤ºä»»åŠ¡çš„é‡è¦æ€§ã€‚åœ¨ P-Net å’Œ R-Net ä¸­ï¼Œ$\alpha</em>{det}=1, \alpha<em>{box}=0.5, \alpha</em>{landmark}=0.5$ï¼Œåœ¨O-Netä¸­ï¼Œ$\alpha<em>{det}=1, \alpha</em>{box}=0.5, \alpha_{landmark}=1$</p><p><strong>(5)online hard sample mining</strong></p><p>ä¼ ç»Ÿçš„éš¾ä¾‹å¤„ç†æ–¹æ³•æ˜¯æ£€æµ‹è¿‡ä¸€æ¬¡ä»¥åï¼Œæ‰‹åŠ¨æ£€æµ‹å“ªäº›å›°éš¾çš„æ ·æœ¬æ— æ³•è¢«åˆ†ç±»ï¼Œæœ¬æ–‡é‡‡ç”¨online hard sample miningçš„æ–¹æ³•ã€‚å…·ä½“å°±æ˜¯åœ¨æ¯ä¸ªmini-batchä¸­ï¼Œå–lossæœ€å¤§çš„70%è¿›è¡Œåå‘ä¼ æ’­ï¼Œå¿½ç•¥é‚£äº›ç®€å•çš„æ ·æœ¬ã€‚</p><h4 id="3-å®éªŒ"><a href="#3-å®éªŒ" class="headerlink" title="3. å®éªŒ"></a>3. å®éªŒ</h4><p>æœ¬æ–‡ä¸»è¦ä½¿ç”¨ä¸‰ä¸ªæ•°æ®é›†è¿›è¡Œè®­ç»ƒï¼šFDDBï¼ŒWider Faceï¼ŒAFLWã€‚</p><p>Aã€è®­ç»ƒæ•°æ®</p><p>æœ¬æ–‡å°†æ•°æ®åˆ†æˆ4ç§ï¼š</p><p>Negativeï¼šéäººè„¸ </p><p>Positiveï¼šäººè„¸ </p><p>Part facesï¼šéƒ¨åˆ†äººè„¸ </p><p>Landmark faceï¼šæ ‡è®°å¥½ç‰¹å¾ç‚¹çš„äººè„¸</p><p>åˆ†åˆ«ç”¨äºè®­ç»ƒä¸‰ç§ä¸åŒçš„ä»»åŠ¡ã€‚Negativeå’ŒPositiveç”¨äºäººè„¸åˆ†ç±»ï¼Œpositiveå’Œpart facesç”¨äºbounding box regressionï¼Œlandmark faceç”¨äºç‰¹å¾ç‚¹å®šä½ã€‚</p><p>Bã€æ•ˆæœ</p><p>æœ¬æ–‡çš„äººè„¸æ£€æµ‹å’Œäººè„¸ç‰¹å¾ç‚¹å®šä½çš„æ•ˆæœéƒ½éå¸¸å¥½ã€‚å…³é”®æ˜¯è¿™ä¸ªç®—æ³•é€Ÿåº¦å¾ˆå¿«ï¼Œåœ¨2.6GHZçš„CPUä¸Šè¾¾åˆ°16fpsï¼Œåœ¨Nvidia Titanè¾¾åˆ°99fpsã€‚</p><h4 id="4-æ€»ç»“"><a href="#4-æ€»ç»“" class="headerlink" title="4. æ€»ç»“"></a>4. æ€»ç»“</h4><p>æœ¬æ–‡ä½¿ç”¨ä¸€ç§çº§è”çš„ç»“æ„è¿›è¡Œäººè„¸æ£€æµ‹å’Œç‰¹å¾ç‚¹æ£€æµ‹ï¼Œè¯¥æ–¹æ³•é€Ÿåº¦å¿«æ•ˆæœå¥½ï¼Œå¯ä»¥è€ƒè™‘åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šä½¿ç”¨ã€‚è¿™ç§æ–¹æ³•ä¹Ÿæ˜¯ä¸€ç§ç”±ç²—åˆ°ç»†çš„æ–¹æ³•ï¼Œå’ŒViola-Jonesçš„çº§è”AdaBoostæ€è·¯ç›¸ä¼¼ã€‚</p><p>ç±»ä¼¼äºViola-Jonesï¼š1ã€å¦‚ä½•é€‰æ‹©å¾…æ£€æµ‹åŒºåŸŸï¼šå›¾åƒé‡‘å­—å¡”+P-Netï¼›2ã€å¦‚ä½•æå–ç›®æ ‡ç‰¹å¾ï¼šCNNï¼›3ã€å¦‚ä½•åˆ¤æ–­æ˜¯ä¸æ˜¯æŒ‡å®šç›®æ ‡ï¼šçº§è”åˆ¤æ–­ã€‚</p><h4 id="5-è®­ç»ƒæµç¨‹"><a href="#5-è®­ç»ƒæµç¨‹" class="headerlink" title="5. è®­ç»ƒæµç¨‹"></a>5. è®­ç»ƒæµç¨‹</h4><p>ç¬¬ä¸€é˜¶æ®µï¼šé¦–å…ˆå¯¹åŸå›¾ç‰‡æ„å»ºä¸€ä¸ªé‡‘å­—å¡”ï¼Œå¯¹ä¸åŒå°ºå¯¸çš„å›¾ç‰‡è°ƒæ•´åˆ°12x12è¾“å…¥åˆ°PNet(Propossal)ä¸­ï¼ŒPNetä¼šè¿”å›è¯¸å¤šçš„Bboxï¼Œåˆ©ç”¨nmsé€‰å–åˆé€‚çš„Bboxã€‚</p><p>ç¬¬äºŒé˜¶æ®µï¼Œç”±PNetå¾—å‡ºçš„å€™é€‰æ¡†è¾“é€ç»™RNet(Refine)ï¼Œ RNetä¼šå¯¹ç›¸åº”çš„Bboxè¿›è¡Œç²¾ç»†å›å½’ï¼Œå¹¶è¿”å›ç½®ä¿¡åº¦ã€‚åˆ©ç”¨nmså¯¹ç²¾ç»†å›å½’åçš„Bboxè¿›è¡Œnmsé€‰å–ï¼Œ å¹¶èˆå¼ƒç›¸åº”çš„ç½®ä¿¡åº¦è¾ƒä½çš„äººè„¸ã€‚</p><p>ç¬¬ä¸‰é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µç›¸ä¼¼ï¼Œåªä¸è¿‡æœ€åä¼šè¿”å›ç›¸åº”çš„Landmarkåæ ‡ã€‚</p><p>å…·ä½“çš„è®­ç»ƒè¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="/2019/04/13/MTCNN/train_step.png" alt></p><p><strong>å…·ä½“çš„æŠ€æœ¯ç»†èŠ‚ï¼š</strong></p><p><strong>(1) å¦‚ä½•æ„é€ é‡‘å­—å¡”ï¼š</strong></p><p>å¦‚æœè¾“å…¥å›¾åƒä¸º100Ã—120, å‡è®¾è¾“å…¥å›¾åƒä¸­å­˜åœ¨ä¸€ä¸ªäººè„¸ï¼Œåˆ™å…¶ä¸­äººè„¸æœ€å°ä¸º20Ã—20ï¼Œæœ€å¤§ä¸º100Ã—100â€”â€”å¯¹åº”å›¾åƒè¾ƒçŸ­è¾¹é•¿, ä¸ºäº†å°†äººè„¸æ”¾ç¼©åˆ°12Ã—12ï¼ŒåŒæ—¶ä¿è¯ç›¸é‚»å±‚é—´ç¼©æ”¾æ¯”ç‡factor=0.709ï¼Œåˆ™é‡‘å­å¡”ä¸­å›¾åƒå°ºå¯¸ä¾æ¬¡ä¸º 60Ã—72ã€52Ã—61ã€36Ã—43ã€26Ã—31ã€18Ã—22ã€13Ã—16ï¼Œå…¶ä¸­60Ã—72å¯¹åº”æŠŠ20Ã—20çš„äººè„¸ç¼©æ”¾åˆ°12Ã—12ï¼Œ13Ã—16å¯¹åº”æŠŠ100Ã—100çš„äººè„¸ç¼©æ”¾åˆ°12Ã—12</p><pre><code class="hljs python"><span class="hljs-comment"># scales for scaling the image</span>scales = [] m = min_detection_size/min_face_sizemin_length *= m factor_count = <span class="hljs-number">0</span><span class="hljs-keyword">while</span> min_length &gt; min_detection_size:      scales.append(m*factor**factor_count)    min_length *= factor      factor_count += <span class="hljs-number">1</span></code></pre><p><strong>(2) å¦‚ä½•ç”Ÿæˆè®­ç»ƒæ•°æ®?</strong></p><p>PNet ç½‘ç»œï¼šposã€partã€neg æ˜¯éšæœºè£å‰ªå¾—åˆ°çš„å›¾åƒï¼Œlandmarkæˆªå–çš„æ˜¯å¸¦æœ‰å…³é”®ç‚¹çš„å›¾åƒã€‚å°†è¿™äº›å›¾åƒéƒ½resizeæˆ12x12 ä½œä¸ºPNetçš„è¾“å…¥ã€‚</p><p>RNetç½‘ç»œï¼šå›¾ç‰‡(é‡‘å­—å¡”ä¹‹å)ç»è¿‡PNet äº§ç”Ÿäº§ç”Ÿçš„å¤§é‡äººè„¸æ¡†ï¼Œç„¶åå°†å…¶resizeä¸º 24x24å¤§å°ä½œä¸ºRnet è¾“å…¥ã€‚</p><p>ONetç½‘ç»œï¼š å›¾ç‰‡(é‡‘å­—å¡”ä¹‹å)ç»è¿‡PNet å’Œ RNet äº§ç”Ÿçš„è¿‡æ»¤åçš„äººè„¸æ¡†ï¼Œç„¶åå°†å…¶ resize ä¸º 48x48å¤§å°ä½œä¸ºONet çš„è¾“å…¥ã€‚</p><p>æ³¨æ„ï¼š</p><ul><li>pos[IoU&gt;0.65]ã€part[0.4&lt;=IoU&lt;0.65]ã€neg[IoU&lt;0.3] </li><li>BBox å’Œ Landmark éƒ½æ˜¯éœ€è¦è¿›è¡Œå½’ä¸€åŒ–çš„</li></ul><p><strong>(2)NMSçš„åŸºæœ¬åŸç†ï¼š</strong> </p><p>éæå¤§å€¼æŠ‘åˆ¶ï¼ˆNMSï¼‰é¡¾åæ€ä¹‰å°±æ˜¯æŠ‘åˆ¶ä¸æ˜¯æå¤§å€¼çš„å…ƒç´ ï¼Œæœç´¢å±€éƒ¨çš„æå¤§å€¼ã€‚</p><ul><li>å°†æ‰€æœ‰æ¡†çš„å¾—åˆ†é™åºæ’åˆ—ï¼Œé€‰ä¸­æœ€é«˜åˆ†åŠå…¶å¯¹åº”çš„æ¡†ã€‚</li><li>éå†å…¶ä½™çš„æ¡†ï¼Œå¦‚æœå’Œå½“å‰æœ€é«˜åˆ†æ¡†çš„é‡å é¢ç§¯(IOU)å¤§äºä¸€å®šé˜ˆå€¼ï¼Œæˆ‘ä»¬å°±å°†æ¡†åˆ é™¤ã€‚</li><li>ä»æœªå¤„ç†çš„æ¡†ä¸­ç»§ç»­é€‰ä¸€ä¸ªå¾—åˆ†æœ€é«˜çš„ï¼Œé‡å¤ä¸Šè¿°è¿‡ç¨‹ã€‚</li></ul><pre><code class="hljs python"><span class="hljs-comment"># nms python cpu å®ç°</span><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">py_cpu_nms</span>(<span class="hljs-params">dets, thresh</span>):</span>    <span class="hljs-string">&quot;&quot;&quot;Pure Python NMS baseline.&quot;&quot;&quot;</span>    x1 = dets[:, <span class="hljs-number">0</span>]    y1 = dets[:, <span class="hljs-number">1</span>]    x2 = dets[:, <span class="hljs-number">2</span>]    y2 = dets[:, <span class="hljs-number">3</span>]    scores = dets[:, <span class="hljs-number">4</span>]    areas = (x2 - x1 + <span class="hljs-number">1</span>) * (y2 - y1 + <span class="hljs-number">1</span>)    order = scores.argsort()[::<span class="hljs-number">-1</span>]    keep = []    <span class="hljs-keyword">while</span> order.size &gt; <span class="hljs-number">0</span>:        i = order[<span class="hljs-number">0</span>]        keep.append(i)        xx1 = np.maximum(x1[i], x1[order[<span class="hljs-number">1</span>:]])        yy1 = np.maximum(y1[i], y1[order[<span class="hljs-number">1</span>:]])        xx2 = np.minimum(x2[i], x2[order[<span class="hljs-number">1</span>:]])        yy2 = np.minimum(y2[i], y2[order[<span class="hljs-number">1</span>:]])        w = np.maximum(<span class="hljs-number">0.0</span>, xx2 - xx1 + <span class="hljs-number">1</span>)        h = np.maximum(<span class="hljs-number">0.0</span>, yy2 - yy1 + <span class="hljs-number">1</span>)        inter = w * h        ovr = inter / (areas[i] + areas[order[<span class="hljs-number">1</span>:]] - inter)        inds = np.where(ovr &lt;= thresh)[<span class="hljs-number">0</span>]        order = order[inds + <span class="hljs-number">1</span>]    <span class="hljs-keyword">return</span> keep</code></pre><p><strong>ï¼ˆ3ï¼‰ä¸‰ä¸ªä»»åŠ¡çš„æŸå¤±æ˜¯ä»€ä¹ˆï¼Ÿå‡½æ•°å¦‚ä½•å¹³è¡¡ï¼Ÿ</strong></p><p>ç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯åˆ†ç±»ä»»åŠ¡ï¼šå…¶æŸå¤±å‡½æ•°ä¸ºäº¤å‰ç†µæŸå¤±å‡½æ•°ã€‚ç¬¬äºŒä¸ªä»»åŠ¡å’Œç¬¬ä¸‰ä¸ªä»»åŠ¡å‡æ˜¯å›å½’ä»»åŠ¡ï¼Œå…¶æŸå¤±æ˜¯å¹³æ–¹å‡å·®æŸå¤±å‡½æ•°ã€‚é€šè¿‡åŠ æƒ $\alpha$ æ¥å¹³è¡¡ä¸‰ä¸ªä»»åŠ¡çš„æƒé‡ï¼šåœ¨ P-Net å’Œ R-Net ä¸­ï¼Œ$\alpha<em>{det}=1$, $\alpha</em>{box}=0.5$, $\alpha<em>{landmark}=0.5$ï¼Œåœ¨O-Netä¸­ï¼Œ$\alpha</em>{det}=1$, $\alpha<em>{box}=0.5$, $\alpha</em>{landmark}=1$</p><p><strong>ï¼ˆ4ï¼‰è®ºæ–‡çš„ä¸»è¦åˆ›æ–°ç‚¹ï¼Ÿ å°½é‡ç®€å•æ¦‚æ‹¬</strong></p><p>â€‹    é€šè¿‡çº§è”ä¸‰ä¸ªå·ç§¯ç¥ç»ç½‘ç»œæ¥å®ç°äººè„¸çš„æ£€æµ‹å’ŒLandmarkå®šä½ã€‚å¦å¤–æœ¬æ–‡ä¹Ÿæå‡ºäº†ä¸€ç§online hard sample miningæ–¹æ³•ï¼Œå…·ä½“å°±æ˜¯åœ¨æ¯ä¸ªmini-batchä¸­ï¼Œå–lossæœ€å¤§çš„70%è¿›è¡Œåå‘ä¼ æ’­ï¼Œå¿½ç•¥é‚£äº›ç®€å•çš„æ ·æœ¬ã€‚</p><p><strong>ï¼ˆ5ï¼‰æœ‰ä»€ä¹ˆæ”¹è¿›æªæ–½ï¼Ÿ</strong></p><ul><li>èå…¥ anchoræœºåˆ¶ï¼Œ åŒæ—¶å¯ä»¥ä¿®æ”¹æŸå¤±å‡½æ•°ä¸º focal loss</li><li>åŠ å¤§æ•°æ®å¢å¼ºæ–¹æ³•</li><li>bnå±‚ã€leakey relu/prelu</li><li>æ¨¡ä»¿shufflenetã€mobilenetè¿›è¡Œæ”¹è¿›æé«˜é€Ÿåº¦</li></ul>]]></content>
    
    
    <categories>
      
      <category>Face</category>
      
    </categories>
    
    
    <tags>
      
      <tag>faceã€MTCNN</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Classification_neural_network</title>
    <link href="/2019/04/13/Classification-neural-network/"/>
    <url>/2019/04/13/Classification-neural-network/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦æ¢³ç†äº†å››ç§ä¸»è¦å¸¸è§çš„åˆ†ç±»ç½‘ç»œ alexnetã€vggã€inceptionã€resnetã€‚</p><a id="more"></a><h3 id="1-Alexnet"><a href="#1-Alexnet" class="headerlink" title="1. Alexnet"></a>1. Alexnet</h3><p>Alexnet å°† LeNet çš„æ€æƒ³å‘æ‰¬å…‰å¤§ï¼ŒæŠŠCNN çš„åŸºæœ¬åŸç†åº”ç”¨åˆ°äº†å¾ˆæ·±å¾ˆå®½çš„ç½‘ç»œä¸­ã€‚</p><p>AlexNet ä¸»è¦ç”¨åˆ°çš„æ–°æŠ€æœ¯ç‚¹å¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰ æˆåŠŸ<strong>ä½¿ç”¨ReLUä½œä¸ºCNN çš„æ¿€æ´»å‡½æ•°</strong>ï¼Œå¹¶éªŒè¯å…¶æ•ˆæœåœ¨è¾ƒæ·±çš„ç½‘ç»œè¶…è¿‡ Sigmoidï¼Œ æˆåŠŸè§£å†³äº†Sigmoidåœ¨ç½‘ç»œè¾ƒæ·±æ—¶çš„æ¢¯åº¦å¼¥æ•£é—®é¢˜ã€‚</p><p>ï¼ˆ2ï¼‰ è®­ç»ƒæ—¶<strong>ä½¿ç”¨Dropoutéšæœºå¿½ç•¥ä¸€éƒ¨åˆ†ç¥ç»å…ƒï¼Œä»¥é¿å…è¿‡æ‹Ÿåˆ</strong>ã€‚</p><p>ï¼ˆ3ï¼‰åœ¨CNNä¸­<strong>ä½¿ç”¨é‡å çš„æœ€å¤§æ± åŒ–</strong>ã€‚æ­¤å‰CNN ä¸­æ™®éé‡‡ç”¨å¹³å‡æ± åŒ–,AlexNet å…¨éƒ¨ä½¿ç”¨æœ€å¤§æ± åŒ–ï¼Œé¿å…å¹³å‡æ± åŒ–çš„æ¨¡ç³ŠåŒ–æ•ˆæœã€‚å¹¶ä¸” AlexNet ä¸­æå‡ºè®©æ­¥é•¿æ¯”æ± åŒ–æ ¸çš„å°ºå¯¸å°ï¼Œè¿™æ ·æ± åŒ–å±‚çš„è¾“å‡ºä¹‹é—´æœ‰é‡å å’Œè¦†ç›–ï¼Œæé«˜äº†ç‰¹å¾çš„ä¸°å¯Œæ€§ã€‚</p><p>ï¼ˆ4ï¼‰æå‡º<strong>LRNå±‚ï¼Œå¯¹å±€éƒ¨ç¥ç»å…ƒçš„æ´»åŠ¨åˆ›å»ºç«äº‰æœºåˆ¶</strong>ï¼Œä½¿å¾—å…¶ä¸­å“åº”æ¯”è¾ƒå¤§çš„å€¼å˜å¾—ç›¸å¯¹æ›´å¤§ï¼Œå¹¶æŠ‘åˆ¶å…¶ä»–åé¦ˆè¾ƒå°çš„ç¥ç»å…ƒï¼Œå¢å¼ºæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚</p><p>ï¼ˆ5ï¼‰ <strong>ä½¿ç”¨CUDAåŠ é€Ÿæ·±åº¦å·ç§¯ç½‘ç»œçš„è®­ç»ƒ</strong>ï¼Œåˆ©ç”¨GPUå¼ºå¤§çš„å¹¶è¡Œèƒ½åŠ›ï¼Œå¤„ç†ç¥ç»ç½‘ç»œè®­ç»ƒæ—¶å¤§é‡çš„çŸ©é˜µè¿ç®—ã€‚</p><p>ï¼ˆ6ï¼‰<strong>æ•°æ®å¢å¼º</strong>ï¼Œéšæœºåœ°ä» 256 x 256 çš„åŸå§‹å›¾åƒä¸­æˆªå– 224 x 224 å¤§å°çš„åŒºåŸŸï¼ˆä»¥åŠæ°´å¹³ç¿»è½¬çš„é•œåƒï¼‰ç›¸å½“äºå¢åŠ äº†(256-224)^2 * 2 = 2048 å€çš„æ•°æ®é‡ã€‚å¤§å¤§å‡è½»äº†æ¨¡å‹è¿‡æ‹Ÿåˆï¼Œæå‡æ³›åŒ–èƒ½åŠ›ã€‚åŒæ—¶ AlexNet è®ºæ–‡ä¸­æåˆ°äº†ä¼šå¯¹å›¾åƒçš„RGB æ•°æ®è¿›è¡ŒPCA å¤„ç†ï¼Œå¹¶å¯¹ä¸»æˆåˆ†åšä¸€ä¸ªæ ‡å‡†å·®ä¸º0.1çš„é«˜æ–¯æ‰°åŠ¨ï¼Œ å¢åŠ ä¸€äº›å™ªå£°ã€‚</p><p><img src="/2019/04/13/Classification-neural-network/Alexnet.png" alt></p><h3 id="2-VGGNet"><a href="#2-VGGNet" class="headerlink" title="2. VGGNet"></a>2. VGGNet</h3><p><strong>VGGNetæ¢ç´¢äº†å·ç§¯ç¥ç»ç½‘ç»œçš„æ·±åº¦ä¸å…¶æ€§èƒ½ä¹‹é—´çš„å…³ç³»ï¼Œé€šè¿‡åå¤å †å 3x3çš„å°å‹å·ç§¯æ ¸å’Œ2x2 çš„æœ€å¤§æ± åŒ–å±‚ï¼Œ VGGnetæˆåŠŸæ„ç­‘äº†16~19å±‚æ·±çš„å·ç§¯ç¥ç»ç½‘ç»œ</strong>ã€‚</p><p>ï¼ˆ1ï¼‰<strong>é€šè¿‡å°†å¤šä¸ªå·ç§¯å±‚å †å åœ¨ä¸€èµ·ï¼Œå¯ä»¥å‡å°‘å‚æ•°æ•°ç›®çš„åŒæ—¶å¢åŠ å·ç§¯å±‚çš„éçº¿æ€§å˜æ¢ï¼Œä½¿å¾—CNN å¯¹ç‰¹å¾çš„å­¦ä¹ èƒ½åŠ›æ›´å¼º</strong>ã€‚</p><p>ï¼ˆ2ï¼‰VGGNet åœ¨è®­ç»ƒæ—¶æœ‰ä¸ªå°æŠ€å·§ï¼Œå…ˆè®­ç»ƒçº§åˆ«A çš„ç®€å•ç½‘ç»œï¼Œå†å¤ç”¨Aç½‘ç»œçš„æƒé‡æ¥åˆå§‹åŒ–åé¢å‡ ä¸ªå¤æ‚æ¨¡å‹ï¼Œè¿™æ ·è®­ç»ƒæ”¶æ•›çš„é€Ÿåº¦æ›´å¿«ã€‚</p><p>ï¼ˆ3ï¼‰åœ¨æµ‹è¯•ï¼ŒVGG é‡‡ç”¨äº† Multi-Scale çš„æ–¹æ³•ï¼Œå°† å›¾åƒscaleåˆ°ä¸€ä¸ªå°ºå¯¸Qï¼Œ å¹¶å°†å›¾ç‰‡è¾“å…¥å·ç§¯ç½‘ç»œè¿ç®—ã€‚å†å°†ä¸åŒå°ºå¯¸Qçš„ç»“æœå¹³å‡å¾—åˆ°æœ€åç»“æœï¼Œè¿™æ ·æé«˜å›¾ç‰‡æ•°æ®çš„åˆ©ç”¨ç‡å¹¶æå‡å‡†ç¡®ç‡ã€‚åŒæ—¶åœ¨è®­ç»ƒä¸­è¿˜æ˜¯ç”¨äº†Multi-Scale çš„æ–¹æ³•åšæ•°æ®å¢å¼ºã€‚</p><p><img src="/2019/04/13/Classification-neural-network/vgg.jpg" alt></p><h3 id="3-Google-Inception-Net"><a href="#3-Google-Inception-Net" class="headerlink" title="3. Google Inception Net"></a>3. Google Inception Net</h3><p>ï¼ˆ1ï¼‰<strong>ç²¾å¿ƒè®¾è®¡äº† Inception Moduleæé«˜å‚æ•°çš„åˆ©ç”¨æ•ˆç‡ï¼Œå…¶ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼ŒInception Moduleä¸­åŒ…å«3ç§ä¸åŒå°ºå¯¸çš„å·ç§¯æ ¸1ä¸ªæœ€å¤§æ± åŒ–ï¼Œå¢åŠ äº†ç½‘ç»œå¯¹ä¸åŒå°ºåº¦çš„é€‚åº”æ€§</strong>ã€‚</p><p>ç¬¬ä¸€ä¸ªåˆ†æ”¯å¯¹è¾“å…¥è¿›è¡Œ 1x1å·ç§¯ï¼Œ<strong>1x1å·ç§¯å¯ä»¥è·¨é€šé“ç»„ç»‡ä¿¡æ¯ï¼Œæé«˜ç½‘ç»œçš„è¡¨è¾¾èƒ½åŠ›ï¼ŒåŒæ—¶å¯ä»¥å¯¹è¾“å‡ºé€šé“å‡ç»´å’Œé™ç»´</strong>ã€‚</p><p>ç¬¬äºŒä¸ªåˆ†æ”¯å…ˆä½¿ç”¨äº† 1x1 å·ç§¯ï¼Œç„¶åè¿æ¥ 3x3 å·ç§¯ï¼Œç›¸å½“äºè¿›è¡Œä¸¤æ¬¡ç‰¹å¾å˜æ¢ã€‚</p><p>ç¬¬ä¸‰ä¸ªåˆ†æ”¯å’Œç¬¬äºŒä¸ªåˆ†æ”¯ç±»ä¼¼ï¼Œå…ˆæ˜¯ä½¿ç”¨äº†1x1 çš„å·ç§¯ï¼Œç„¶åè¿æ¥ 5x5 çš„å·ç§¯ã€‚</p><p>æœ€åä¸€ä¸ªåˆ†æ”¯åˆ™æ˜¯3x3 æœ€å¤§æ± åŒ–åç›´æ¥ä½¿ç”¨1x1å·ç§¯ã€‚</p><p>Inception Module çš„4ä¸ªåˆ†æ”¯åœ¨æœ€åé€šè¿‡ä¸€ä¸ªèšåˆæ“ä½œåˆå¹¶ï¼ˆå†è¾“å‡ºé€šé“è¿™ä¸ªç»´åº¦ä¸Šèšåˆï¼‰</p><p><img src="/2019/04/13/Classification-neural-network/inception.png" alt="img"></p><p>ï¼ˆ2ï¼‰ <strong>å»é™¤äº†æœ€åçš„å…¨è¿æ¥å±‚ï¼Œç”¨å…¨å±€å¹³å‡æ± åŒ–å±‚æ¥å–ä»£å®ƒ</strong>ã€‚</p><h3 id="4-ResNet"><a href="#4-ResNet" class="headerlink" title="4. ResNet"></a>4. ResNet</h3><p>â€‹    <strong>ResNet é€šè¿‡è°ƒæ•´ç½‘ç»œç»“æ„æ¥è§£å†³æ¢¯åº¦æ¶ˆå¤±é—®é¢˜</strong>ï¼ˆåå‘ä¼ æ’­æ—¶ï¼Œæ¢¯åº¦å°†æ¶‰åŠå¤šå±‚å‚æ•°çš„äº¤å‰ç›¸ä¹˜ï¼Œå¯èƒ½ä¼šåœ¨ç¦»è¾“å…¥è¿‘çš„ç½‘ç»œå±‚ä¸­äº§ç”Ÿæ¢¯åº¦æ¶ˆå¤±çš„ç°è±¡ï¼‰ã€‚é¦–å…ˆè€ƒè™‘ä¸¤å±‚ç¥ç»ç½‘ç»œçš„ç®€å•å åŠ ï¼Œè¿™æ—¶  x ç»è¿‡ä¸¤ä¸ªç½‘ç»œå±‚çš„å˜æ¢å¾—åˆ°H(x),  æ¿€æ´»å‡½æ•°é‡‡ç”¨ ReLUï¼Œ å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æ—¢ç„¶ç¦»è¾“å…¥è¿‘çš„ç¥ç»ç½‘ç»œå±‚è¾ƒéš¾è®­ç»ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†å®ƒçŸ­æ¥åˆ°æ›´é è¿‘è¾“å‡ºçš„å±‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚è¾“å…¥  ç»è¿‡ä¸¤ä¸ªç¥ç»ç½‘ç»œå˜æ¢å¾—åˆ°F(x) , åŒæ—¶ä¹ŸçŸ­æ¥åˆ°ä¸¤å±‚ä¹‹åï¼Œæœ€åè¿™ä¸ªåŒ…å«ä¸¤å±‚çš„ç¥ç»ç½‘ç»œæ¨¡å—è¾“å‡ºH(x) = F(x) + x ã€‚è¿™æ ·ä¸€æ¥ï¼ŒF(x) è¢«è®¾è®¡ä¸ºåªéœ€è¦æ‹Ÿåˆè¾“å…¥xä¸ç›®æ ‡è¾“å…¥H(x)çš„æ®‹å·®H(x)-x ï¼Œ æ®‹å·®ç½‘ç»œçš„åç§°ä¹Ÿå› æ­¤è€Œæ¥ã€‚å¦‚æœæŸä¸€å±‚çš„è¾“å‡ºå·²ç»è¾ƒå¥½çš„æ‹Ÿåˆäº†æœŸæœ›ç»“æœï¼Œé‚£ä¹ˆå¤šåŠ å…¥ä¸€å±‚ä¹Ÿä¸ä¼šä½¿å¾—æ¨¡å‹å˜å¾—æ›´å·®ï¼Œå› ä¸ºè¯¥å±‚çš„è¾“å‡ºå°†ç›´æ¥çŸ­æ¥åˆ°ä¸¤å±‚ä¹‹åï¼Œç›¸å½“äºç›´æ¥å­¦ä¹ äº†ä¸€ä¸ªæ’ç­‰æ˜ å°„ï¼Œè€Œè·³è¿‡çš„ä¸¤å±‚åªéœ€è¦æ‹Ÿåˆä¸Šå±‚è¾“å‡ºå’Œç›®æ ‡ä¹‹é—´çš„æ®‹å·®å³å¯ã€‚</p><p><img src="/2019/04/13/Classification-neural-network/resnet.png" alt="img"></p>]]></content>
    
    
    
    <tags>
      
      <tag>classification</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>efficient-conv</title>
    <link href="/2019/04/13/efficient-conv/"/>
    <url>/2019/04/13/efficient-conv/</url>
    
    <content type="html"><![CDATA[<p><img src="/2019/04/13/efficient-conv/1.png" alt></p><p>ï¼ï¼ï¼ å…ˆæŒ–ä¸ªå‘å§ï¼Œç­‰æœ‰ç©ºå†å¡«ï¼Œç°åœ¨æ˜¯æ²¡æœ‰æ—¶é—´äº†ğŸ¤£</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>mobile-neural-network-engine-design</title>
    <link href="/2019/04/13/mobile-neural-network-engine-design/"/>
    <url>/2019/04/13/mobile-neural-network-engine-design/</url>
    
    <content type="html"><![CDATA[<h4 id="1-åŸºäºC-C-çš„åŸºæœ¬ä¼˜åŒ–"><a href="#1-åŸºäºC-C-çš„åŸºæœ¬ä¼˜åŒ–" class="headerlink" title="1. åŸºäºC/C++çš„åŸºæœ¬ä¼˜åŒ–"></a>1. åŸºäºC/C++çš„åŸºæœ¬ä¼˜åŒ–</h4><ol><li><p>ç¼–è¯‘å™¨å¾ˆç‰›é€¼ï¼ŒGCC/CLANG éƒ½æœ‰è¿è¡Œé€Ÿåº¦çš„ä¼˜åŒ–é€‰é¡¹ï¼Œæ‰“å¼€è¿™äº›é€‰é¡¹èƒ½å¸®åŠ©ç¨‹åºæ˜¾è‘—æå‡é€Ÿåº¦ï¼Œè™½ç„¶è¿™è¿˜è¿œè¿œä¸å¤Ÿï¼Œä½†èŠèƒœäºæ— å§ã€‚</p><p>ä¸‹é¢æ˜¯ ncnn ç¤ºä¾‹é¡¹ç›®ä¸­çš„ä¸€æ®µä»£ç :</p><pre><code class="hljs cmake"><span class="hljs-comment"># ncnn/examples/squeezencnn/jni/Android.mk</span>LOCAL_CFLAGS := -O2 -fvisibility=hidden -fomit-frame-pointer -fstrict-aliasing -ffunction-sections -fdata-sections -ffast-<span class="hljs-keyword">math</span>LOCAL_CPPFLAGS := -O2 -fvisibility=hidden -fvisibility-inlines-hidden -fomit-frame-pointer -fstrict-aliasing -ffunction-sections -fdata-sections -ffast-<span class="hljs-keyword">math</span>LOCAL_LDFLAGS += -Wl,--gc-sections</code></pre><p>ä»¥å‰å·¥ä½œæ—¶å€™å†™çš„CMakeLists ä¸­çš„ä»£ç ï¼š</p><pre><code class="hljs cmake"><span class="hljs-comment"># set(CMAKE_BUILD_TYPE Release)</span><span class="hljs-keyword">if</span> (CMAKE_BUILD_TYPE <span class="hljs-keyword">STREQUAL</span> <span class="hljs-string">&quot;Debug&quot;</span>)    <span class="hljs-keyword">set</span>(CMAKE_CXX_FLAGS_DEBUG <span class="hljs-string">&quot;$ENV&#123;CXXFLAGS&#125; -O0 -Wall -g2 -ggdb&quot;</span>)    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;CMAKE_BUILD_TYPE = Debug&quot;</span>)<span class="hljs-keyword">else</span>()    <span class="hljs-keyword">set</span>(CMAKE_CXX_FLAGS_RELEASE <span class="hljs-string">&quot;$ENV&#123;CXXFLAGS&#125; -O3 -Wall&quot;</span>)    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;CMAKE_BUILD_TYPE = Release&quot;</span>)<span class="hljs-keyword">endif</span>()</code></pre></li><li><p>ä¹¦å†™é«˜æ•ˆçš„Cä»£ç ã€‚å¾ªç¯å±•å¼€ã€å†…è”ã€åˆ†æ”¯ä¼˜åŒ–ï¼Œé¿å…é™¤æ³•ï¼ŒæŸ¥è¡¨ç­‰ä¼˜åŒ–å°æŠ€å·§è¦æ»šç“œçƒ‚ç†Ÿï¼Œä¿¡æ‰‹æ‹ˆæ¥ã€‚</p></li><li><p>å¿…é¡»çœ‹å¾—æ‡‚æ±‡ç¼–ï¼Œå³ä½¿ä½ ä¸å†™ï¼Œä¹Ÿè¦çŸ¥é“ç¼–è¯‘å™¨ç¼–è¯‘å‡ºæ¥çš„æ±‡ç¼–ä»£ç æ•ˆç‡å¦‚ä½•ã€‚è¿™æ ·ä½ å¯ä»¥é€šè¿‡è°ƒæ•´C/C++ä»£ç ï¼Œè®©ç¼–è¯‘å™¨ç”Ÿæˆä½ éœ€è¦çš„ä»£ç ã€‚</p></li></ol><h4 id="2-ç¼“å­˜å‹å¥½"><a href="#2-ç¼“å­˜å‹å¥½" class="headerlink" title="2. ç¼“å­˜å‹å¥½"></a>2. ç¼“å­˜å‹å¥½</h4><h5 id="ï¼ˆ1ï¼‰å°‘ç”¨å†…å­˜"><a href="#ï¼ˆ1ï¼‰å°‘ç”¨å†…å­˜" class="headerlink" title="ï¼ˆ1ï¼‰å°‘ç”¨å†…å­˜"></a>ï¼ˆ1ï¼‰å°‘ç”¨å†…å­˜</h5><h5 id="ï¼ˆ2ï¼‰è¿ç»­è®¿é—®ã€å¯¹é½è®¿é—®ã€åˆå¹¶è®¿é—®ã€æ˜¾ç¤ºå¯¹é½æ•°æ®åŠ è½½ã€ç¼“å­˜é¢„å–"><a href="#ï¼ˆ2ï¼‰è¿ç»­è®¿é—®ã€å¯¹é½è®¿é—®ã€åˆå¹¶è®¿é—®ã€æ˜¾ç¤ºå¯¹é½æ•°æ®åŠ è½½ã€ç¼“å­˜é¢„å–" class="headerlink" title="ï¼ˆ2ï¼‰è¿ç»­è®¿é—®ã€å¯¹é½è®¿é—®ã€åˆå¹¶è®¿é—®ã€æ˜¾ç¤ºå¯¹é½æ•°æ®åŠ è½½ã€ç¼“å­˜é¢„å–"></a>ï¼ˆ2ï¼‰è¿ç»­è®¿é—®ã€å¯¹é½è®¿é—®ã€åˆå¹¶è®¿é—®ã€æ˜¾ç¤ºå¯¹é½æ•°æ®åŠ è½½ã€ç¼“å­˜é¢„å–</h5><h4 id="3-å¤šçº¿ç¨‹"><a href="#3-å¤šçº¿ç¨‹" class="headerlink" title="3. å¤šçº¿ç¨‹"></a>3. å¤šçº¿ç¨‹</h4><h5 id="1-OpenMP"><a href="#1-OpenMP" class="headerlink" title="1. OpenMP"></a>1. OpenMP</h5><p>OpenMPä¼šè‡ªåŠ¨ä¸ºå¾ªç¯åˆ†é…çº¿ç¨‹ï¼Œä½¿ç”¨OpenMPåŠ é€Ÿåªéœ€è¦åœ¨ä¸²è¡Œä»£ç ä¸­æ·»åŠ ç¼–è¯‘æŒ‡ä»¤ä»¥åŠå°‘é‡APIå³å¯ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼ŒåŠ é€Ÿæ¯”å¤§çº¦èƒ½è¾¾åˆ°0.75*coresã€‚</p><pre><code class="hljs cpp"><span class="hljs-comment">// ncnn/src/layer/relu.cpp</span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">ReLU::forward_inplace</span><span class="hljs-params">(Mat&amp; bottom_top_blob, <span class="hljs-keyword">const</span> Option&amp; opt)</span> <span class="hljs-keyword">const</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span> (bottom_top_blob.elemsize == <span class="hljs-number">1u</span>)        <span class="hljs-keyword">return</span> ReLU::forward_inplace_int8(bottom_top_blob, opt);    <span class="hljs-keyword">int</span> w = bottom_top_blob.w;    <span class="hljs-keyword">int</span> h = bottom_top_blob.h;    <span class="hljs-keyword">int</span> channels = bottom_top_blob.c;    <span class="hljs-keyword">int</span> size = w * h;    <span class="hljs-keyword">if</span> (slope == <span class="hljs-number">0.f</span>)    &#123;        <span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> omp parallel for num_threads(opt.num_threads)</span>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> q=<span class="hljs-number">0</span>; q&lt;channels; q++)        &#123;            <span class="hljs-keyword">float</span>* ptr = bottom_top_blob.channel(q);            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;size; i++)            &#123;                <span class="hljs-keyword">if</span> (ptr[i] &lt; <span class="hljs-number">0</span>)                    ptr[i] = <span class="hljs-number">0</span>;            &#125;        &#125;    &#125;    <span class="hljs-keyword">else</span>    &#123;        #pragma omp parallel <span class="hljs-keyword">for</span> num_threads(opt.num_threads)        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> q=<span class="hljs-number">0</span>; q&lt;channels; q++)        &#123;            <span class="hljs-keyword">float</span>* ptr = bottom_top_blob.channel(q);            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;size; i++)            &#123;                <span class="hljs-keyword">if</span> (ptr[i] &lt; <span class="hljs-number">0</span>)                    ptr[i] *= slope;            &#125;        &#125;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>â€‹    ä½†å¹¶éæ‰€æœ‰å¾ªç¯éƒ½é€‚åˆåšå¤šçº¿ç¨‹ä¼˜åŒ–ï¼Œå¦‚æœæ¯æ¬¡å¾ªç¯åªåšäº†éå¸¸å°‘çš„äº‹æƒ…ï¼Œé‚£ä¹ˆä½¿ç”¨å¤šçº¿ç¨‹ä¼šå¾—ä¸å¿å¤±ã€‚å®é™…è¿ç”¨ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>#pragma omp parallel for if (cond)</code> è¯­å¥æ¥åˆ¤æ–­runtimeè¿‡ç¨‹ä¸­æ˜¯å¦è¦å¯ç”¨å¤šçº¿ç¨‹ã€‚</p><h5 id="åŠ¨æ€è°ƒåº¦"><a href="#åŠ¨æ€è°ƒåº¦" class="headerlink" title="åŠ¨æ€è°ƒåº¦"></a>åŠ¨æ€è°ƒåº¦</h5><h5 id="ç¨€ç–åŒ–"><a href="#ç¨€ç–åŒ–" class="headerlink" title="ç¨€ç–åŒ–"></a>ç¨€ç–åŒ–</h5><h5 id="å®šç‚¹åŒ–"><a href="#å®šç‚¹åŒ–" class="headerlink" title="å®šç‚¹åŒ–"></a>å®šç‚¹åŒ–</h5><h5 id="NEON-æ±‡ç¼–"><a href="#NEON-æ±‡ç¼–" class="headerlink" title="NEON æ±‡ç¼–"></a>NEON æ±‡ç¼–</h5><h4 id="4-å†…å­˜ç²¾ç®€"><a href="#4-å†…å­˜ç²¾ç®€" class="headerlink" title="4. å†…å­˜ç²¾ç®€"></a>4. å†…å­˜ç²¾ç®€</h4><p>æ¯ä¸ªlayeréƒ½ä¼šäº§ç”Ÿblobï¼Œé™¤äº†æœ€åçš„ç»“æœå’Œå¤šåˆ†æ”¯ä¸­é—´ç»“æœï¼Œå¤§éƒ¨åˆ†blobéƒ½å¯ä»¥ä¸ä¿ç•™ï¼Œå¼€å¯ncnnçš„è½»æ¨¡å¼å¯ä»¥åœ¨è¿ç®—åè‡ªåŠ¨å›æ”¶ï¼Œçœä¸‹å†…å­˜ã€‚  å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/2019/04/13/mobile-neural-network-engine-design/1.png" alt>æŸç½‘ç»œç»“æ„ä¸º <code>Conv</code> -&gt; <code>Bias</code> -&gt; <code>ReLU</code> -&gt; <code>Concat</code>ï¼Œåœ¨è½»æ¨¡å¼ä¸‹ï¼Œå‘ncnnç´¢è¦Concatç»“æœæ—¶ï¼ŒConvç»“æœä¼šåœ¨è¿ç®—Biasæ—¶è‡ªåŠ¨å›æ”¶ï¼Œè€ŒBaisç»“æœä¼šåœ¨è¿ç®—ReLUæ—¶è‡ªåŠ¨å›æ”¶ï¼Œè€ŒReLUç»“æœä¼šåœ¨è¿ç®—Concatæ—¶è‡ªåŠ¨å›æ”¶, æœ€ååªä¿ç•™Concatç»“æœï¼Œåé¢å†éœ€è¦Cç»“æœä¼šç›´æ¥è·å¾—ï¼Œæ»¡è¶³ç»å¤§éƒ¨åˆ†æ·±åº¦ç½‘ç»œçš„ä½¿ç”¨æ–¹å¼ã€‚ncnn å¼€å¯è½»æ¨¡å¼ä»…éœ€è¦ä¸€è¡Œä»£ç :</p><pre><code class="hljs cpp">set_light_mode(<span class="hljs-literal">true</span>)</code></pre><p>ç›¸å…³å‚è€ƒèµ„æ–™ï¼š</p><p><a href="https://m.facebook.com/notes/facebook-engineering/three-optimization-tips-for-c/10151361643253920">Three-optimization-tips-for-c</a></p><p><a href="https://www.ibm.com/developerworks/cn/aix/library/au-aix-openmp-framework/index.html">é€šè¿‡GCCå­¦ä¹ OpenMPæ¡†æ¶</a></p><p><a href="https://www.openmp.org/">OPEN MPå®˜ç½‘</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>create user and setup security</title>
    <link href="/2019/04/12/create-user-and-setup-security/"/>
    <url>/2019/04/12/create-user-and-setup-security/</url>
    
    <content type="html"><![CDATA[<p>Letâ€™s create a new user and then setup some security.</p><h3 id="1-New-User"><a href="#1-New-User" class="headerlink" title="1. New User"></a>1. New User</h3><p>login first</p><pre><code class="hljs shell">mkdfideloper<span class="hljs-meta">#</span><span class="bash"> Create password, skip extra field and Set Y to save the new user</span></code></pre><p>Become new user fideloper</p><pre><code class="hljs ebnf"><span class="hljs-attribute">sudo su fideloper</span></code></pre><p>Head to home directory</p><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> ~/</code></pre><p>See the file path</p><pre><code class="hljs bash"><span class="hljs-built_in">pwd</span> <span class="hljs-comment"># /home/ubuntu</span></code></pre><h3 id="2-Setup-SSH-Key-Authentication"><a href="#2-Setup-SSH-Key-Authentication" class="headerlink" title="2 . Setup SSH Key Authentication"></a>2 . Setup SSH Key Authentication</h3><p>We can re-use the SSH key we created to allow us to log in as user root. On our Mac, we can get the public key into our clipboard again:</p><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> On our host (Macintosh):</span>cat ~/.ssh/id_sfh_start.pub | pbcopy</code></pre><p>Then over in the server, add that public key to user fideloperâ€™s authorized_keys file:</p><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> Logged <span class="hljs-keyword">in</span> as user fideloper</span>cd ~mkdir .sshvim .ssh/authorized_keys <span class="hljs-meta">#</span><span class="bash"> Paste <span class="hljs-keyword">in</span> the public key </span></code></pre><h3 id="3-Disallow-Root-Login"><a href="#3-Disallow-Root-Login" class="headerlink" title="3. Disallow Root Login"></a>3. Disallow Root Login</h3><p>First, we want user fideloper to be able to use sudo commands, so we donâ€™t need the root user to perform administrative tasks.</p><pre><code class="hljs dockerfile">sudo <span class="hljs-keyword">user</span></code></pre><p>We can do this easily in Ubuntu by adding the user fideloper to the group sudo or admin (More explanation on that within the video).</p><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> Append (-a) secondary group (-G) <span class="hljs-string">&quot;admin&quot;</span> to user <span class="hljs-string">&quot;fideloper&quot;</span></span>usermod -aG admin fideloper</code></pre><p>Then log out, and log back in as user fideloper and youâ€™ll be able to use sudocommands. Next, letâ€™s secure our server further and disallow root. </p><h4 id="Configure-SSH"><a href="#Configure-SSH" class="headerlink" title="Configure SSH"></a>Configure SSH</h4><p>Now that user fideloper can do administrative tasks (thingsrequiring super user access), letâ€™s edit the SSH daemonconfiguration to change this.</p><p>Weâ€™ll do two things:</p><ul><li><p>Disallow password based authentication</p></li><li><p>Disallow root user login</p></li></ul><p>Do to that, we update the file <code>/etc/ssh/sshd_config</code> and change the following: </p><pre><code class="hljs yaml"><span class="hljs-comment"># Disallow root login over ssh</span><span class="hljs-string">PermitRootLogin</span> <span class="hljs-literal">no</span> <span class="hljs-comment"># Disallow password authentication</span><span class="hljs-string">PasswordAuthentication</span> <span class="hljs-literal">no</span></code></pre><p> Then restart the SSH daemon: </p><pre><code class="hljs routeros">sudo<span class="hljs-built_in"> service </span>ssh restart</code></pre><p>And youâ€™re all set!</p><p><strong>reference</strong>:<a href="https://serversforhackers.com/c/creating-users-">https://serversforhackers.com/c/creating-users-</a> and-ssh-security</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>img2col</title>
    <link href="/2019/04/12/img2col/"/>
    <url>/2019/04/12/img2col/</url>
    
    <content type="html"><![CDATA[<h4 id="1-im2col-åŸºæœ¬åŸç†"><a href="#1-im2col-åŸºæœ¬åŸç†" class="headerlink" title="1. im2col åŸºæœ¬åŸç†"></a>1. im2col åŸºæœ¬åŸç†</h4><p><strong>(1) å¯¹äºå›¾åƒçš„å˜æ¢ï¼š</strong></p><p>é¦–å…ˆå°†æ¯ä¸ªå·ç§¯æ‰€å·ç§¯çš„åŒºåŸŸä½œä¸ºä¸€è¡Œï¼Œæ‰€æœ‰çš„å·ç§¯åŒºåŸŸçºµå‘æ’åˆ—ï¼Œä½œä¸ºå³ä¹˜çŸ©é˜µã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¤šä¸ªé€šé“åº”è¯¥å †å åœ¨ä¸‹é¢ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p>å•é€šé“ï¼š</p><p><img src="/2019/04/12/img2col/1.jpeg" alt="img"></p><p>å¤šé€šé“ï¼š</p><p><img src="/2019/04/12/img2col/2.jpeg" alt="img"></p><p><strong>è¾“å…¥ç‰¹å¾å›¾è½¬åŒ–å¾—åˆ°çš„çŸ©é˜µå°ºåº¦ = (å·ç§¯ç»„è¾“å…¥é€šé“æ•°*å·ç§¯æ ¸é«˜*å·ç§¯æ ¸å®½) * (å·ç§¯å±‚è¾“å‡ºå•é€šé“ç‰¹å¾å›¾é«˜ * å·ç§¯å±‚è¾“å‡ºå•é€šé“ç‰¹å¾å›¾å®½)</strong></p><p><strong>(2) å¯¹äºå·ç§¯æ ¸çš„å˜æ¢</strong></p><p>å°†ä¸€ä¸ªå·ç§¯æ ¸æ‹‰ä¼¸ä¸ºä¸€ä¸ªæ¨ªè¡Œï¼Œä½œä¸ºå·¦ä¹˜çŸ©é˜µï¼š(ä¸ºä»€ä¹ˆè¦æ‹‰ä¼¸ä¸ºæ¨ªè¡Œï¼Œåœ¨äºå¯¹åº”çš„å·ç§¯åŒºåŸŸæ‹‰ä¼¸ä¸ºç«–è¡Œï¼Œè¿™æ ·æ‰èƒ½ä¸ä¹‹ç›¸å¯¹åº”ï¼Œè¿›è¡ŒçŸ©é˜µä¹˜æ³•)</p><p><img src="/2019/04/12/img2col/3.jpeg" alt="img"></p><p><strong>æƒå€¼çŸ©é˜µå°ºåº¦ = (è¾“å‡ºå±‚é€šé“æ•°) * (å·ç§¯è¾“å…¥é€šé“æ•°*å·ç§¯æ ¸é«˜*å·ç§¯æ ¸å®½)</strong></p><p><strong>(3) å°†å·ç§¯æ ¸çŸ©é˜µæ ¸å›¾åƒçŸ©é˜µç›¸ä¹˜å³å¯</strong></p><p><img src="/2019/04/12/img2col/4.jpeg" alt="img"></p><p><strong>å·ç§¯å±‚è¾“å‡ºå°ºåº¦ = (å·ç§¯å±‚è¾“å‡ºé€šé“æ•°) * (å·ç§¯å±‚è¾“å‡ºå•é€šé“ç‰¹å¾å›¾é«˜ * å·ç§¯å±‚è¾“å‡ºå•é€šé“ç‰¹å¾å›¾å®½)</strong></p><p>æœ€åéœ€è¦å°†ç»“æœè°ƒæ•´æˆä¸ºéœ€è¦çš„å¤§å°ï¼š </p><p><img src="/2019/04/12/img2col/5.jpeg" alt="img"></p><p><strong>(4) å¯¹äºå¤šä¸ªè¾“å‡ºé€šé“å›¾åƒçš„å·ç§¯</strong></p><p>åº”è¯¥çºµå‘å †å æ¯ä¸ªå·ç§¯å±‚</p><p><img src="/2019/04/12/img2col/6.jpeg" alt="img"></p><p>æœ€åå†è°ƒæ•´è¾“å‡ºçŸ©é˜µï¼š</p><p><img src="/2019/04/12/img2col/7.jpeg" alt="img"></p><h4 id="2-æ€»ä½“ç®€å›¾ï¼š"><a href="#2-æ€»ä½“ç®€å›¾ï¼š" class="headerlink" title="2. æ€»ä½“ç®€å›¾ï¼š"></a>2. æ€»ä½“ç®€å›¾ï¼š</h4><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ•´ä½“çŸ©é˜µä¹˜æ³•çš„ç®€å›¾ï¼š</p><p><img src="/2019/04/12/img2col/8.jpeg" alt="img"></p><h4 id="3-im2col-cpu-æºç å‰–æ"><a href="#3-im2col-cpu-æºç å‰–æ" class="headerlink" title="3. im2col_cpu æºç å‰–æ"></a>3. im2col_cpu æºç å‰–æ</h4><p>im2col_cpuå‡½æ•°å°†å·ç§¯å±‚è¾“å…¥è½¬åŒ–ä¸ºçŸ©é˜µç›¸ä¹˜çš„å³å…ƒï¼Œæ ¸å¿ƒæ˜¯5ä¸ªforå¾ªç¯ï¼Œé¦–å…ˆç¬¬ä¸€ä¸ªforå¾ªç¯è¡¨ç¤ºæŒ‰ç…§è¾“å…¥çš„é€šé“æ•°é€ä¸ªå¤„ç†å·ç§¯å±‚è¾“å…¥çš„ç‰¹å¾å›¾ï¼Œä¸‹é¢ç¬”è€…å°†ç”¨å›¾ç¤ºè¡¨ç¤ºå‰©ä½™çš„å››ä¸ªforå¾ªç¯æ“ä½œï¼Œå‘è¯»è€…æœ‹å‹ä»¬å±•ç¤ºå·ç§¯å±‚è¾“å…¥çš„å•é€šé“ç‰¹å¾å›¾æ˜¯é€šè¿‡æ€æ ·çš„æ–¹å¼è½¬åŒ–ä¸ºä¸€ä¸ªçŸ©é˜µã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å‡è®¾ï¼Œå·ç§¯å±‚è¾“å…¥å•é€šé“ç‰¹å¾å›¾åŸå¤§å°ä¸º5*5ï¼Œé«˜å’Œå®½æ–¹å‘çš„padä¸º1ï¼Œé«˜å’Œå®½æ–¹å‘æ­¥é•¿ä¸º2ï¼Œå·ç§¯æ ¸ä¸è¿›è¡Œæ‰©å±•ã€‚</p><p>  æˆ‘ä»¬å…ˆè®¡ç®—ä¸€ä¸‹ï¼Œå·ç§¯å±‚è¾“å…¥å•é€šé“ç‰¹å¾å›¾è½¬åŒ–å¾—åˆ°çš„çŸ©é˜µçš„å°ºåº¦ï¼ŒçŸ©é˜µçš„è¡Œæ•°åº”è¯¥ä¸ºå·ç§¯æ ¸é«˜<em>å·ç§¯æ ¸å®½ï¼Œå³ä¸º9ï¼Œåˆ—æ•°åº”è¯¥ä¸ºå·ç§¯å±‚è¾“å‡ºç‰¹å¾å›¾é«˜(output_h)</em>å·ç§¯å±‚è¾“å‡ºç‰¹å¾å›¾å®½(output_w)ï¼Œä¹Ÿä¸º9ï¼Œé‚£ä¹ˆï¼Œim2colç®—æ³•èµ·å§‹ç”±ä¸‹å›¾å¼€å§‹ï¼š</p><p><img src="/2019/04/12/img2col/11.png" alt></p><p>é¦–å…ˆkernel_rowä¸º0ï¼Œkernel_colä¹Ÿä¸º0ã€‚æŒ‰ç…§input_row = -pad_h + kernel_row * dilation_hè®¡ç®—input_rowçš„å€¼ï¼Œåœ¨è¿™é‡Œï¼Œpad_hä¸º1ï¼Œkernel_rowä¸º0ï¼Œdilation_hä¸º1ï¼Œè®¡ç®—å‡ºinput_rowä¸º-1ï¼Œæ­¤æ—¶output_rowä¸º3ï¼Œæ»¡è¶³å‡½æ•°ä¸­çš„ç¬¬ä¸€ä¸ªifæ¡ä»¶ï¼Œé‚£ä¹ˆåœ¨è¾“å‡ºå›¾åƒä¸Šå…ˆç½®output_wä¸ªé›¶ï¼Œå› ä¸ºoutput_wä¸º3ï¼Œå› æ­¤å¾—åˆ°ä¸‹å›¾ï¼š</p><p><img src="/2019/04/12/img2col/12.png" alt></p><p> ç„¶åinput_rowåŠ ä¸Šæ­¥é•¿2ï¼Œç”±-1å˜æˆ1ï¼Œæ­¤æ—¶output_rowsä¸º2ï¼Œè®¡ç®—input_colç­‰äº-1ï¼Œæ­¤æ—¶æ‰§è¡Œinput_colå®šä¹‰ä¸‹é¢çš„forå¾ªç¯ï¼Œå¾—åˆ°3ä¸ªå€¼ï¼šä¾æ¬¡å¾€ç›®æ ‡çŸ©é˜µä¸­å¡«å…¥0ï¼Œdata_im[1*5+1]å’Œdata_im[1*5+3]ï¼Œå³å¡«å…¥0,7å’Œ9ã€‚å¾—åˆ°ä¸‹å›¾ï¼š</p><p><img src="/2019/04/12/img2col/13.png" alt></p><p>å†æ¥ç€æ‰§è¡Œï¼Œæ­¤æ—¶input_rowå†åŠ ä¸Š2å˜ä¸º3ï¼Œæ­¤æ—¶output_rowså˜ä¸º1ï¼Œè®¡ç®—input_colç­‰äº-1ï¼Œæ‰§è¡Œinput_colå®šä¹‰ä¸‹é¢çš„forå¾ªç¯ï¼Œå¾—åˆ°3ä¸ªå€¼ï¼Œåˆ†åˆ«ä¸º0ï¼Œdata_im[3*5+1]å’Œdata_im[3*5+3]ï¼Œå³å¡«å…¥0,17å’Œ19ã€‚å¾—åˆ°ä¸‹å›¾ï¼š(ä»¥ä¸Šæ“ä½œæ˜¯å°†ç¬¬ä¸€ä¸ªé€šé“çš„å·ç§¯å¯¹åº”ç¬¬ä¸€ä¸ªå¯¹åº”ä½ç½®è¿›æ”¾å¥½)</p><p><img src="/2019/04/12/img2col/14.png" alt></p><p> æ¥ç€ï¼Œkernel_colå˜æˆ1ï¼Œæ­¤æ—¶kernel_rowä¸º0ï¼Œkernel_colä¸º1ã€‚è®¡ç®—input_rowåˆå˜æˆ-1ï¼Œç¬¬ä¸€ä¸ªifæ¡ä»¶æˆç«‹ï¼Œé‚£ä¹ˆï¼Œå†åœ¨è¾“å‡ºçŸ©é˜µä¸Šè¾“å‡º3ä¸ª0ã€‚ç„¶åï¼Œinput_rowå˜æˆ1ï¼Œinput_colåˆ†åˆ«ä¸º0(-1+1)ï¼Œ2(-1+1+2)å’Œ4(-1+1+2+2)æ—¶ï¼Œè¾“å‡ºçŸ©é˜µä¸Šåˆ†åˆ«è¾“å‡ºdata_im[1*5+0]ï¼Œdata[1*5+2]ï¼Œdata[1*5+4]ï¼Œå³åˆ†åˆ«å¡«å…¥6,8,10ã€‚ç„¶åï¼Œinput_rowå˜æˆ3ï¼Œinput_colåˆ†åˆ«ä¸º0ï¼Œ2ï¼Œ4æ—¶ï¼Œè¾“å‡ºçŸ©é˜µä¸Šåˆ†åˆ«è¾“å‡ºdata_im[3*5+0]ï¼Œdata[3*5+2]ï¼Œdata[3*5+4]ï¼Œå³åˆ†åˆ«è¾“å‡º16,18,20ã€‚ï¼ˆå°†ç¬¬ä¸€ä¸ªé€šé“çš„å·ç§¯å¯¹åº”ç¬¬äºŒä¸ªå¯¹åº”ä½ç½®è¿›æ”¾å¥½ï¼‰</p><p><img src="/2019/04/12/img2col/15.png" alt></p><p>ç„¶åï¼Œkernel_colå˜æˆ2ï¼Œæ­¤æ—¶kernel_rowä¸º0ï¼Œkernel_colä¸º2ã€‚è®¡ç®—input_rowåˆå˜æˆ-1ï¼Œç¬¬ä¸€ä¸ªifæ¡ä»¶æˆç«‹ï¼Œé‚£ä¹ˆï¼Œå†åœ¨è¾“å‡ºçŸ©é˜µä¸Šè¾“å‡º3ä¸ª0ã€‚ç„¶åï¼Œinput_rowå˜æˆ1ï¼Œinput_colåˆ†åˆ«ä¸º1(-1+2)ï¼Œ3(-1+2+2)å’Œ5(-1+2+2+2)æ—¶ï¼Œè¾“å‡ºçŸ©é˜µä¸Šåˆ†åˆ«è¾“å‡ºdata_im[1*5+1]ï¼Œdata[1*5+3]ï¼Œ0ï¼Œå³åˆ†åˆ«å¡«å…¥7,9,0ã€‚ç„¶åï¼Œinput_rowå˜æˆ3ï¼Œinput_colåˆ†åˆ«ä¸º1ï¼Œ3ï¼Œ5æ—¶ï¼Œè¾“å‡ºçŸ©é˜µä¸Šåˆ†åˆ«è¾“å‡ºdata_im[3*5+0]ï¼Œdata[3*5+2]ï¼Œ0ï¼Œå³åˆ†åˆ«è¾“å‡º17,19,0ã€‚è§ä¸‹å›¾ï¼šï¼ˆå°†ç¬¬ä¸€ä¸ªé€šé“çš„å·ç§¯å¯¹åº”ç¬¬ä¸‰ä¸ªå¯¹åº”ä½ç½®è¿›æ”¾å¥½ï¼‰</p><p><img src="/2019/04/12/img2col/16.png" alt></p><p>æ¥ç€ï¼Œkernel_rowå˜æˆ1ï¼Œkernel_colå˜æˆ0ã€‚è®¡ç®—input_rowåˆå˜æˆ0ï¼Œinput_colåˆ†åˆ«ä¸º-1(-1+0)ï¼Œ1(-1+0+2)å’Œ3(-1+0+2+2)ï¼Œè¾“å‡ºçŸ©é˜µä¸Šåˆ†åˆ«è¾“å‡º0ï¼Œdata[0*5+1]ï¼Œdata[0*5+3]ï¼Œå³åˆ†åˆ«å¡«å…¥0,2,4ã€‚ç„¶åï¼Œinput_rowå˜æˆ2ï¼Œinput_colåˆ†åˆ«ä¸º-1ï¼Œ1å’Œ3æ—¶ï¼Œè¾“å‡ºçŸ©é˜µä¸Šåˆ†åˆ«è¾“å‡º0ï¼Œdata[2*5+1]ï¼Œdata[2*5+3]ï¼Œå³åˆ†åˆ«å¡«å…¥0,12,14ã€‚ç„¶åï¼Œinput_rowå˜æˆ4ï¼Œinput_colåˆ†åˆ«ä¸º-1ï¼Œ1ï¼Œ3æ—¶ï¼Œè¾“å‡ºçŸ©é˜µä¸Šåˆ†åˆ«è¾“å‡º0ï¼Œdata[4*5+1]ï¼Œdata[4*5+3]ï¼Œå³åˆ†åˆ«è¾“å‡º0,22,24ã€‚è§ä¸‹å›¾ï¼šï¼ˆå°†ç¬¬ä¸€ä¸ªé€šé“çš„å·ç§¯å¯¹åº”ç¬¬å››ä¸ªå¯¹åº”ä½ç½®è¿›æ”¾å¥½ï¼‰</p><p><img src="/2019/04/12/img2col/17.png" alt></p><p>ç„¶åï¼Œkernel_rowä¸º1ï¼Œkernel_colå˜æˆ1ã€‚è®¡ç®—input_rowä¸º0ï¼Œinput_colåˆ†åˆ«ä¸º0(-1+1)ï¼Œ2(-1+1+2)å’Œ4(-1+1+2+2)ï¼Œè¾“å‡ºçŸ©é˜µä¸Šåˆ†åˆ«è¾“å‡ºdata[0*5+0]ï¼Œdata[0*5+2]ï¼Œdata[0*5+4]ï¼Œå³åˆ†åˆ«å¡«å…¥1,3,5ã€‚ç„¶åï¼Œinput_rowå˜æˆ2ï¼Œinput_colåˆ†åˆ«ä¸º0ï¼Œ2å’Œ4æ—¶ï¼Œè¾“å‡ºçŸ©é˜µä¸Šåˆ†åˆ«è¾“å‡ºdata[2*5+0]ï¼Œdata[2*5+2]ï¼Œdata[2*5+4]ï¼Œå³åˆ†åˆ«å¡«å…¥11,13,15ã€‚ç„¶åï¼Œinput_rowå˜æˆ4ï¼Œinput_colåˆ†åˆ«ä¸º0ï¼Œ2ï¼Œ4æ—¶ï¼Œè¾“å‡ºçŸ©é˜µä¸Šåˆ†åˆ«è¾“å‡ºdata[4*5+0]ï¼Œdata[4*5+2]ï¼Œdata[4*5+4]ï¼Œå³åˆ†åˆ«è¾“å‡º21,23,25ã€‚è§ä¸‹å›¾ï¼šï¼ˆå°†ç¬¬ä¸€ä¸ªé€šé“çš„å·ç§¯å¯¹åº”ç¬¬äº”ä¸ªå¯¹åº”ä½ç½®è¿›æ”¾å¥½ï¼‰</p><p><img src="/2019/04/12/img2col/18.png" alt></p><p>ç„¶åï¼Œkernel_rowä¸º1ï¼Œkernel_colå˜æˆ2ã€‚è®¡ç®—input_rowä¸º0ï¼Œinput_colåˆ†åˆ«ä¸º1(-1+2)ï¼Œ3(-1+2+2)å’Œ5(-1+2+2+2)ï¼Œè¾“å‡ºçŸ©é˜µä¸Šåˆ†åˆ«è¾“å‡ºdata[0*5+1]ï¼Œdata[0*5+3]ï¼Œ0ï¼Œå³åˆ†åˆ«å¡«å…¥2,4,0ã€‚ç„¶åï¼Œinput_rowå˜æˆ2ï¼Œinput_colåˆ†åˆ«ä¸º1ï¼Œ3å’Œ5æ—¶ï¼Œè¾“å‡ºçŸ©é˜µä¸Šåˆ†åˆ«è¾“å‡ºdata[2*5+1]ï¼Œdata[2*5+3]ï¼Œ0ï¼Œå³åˆ†åˆ«å¡«å…¥12,14,0ã€‚ç„¶åï¼Œinput_rowå˜æˆ4ï¼Œinput_colåˆ†åˆ«ä¸º1ï¼Œ3ï¼Œ5æ—¶ï¼Œè¾“å‡ºçŸ©é˜µä¸Šåˆ†åˆ«è¾“å‡ºdata[4*5+1]ï¼Œdata[4*5+3]ï¼Œ0ï¼Œå³åˆ†åˆ«è¾“å‡º22,24,0ã€‚è§ä¸‹å›¾ï¼šï¼ˆå°†ç¬¬ä¸€ä¸ªé€šé“çš„å·ç§¯å¯¹åº”ç¬¬å…­ä¸ªå¯¹åº”ä½ç½®è¿›æ”¾å¥½ï¼‰</p><p><img src="/2019/04/12/img2col/19.png" alt></p><p>   æ¥ç€ï¼Œkernel_rowå˜æˆ2ï¼Œkernel_colå˜æˆ0ã€‚è®¡ç®—input_rowä¸º1ï¼Œinput_colåˆ†åˆ«ä¸º-1(-1+0)ï¼Œ1(-1+0+2)å’Œ3(-1+0+2+2)ï¼Œè¾“å‡ºçŸ©é˜µä¸Šåˆ†åˆ«è¾“å‡º0ï¼Œdata[1*5+1]ï¼Œdata[1*5+3]ï¼Œå³åˆ†åˆ«å¡«å…¥0,7,9ã€‚ç„¶åï¼Œinput_rowå˜æˆ3ï¼Œinput_colåˆ†åˆ«ä¸º-1ï¼Œ1å’Œ3æ—¶ï¼Œè¾“å‡ºçŸ©é˜µä¸Šåˆ†åˆ«è¾“å‡º0ï¼Œdata[3*5+1]ï¼Œdata[3*5+3]ï¼Œå³åˆ†åˆ«å¡«å…¥0,17,19ã€‚ç„¶åï¼Œinput_rowå˜æˆ5ï¼Œæ»¡è¶³ç¬¬ä¸€ä¸ªifæ¡ä»¶ï¼Œç›´æ¥è¾“å‡ºä¸‰ä¸ª0ã€‚è§ä¸‹å›¾ï¼šï¼ˆ**å°†ç¬¬ä¸€ä¸ªé€šé“çš„å·ç§¯å¯¹åº”ç¬¬ä¸ƒä¸ªå¯¹åº”ä½ç½®è¿›æ”¾å¥½ï¼‰</p><p><img src="/2019/04/12/img2col/20.png" alt="Center"></p><p>   ç„¶åï¼Œkernel_rowä¸º2ï¼Œkernel_colå˜æˆ1ã€‚è®¡ç®—input_rowä¸º1ï¼Œinput_colåˆ†åˆ«ä¸º0(-1+1)ï¼Œ2(-1+1+2)å’Œ4(-1+1+2+2)ï¼Œè¾“å‡ºçŸ©é˜µä¸Šåˆ†åˆ«è¾“å‡ºdata[1*5+0]ï¼Œdata[1*5+2]ï¼Œdata[1*5+4]ï¼Œå³åˆ†åˆ«å¡«å…¥6,8,10ã€‚ç„¶åï¼Œinput_rowå˜æˆ3ï¼Œinput_colåˆ†åˆ«ä¸º0ï¼Œ2å’Œ4æ—¶ï¼Œè¾“å‡ºçŸ©é˜µä¸Šåˆ†åˆ«è¾“å‡ºdata[3*5+0]ï¼Œdata[3*5+2]ï¼Œdata[3*5+4]ï¼Œå³åˆ†åˆ«å¡«å…¥16,18,20ã€‚ç„¶åï¼Œinput_rowå˜æˆ5ï¼Œæ»¡è¶³ç¬¬ä¸€ä¸ªifæ¡ä»¶ï¼Œç›´æ¥è¾“å‡ºä¸‰ä¸ª0ã€‚è§ä¸‹å›¾ï¼šï¼ˆå°†ç¬¬ä¸€ä¸ªé€šé“çš„å·ç§¯å¯¹åº”ç¬¬å…«ä¸ªå¯¹åº”ä½ç½®è¿›æ”¾å¥½ï¼‰</p><p><img src="/2019/04/12/img2col/21.png" alt></p><p>   æœ€åï¼Œkernel_rowä¸º2ï¼Œkernel_colå˜æˆ2ã€‚è®¡ç®—input_rowä¸º1ï¼Œinput_colåˆ†åˆ«ä¸º1(-1+2)ï¼Œ3(-1+2+2)å’Œ5(-1+2+2+2)ï¼Œè¾“å‡ºçŸ©é˜µä¸Šåˆ†åˆ«è¾“å‡ºdata[1*5+1]ï¼Œdata[1*5+3]ï¼Œ0ï¼Œå³åˆ†åˆ«å¡«å…¥7,9,0ã€‚ç„¶åï¼Œinput_rowå˜æˆ3ï¼Œinput_colåˆ†åˆ«ä¸º1ï¼Œ3å’Œ5æ—¶ï¼Œè¾“å‡ºçŸ©é˜µä¸Šåˆ†åˆ«è¾“å‡ºdata[3*5+1]ï¼Œdata[3*5+3]ï¼Œ0ï¼Œå³åˆ†åˆ«å¡«å…¥17,19,0ã€‚ç„¶åï¼Œinput_rowå˜æˆ5ï¼Œæ»¡è¶³ç¬¬ä¸€ä¸ªifæ¡ä»¶ï¼Œç›´æ¥è¾“å‡ºä¸‰ä¸ª0ã€‚è§ä¸‹å›¾ï¼šï¼ˆå°†ç¬¬ä¸€ä¸ªé€šé“çš„å·ç§¯å¯¹åº”ç¬¬äº”ä¸ªå¯¹åº”ä½ç½®è¿›æ”¾å¥½ï¼‰</p><p><img src="/2019/04/12/img2col/22.png" alt></p><p>   åˆ°æ­¤å·ç§¯å±‚å•é€šé“è¾“å…¥ç‰¹å¾å›¾å°±è½¬åŒ–æˆäº†ä¸€ä¸ªçŸ©é˜µï¼Œè¯·è¯»è€…æœ‹å‹ä»¬ä»”ç»†çœ‹çœ‹ï¼ŒçŸ©é˜µçš„å„åˆ—å°±æ˜¯å·ç§¯æ ¸æ“ä½œçš„å„å°çª—å£ã€‚</p><p><img src="/2019/04/12/img2col/23.png" alt></p><p><strong>!!! æ³¨æ„ç‚¹ï¼š</strong></p><p><strong>ï¼ˆ1ï¼‰å¦‚æœæ˜¯å¤šä¸ªé€šé“çš„è¯ï¼Œå°±è¦å°†å…¶ä»–é€šé“æ”¾ç½®åœ¨è¿™ä¸ªé€šé“çš„ä¸‹é¢ï¼Œæœ€ç»ˆçš„ç»“æœæ˜¯ç”ŸæˆçŸ©é˜µçš„æ¯ä¸€åˆ—å¯¹åº”ä¸€ä¸ªå·ç§¯æ ¸(å¤šä¸ªé€šé“)ã€‚</strong></p><p><strong>ï¼ˆ2ï¼‰å·ç§¯ä¸­çš„zero-paddingæ“ä½œçš„å®ç°ï¼Œå¹¶ä¸æ˜¯çœŸæ­£åœ¨åŸå§‹è¾“å…¥ç‰¹å¾å›¾å‘¨å›´æ·»åŠ 0ï¼Œè€Œæ˜¯åœ¨ç‰¹å¾å›¾è½¬åŒ–å¾—åˆ°çš„çŸ©é˜µä¸Šçš„å¯¹åº”ä½ç½®æ·»åŠ 0ã€‚</strong></p><p><strong>ï¼ˆ3ï¼‰è¿™ç§ç®—æ³•çš„æ ¸å¿ƒç‚¹åœ¨äºï¼Œå…ˆå»æ‰¾å·ç§¯æ ¸(å•é€šé“)å¯¹åº”æ‰€æœ‰å·ç§¯ç»“æœå¯¹åº”çš„æŸä¸ªä½ç½®çš„åƒç´ å€¼ï¼Œå°†å…¶æ”¾ç½®åœ¨ä¸€è¡Œï¼Œä»è€Œå®Œæ•´å•é€šé“çš„å¤åˆ¶ã€‚å½“ç„¶ä¹Ÿå¯ä»¥æ‰¾åˆ°æŸä¸ªå·ç§¯æ ¸(å•é€šé“)å¯¹åº”çš„ä½ç½®ï¼Œå°†å…¶æ‹‰ä¼¸ä¸ºåˆ—ã€‚</strong></p><p><strong>è€Œim2col_cpuå‡½æ•°åŠŸèƒ½çš„ç›¸åæ–¹å‘çš„å®ç°åˆ™æœ‰ç”±col2im_cpuå‡½æ•°å®Œæˆï¼Œç¬”è€…ä¾æ—§æŠŠè¯¥å‡½æ•°çš„ä»£ç æ³¨é‡Šæ”¾åœ¨ä¸‹é¢ï¼š</strong></p><pre><code class="hljs cpp"><span class="hljs-comment">/*col2im_cpuä¸ºim2col_cpuçš„é€†æ“ä½œæ¥æ”¶13ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸ºè¾“å…¥çŸ©é˜µæ•°æ®æŒ‡é’ˆ(data_col)ï¼Œå·ç§¯æ“ä½œå¤„ç†çš„ä¸€ä¸ªå·ç§¯ç»„çš„é€šé“ æ•°(channels)ï¼Œè¾“å…¥å›¾åƒçš„é«˜(height)ä¸å®½(width)ï¼ŒåŸå§‹å·ç§¯æ ¸çš„é«˜(kernel_h)ä¸å®½(kernel_w)ï¼Œ è¾“å…¥å›¾åƒé«˜(pad_h)ä¸å®½(pad_w)æ–¹å‘çš„padï¼Œå·ç§¯æ“ä½œé«˜(stride_h)ä¸å®½(stride_w)æ–¹å‘çš„æ­¥é•¿ï¼Œ å·ç§¯æ ¸é«˜(stride_h)ä¸å®½(stride_h)æ–¹å‘çš„æ‰©å±•ï¼Œè¾“å‡ºå›¾åƒæ•°æ®æŒ‡é’ˆ(data_im)*/</span>  <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Dtype&gt;  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">col2im_cpu</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Dtype* data_col, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> channels,  </span></span><span class="hljs-function"><span class="hljs-params">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> height, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> kernel_h, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> kernel_w,  </span></span><span class="hljs-function"><span class="hljs-params">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> pad_h, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> pad_w,  </span></span><span class="hljs-function"><span class="hljs-params">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> stride_h, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> stride_w,  </span></span><span class="hljs-function"><span class="hljs-params">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> dilation_h, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> dilation_w,  </span></span><span class="hljs-function"><span class="hljs-params">    Dtype* data_im)</span> </span>&#123;      caffe_set(height * width * channels, Dtype(<span class="hljs-number">0</span>), data_im);   <span class="hljs-comment">//é¦–å…ˆå¯¹è¾“å‡ºçš„åŒºåŸŸè¿›è¡Œåˆå§‹åŒ–ï¼Œå…¨éƒ¨å¡«å……0  </span>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> output_h = (height + <span class="hljs-number">2</span> * pad_h - (dilation_h * (kernel_h - <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>)) / stride_h + <span class="hljs-number">1</span>;  <span class="hljs-comment">//è®¡ç®—å·ç§¯å±‚è¾“å‡ºå›¾åƒçš„å®½  </span>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> output_w = (width + <span class="hljs-number">2</span> * pad_w - (dilation_w * (kernel_w - <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>)) / stride_w + <span class="hljs-number">1</span>;  <span class="hljs-comment">//è®¡ç®—å·ç§¯å±‚è¾“å‡ºå›¾åƒçš„é«˜  </span>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> channel_size = height * width;   <span class="hljs-comment">//col2imè¾“å‡ºçš„å•é€šé“å›¾åƒå®¹é‡</span>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> channel = channels; channel--; data_im += channel_size) &#123;<span class="hljs-comment">//æŒ‰ç…§è¾“å‡ºé€šé“æ•°ä¸€ä¸ªä¸€ä¸ªå¤„ç†  </span>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> kernel_row = <span class="hljs-number">0</span>; kernel_row &lt; kernel_h; kernel_row++) &#123;              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> kernel_col = <span class="hljs-number">0</span>; kernel_col &lt; kernel_w; kernel_col++) &#123;              <span class="hljs-keyword">int</span> input_row = -pad_h + kernel_row * dilation_h;<span class="hljs-comment">//åœ¨è¿™é‡Œæ‰¾åˆ°å·ç§¯æ ¸ä¸­çš„æŸä¸€è¡Œåœ¨è¾“å…¥å›¾åƒä¸­çš„ç¬¬ä¸€ä¸ªæ“ä½œåŒºåŸŸçš„è¡Œç´¢å¼•  </span>         <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> output_rows = output_h; output_rows; output_rows--) &#123;               <span class="hljs-keyword">if</span> (!is_a_ge_zero_and_a_lt_b(input_row, height)) &#123;<span class="hljs-comment">//å¦‚æœè®¡ç®—å¾—åˆ°çš„è¾“å…¥å›¾åƒçš„è¡Œå€¼ç´¢å¼•å°äºé›¶æˆ–è€…å¤§äºè¾“å…¥å›¾åƒçš„é«˜(è¯¥è¡Œä¸ºpad)  </span>                data_col += output_w;  <span class="hljs-comment">//é‚£ä¹ˆï¼Œç›´æ¥è·³è¿‡è¿™output_wä¸ªæ•°ï¼Œè¿™äº›æ•°æ˜¯è¾“å…¥å›¾åƒç¬¬ä¸€è¡Œä¸Šé¢æˆ–è€…æœ€åä¸€è¡Œä¸‹é¢padçš„0  </span>             &#125; <span class="hljs-keyword">else</span> &#123;                   <span class="hljs-keyword">int</span> input_col = -pad_w + kernel_col * dilation_w;<span class="hljs-comment">//åœ¨è¿™é‡Œæ‰¾åˆ°å·ç§¯æ ¸ä¸­çš„æŸä¸€åˆ—åœ¨è¾“å…¥å›¾åƒä¸­çš„ç¬¬ä¸€ä¸ªæ“ä½œåŒºåŸŸçš„åˆ—ç´¢å¼•  </span>                 <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> output_col = output_w; output_col; output_col--) &#123;                        <span class="hljs-keyword">if</span> (is_a_ge_zero_and_a_lt_b(input_col, width)) &#123;<span class="hljs-comment">//å¦‚æœè®¡ç®—å¾—åˆ°çš„è¾“å…¥å›¾åƒçš„åˆ—å€¼ç´¢å¼•å¤§äºç­‰äºäºé›¶æˆ–è€…å°äºè¾“å…¥å›¾åƒçš„å®½(è¯¥åˆ—ä¸æ˜¯pad)  </span>                      data_im[input_row * width + input_col] += *data_col;<span class="hljs-comment">//å°†çŸ©é˜µä¸Šå¯¹åº”çš„å…ƒæ”¾åˆ°å°†è¦è¾“å‡ºçš„å›¾åƒä¸Š  </span>                 &#125; <span class="hljs-comment">//è¿™é‡Œæ²¡æœ‰elseï¼Œå› ä¸ºå¦‚æœç´§æŒ¨çš„ifæ¡ä»¶ä¸æˆç«‹çš„è¯ï¼Œinput_row*width + input_colè¿™ä¸ªä¸‹æ ‡åœ¨data_imä¸­ä¸å­˜åœ¨ï¼ŒåŒæ—¶éå†åˆ°data_colçš„å¯¹åº”å…ƒä¸º0  </span>                 data_col++;<span class="hljs-comment">//éå†ä¸‹ä¸€ä¸ªdata_colä¸­çš„æ•°  </span>                 input_col += stride_w;<span class="hljs-comment">//æŒ‰ç…§å®½æ–¹å‘æ­¥é•¿éå†å·ç§¯æ ¸ä¸Šå›ºå®šåˆ—åœ¨è¾“å…¥å›¾åƒä¸Šæ»‘åŠ¨æ“ä½œçš„åŒºåŸŸ  </span>             &#125;            &#125;            input_row += stride_h;<span class="hljs-comment">//æŒ‰ç…§é«˜æ–¹å‘æ­¥é•¿éå†å·ç§¯æ ¸ä¸Šå›ºå®šè¡Œåœ¨è¾“å…¥å›¾åƒä¸Šæ»‘åŠ¨æ“ä½œçš„åŒºåŸŸ  </span>             &#125;              &#125;          &#125;      &#125;  &#125;</code></pre>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>å¸¸ç”¨å¼€å‘å·¥å…·</title>
    <link href="/2019/04/10/Dev-tools/"/>
    <url>/2019/04/10/Dev-tools/</url>
    
    <content type="html"><![CDATA[<h4 id="1-Mac-å¿…å¤‡è½¯ä»¶"><a href="#1-Mac-å¿…å¤‡è½¯ä»¶" class="headerlink" title="1. Mac å¿…å¤‡è½¯ä»¶"></a>1. Mac å¿…å¤‡è½¯ä»¶</h4><h5 id="å¿«æ·é”®æŸ¥è¯¢ï¼šcheat-sheet"><a href="#å¿«æ·é”®æŸ¥è¯¢ï¼šcheat-sheet" class="headerlink" title="å¿«æ·é”®æŸ¥è¯¢ï¼šcheat sheet"></a>å¿«æ·é”®æŸ¥è¯¢ï¼šcheat sheet</h5><h5 id="è½¯ä»¶å®‰è£…ä¸ä¸‹è½½ï¼šbrew"><a href="#è½¯ä»¶å®‰è£…ä¸ä¸‹è½½ï¼šbrew" class="headerlink" title="è½¯ä»¶å®‰è£…ä¸ä¸‹è½½ï¼šbrew"></a>è½¯ä»¶å®‰è£…ä¸ä¸‹è½½ï¼šbrew</h5><h5 id="Githubï¼šGithub-Desktop"><a href="#Githubï¼šGithub-Desktop" class="headerlink" title="Githubï¼šGithub Desktop"></a>Githubï¼šGithub Desktop</h5><h5 id="å›¾ç‰‡æ ‡è®°ï¼š-åœˆç‚¹"><a href="#å›¾ç‰‡æ ‡è®°ï¼š-åœˆç‚¹" class="headerlink" title="å›¾ç‰‡æ ‡è®°ï¼š åœˆç‚¹"></a>å›¾ç‰‡æ ‡è®°ï¼š åœˆç‚¹</h5><h5 id="è¿œç¨‹ä¼šè®®ï¼š-TeamViewer"><a href="#è¿œç¨‹ä¼šè®®ï¼š-TeamViewer" class="headerlink" title="è¿œç¨‹ä¼šè®®ï¼š TeamViewer"></a>è¿œç¨‹ä¼šè®®ï¼š TeamViewer</h5><h5 id="å¾…åŠäº‹é¡¹ï¼šThings3"><a href="#å¾…åŠäº‹é¡¹ï¼šThings3" class="headerlink" title="å¾…åŠäº‹é¡¹ï¼šThings3"></a>å¾…åŠäº‹é¡¹ï¼šThings3</h5><h5 id="é˜²æ­¢å¾…æœºè½¯ä»¶ï¼š-caffeine"><a href="#é˜²æ­¢å¾…æœºè½¯ä»¶ï¼š-caffeine" class="headerlink" title="é˜²æ­¢å¾…æœºè½¯ä»¶ï¼š caffeine"></a>é˜²æ­¢å¾…æœºè½¯ä»¶ï¼š caffeine</h5><h5 id="æ–‡æ¡£-APIæŸ¥è¯¢-Dash"><a href="#æ–‡æ¡£-APIæŸ¥è¯¢-Dash" class="headerlink" title="æ–‡æ¡£/APIæŸ¥è¯¢: Dash"></a>æ–‡æ¡£/APIæŸ¥è¯¢: Dash</h5><h5 id="æŠ¤çœ¼ï¼šFlux"><a href="#æŠ¤çœ¼ï¼šFlux" class="headerlink" title="æŠ¤çœ¼ï¼šFlux"></a>æŠ¤çœ¼ï¼šFlux</h5><h5 id="å½±éŸ³æ’­æ”¾ï¼šIINA"><a href="#å½±éŸ³æ’­æ”¾ï¼šIINA" class="headerlink" title="å½±éŸ³æ’­æ”¾ï¼šIINA"></a>å½±éŸ³æ’­æ”¾ï¼šIINA</h5><h5 id="ä¸‹è½½-Motrix"><a href="#ä¸‹è½½-Motrix" class="headerlink" title="ä¸‹è½½ Motrix"></a>ä¸‹è½½ Motrix</h5><h5 id="ä»£ç æ¯”å¯¹ï¼š-Beyond-compare"><a href="#ä»£ç æ¯”å¯¹ï¼š-Beyond-compare" class="headerlink" title="ä»£ç æ¯”å¯¹ï¼š Beyond compare"></a>ä»£ç æ¯”å¯¹ï¼š Beyond compare</h5><h4 id="2-Python"><a href="#2-Python" class="headerlink" title="2. Python"></a>2. Python</h4><h5 id="2-3ç‰ˆæœ¬ç®¡ç†-anaconda"><a href="#2-3ç‰ˆæœ¬ç®¡ç†-anaconda" class="headerlink" title="2/3ç‰ˆæœ¬ç®¡ç†: anaconda"></a>2/3ç‰ˆæœ¬ç®¡ç†: anaconda</h5><h5 id="Python-ä»£ç å¯è§†åŒ–å·¥å…·-yapf"><a href="#Python-ä»£ç å¯è§†åŒ–å·¥å…·-yapf" class="headerlink" title="Python ä»£ç å¯è§†åŒ–å·¥å…· yapf"></a>Python ä»£ç å¯è§†åŒ–å·¥å…· yapf</h5><h5 id="3-ç¬”è®°ç±»è½¯ä»¶"><a href="#3-ç¬”è®°ç±»è½¯ä»¶" class="headerlink" title="3. ç¬”è®°ç±»è½¯ä»¶"></a>3. ç¬”è®°ç±»è½¯ä»¶</h5><h5 id="1-Markdownï¼šTypora"><a href="#1-Markdownï¼šTypora" class="headerlink" title="1. Markdownï¼šTypora"></a>1. Markdownï¼šTypora</h5><h5 id="2-ç¬”è®°è½¯ä»¶ï¼ševernoteã€æœ‰é“äº‘ç¬”è®°"><a href="#2-ç¬”è®°è½¯ä»¶ï¼ševernoteã€æœ‰é“äº‘ç¬”è®°" class="headerlink" title="2. ç¬”è®°è½¯ä»¶ï¼ševernoteã€æœ‰é“äº‘ç¬”è®°"></a>2. ç¬”è®°è½¯ä»¶ï¼ševernoteã€æœ‰é“äº‘ç¬”è®°</h5><h5 id="3-pdf-é˜…è¯»ï¼šPDF-Expertã€margin-note3ã€adobe-readerã€é¢„è§ˆ"><a href="#3-pdf-é˜…è¯»ï¼šPDF-Expertã€margin-note3ã€adobe-readerã€é¢„è§ˆ" class="headerlink" title="3. pdf é˜…è¯»ï¼šPDF Expertã€margin note3ã€adobe readerã€é¢„è§ˆ"></a>3. pdf é˜…è¯»ï¼šPDF Expertã€margin note3ã€adobe readerã€é¢„è§ˆ</h5><h5 id="4-ç¼–è¾‘å™¨ï¼š-Sublime-Text3ã€Visual-Studio-Code"><a href="#4-ç¼–è¾‘å™¨ï¼š-Sublime-Text3ã€Visual-Studio-Code" class="headerlink" title="4. ç¼–è¾‘å™¨ï¼š Sublime Text3ã€Visual Studio Code"></a>4. ç¼–è¾‘å™¨ï¼š Sublime Text3ã€Visual Studio Code</h5><h5 id="5-è®ºæ–‡ç¼–è¾‘ï¼šLatex"><a href="#5-è®ºæ–‡ç¼–è¾‘ï¼šLatex" class="headerlink" title="5.è®ºæ–‡ç¼–è¾‘ï¼šLatex"></a>5.è®ºæ–‡ç¼–è¾‘ï¼šLatex</h5><h5 id="4-æ€ç»´å¯¼å›¾ï¼š"><a href="#4-æ€ç»´å¯¼å›¾ï¼š" class="headerlink" title="4. æ€ç»´å¯¼å›¾ï¼š"></a>4. æ€ç»´å¯¼å›¾ï¼š</h5><h5 id="Xmind-ZEN"><a href="#Xmind-ZEN" class="headerlink" title="Xmind ZEN"></a>Xmind ZEN</h5><h5 id="MindNode"><a href="#MindNode" class="headerlink" title="MindNode"></a>MindNode</h5><h4 id="chrome-æ’ä»¶"><a href="#chrome-æ’ä»¶" class="headerlink" title="chrome æ’ä»¶"></a>chrome æ’ä»¶</h4><h5 id="1-clip-to-evernote"><a href="#1-clip-to-evernote" class="headerlink" title="1. clip to evernote"></a>1. clip to evernote</h5><h5 id="2-Fireshot"><a href="#2-Fireshot" class="headerlink" title="2. Fireshot"></a>2. Fireshot</h5><h5 id="3-One-Tap"><a href="#3-One-Tap" class="headerlink" title="3. One Tap"></a>3. One Tap</h5><h5 id="4-Pocket"><a href="#4-Pocket" class="headerlink" title="4. Pocket"></a>4. Pocket</h5><h5 id="5-Adblock"><a href="#5-Adblock" class="headerlink" title="5. Adblock"></a>5. Adblock</h5>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>FDDBæµ‹è¯„</title>
    <link href="/2019/04/06/FDDB-benchmark/"/>
    <url>/2019/04/06/FDDB-benchmark/</url>
    
    <content type="html"><![CDATA[<h4 id="1-å‡†å¤‡å·¥ä½œ"><a href="#1-å‡†å¤‡å·¥ä½œ" class="headerlink" title="1. å‡†å¤‡å·¥ä½œ"></a>1. å‡†å¤‡å·¥ä½œ</h4><h5 id="ï¼ˆ1ï¼‰ä¸‹è½½-FDDB-ç›¸å…³æ–‡ä»¶"><a href="#ï¼ˆ1ï¼‰ä¸‹è½½-FDDB-ç›¸å…³æ–‡ä»¶" class="headerlink" title="ï¼ˆ1ï¼‰ä¸‹è½½ FDDB ç›¸å…³æ–‡ä»¶"></a>ï¼ˆ1ï¼‰ä¸‹è½½ FDDB ç›¸å…³æ–‡ä»¶</h5><ul><li>ä» <a href="http://vis-www.cs.umass.edu/fddb/index.html">å®˜ç½‘</a>ä¸‹è½½ FDDB æ•°æ®é›†ï¼Œè§£å‹å¾—åˆ° <strong>originalPics</strong> æ–‡ä»¶å¤¹ï¼Œ<strong>FDDB-folds</strong> æ–‡ä»¶å¤¹å’Œ <strong>README.txt</strong> </li><li>åˆ° <a href="http://vis-www.cs.umass.edu/fddb/results.html">results é¡µé¢</a> ä¸‹è½½è¯„ä¼°ç¨‹åºï¼Œè§£å‹å¾—åˆ° evaluation æ–‡ä»¶å¤¹ã€‚</li></ul><h5 id="ï¼ˆ2ï¼‰å‡†å¤‡-txt-æ–‡ä»¶"><a href="#ï¼ˆ2ï¼‰å‡†å¤‡-txt-æ–‡ä»¶" class="headerlink" title="ï¼ˆ2ï¼‰å‡†å¤‡ .txt æ–‡ä»¶"></a>ï¼ˆ2ï¼‰å‡†å¤‡ .txt æ–‡ä»¶</h5><p>ç”¨ä½ çš„æ¨¡å‹æŒ‰ç…§ FDDB-folds/FDDB-fold-i.txt çš„é¡ºåºæ£€æµ‹å›¾ç‰‡ï¼Œç”Ÿæˆä¸ä¹‹å¯¹åº”çš„ 10 ä¸ª fold-i-out.txtï¼Œå­˜æ”¾åœ¨ out-folds æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶åˆå¹¶æˆ–å¤åˆ¶ç²˜è´´æˆ results.txtã€‚ç»“æœæ–‡ä»¶çš„æ ¼å¼éœ€è¦ä¸º </p><pre><code class="hljs tex">... image name i number of faces in this image =im face i1 face i2 ... face im ...</code></pre><h5 id="ï¼ˆ3ï¼‰å®‰è£…-OPENCVï¼ˆv3-2ï¼‰"><a href="#ï¼ˆ3ï¼‰å®‰è£…-OPENCVï¼ˆv3-2ï¼‰" class="headerlink" title="ï¼ˆ3ï¼‰å®‰è£… OPENCVï¼ˆv3.2ï¼‰"></a>ï¼ˆ3ï¼‰å®‰è£… OPENCVï¼ˆv3.2ï¼‰</h5><h5 id="ï¼ˆ4ï¼‰å®‰è£…-gnuplot"><a href="#ï¼ˆ4ï¼‰å®‰è£…-gnuplot" class="headerlink" title="ï¼ˆ4ï¼‰å®‰è£… gnuplot"></a>ï¼ˆ4ï¼‰å®‰è£… gnuplot</h5><p>Ubuntu ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><pre><code class="hljs shell">sudo apt-get install gnuplot</code></pre><h4 id="2-ç¼–è¯‘-evalution"><a href="#2-ç¼–è¯‘-evalution" class="headerlink" title="2. ç¼–è¯‘ evalution"></a>2. ç¼–è¯‘ evalution</h4><h5 id="ï¼ˆ1ï¼‰ä¿®æ”¹Makefile-æ–‡ä»¶ï¼š"><a href="#ï¼ˆ1ï¼‰ä¿®æ”¹Makefile-æ–‡ä»¶ï¼š" class="headerlink" title="ï¼ˆ1ï¼‰ä¿®æ”¹Makefile æ–‡ä»¶ï¼š"></a>ï¼ˆ1ï¼‰ä¿®æ”¹Makefile æ–‡ä»¶ï¼š</h5><p>æ‰“å¼€evalution æ–‡ä»¶å¤¹ä¸‹çš„MakeFileï¼Œ æ·»åŠ å¦‚ä¸‹ç›¸åº”çš„è¡Œ</p><pre><code class="hljs makefile">INCS = -I/usr/local/<span class="hljs-keyword">include</span>/opencvLIBS = -L/usr/local/lib -lopencv_core -lopencv_imgproc -lopencv_highgui       -lopencv_ml -lopencv_video -lopencv_features2d -lopencv_calib3d       -lopencv_objdetect -lopencv_contrib -lopencv_legacy<span class="hljs-comment"># å¯¹äº opencv 3.2 å»æ‰ -lopencv_contrib and -lopencv_legacy  åŠ ä¸Š -lopencv_imgcodecs</span></code></pre><p>ä¿®æ”¹å¦‚ä¸‹è¡Œï¼š</p><pre><code class="hljs gams"># evaluate: <span class="hljs-symbol">$</span>(OBJS)#        <span class="hljs-symbol">$</span>(CC) <span class="hljs-symbol">$</span>(LIBS) <span class="hljs-symbol">$</span>(OBJS) -o <span class="hljs-symbol">$</span>@evaluate: <span class="hljs-symbol">$</span>(OBJS)    <span class="hljs-symbol">$</span>(CC) <span class="hljs-symbol">$</span>(OBJS) -o <span class="hljs-symbol">$</span>@ <span class="hljs-symbol">$</span>(LIBS)</code></pre><h5 id="ï¼ˆ2ï¼‰ä¿®æ”¹-common-hpp"><a href="#ï¼ˆ2ï¼‰ä¿®æ”¹-common-hpp" class="headerlink" title="ï¼ˆ2ï¼‰ä¿®æ”¹ common.hpp"></a>ï¼ˆ2ï¼‰ä¿®æ”¹ common.hpp</h5><p>æ‰“å¼€ evaluation æ–‡ä»¶å¤¹ä¸‹çš„ common.hppï¼Œå°†</p><pre><code class="hljs cpp"><span class="hljs-comment">// #define __IMAGE_FORMAT__ &quot;.jpg&quot;</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __IMAGE_FORMAT__ <span class="hljs-meta-string">&quot;.ppm&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __CVLOADIMAGE_WORKING__</span></code></pre><p>ä¿®æ”¹ä¸ºï¼š</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __IMAGE_FORMAT__ <span class="hljs-meta-string">&quot;.jpg&quot;</span></span><span class="hljs-comment">// #define __IMAGE_FORMAT__ &quot;.ppm&quot;</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __CVLOADIMAGE_WORKING__</span></code></pre><h5 id="ï¼ˆ3ï¼‰ç¼–è¯‘"><a href="#ï¼ˆ3ï¼‰ç¼–è¯‘" class="headerlink" title="ï¼ˆ3ï¼‰ç¼–è¯‘"></a>ï¼ˆ3ï¼‰ç¼–è¯‘</h5><pre><code class="hljs ebnf"><span class="hljs-attribute">make</span></code></pre><p>å¦‚æœå‡ºç°é”™è¯¯ï¼š <strong>fatal error</strong>: â€˜cv.hâ€™ file not found [Mac platform]</p><p><strong>solution</strong>: æ‰¾åˆ°å¯¹åº”æ–‡ä»¶ï¼šå°†å…¶ä¿®æ”¹ä¸º</p><pre><code class="hljs cpp"><span class="hljs-comment">// #include &quot;opencv/cv.h&quot;</span><span class="hljs-comment">// #include &quot;opencv/highgui.h&quot;</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;opencv/cv.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;opencv/highgui.h&quot;</span></span></code></pre><h4 id="3-è¾“å‡ºæ–‡ä»¶å¹¶ç»˜å›¾"><a href="#3-è¾“å‡ºæ–‡ä»¶å¹¶ç»˜å›¾" class="headerlink" title="3. è¾“å‡ºæ–‡ä»¶å¹¶ç»˜å›¾"></a>3. è¾“å‡ºæ–‡ä»¶å¹¶ç»˜å›¾</h4><h5 id="ï¼ˆ1ï¼‰ä¿®æ”¹-runEvaluate-pl"><a href="#ï¼ˆ1ï¼‰ä¿®æ”¹-runEvaluate-pl" class="headerlink" title="ï¼ˆ1ï¼‰ä¿®æ”¹ runEvaluate.pl"></a>ï¼ˆ1ï¼‰ä¿®æ”¹ runEvaluate.pl</h5><p>æ‰“å¼€ evaluation æ–‡ä»¶å¤¹ä¸‹çš„ runEvaluate.plï¼Œå¡«å†™è·¯å¾„å¦‚ä¸‹ï¼š</p><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">where</span> gnuplot is</span>my $GNUPLOT = &quot;/usr/local/bin/gnuplot&quot;;<span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">where</span> the binary is</span>my $evaluateBin = &quot;./evaluate&quot;;<span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">where</span> the images are</span>my $imDir = &quot;../originalPics/&quot;;<span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">where</span> the folds are</span>my $fddbDir = &quot;../FDDB-folds&quot;;<span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">where</span> the detections are</span>my $detDir = &quot;../results&quot;;</code></pre><p>æ³¨æ„è‹¥æ–‡ä»¶åç§°å’Œè·¯å¾„ä¸ç¬”è€… (è§ç¬¬ 2 æ­¥ä¸­çš„æˆªå›¾) ä¸åŒï¼Œéœ€è¦ç›¸åº”ä¿®æ”¹ã€‚</p><h5 id="ï¼ˆ2ï¼‰æ‰§è¡Œ-runEvaluate-pl"><a href="#ï¼ˆ2ï¼‰æ‰§è¡Œ-runEvaluate-pl" class="headerlink" title="ï¼ˆ2ï¼‰æ‰§è¡Œ runEvaluate.pl"></a>ï¼ˆ2ï¼‰æ‰§è¡Œ runEvaluate.pl</h5><pre><code class="hljs reasonml">perl runEvaluate.pl å®Œæˆååœ¨ results æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆäº† <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ContROC</span>.</span></span>txt, <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DiscROC</span>.</span></span>txt, <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ContROC</span>.</span></span>png å’Œ <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DiscROC</span>.</span></span>png å››ä¸ªæ–‡ä»¶ã€‚</code></pre>]]></content>
    
    
    <categories>
      
      <category>Face</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pytorch Cookbook</title>
    <link href="/2019/03/19/Pytorch-Cookbook/"/>
    <url>/2019/03/19/Pytorch-Cookbook/</url>
    
    <content type="html"><![CDATA[<p>ğŸ”¥ ä¸€äº› pytorch ç¼–ç¨‹çš„å°æŠ€å·§ã€trick å’Œ ç¤ºä¾‹ä»£ç </p><a id="more"></a><p>æœ¬æ–‡ä»£ç åŸºäºPyTorch 1.0ç‰ˆæœ¬ï¼Œéœ€è¦ç”¨åˆ°ä»¥ä¸‹åŒ…</p><pre><code class="hljs elm"><span class="hljs-keyword">import</span> collections<span class="hljs-keyword">import</span> os<span class="hljs-keyword">import</span> shutil<span class="hljs-keyword">import</span> tqdm<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<span class="hljs-keyword">import</span> PIL.Image<span class="hljs-keyword">import</span> torch<span class="hljs-keyword">import</span> torchvision</code></pre><h3 id="1-åŸºç¡€é…ç½®"><a href="#1-åŸºç¡€é…ç½®" class="headerlink" title="1. åŸºç¡€é…ç½®"></a>1. åŸºç¡€é…ç½®</h3><h5 id="1-check-pytorch-version"><a href="#1-check-pytorch-version" class="headerlink" title="(1) check pytorch version"></a>(1) check pytorch version</h5><pre><code class="hljs python">torch.__version__               <span class="hljs-comment"># PyTorch version</span>torch.version.cuda              <span class="hljs-comment"># Corresponding CUDA version</span>torch.backends.cudnn.version()  <span class="hljs-comment"># Corresponding cuDNN version</span>torch.cuda.get_device_name(<span class="hljs-number">0</span>)   <span class="hljs-comment"># GPU type</span></code></pre><h5 id="2-update-pytorch"><a href="#2-update-pytorch" class="headerlink" title="(2) update pytorch"></a>(2) update pytorch</h5><pre><code class="hljs ebnf"><span class="hljs-attribute">conda update pytorch torchvision -c pytorch</span></code></pre><h5 id="3-random-seed-setting"><a href="#3-random-seed-setting" class="headerlink" title="(3) random seed setting"></a>(3) random seed setting</h5><pre><code class="hljs css"><span class="hljs-selector-tag">torch</span><span class="hljs-selector-class">.manual_seed</span>(0) # <span class="hljs-selector-tag">CPU</span><span class="hljs-selector-tag">torch</span><span class="hljs-selector-class">.cuda</span><span class="hljs-selector-class">.manual_seed_all</span>(0) # <span class="hljs-selector-tag">GPU</span></code></pre><h5 id="4-æŒ‡å®šç¨‹åºè¿è¡Œåœ¨ç‰¹å®šæ˜¾å¡ä¸Šï¼š"><a href="#4-æŒ‡å®šç¨‹åºè¿è¡Œåœ¨ç‰¹å®šæ˜¾å¡ä¸Šï¼š" class="headerlink" title="(4) æŒ‡å®šç¨‹åºè¿è¡Œåœ¨ç‰¹å®šæ˜¾å¡ä¸Šï¼š"></a>(4) æŒ‡å®šç¨‹åºè¿è¡Œåœ¨ç‰¹å®šæ˜¾å¡ä¸Šï¼š</h5><p>åœ¨å‘½ä»¤è¡ŒæŒ‡å®šç¯å¢ƒå˜é‡</p><pre><code class="hljs angelscript">CUDA_VISIBLE_DEVICES=<span class="hljs-number">0</span>,<span class="hljs-number">1</span> python train.py</code></pre><p>åœ¨ä»£ç ä¸­æŒ‡å®š</p><pre><code class="hljs lua"><span class="hljs-built_in">os</span>.environ[<span class="hljs-string">&#x27;CUDA_VISIBLE_DEVICES&#x27;</span>] = <span class="hljs-string">&#x27;0,1&#x27;</span></code></pre><h5 id="5-åˆ¤æ–­æ˜¯å¦æœ‰CUDAæ”¯æŒ"><a href="#5-åˆ¤æ–­æ˜¯å¦æœ‰CUDAæ”¯æŒ" class="headerlink" title="(5) åˆ¤æ–­æ˜¯å¦æœ‰CUDAæ”¯æŒ"></a>(5) åˆ¤æ–­æ˜¯å¦æœ‰CUDAæ”¯æŒ</h5><pre><code class="hljs ceylon">torch.cuda.<span class="hljs-keyword">is</span><span class="hljs-number">_</span>available()torch.set<span class="hljs-number">_</span><span class="hljs-keyword">default</span><span class="hljs-number">_</span>tensor<span class="hljs-number">_</span>type(<span class="hljs-string">&#x27;torch.cuda.FloatTensor&#x27;</span>)   os.environ[<span class="hljs-string">&#x27;CUDA_LAUNCH_BLOCKING&#x27;</span>] = <span class="hljs-string">&#x27;1&#x27;</span></code></pre><h5 id="6-è®¾ç½®ä¸ºcuDNN-benchmarkæ¨¡å¼"><a href="#6-è®¾ç½®ä¸ºcuDNN-benchmarkæ¨¡å¼" class="headerlink" title="(6) è®¾ç½®ä¸ºcuDNN benchmarkæ¨¡å¼"></a>(6) è®¾ç½®ä¸ºcuDNN benchmarkæ¨¡å¼</h5><p>Benchmarkæ¨¡å¼ä¼šæå‡è®¡ç®—é€Ÿåº¦ï¼Œä½†æ˜¯ç”±äºè®¡ç®—ä¸­æœ‰éšæœºæ€§ï¼Œæ¯æ¬¡ç½‘ç»œå‰é¦ˆç»“æœç•¥æœ‰å·®å¼‚ã€‚</p><pre><code class="hljs ini"><span class="hljs-attr">toch.backends.cudnn.benchmark</span> = <span class="hljs-literal">True</span></code></pre><p>å¦‚æœæƒ³è¦é¿å…è¿™ç§ç»“æœæ³¢åŠ¨ï¼Œè®¾ç½®</p><pre><code class="hljs ini"><span class="hljs-attr">torch.backends.cudnn.deterministic</span> = <span class="hljs-literal">True</span></code></pre><h5 id="7-æ‰‹åŠ¨æ¸…é™¤GPUå­˜å‚¨"><a href="#7-æ‰‹åŠ¨æ¸…é™¤GPUå­˜å‚¨" class="headerlink" title="(7) æ‰‹åŠ¨æ¸…é™¤GPUå­˜å‚¨"></a>(7) æ‰‹åŠ¨æ¸…é™¤GPUå­˜å‚¨</h5><p>æœ‰æ—¶Control-Cä¸­æ­¢è¿è¡ŒåGPUå­˜å‚¨æ²¡æœ‰åŠæ—¶é‡Šæ”¾ï¼Œéœ€è¦æ‰‹åŠ¨æ¸…ç©ºã€‚åœ¨PyTorchå†…éƒ¨å¯ä»¥</p><pre><code class="hljs css"><span class="hljs-selector-tag">torch</span><span class="hljs-selector-class">.cuda</span><span class="hljs-selector-class">.empty_cache</span>()</code></pre><p>æˆ–åœ¨å‘½ä»¤è¡Œå¯ä»¥å…ˆä½¿ç”¨psæ‰¾åˆ°ç¨‹åºçš„PIDï¼Œå†ä½¿ç”¨killç»“æŸè¯¥è¿›ç¨‹</p><pre><code class="hljs vim"><span class="hljs-keyword">ps</span> aux | <span class="hljs-keyword">grep</span> <span class="hljs-keyword">python</span>    kill -<span class="hljs-number">9</span> [pid]</code></pre><p>æˆ–è€…ç›´æ¥é‡ç½®æ²¡æœ‰è¢«æ¸…ç©ºçš„GPU</p><pre><code class="hljs ada">nvidia-smi <span class="hljs-comment">--gpu-reset -i [gpu_id]</span></code></pre><h3 id="2-æ¨¡å‹"><a href="#2-æ¨¡å‹" class="headerlink" title="2. æ¨¡å‹"></a>2. æ¨¡å‹</h3><h5 id="1-æå–ImageNeté¢„è®­ç»ƒæ¨¡å‹æŸå±‚çš„å·ç§¯ç‰¹å¾"><a href="#1-æå–ImageNeté¢„è®­ç»ƒæ¨¡å‹æŸå±‚çš„å·ç§¯ç‰¹å¾" class="headerlink" title="(1) æå–ImageNeté¢„è®­ç»ƒæ¨¡å‹æŸå±‚çš„å·ç§¯ç‰¹å¾"></a>(1) æå–ImageNeté¢„è®­ç»ƒæ¨¡å‹æŸå±‚çš„å·ç§¯ç‰¹å¾</h5><pre><code class="hljs gams"># VGG<span class="hljs-number">-16</span> relu5<span class="hljs-number">-3</span> feature.<span class="hljs-keyword">model</span> = torchvision.<span class="hljs-keyword">models</span>.vgg16(pretrained=True).features# VGG<span class="hljs-number">-16</span> pool5 feature.<span class="hljs-keyword">model</span> = torchvision.<span class="hljs-keyword">models</span>.vgg16(pretrained=True)<span class="hljs-keyword">model</span> = torch.nn.Sequential(<span class="hljs-keyword">model</span>.features, <span class="hljs-keyword">model</span>.avgpool)# VGG<span class="hljs-number">-16</span> fc7 feature.<span class="hljs-keyword">model</span> = torchvision.<span class="hljs-keyword">models</span>.vgg16(pretrained=True)<span class="hljs-keyword">model</span>.classifier = torch.nn.Sequential(*list(<span class="hljs-keyword">model</span>.classifier.children())[:<span class="hljs-number">-3</span>])# ResNet GAP feature.<span class="hljs-keyword">model</span> = torchvision.<span class="hljs-keyword">models</span>.resnet18(pretrained=True)<span class="hljs-keyword">model</span> = torch.nn.Sequential(collections.OrderedDict(    list(<span class="hljs-keyword">model</span>.named_children())[:<span class="hljs-number">-1</span>]))with torch.no_grad():    <span class="hljs-keyword">model</span>.eval()    conv_representation = <span class="hljs-keyword">model</span>(image)</code></pre><h5 id="2-æå–ImageNeté¢„è®­ç»ƒæ¨¡å‹å¤šå±‚çš„å·ç§¯ç‰¹å¾"><a href="#2-æå–ImageNeté¢„è®­ç»ƒæ¨¡å‹å¤šå±‚çš„å·ç§¯ç‰¹å¾" class="headerlink" title="(2) æå–ImageNeté¢„è®­ç»ƒæ¨¡å‹å¤šå±‚çš„å·ç§¯ç‰¹å¾"></a>(2) æå–ImageNeté¢„è®­ç»ƒæ¨¡å‹å¤šå±‚çš„å·ç§¯ç‰¹å¾</h5><pre><code class="hljs vim">class FeatureExtractor(torch.<span class="hljs-keyword">nn</span>.Module):    <span class="hljs-string">&quot;&quot;</span><span class="hljs-comment">&quot;Helper class to extract several convolution features from the given</span>    <span class="hljs-keyword">pre</span>-trained model.    Attribute<span class="hljs-variable">s:</span>        _model, torch.<span class="hljs-keyword">nn</span>.Module.        _layers_to_extract, <span class="hljs-keyword">list</span><span class="hljs-symbol">&lt;str&gt;</span> <span class="hljs-built_in">or</span> <span class="hljs-keyword">set</span><span class="hljs-symbol">&lt;str&gt;</span>    Example:        &gt;&gt;&gt; model = torchvision.models.resnet152(pretrained=True)        &gt;&gt;&gt; model = torch.<span class="hljs-keyword">nn</span>.Sequential(collections.OrderedDict(                <span class="hljs-keyword">list</span>(model.named_children())[:-<span class="hljs-number">1</span>]))        &gt;&gt;&gt; conv_representation = FeatureExtractor(                pretrained_model=model,                layers_to_extract=&#123;<span class="hljs-string">&#x27;layer1&#x27;</span>, <span class="hljs-string">&#x27;layer2&#x27;</span>, <span class="hljs-string">&#x27;layer3&#x27;</span>, <span class="hljs-string">&#x27;layer4&#x27;</span>&#125;)(image)    <span class="hljs-string">&quot;&quot;</span><span class="hljs-comment">&quot;</span>    def __init__(self, pretrained_model, layers_to_extract):        torch.<span class="hljs-keyword">nn</span>.Module.__init__(self)        self._model = pretrained_model        self._model.<span class="hljs-built_in">eval</span>()        self._layers_to_extract = <span class="hljs-keyword">set</span>(layers_to_extract)        def forward(self, <span class="hljs-keyword">x</span>):        with torch.no_grad():            conv_representation = []            <span class="hljs-keyword">for</span> name, layer in self._model.named_children():                <span class="hljs-keyword">x</span> = layer(<span class="hljs-keyword">x</span>)                <span class="hljs-keyword">if</span> name in self._layers_to_extrac<span class="hljs-variable">t:</span>                    conv_representation.<span class="hljs-keyword">append</span>(<span class="hljs-keyword">x</span>)            <span class="hljs-keyword">return</span> conv_representation</code></pre><h5 id="ï¼“-éƒ¨åˆ†å±‚ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹"><a href="#ï¼“-éƒ¨åˆ†å±‚ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹" class="headerlink" title="(ï¼“)  éƒ¨åˆ†å±‚ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹"></a>(ï¼“)  éƒ¨åˆ†å±‚ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹</h5><p>æ³¨æ„å¦‚æœä¿å­˜çš„æ¨¡å‹æ˜¯<code>torch.nn.DataParallel</code>ï¼Œåˆ™å½“å‰çš„æ¨¡å‹ä¹Ÿéœ€è¦æ˜¯<code>torch.nn.DataParallel</code>ã€‚<code>torch.nn.DataParallel(model).module == model</code>ã€‚</p><pre><code class="hljs reasonml">model.load<span class="hljs-constructor">_state_dict(<span class="hljs-params">torch</span>.<span class="hljs-params">load</span>(&#x27;<span class="hljs-params">model</span>,<span class="hljs-params">pth</span>&#x27;)</span>, strict=False)</code></pre><p>å°†åœ¨GPUä¿å­˜çš„æ¨¡å‹åŠ è½½åˆ°CPU:</p><pre><code class="hljs reasonml">model.load<span class="hljs-constructor">_state_dict(<span class="hljs-params">torch</span>.<span class="hljs-params">load</span>(&#x27;<span class="hljs-params">model</span>,<span class="hljs-params">pth</span>&#x27;, <span class="hljs-params">map_location</span>=&#x27;<span class="hljs-params">cpu</span>&#x27;)</span>)</code></pre><h5 id="ï¼ˆï¼”ï¼‰fine-tune-å¾®è°ƒå…¨è¿æ¥å±‚"><a href="#ï¼ˆï¼”ï¼‰fine-tune-å¾®è°ƒå…¨è¿æ¥å±‚" class="headerlink" title="ï¼ˆï¼”ï¼‰fine-tune å¾®è°ƒå…¨è¿æ¥å±‚"></a>ï¼ˆï¼”ï¼‰fine-tune å¾®è°ƒå…¨è¿æ¥å±‚</h5><h5 id="4-å¾®è°ƒå…¨è¿æ¥å±‚"><a href="#4-å¾®è°ƒå…¨è¿æ¥å±‚" class="headerlink" title="(4) å¾®è°ƒå…¨è¿æ¥å±‚"></a>(4) å¾®è°ƒå…¨è¿æ¥å±‚</h5><pre><code class="hljs nix"><span class="hljs-attr">model</span> = torchvision.models.resnet18(<span class="hljs-attr">pretrained=True)</span>for param <span class="hljs-keyword">in</span> model.parameters():    param.<span class="hljs-attr">requires_grad</span> = Falsemodel.<span class="hljs-attr">fc</span> = nn.Linear(<span class="hljs-number">512</span>, <span class="hljs-number">100</span>)  <span class="hljs-comment"># Replace the last fc layer</span><span class="hljs-attr">optimizer</span> = torch.optim.SGD(model.fc.parameters(), <span class="hljs-attr">lr=1e-2,</span> <span class="hljs-attr">momentum=0.9,</span> <span class="hljs-attr">weight_decay=1e-4)</span></code></pre><p>ä»¥è¾ƒå¤§å­¦ä¹ ç‡å¾®è°ƒå…¨è¿æ¥å±‚ï¼Œè¾ƒå°å­¦ä¹ ç‡å¾®è°ƒå·ç§¯å±‚</p><pre><code class="hljs ini"><span class="hljs-attr">model</span> = torchvision.models.resnet18(pretrained=<span class="hljs-literal">True</span>)<span class="hljs-attr">finetuned_parameters</span> = list(map(id, model.fc.parameters()))<span class="hljs-attr">conv_parameters</span> = (p for p in model.parameters() if id(p) not in finetuned_parameters)<span class="hljs-attr">parameters</span> = [&#123;<span class="hljs-string">&#x27;parameters&#x27;</span>: conv_parameters, <span class="hljs-string">&#x27;lr&#x27;</span>: <span class="hljs-number">1</span>e-<span class="hljs-number">3</span>&#125;,               &#123;<span class="hljs-string">&#x27;parameters&#x27;</span>: model.fc.parameters()&#125;]<span class="hljs-attr">optimizer</span> = torch.optim.SGD(parameters, lr=<span class="hljs-number">1</span>e-<span class="hljs-number">2</span>, momentum=<span class="hljs-number">0.9</span>, weight_decay=<span class="hljs-number">1</span>e-<span class="hljs-number">4</span>)</code></pre><h5 id="ï¼ˆï¼•ï¼‰ä¿å­˜ä¸åŠ è½½æ–­ç‚¹"><a href="#ï¼ˆï¼•ï¼‰ä¿å­˜ä¸åŠ è½½æ–­ç‚¹" class="headerlink" title="ï¼ˆï¼•ï¼‰ä¿å­˜ä¸åŠ è½½æ–­ç‚¹"></a>ï¼ˆï¼•ï¼‰ä¿å­˜ä¸åŠ è½½æ–­ç‚¹</h5><p>æ³¨æ„ä¸ºäº†èƒ½å¤Ÿæ¢å¤è®­ç»ƒï¼Œæˆ‘ä»¬éœ€è¦åŒæ—¶ä¿å­˜æ¨¡å‹å’Œä¼˜åŒ–å™¨çš„çŠ¶æ€ï¼Œä»¥åŠå½“å‰çš„è®­ç»ƒè½®æ•°ã€‚</p><pre><code class="hljs lua"># Save checkpoint.is_best = current_acc &gt; best_accbest_acc = <span class="hljs-built_in">max</span>(best_acc, current_acc)checkpoint = &#123;    <span class="hljs-string">&#x27;best_acc&#x27;</span>: best_acc,        <span class="hljs-string">&#x27;epoch&#x27;</span>: t + <span class="hljs-number">1</span>,    <span class="hljs-string">&#x27;model&#x27;</span>: model.state_dict(),    <span class="hljs-string">&#x27;optimizer&#x27;</span>: optimizer.state_dict(),&#125;model_path = <span class="hljs-built_in">os</span>.<span class="hljs-built_in">path</span>.join(<span class="hljs-string">&#x27;model&#x27;</span>, <span class="hljs-string">&#x27;checkpoint.pth.tar&#x27;</span>)torch.save(checkpoint, model_path)<span class="hljs-keyword">if</span> is_best:    shutil.copy(<span class="hljs-string">&#x27;checkpoint.pth.tar&#x27;</span>, model_path)# Load checkpoint.<span class="hljs-keyword">if</span> <span class="hljs-built_in">resume</span>:    model_path = <span class="hljs-built_in">os</span>.<span class="hljs-built_in">path</span>.join(<span class="hljs-string">&#x27;model&#x27;</span>, <span class="hljs-string">&#x27;checkpoint.pth.tar&#x27;</span>)    <span class="hljs-built_in">assert</span> <span class="hljs-built_in">os</span>.<span class="hljs-built_in">path</span>.isfile(model_path)    checkpoint = torch.<span class="hljs-built_in">load</span>(model_path)    best_acc = checkpoint[<span class="hljs-string">&#x27;best_acc&#x27;</span>]    start_epoch = checkpoint[<span class="hljs-string">&#x27;epoch&#x27;</span>]    model.load_state_dict(checkpoint[<span class="hljs-string">&#x27;model&#x27;</span>])    optimizer.load_state_dict(checkpoint[<span class="hljs-string">&#x27;optimizer&#x27;</span>])    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Load checkpoint at epoch %d.&#x27;</span> % start_epoch)</code></pre><h5 id="ï¼–-è®¡ç®—æ¨¡å‹å‚æ•°é‡-D"><a href="#ï¼–-è®¡ç®—æ¨¡å‹å‚æ•°é‡-D" class="headerlink" title="(ï¼–) è®¡ç®—æ¨¡å‹å‚æ•°é‡[D]"></a>(ï¼–) è®¡ç®—æ¨¡å‹å‚æ•°é‡[D]</h5><pre><code class="hljs lisp"># Total parameters                    num_params = sum(<span class="hljs-name">p</span>.numel() for p in model.parameters()) # Trainable parametersnum_trainable_params = sum(<span class="hljs-name">p</span>.numel() for p in model.parameters() if p.requires_grad)</code></pre><h5 id="ï¼—-æ¨¡å‹æƒå€¼åˆå§‹åŒ–-D"><a href="#ï¼—-æ¨¡å‹æƒå€¼åˆå§‹åŒ–-D" class="headerlink" title="(ï¼—) æ¨¡å‹æƒå€¼åˆå§‹åŒ–[D]"></a>(ï¼—) æ¨¡å‹æƒå€¼åˆå§‹åŒ–[D]</h5><p>æ³¨æ„<code>model.modules()</code>å’Œ<code>model.children()</code>çš„åŒºåˆ«ï¼š<code>model.modules()</code>ä¼šè¿­ä»£åœ°éå†æ¨¡å‹çš„æ‰€æœ‰å­å±‚ï¼Œè€Œ<code>model.children()</code>åªä¼šéå†æ¨¡å‹ä¸‹çš„ä¸€å±‚ã€‚</p><pre><code class="hljs python"><span class="hljs-comment"># Common practise for initialization.</span><span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> model.modules():    <span class="hljs-keyword">if</span> isinstance(m, torch.nn.Conv2d):        torch.nn.init.kaiming_normal_(m.weight, mode=<span class="hljs-string">&#x27;fan_out&#x27;</span>,                                      nonlinearity=<span class="hljs-string">&#x27;relu&#x27;</span>)        <span class="hljs-keyword">if</span> m.bias <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:            torch.nn.init.constant_(m.bias, val=<span class="hljs-number">0.0</span>)        <span class="hljs-keyword">elif</span> isinstance(m, torch.nn.BatchNorm2d):        torch.nn.init.constant_(m.weight, <span class="hljs-number">1.0</span>)        torch.nn.init.constant_(m.bias, <span class="hljs-number">0.0</span>)      <span class="hljs-keyword">elif</span> isinstance(m, torch.nn.Linear):        torch.nn.init.xavier_normal_(m.weight)        <span class="hljs-keyword">if</span> m.bias <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:            torch.nn.init.constant_(m.bias, <span class="hljs-number">0.0</span>)<span class="hljs-comment"># Initialization with given tensor.</span>m.weight = torch.nn.Parameter(tensor)</code></pre><h5 id="8-å†»ç»“å‚æ•°"><a href="#8-å†»ç»“å‚æ•°" class="headerlink" title="(8) å†»ç»“å‚æ•°"></a>(8) å†»ç»“å‚æ•°</h5><pre><code class="hljs sqf"><span class="hljs-keyword">if</span> <span class="hljs-built_in">not</span> requires_grad:    <span class="hljs-keyword">for</span> <span class="hljs-built_in">param</span> <span class="hljs-built_in">in</span> self.parameters():        <span class="hljs-built_in">param</span>.requires_grad = <span class="hljs-literal">False</span></code></pre><h3 id="3-æ•°æ®"><a href="#3-æ•°æ®" class="headerlink" title="3. æ•°æ®"></a>3. æ•°æ®</h3><h5 id="1-å¸¸è§è®­ç»ƒå’ŒéªŒè¯æ•°æ®é¢„å¤„ç†"><a href="#1-å¸¸è§è®­ç»ƒå’ŒéªŒè¯æ•°æ®é¢„å¤„ç†" class="headerlink" title="(1) å¸¸è§è®­ç»ƒå’ŒéªŒè¯æ•°æ®é¢„å¤„ç†"></a>(1) å¸¸è§è®­ç»ƒå’ŒéªŒè¯æ•°æ®é¢„å¤„ç†</h5><p>ToTensoræ“ä½œä¼šå°†PIL.Imageæˆ–å½¢çŠ¶ä¸ºHÃ—WÃ—Dï¼Œæ•°å€¼èŒƒå›´ä¸º[0, 255]çš„np.ndarrayè½¬æ¢ä¸ºå½¢çŠ¶ä¸ºDÃ—HÃ—Wï¼Œæ•°å€¼èŒƒå›´ä¸º[0.0, 1.0]çš„torch.Tensorã€‚</p><pre><code class="hljs angelscript">train_transform = torchvision.transforms.Compose([    torchvision.transforms.RandomResizedCrop(size=<span class="hljs-number">224</span>,                                             scale=(<span class="hljs-number">0.08</span>, <span class="hljs-number">1.0</span>)),    torchvision.transforms.RandomHorizontalFlip(),    torchvision.transforms.ToTensor(),    torchvision.transforms.Normalize(mean=(<span class="hljs-number">0.485</span>, <span class="hljs-number">0.456</span>, <span class="hljs-number">0.406</span>),                                     std=(<span class="hljs-number">0.229</span>, <span class="hljs-number">0.224</span>, <span class="hljs-number">0.225</span>)), ]) val_transform = torchvision.transforms.Compose([    torchvision.transforms.Resize(<span class="hljs-number">224</span>),    torchvision.transforms.CenterCrop(<span class="hljs-number">224</span>),    torchvision.transforms.ToTensor(),    torchvision.transforms.Normalize(mean=(<span class="hljs-number">0.485</span>, <span class="hljs-number">0.456</span>, <span class="hljs-number">0.406</span>),                                     std=(<span class="hljs-number">0.229</span>, <span class="hljs-number">0.224</span>, <span class="hljs-number">0.225</span>)),])</code></pre><h3 id="4-è®­ç»ƒ"><a href="#4-è®­ç»ƒ" class="headerlink" title="4. è®­ç»ƒ"></a>4. è®­ç»ƒ</h3><h5 id="1-å°†æ•´æ•°æ ‡è®°è½¬æ¢æˆç‹¬çƒ­ï¼ˆone-hotï¼‰ç¼–ç "><a href="#1-å°†æ•´æ•°æ ‡è®°è½¬æ¢æˆç‹¬çƒ­ï¼ˆone-hotï¼‰ç¼–ç " class="headerlink" title="(1) å°†æ•´æ•°æ ‡è®°è½¬æ¢æˆç‹¬çƒ­ï¼ˆone-hotï¼‰ç¼–ç "></a>(1) å°†æ•´æ•°æ ‡è®°è½¬æ¢æˆç‹¬çƒ­ï¼ˆone-hotï¼‰ç¼–ç </h5><p> (PyTorchä¸­çš„æ ‡è®°é»˜è®¤ä»0å¼€å§‹)</p><pre><code class="hljs routeros">N = tensor.size(0)one_hot = torch.zeros(N, num_classes).long()one_hot.scatter_(<span class="hljs-attribute">dim</span>=1, <span class="hljs-attribute">index</span>=torch.unsqueeze(tensor, <span class="hljs-attribute">dim</span>=1), <span class="hljs-attribute">src</span>=torch.ones(N, num_classes).long())</code></pre><h5 id="2-è®¡ç®—ä¸¤ç»„æ•°æ®ä¹‹é—´çš„ä¸¤ä¸¤æ¬§å¼è·ç¦»"><a href="#2-è®¡ç®—ä¸¤ç»„æ•°æ®ä¹‹é—´çš„ä¸¤ä¸¤æ¬§å¼è·ç¦»" class="headerlink" title="(2) è®¡ç®—ä¸¤ç»„æ•°æ®ä¹‹é—´çš„ä¸¤ä¸¤æ¬§å¼è·ç¦»"></a>(2) è®¡ç®—ä¸¤ç»„æ•°æ®ä¹‹é—´çš„ä¸¤ä¸¤æ¬§å¼è·ç¦»</h5><pre><code class="hljs markdown"><span class="hljs-section"># X1 is of shape m<span class="hljs-emphasis">*d.</span></span><span class="hljs-section"><span class="hljs-emphasis">X1 = torch.unsqueeze(X1, dim=1).expand(m, n, d)</span></span><span class="hljs-section"><span class="hljs-emphasis"># X2 is of shape n*</span>d.</span>X2 = torch.unsqueeze(X2, dim=0).expand(m, n, d)<span class="hljs-section"># dist is of shape m<span class="hljs-emphasis">*n, where dist[<span class="hljs-string">i</span>][<span class="hljs-symbol">j</span>] = sqrt(|X1[i, :] - X[j, :]|^2)</span></span><span class="hljs-section"><span class="hljs-emphasis">dist = torch.sqrt(torch.sum((X1 - X2) <span class="hljs-strong">** 2, dim=2))</span></span></span></code></pre><h5 id="3-åŒçº¿æ€§æ±‡åˆï¼ˆbilinear-poolingï¼‰"><a href="#3-åŒçº¿æ€§æ±‡åˆï¼ˆbilinear-poolingï¼‰" class="headerlink" title="(3) åŒçº¿æ€§æ±‡åˆï¼ˆbilinear poolingï¼‰"></a>(3) åŒçº¿æ€§æ±‡åˆï¼ˆbilinear poolingï¼‰</h5><pre><code class="hljs tp"><span class="hljs-keyword">X</span> = torch.reshape(N, D, H * <span class="hljs-keyword">W</span>)                        # Assume <span class="hljs-keyword">X</span> has shape N*D*H*<span class="hljs-keyword">W</span><span class="hljs-keyword">X</span> = torch.bmm(<span class="hljs-keyword">X</span>, torch.transpose(<span class="hljs-keyword">X</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)) / (H * <span class="hljs-keyword">W</span>)  # Bilinear poolingassert <span class="hljs-keyword">X</span>.size() == (N, D, D)<span class="hljs-keyword">X</span> = torch.reshape(<span class="hljs-keyword">X</span>, (N, D * D))<span class="hljs-keyword">X</span> = torch.sign(<span class="hljs-keyword">X</span>) * torch.sqrt(torch.abs(<span class="hljs-keyword">X</span>) + <span class="hljs-number">1e-5</span>)   # Signed-sqrt normalization<span class="hljs-keyword">X</span> = torch.nn.functional.normalize(<span class="hljs-keyword">X</span>)                  # L<span class="hljs-number">2</span> normalization</code></pre><h5 id="4-L1-æ­£åˆ™åŒ–"><a href="#4-L1-æ­£åˆ™åŒ–" class="headerlink" title="(4) L1 æ­£åˆ™åŒ–"></a>(4) L1 æ­£åˆ™åŒ–</h5><pre><code class="hljs gams">l1_regularization = torch.nn.L1Loss(reduction=<span class="hljs-string">&#x27;sum&#x27;</span>)loss = ...  # Standard cross-<span class="hljs-built_in">entropy</span> loss<span class="hljs-keyword">for</span> param in <span class="hljs-keyword">model</span>.parameters():    loss += torch.<span class="hljs-keyword">sum</span>(torch.<span class="hljs-built_in">abs</span>(param))loss.backward()reg = <span class="hljs-number">1e-6</span>l2_loss = <span class="hljs-keyword">Variable</span>(torch.FloatTensor(1), requires_grad=True)for <span class="hljs-comment">name, param in model.named_parameters():</span>    if <span class="hljs-comment">&#x27;bias&#x27;</span><span class="hljs-comment"> not in name:</span>        l2_loss <span class="hljs-comment">= l2_loss + (0.5 * reg * torch.sum(torch.pow(W, 2)))</span></code></pre><h5 id="5-ä¸å¯¹åç½®é¡¹è¿›è¡ŒL2æ­£åˆ™åŒ–-æƒå€¼è¡°å‡ï¼ˆweight-decayï¼‰"><a href="#5-ä¸å¯¹åç½®é¡¹è¿›è¡ŒL2æ­£åˆ™åŒ–-æƒå€¼è¡°å‡ï¼ˆweight-decayï¼‰" class="headerlink" title="(5) ä¸å¯¹åç½®é¡¹è¿›è¡ŒL2æ­£åˆ™åŒ–/æƒå€¼è¡°å‡ï¼ˆweight decayï¼‰"></a>(5) ä¸å¯¹åç½®é¡¹è¿›è¡ŒL2æ­£åˆ™åŒ–/æƒå€¼è¡°å‡ï¼ˆweight decayï¼‰</h5><pre><code class="hljs ini"><span class="hljs-attr">bias_list</span> = (param for name, param in model.named_parameters() if name[-<span class="hljs-number">4</span>:] == <span class="hljs-string">&#x27;bias&#x27;</span>)<span class="hljs-attr">others_list</span> = (param for name, param in model.named_parameters() if name[-<span class="hljs-number">4</span>:] != <span class="hljs-string">&#x27;bias&#x27;</span>)<span class="hljs-attr">parameters</span> = [&#123;<span class="hljs-string">&#x27;parameters&#x27;</span>: bias_list, <span class="hljs-string">&#x27;weight_decay&#x27;</span>: <span class="hljs-number">0</span>&#125;,                              &#123;<span class="hljs-string">&#x27;parameters&#x27;</span>: others_list&#125;]<span class="hljs-attr">optimizer</span> = torch.optim.SGD(parameters, lr=<span class="hljs-number">1</span>e-<span class="hljs-number">2</span>, momentum=<span class="hljs-number">0.9</span>, weight_decay=<span class="hljs-number">1</span>e-<span class="hljs-number">4</span>)</code></pre><h5 id="6-æ¢¯åº¦è£å‰ªï¼ˆgradient-clippingï¼‰"><a href="#6-æ¢¯åº¦è£å‰ªï¼ˆgradient-clippingï¼‰" class="headerlink" title="(6) æ¢¯åº¦è£å‰ªï¼ˆgradient clippingï¼‰"></a>(6) æ¢¯åº¦è£å‰ªï¼ˆgradient clippingï¼‰</h5> <pre><code class="hljs reasonml">torch.nn.utils.clip<span class="hljs-constructor">_grad_norm_(<span class="hljs-params">model</span>.<span class="hljs-params">parameters</span>()</span>, max_norm=<span class="hljs-number">20</span>)</code></pre><h5 id="7-è®¡ç®—Softmax-è¾“å‡ºçš„æ­£ç¡®ç‡"><a href="#7-è®¡ç®—Softmax-è¾“å‡ºçš„æ­£ç¡®ç‡" class="headerlink" title="(7) è®¡ç®—Softmax è¾“å‡ºçš„æ­£ç¡®ç‡"></a>(7) è®¡ç®—Softmax è¾“å‡ºçš„æ­£ç¡®ç‡</h5><pre><code class="hljs ini"><span class="hljs-attr">score</span> = model(images)<span class="hljs-attr">prediction</span> = torch.argmax(score, dim=<span class="hljs-number">1</span>)<span class="hljs-attr">num_correct</span> = torch.sum(prediction == labels).item()<span class="hljs-attr">accuruacy</span> = num_correct / labels.size(<span class="hljs-number">0</span>)</code></pre><h5 id="8-è·å–å½“å‰å­¦ä¹ ç‡"><a href="#8-è·å–å½“å‰å­¦ä¹ ç‡" class="headerlink" title="(8) è·å–å½“å‰å­¦ä¹ ç‡"></a>(8) è·å–å½“å‰å­¦ä¹ ç‡</h5><pre><code class="hljs vim"># If there <span class="hljs-keyword">is</span> one <span class="hljs-keyword">global</span> learning rate (which <span class="hljs-keyword">is</span> the common case).<span class="hljs-keyword">lr</span> = <span class="hljs-keyword">next</span>(iter(optimizer.param_groups))[<span class="hljs-string">&#x27;lr&#x27;</span>]# If there are multiple learning rates <span class="hljs-keyword">for</span> different layers.all_lr = []<span class="hljs-keyword">for</span> param_group in optimizer.param_group<span class="hljs-variable">s:</span>    all_lr.<span class="hljs-keyword">append</span>(param_group[<span class="hljs-string">&#x27;lr&#x27;</span>])</code></pre><h3 id="5-Trick"><a href="#5-Trick" class="headerlink" title="5. Trick"></a>5. Trick</h3><h5 id="1-label-smothing"><a href="#1-label-smothing" class="headerlink" title="(1)  label smothing"></a>(1)  label smothing</h5><pre><code class="hljs nix">for images, labels <span class="hljs-keyword">in</span> train_loader:    images, <span class="hljs-attr">labels</span> = images.cuda(), labels.cuda()    <span class="hljs-attr">N</span> = labels.size(<span class="hljs-number">0</span>)    <span class="hljs-comment"># C is the number of classes.</span>    <span class="hljs-attr">smoothed_labels</span> = torch.full(<span class="hljs-attr">size=(N,</span> C), <span class="hljs-attr">fill_value=0.1</span> / (C - <span class="hljs-number">1</span>)).cuda()    smoothed_labels.scatter_(<span class="hljs-attr">dim=1,</span> <span class="hljs-attr">index=torch.unsqueeze(labels,</span> <span class="hljs-attr">dim=1),</span> <span class="hljs-attr">value=0.9)</span>    <span class="hljs-attr">score</span> = model(images)    <span class="hljs-attr">log_prob</span> = torch.nn.functional.log_softmax(score, <span class="hljs-attr">dim=1)</span>    <span class="hljs-attr">loss</span> = -torch.sum(log_prob * smoothed_labels) / N    optimizer.zero_grad()    loss.backward()    optimizer.step()</code></pre><h5 id="2-Mixup"><a href="#2-Mixup" class="headerlink" title="(2) Mixup"></a>(2) Mixup</h5><pre><code class="hljs reasonml">beta_distribution = torch.distributions.beta.<span class="hljs-constructor">Beta(<span class="hljs-params">alpha</span>, <span class="hljs-params">alpha</span>)</span><span class="hljs-keyword">for</span> images, labels <span class="hljs-keyword">in</span> train_loader:    images, labels = images.cuda<span class="hljs-literal">()</span>, labels.cuda<span class="hljs-literal">()</span>    # Mixup images.    lambda_ = beta_distribution.sample(<span class="hljs-literal">[]</span>).item<span class="hljs-literal">()</span>    index = torch.randperm(images.size(<span class="hljs-number">0</span>)).cuda<span class="hljs-literal">()</span>    mixed_images = lambda_<span class="hljs-operator"> * </span>images + (<span class="hljs-number">1</span> - lambda_)<span class="hljs-operator"> * </span>images<span class="hljs-literal">[<span class="hljs-identifier">index</span>, :]</span>    # Mixup loss.        scores = model(mixed_images)    loss = (lambda_<span class="hljs-operator"> * </span>loss<span class="hljs-constructor">_function(<span class="hljs-params">scores</span>, <span class="hljs-params">labels</span>)</span>             + (<span class="hljs-number">1</span> - lambda_)<span class="hljs-operator"> * </span>loss<span class="hljs-constructor">_function(<span class="hljs-params">scores</span>, <span class="hljs-params">labels</span>[<span class="hljs-params">index</span>])</span>)    optimizer.zero<span class="hljs-constructor">_grad()</span>    loss.backward<span class="hljs-literal">()</span>    optimizer.step<span class="hljs-literal">()</span></code></pre><h5 id="3-å¤šå¡åŒæ­¥BNï¼ˆBatch-normalizationï¼‰"><a href="#3-å¤šå¡åŒæ­¥BNï¼ˆBatch-normalizationï¼‰" class="headerlink" title="(3) å¤šå¡åŒæ­¥BNï¼ˆBatch normalizationï¼‰"></a>(3) å¤šå¡åŒæ­¥BNï¼ˆBatch normalizationï¼‰</h5><p>å½“ä½¿ç”¨torch.nn.DataParallelå°†ä»£ç è¿è¡Œåœ¨å¤šå¼ GPUå¡ä¸Šæ—¶ï¼ŒPyTorchçš„BNå±‚é»˜è®¤æ“ä½œæ˜¯å„å¡ä¸Šæ•°æ®ç‹¬ç«‹åœ°è®¡ç®—å‡å€¼å’Œæ ‡å‡†å·®ï¼ŒåŒæ­¥BNä½¿ç”¨æ‰€æœ‰å¡ä¸Šçš„æ•°æ®ä¸€èµ·è®¡ç®—BNå±‚çš„å‡å€¼å’Œæ ‡å‡†å·®ï¼Œç¼“è§£äº†å½“æ‰¹é‡å¤§å°ï¼ˆbatch sizeï¼‰æ¯”è¾ƒå°æ—¶å¯¹å‡å€¼å’Œæ ‡å‡†å·®ä¼°è®¡ä¸å‡†çš„æƒ…å†µï¼Œæ˜¯åœ¨ç›®æ ‡æ£€æµ‹ç­‰ä»»åŠ¡ä¸­ä¸€ä¸ªæœ‰æ•ˆçš„æå‡æ€§èƒ½çš„æŠ€å·§ã€‚</p><p>å‚è§ï¼š <a href="vacancy/Synchronized-BatchNorm-PyTorchgithub.com">Synchronized-BatchNorm-PyTorchgithub</a></p><p>Reference:</p><ol><li><a href>Tensorflow cookbook</a></li><li><a href>Pytorch cookbook</a></li><li><a href="https://github.com/kevinzakka/pytorch-goodies">Pytorch-goodies</a></li><li><a href="https://github.com/chenyuntc/pytorch-book">Pytorch book</a></li><li>Pytorch å®˜æ–¹æ–‡æ¡£ å’Œ Tutorial</li></ol>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pytorchåŸºæœ¬æ¦‚å¿µ</title>
    <link href="/2019/03/17/pytorch%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/"/>
    <url>/2019/03/17/pytorch%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/</url>
    
    <content type="html"><![CDATA[<p>Pytorchå‡ ä¸ªåŸºæœ¬æ¦‚å¿µçš„åŒºåˆ†</p><a id="more"></a><h3 id="1-numpy-array-å’Œ-Tensor-CPU-amp-GPU"><a href="#1-numpy-array-å’Œ-Tensor-CPU-amp-GPU" class="headerlink" title="1. numpy array å’Œ Tensor(CPU &amp; GPU)"></a>1. numpy array å’Œ Tensor(CPU &amp; GPU)</h3><pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; import torch</span><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; import numpy as np</span><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; a = np.ones(5)</span><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; a</span>array([1., 1., 1., 1., 1.])<span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; b = torch.from_numpy(a)     <span class="hljs-comment"># numpy array-&gt; CPU Tensor</span></span><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; b </span>tensor([1., 1., 1., 1., 1.], dtype=torch.float64)<span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; y = y.cuda()     <span class="hljs-comment"># CPU Tensor -&gt; GPU Tensor</span></span><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; y</span>tensor([1., 1., 1., 1., 1.], device=&#x27;cuda:0&#x27;, dtype=torch.float64)<span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; y = y.cpu()  <span class="hljs-comment"># GPU Tensor-&gt; CPU Tensor</span></span><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; y</span>tensor([1., 1., 1., 1., 1.], dtype=torch.float64)<span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; y = y.numpy()  <span class="hljs-comment"># CPU Tensor -&gt; numpy array</span></span><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; y</span>array([1., 1., 1., 1., 1.])device = torch.device(&quot;cuda&quot; if torch.cuda.is_available() else &quot;cpu&quot;)<span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; y = torch.from_numpy(y)</span><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; y.to(device) <span class="hljs-comment"># è¿™é‡Œ x.to(device) ç­‰ä»·äº x.cuda()</span></span>tensor([1., 1., 1., 1., 1.], device=&#x27;cuda:0&#x27;, dtype=torch.float64)</code></pre><p>ç´¢å¼•ã€ view æ˜¯ä¸ä¼šå¼€è¾Ÿæ–°å†…å­˜çš„ï¼Œè€Œåƒ y = x + y è¿™æ ·çš„è¿ç®—æ˜¯ä¼šæ–°å¼€å†…å­˜çš„ï¼Œç„¶åå°† y æŒ‡å‘æ–°å†…å­˜ã€‚</p><h3 id="2-Variable-å’Œ-Tensor-require-grad-True"><a href="#2-Variable-å’Œ-Tensor-require-grad-True" class="headerlink" title="2. Variable å’Œã€€Tensor (require_grad=True)"></a>2. Variable å’Œã€€Tensor (require_grad=True)</h3><p>â€‹    Pytorch 0.4 ä¹‹å‰çš„æ¨¡å¼ä¸º:ã€€<strong>Tensor æ²¡æœ‰æ¢¯åº¦è®¡ç®—ï¼ŒåŠ ä¸Šæ¢¯åº¦æ›´æ–°ç­‰æ“ä½œåå¯ä»¥å˜ä¸ºVariable</strong>.  Pytorch0.4 å°† Tensor å’ŒVariable åˆå¹¶ã€‚é»˜è®¤ Tensor çš„ require_grad ä¸º falseï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ requires_grad æ¥ä¸ºå…¶æ·»åŠ æ¢¯åº¦æ›´æ–°æ“ä½œã€‚</p><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>ytensor([<span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>], dtype=torch.float64)  <span class="hljs-meta">&gt;&gt;&gt; </span>y.requires_grad<span class="hljs-literal">False</span><span class="hljs-meta">&gt;&gt;&gt; </span>y.requires_grad = <span class="hljs-literal">True</span><span class="hljs-meta">&gt;&gt;&gt; </span>ytensor([<span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>], dtype=torch.float64, requires_grad=<span class="hljs-literal">True</span>)</code></pre><h3 id="3-detach-å’Œ-with-torch-no-grad"><a href="#3-detach-å’Œ-with-torch-no-grad" class="headerlink" title="3. detach å’Œã€€with torch.no_grad()"></a>3. detach å’Œã€€with torch.no_grad()</h3><p>ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ detachå’Œ torch.no_gradåŒºåˆ«çš„è§£é‡Š:</p><blockquote><p><strong><code>detach()</code> detaches the output from the computationnal graph. So no gradient will be backproped along this variable.</strong></p><p><strong><code>torch.no_grad</code> says that no operation should build the graph.</strong></p><p><strong>The difference is that one refers to only a given variable on which itâ€™s called. The other affects all operations taking place within the with statement.</strong></p></blockquote><p><code>detach()</code> å°†ä¸€ä¸ªå˜é‡ä»è®¡ç®—å›¾ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä¹Ÿæ²¡æœ‰äº†ç›¸å…³çš„æ¢¯åº¦æ›´æ–°ã€‚<code>torch.no_grad()</code>åªæ˜¯è¯´æ˜è¯¥æ“ä½œæ²¡å¿…è¦å»ºå›¾ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œå‰è€…åªèƒ½æŒ‡å®šä¸€ä¸ªç»™å®šçš„å˜é‡ï¼Œåè€… åˆ™ä¼šå½±å“å½±å“åœ¨ with è¯­å¥ä¸­å‘ç”Ÿçš„æ‰€æœ‰æ“ä½œã€‚</p><h3 id="4-model-eval-å’Œ-torch-no-grad"><a href="#4-model-eval-å’Œ-torch-no-grad" class="headerlink" title="4. model.eval()ã€€å’Œ torch.no_grad()"></a>4. model.eval()ã€€å’Œ torch.no_grad()</h3><blockquote><p><strong>These two have different goals:</strong></p><ul><li><p><code>model.eval()</code> will notify all your layers that you are in eval mode, that way, batchnorm or dropout layers will work in eval mode instead of training mode.</p></li><li><p><code>torch.no_grad()</code> impacts the autograd engine and deactivate it. It will reduce memory usage and speed up computations but you wonâ€™t be able to backprop (which you donâ€™t want in an eval script).</p></li></ul></blockquote><p><code>model.eval()</code>å’Œ<code>torch.no_grad()</code>çš„åŒºåˆ«åœ¨äºï¼Œ<code>model.eval()</code>æ˜¯å°†ç½‘ç»œåˆ‡æ¢ä¸ºæµ‹è¯•çŠ¶æ€ï¼Œä¾‹å¦‚BNå’Œéšæœºå¤±æ´»ï¼ˆdropoutï¼‰åœ¨è®­ç»ƒå’Œæµ‹è¯•é˜¶æ®µä½¿ç”¨ä¸åŒçš„è®¡ç®—æ–¹æ³•ã€‚<code>torch.no_grad()</code>æ˜¯å…³é—­PyTorchå¼ é‡çš„è‡ªåŠ¨æ±‚å¯¼æœºåˆ¶ï¼Œä»¥å‡å°‘å­˜å‚¨ä½¿ç”¨å’ŒåŠ é€Ÿè®¡ç®—ï¼Œå¾—åˆ°çš„ç»“æœæ— æ³•è¿›è¡Œ<code>loss.backward()</code></p><h3 id="5-xx-data-å’Œ-xx-detach"><a href="#5-xx-data-å’Œ-xx-detach" class="headerlink" title="5. xx.data å’Œ xx.detach()"></a>5. xx.data å’Œ xx.detach()</h3><p>â€‹      åœ¨ 0.4.0 ç‰ˆæœ¬ä¹‹å‰,  .data çš„è¯­ä¹‰æ˜¯ è·å– Variable çš„ å†…éƒ¨ Tensor, åœ¨ 0.4.0 ç‰ˆæœ¬å°† Variable å’Œ Tensor merge ä¹‹å,  <code>.data</code> å’Œä¹‹å‰æœ‰ç±»ä¼¼çš„è¯­ä¹‰ï¼Œ ä¹Ÿæ˜¯å†…éƒ¨çš„ Tensor çš„æ¦‚å¿µã€‚<code>x.data</code> ä¸ <code>x.detach()</code> è¿”å›çš„ tensor æœ‰ç›¸åŒçš„åœ°æ–¹, ä¹Ÿæœ‰ä¸åŒçš„åœ°æ–¹:</p><p><strong>ç›¸åŒ:</strong></p><ul><li>éƒ½å’Œ x å…±äº«åŒä¸€å—æ•°æ®</li><li>éƒ½å’Œ x çš„ è®¡ç®—å†å²æ— å…³</li><li>requires_grad = False</li></ul><p><strong>ä¸åŒ:</strong></p><ul><li>y= x.data åœ¨æŸäº›æƒ…å†µä¸‹ä¸å®‰å…¨, æŸäº›æƒ…å†µ, æŒ‡çš„å°±æ˜¯ä¸Šè¿° inplace operation çš„ç¬¬äºŒç§æƒ…å†µ, æ‰€ä»¥, release note ä¸­æŒ‡å‡º, å¦‚æœæƒ³è¦ detach çš„æ•ˆæœçš„è¯, è¿˜æ˜¯ detach() å®‰å…¨ä¸€äº›.</li></ul><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> torch<span class="hljs-meta">&gt;&gt;&gt; </span>x = torch.FloatTensor([[<span class="hljs-number">1.</span>, <span class="hljs-number">2.</span>]])<span class="hljs-meta">&gt;&gt;&gt; </span>w1 = torch.FloatTensor([[<span class="hljs-number">2.</span>], [<span class="hljs-number">1.</span>]])<span class="hljs-meta">&gt;&gt;&gt; </span>w2 = torch.FloatTensor([<span class="hljs-number">3.</span>])<span class="hljs-meta">&gt;&gt;&gt; </span>w1.requires_grad = <span class="hljs-literal">True</span><span class="hljs-meta">&gt;&gt;&gt; </span>w2.requires_grad = <span class="hljs-literal">True</span><span class="hljs-meta">&gt;&gt;&gt; </span>d = torch.matmul(x, w1)<span class="hljs-meta">&gt;&gt;&gt; </span>d_ = d.data<span class="hljs-meta">&gt;&gt;&gt; </span>f = torch.matmul(d, w2)<span class="hljs-meta">&gt;&gt;&gt; </span>d_[:] = <span class="hljs-number">1</span><span class="hljs-meta">&gt;&gt;&gt; </span>f.backward()</code></pre><p><strong>å¦‚æœéœ€è¦è·å–å…¶å€¼ï¼Œå¯ä»¥ä½¿ç”¨  xx.cpu().numpy() æˆ–è€… xx.cpu().detach().numpy() ç„¶åè¿›è¡Œæ“ä½œï¼Œä¸å»ºè®®å†ä½¿ç”¨ volatileå’Œ  xx.dataæ“ä½œã€‚</strong></p><h3 id="6-ToTensor-amp-ToPILImage-å„è‡ªéƒ½åšäº†ä»€ä¹ˆ"><a href="#6-ToTensor-amp-ToPILImage-å„è‡ªéƒ½åšäº†ä»€ä¹ˆ" class="headerlink" title="6. ToTensor &amp; ToPILImage å„è‡ªéƒ½åšäº†ä»€ä¹ˆ?"></a>6. ToTensor &amp; ToPILImage å„è‡ªéƒ½åšäº†ä»€ä¹ˆ?</h3><p><strong>ToTensor:</strong></p><ul><li>å–å€¼èŒƒå›´ï¼š   [0, 255]  â€”&gt;  [0, 1.0]</li><li>NHWC  â€”&gt; NCHW</li><li>PILImage  â€”&gt; FloatTensor</li></ul><pre><code class="hljs python"><span class="hljs-comment"># PIL.Image -&gt; torch.Tensor.</span>tensor = torch.from_numpy(np.asarray(PIL.Image.open(path))    ).permute(<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>).float() / <span class="hljs-number">255</span><span class="hljs-comment">#ã€€ç­‰ä»·äº</span>tensor = torchvision.transforms.functional.to_tensor(PIL.Image.open(path))</code></pre><p><strong>ToPILImage:</strong></p><ul><li>å–å€¼èŒƒå›´:  [0, 1.0] â€”&gt;  [0, 255]</li><li>NCHW â€”&gt; NHWC</li><li>ç±»å‹: FloatTensor -&gt; numpy Uint8 -&gt; PILImage</li></ul><pre><code class="hljs python"><span class="hljs-comment"># torch.Tensor -&gt; PIL.Image.</span>image = PIL.Image.fromarray(torch.clamp(tensor * <span class="hljs-number">255</span>, min=<span class="hljs-number">0</span>, max=<span class="hljs-number">255</span>    ).byte().permute(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>).cpu().numpy())<span class="hljs-comment">#ã€€ç­‰ä»·äº</span>image = torchvision.transforms.functional.to_pil_image(tensor)</code></pre><h3 id="7-torch-nn-xxx-ä¸-torch-nn-functional-xxx"><a href="#7-torch-nn-xxx-ä¸-torch-nn-functional-xxx" class="headerlink" title="7. torch.nn.xxx ä¸ torch.nn.functional.xxx"></a>7. torch.nn.xxx ä¸ torch.nn.functional.xxx</h3><p>å»ºè®®ç»Ÿä¸€ä½¿ç”¨ã€€<code>torch.nn.xxx</code>ã€€æ¨¡å—ï¼Œ<code>torch.functional.xxx</code> å¯èƒ½ä¼šåœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬ä¸­å»æ‰ã€‚</p><p><code>torch.nn</code>ã€€æ¨¡å—å’Œã€€<code>torch.nn.functional</code>ã€€çš„åŒºåˆ«åœ¨äºï¼Œ<code>torch.nn</code>ã€€æ¨¡å—åœ¨è®¡ç®—æ—¶åº•å±‚è°ƒç”¨äº†<code>torch.nn.functional</code>ï¼Œä½†ã€€<code>torch.nn</code>ã€€æ¨¡å—åŒ…æ‹¬è¯¥å±‚å‚æ•°ï¼Œè¿˜å¯ä»¥åº”å¯¹è®­ç»ƒå’Œæµ‹è¯•ä¸¤ç§ç½‘ç»œçŠ¶æ€ã€‚ä½¿ç”¨ã€€<code>torch.nn.functional</code>ã€€æ—¶è¦æ³¨æ„ç½‘ç»œçŠ¶æ€ï¼Œå¦‚:</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">self, x</span>):</span>    ...    x = torch.nn.functional.dropout(x, p=<span class="hljs-number">0.5</span>, training=self.training)</code></pre>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>neural-network-part1</title>
    <link href="/2019/03/11/neural-network-part1/"/>
    <url>/2019/03/11/neural-network-part1/</url>
    
    <content type="html"><![CDATA[<h3 id="ä¸€-æ•°æ®é¢„å¤„ç†"><a href="#ä¸€-æ•°æ®é¢„å¤„ç†" class="headerlink" title="ä¸€. æ•°æ®é¢„å¤„ç†"></a>ä¸€. æ•°æ®é¢„å¤„ç†</h3><h4 id="1-ä¸­å¿ƒåŒ–"><a href="#1-ä¸­å¿ƒåŒ–" class="headerlink" title="1. ä¸­å¿ƒåŒ–"></a>1. ä¸­å¿ƒåŒ–</h4><p>ä¸­å¿ƒåŒ–æ˜¯é¢„å¤„ç†æœ€å¸¸ç”¨çš„å½¢å¼ã€‚å®ƒå¯¹æ•°æ®ä¸­æ¯ä¸ªç‹¬ç«‹<em>ç‰¹å¾</em>å‡å»å¹³å‡å€¼ï¼Œä»å‡ ä½•ä¸Šå¯ä»¥ç†è§£ä¸ºåœ¨æ¯ä¸ªç»´åº¦ä¸Šéƒ½å°†æ•°æ®äº‘çš„ä¸­å¿ƒéƒ½è¿ç§»åˆ°åŸç‚¹ã€‚åœ¨numpyä¸­ï¼Œè¯¥æ“ä½œå¯ä»¥é€šè¿‡ä»£ç <code>X -= np.mean(X, axis=0)</code>å®ç°ã€‚è€Œå¯¹äºå›¾åƒï¼Œæ›´å¸¸ç”¨çš„æ˜¯å¯¹æ‰€æœ‰åƒç´ éƒ½å‡å»ä¸€ä¸ªå€¼ï¼Œå¯ä»¥ç”¨<code>X -= np.mean(X)</code>å®ç°ï¼Œä¹Ÿå¯ä»¥åœ¨3ä¸ªé¢œè‰²é€šé“ä¸Šåˆ†åˆ«æ“ä½œã€‚</p><h4 id="2-å½’ä¸€åŒ–"><a href="#2-å½’ä¸€åŒ–" class="headerlink" title="2. å½’ä¸€åŒ–"></a>2. å½’ä¸€åŒ–</h4><p>å½’ä¸€åŒ–æ˜¯æŒ‡å°†æ•°æ®çš„æ‰€æœ‰ç»´åº¦éƒ½å½’ä¸€åŒ–ï¼Œä½¿å…¶æ•°å€¼èŒƒå›´éƒ½è¿‘ä¼¼ç›¸ç­‰ã€‚æœ‰ä¸¤ç§å¸¸ç”¨æ–¹æ³•å¯ä»¥å®ç°å½’ä¸€åŒ–ã€‚</p><p>ç¬¬ä¸€ç§æ˜¯å…ˆå¯¹æ•°æ®åšé›¶ä¸­å¿ƒåŒ–ï¼ˆzero-centeredï¼‰å¤„ç†ï¼Œç„¶åæ¯ä¸ªç»´åº¦éƒ½é™¤ä»¥å…¶æ ‡å‡†å·®ï¼Œå®ç°ä»£ç ä¸º<code>X /= np.std(X, axis=0)</code>ã€‚</p><p>ç¬¬äºŒç§æ–¹æ³•æ˜¯å¯¹æ¯ä¸ªç»´åº¦éƒ½åšå½’ä¸€åŒ–ï¼Œä½¿å¾—æ¯ä¸ªç»´åº¦çš„æœ€å¤§å’Œæœ€å°å€¼æ˜¯1å’Œ-1ã€‚</p><p>è¿™ä¸ªé¢„å¤„ç†æ“ä½œåªæœ‰åœ¨ç¡®ä¿¡ä¸åŒçš„è¾“å…¥ç‰¹å¾æœ‰ä¸åŒçš„æ•°å€¼èŒƒå›´ï¼ˆæˆ–è®¡é‡å•ä½ï¼‰æ—¶æ‰æœ‰æ„ä¹‰ï¼Œä½†è¦æ³¨æ„é¢„å¤„ç†æ“ä½œçš„é‡è¦æ€§å‡ ä¹ç­‰åŒäºå­¦ä¹ ç®—æ³•æœ¬èº«ã€‚åœ¨å›¾åƒå¤„ç†ä¸­ï¼Œç”±äºåƒç´ çš„æ•°å€¼èŒƒå›´å‡ ä¹æ˜¯ä¸€è‡´çš„ï¼ˆéƒ½åœ¨0-255ä¹‹é—´ï¼‰ï¼Œæ‰€ä»¥è¿›è¡Œè¿™ä¸ªé¢å¤–çš„é¢„å¤„ç†æ­¥éª¤å¹¶ä¸æ˜¯å¾ˆå¿…è¦ã€‚</p><h3 id="äºŒ-æ¿€æ´»å‡½æ•°"><a href="#äºŒ-æ¿€æ´»å‡½æ•°" class="headerlink" title="äºŒ. æ¿€æ´»å‡½æ•°"></a>äºŒ. æ¿€æ´»å‡½æ•°</h3><h4 id="1-å¸¸è§çš„æ¿€æ´»å‡½æ•°åŠå…¶å¯¼æ•°"><a href="#1-å¸¸è§çš„æ¿€æ´»å‡½æ•°åŠå…¶å¯¼æ•°" class="headerlink" title="1. å¸¸è§çš„æ¿€æ´»å‡½æ•°åŠå…¶å¯¼æ•°"></a>1. å¸¸è§çš„æ¿€æ´»å‡½æ•°åŠå…¶å¯¼æ•°</h4><p>Sigmoid æ¿€æ´»å‡½æ•°çš„å½¢å¼ä¸º   <script type="math/tex">f(z) = \frac{1}{1+e^{-z}}</script>,  å¯¹åº”çš„å¯¼å‡½æ•°ä¸º    $fâ€™(z) = f(z)(1-f(z))$</p><p>Tanhæ¿€æ´»å‡½æ•°çš„å½¢å¼ä¸º   $f(z) = \frac{e^{z} - e^{-z}}{e^{z}+e^{-z}}$,    å¯¹åº”çš„å¯¼å‡½æ•°ä¸º$fâ€™(z) = 1 - (f(z))^2$ </p><p>ReLU æ¿€æ´»å‡½æ•°çš„å½¢å¼ä¸º  $f(z) = max(0, z)$,    å¯¹åº”çš„å¯¼å‡½æ•°ä¸º   <script type="math/tex">f'(z)=\left\{\begin{aligned}1, z > 0 \\0, z \leq 0 \\\end{aligned}\right.</script></p><h4 id="2-ä¸ºä»€ä¹ˆ-sigmoid-å’Œ-tanh-æ¿€æ´»å‡½æ•°ä¼šå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±çš„ç°è±¡ï¼Ÿ"><a href="#2-ä¸ºä»€ä¹ˆ-sigmoid-å’Œ-tanh-æ¿€æ´»å‡½æ•°ä¼šå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±çš„ç°è±¡ï¼Ÿ" class="headerlink" title="2. ä¸ºä»€ä¹ˆ sigmoid å’Œ tanh æ¿€æ´»å‡½æ•°ä¼šå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±çš„ç°è±¡ï¼Ÿ"></a>2. ä¸ºä»€ä¹ˆ sigmoid å’Œ tanh æ¿€æ´»å‡½æ•°ä¼šå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±çš„ç°è±¡ï¼Ÿ</h4><p>sigmoid æ¿€æ´»å‡½æ•°çš„æ›²çº¿å¦‚ä¸‹å·¦å›¾æ‰€ç¤ºã€‚å®ƒå°†è¾“å…¥z æ˜ å°„åˆ°ï¼ˆ0, 1ï¼‰ï¼Œå½“zå¾ˆå¤§æ—¶ï¼Œ f(z) è¶‹è¿‘äº1ï¼›å½“zå¾ˆå°æ—¶ï¼Œ f(z) è¶‹è¿‘äº0ï¼Œ è€Œå…¶å¯¼å‡½æ•° $fâ€™(z) = f(z)(1-f(z)) $ åœ¨ z å¾ˆå¤§æˆ–è€…å¾ˆå°æ—¶éƒ½ä¼šè¶‹è¿‘äº0ï¼Œé€ æˆæ¢¯åº¦æ¶ˆå¤±çš„ç°è±¡ã€‚</p><p>tanh æ¿€æ´»å‡½æ•°çš„å›¾åƒå¦‚ä¸‹å³å›¾æ‰€ç¤ºã€‚å½“zå¾ˆå¤§æ—¶ï¼Œf(z) è¶‹è¿‘äº1ï¼Œ å½“z å¾ˆå°æ—¶ï¼Œ z è¶‹è¿‘äº-1ã€‚ å…¶å¯¼æ•° $fâ€™(z) = 1 - (f(z))^2â€‹$  åœ¨ z å¾ˆå¤§æˆ–å¾ˆå°æ—¶éƒ½ä¼šè¶‹è¿‘äº0ï¼ŒåŒæ ·ä¼šå‡ºç°æ¢¯åº¦æ¶ˆå¤±ã€‚</p><p>å®é™…ä¸Šï¼ŒTanh ç›¸å½“äº Sigmoidçš„å¹³ç§»ï¼š  <script type="math/tex">tanh(z) = 2sigmoid(2x)-1</script>ã€‚</p><p><img src="/2019/03/11/neural-network-part1/sigmoid_and_tanh.png" alt="sigmoid and tanh"></p><h4 id="3-ReLU-ç³»åˆ—çš„æ¿€æ´»å‡½æ•°ç›¸å¯¹äº-sigmoid-å’Œ-tanh-çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿå®ƒä»¬æœ‰ä»€ä¹ˆå±€é™æ€§ä»¥åŠå¦‚ä½•æ”¹è¿›ï¼Ÿ"><a href="#3-ReLU-ç³»åˆ—çš„æ¿€æ´»å‡½æ•°ç›¸å¯¹äº-sigmoid-å’Œ-tanh-çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿå®ƒä»¬æœ‰ä»€ä¹ˆå±€é™æ€§ä»¥åŠå¦‚ä½•æ”¹è¿›ï¼Ÿ" class="headerlink" title="3. ReLU ç³»åˆ—çš„æ¿€æ´»å‡½æ•°ç›¸å¯¹äº sigmoid å’Œ tanh çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿå®ƒä»¬æœ‰ä»€ä¹ˆå±€é™æ€§ä»¥åŠå¦‚ä½•æ”¹è¿›ï¼Ÿ"></a>3. ReLU ç³»åˆ—çš„æ¿€æ´»å‡½æ•°ç›¸å¯¹äº sigmoid å’Œ tanh çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿå®ƒä»¬æœ‰ä»€ä¹ˆå±€é™æ€§ä»¥åŠå¦‚ä½•æ”¹è¿›ï¼Ÿ</h4><p>ä¼˜ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰ä»è®¡ç®—è§’åº¦ä¸Šï¼Œ Sigmoid å’Œ tanh æ¿€æ´»å‡½æ•°å‡éœ€è¦è®¡ç®—æŒ‡æ•°ï¼Œå¤æ‚åº¦é«˜ï¼Œè€ŒReLUåªéœ€è¦ä¸€ä¸ªé˜ˆå€¼å³å¯å¾—åˆ°æ¿€æ´»å€¼ã€‚</p><p>ï¼ˆ2ï¼‰ReLU çš„éçº¿æ€§åŒ…å«çº¿æ€§å¯ä»¥æœ‰æ•ˆåœ°è§£å†³æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œæä¾›ç›¸å¯¹è¾ƒå®½çš„æ¿€æ´»è¾¹ç•Œã€‚</p><p>ï¼ˆ3ï¼‰ReLUçš„å•ä¾§æŠ‘åˆ¶æä¾›äº†ç½‘ç»œçš„ç¨€ç–è¡¨è¾¾èƒ½åŠ›ã€‚  </p><p>å±€é™æ€§ï¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šä¼šå¯¼è‡´ç¥ç»å…ƒæ­»äº¡çš„é—®é¢˜ã€‚è¿™æ˜¯ç”±äº $f(z) = max(0, z)$  å¯¼è‡´è´Ÿæ¢¯åº¦åœ¨ç»è¿‡è¯¥ReLU å•å…ƒæ—¶è¢«ç½®ä¸º0ï¼Œ ä¸”åœ¨ä¹‹åä¹Ÿä¸è¢«ä»»ä½•æ•°æ®æ¿€æ´»ï¼Œå³æµç»è¯¥ç¥ç»å…ƒçš„æ¢¯åº¦æ°¸è¿œä¸º0ï¼Œ ä¸å¯¹ä»»ä½•æ•°æ®äº§ç”Ÿå“åº”ã€‚åœ¨å®é™…è®­ç»ƒä¸­ï¼Œå¦‚æœå­¦ä¹ ç‡è®¾ç½®è¾ƒå¤§ï¼Œä¼šå¯¼è‡´è¶…è¿‡ä¸€å®šæ¯”ä¾‹çš„ç¥ç»å…ƒä¸å¯é€†æ­»äº¡ï¼Œè¿›è€Œå‚æ•°æ¢¯åº¦æ— æ³•æ›´æ–°ï¼Œæ•´ä¸ªè®­ç»ƒè¿‡ç¨‹å¤±è´¥ã€‚</p><p>ä¸€äº›ReLU çš„æ”¹è¿›æªæ–½ï¼š</p><p>ï¼ˆ1ï¼‰Leaky ReLUï¼ˆLReLUï¼‰</p><p>Leaky ReLU çš„è¡¨ç¤ºå½¢å¼ä¸ºï¼š<script type="math/tex">f(z)=\left\{\begin{aligned}z, z > 0 \\\alpha z, z \leq 0 \\\end{aligned}\right.</script> ï¼Œ Leaky ReLU ä¸ ReLU çš„åŒºåˆ«åœ¨äºå½“ $z\le 0$ æ—¶ï¼Œ å…¶å€¼ä¸ä¸ºé›¶ï¼Œä¸€èˆ¬æ¥è¯´a ä¸ºä¸€ä¸ªå¾ˆå°çš„å¸¸æ•°(0.01æˆ–è€…0.001æ•°é‡çº§çš„è¾ƒå°æ•´æ•°)ï¼Œè¿™æ ·æ—¢å®ç°äº†å•ä¾§æŠ‘åˆ¶ï¼Œåˆä¿ç•™äº†éƒ¨åˆ†è´Ÿæ¢¯åº¦ä¿¡æ¯ä»¥è‡´ä¸å®Œå…¨ä¸¢å¤±ã€‚ä½†å¦ä¸€æ–¹é¢ï¼Œ$ \alpha$  ä¸ºè¶…å‚æ•°ï¼Œè¾ƒéš¾è®¾ç½®ä¸ºåˆé€‚çš„å€¼ï¼Œä¸”è¾ƒä¸ºæ•æ„Ÿï¼Œå› æ­¤Leaky ReLU å‡½æ•°åœ¨å®é™…ä½¿ç”¨ä¸­çš„æ€§èƒ½éƒ¨åˆ†ååˆ†ç¨³å®šã€‚</p><p>ï¼ˆ2ï¼‰å‚æ•°åŒ– ReLUï¼ˆParametric  ReLUï¼ŒPReLUï¼‰ï¼šPReLUå°†è´Ÿè½´éƒ¨åˆ†æ–œç‡$ \alpha$ ä½œä¸ºç½‘ç»œä¸­çš„ä¸€ä¸ªå¯å­¦ä¹ çš„å‚æ•°èå…¥æ¨¡å‹çš„æ•´ä½“è®­ç»ƒè¿‡ç¨‹ã€‚æœ‰å‡ ç‚¹æœ‰è¶£çš„ç°è±¡éœ€è¦æ³¨æ„ï¼š</p><ul><li><p>è‡ªç”±åº¦è¾ƒå¤§çš„å„é€šé“ç‹¬äº«å‚æ•°çš„å‚æ•°åŒ–ReLUæ€§èƒ½ç›¸æ¯”è¾ƒå„é€šé“å…±äº«å‚æ•°æ›´ä¼˜ã€‚</p></li><li><p>åœ¨ç‹¬äº«å‚æ•°è®¾å®šä¸‹å­¦åˆ°çš„$ \alpha$å–å€¼å‘ˆç°å‡ºç”±æµ…å±‚åˆ°æ·±å±‚ä¾æ¬¡é€’å‡çš„è¶‹åŠ¿ï¼Œè¿™è¯´æ˜å®é™…ä¸Šç½‘ç»œæ‰€éœ€è¦çš„éçº¿æ€§éšç€ç½‘ç»œå±‚æ•°çš„å¢åŠ è€Œé€’å‡ã€‚ </p><p>åœ¨åˆ†ç±»ç²¾åº¦ä¸Šï¼Œ ä½¿ç”¨PReLU ä½œä¸ºæ¿€æ´»å‡½æ•°çš„ç½‘ç»œè¦ä¼˜äºåŸå§‹ReLUçš„ç½‘ç»œã€‚ä½†æ˜¯PReLUåœ¨å¸¦æ¥æ›´å¤§è‡ªç”±åº¦çš„åŒæ—¶ï¼Œä¹Ÿå¢åŠ äº†ç½‘ç»œæ¨¡å‹è¿‡æ‹Ÿåˆçš„å¥‰çŒ®ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­éœ€è¦æ ¼å¤–æ³¨æ„ã€‚</p></li></ul><p>ï¼ˆ3ï¼‰éšæœºåŒ–ReLU(Random ReLU, RReLUï¼‰ï¼šå¢åŠ äº†â€œéšæœºåŒ–æœºåˆ¶ï¼Œ å…¶å–å€¼åœ¨è®­ç»ƒé˜¶æ®µæœä»å‡åŒ€åˆ†å¸ƒï¼Œåœ¨æµ‹è¯•é˜¶æ®µåˆ™å°†å…¶æŒ‡å®šä¸ºè¯¥å‡åŒ€åˆ†å¸ƒå¯¹åº”çš„æ•°å­¦æœŸæœ› $ \frac{l+u}{2}\ $ã€‚</p><p><img src="/2019/03/11/neural-network-part1/relu_adv.png" alt="sigmoid and tanh"></p><p>ï¼ˆ4ï¼‰æŒ‡æ•°åŒ–çº¿æ€§å•å…ƒï¼ˆExponential Linear Unitï¼Œ ELUï¼‰ï¼š2016å¹´ Clevert ç­‰äººæå‡ºäº†æŒ‡æ•°åŒ–çº¿æ€§å•å…ƒ ELUï¼Œå…¶å…¬å¼ä¸ºï¼š <script type="math/tex">ELU(x)=\left\{\begin{aligned}x, x \ge 0 \\\lambda \cdot (e^x - 1), z \lt 0 \\\end{aligned}\right.</script>ã€‚ReLU å…·å¤‡äº† ReLU å‡½æ•°çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶ä¹Ÿè§£å†³äº†ReLU å‡½æ•°è‡ªèº«çš„â€œæ­»åŒºâ€é—®é¢˜ã€‚ä¸è¿‡ELU å‡½æ•°ä¸­çš„æŒ‡æ•°æ“ä½œç¨ç¨å¢å¤§äº†è®¡ç®—é‡ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒELU ä¸­çš„è¶…å‚æ•° $\lambda$ ä¸€èˆ¬è¢«è®¾ç½®ä¸º1ã€‚</p><h3 id="ä¸‰-ç½‘ç»œå‚æ•°åˆå§‹åŒ–"><a href="#ä¸‰-ç½‘ç»œå‚æ•°åˆå§‹åŒ–" class="headerlink" title="ä¸‰. ç½‘ç»œå‚æ•°åˆå§‹åŒ–"></a>ä¸‰. ç½‘ç»œå‚æ•°åˆå§‹åŒ–</h3><p>ç½‘ç»œå‚æ•°åˆå§‹åŒ–æ–¹å¼ä¸»è¦åˆ†ä¸ºå››ç§ï¼š</p><p>ï¼ˆ1ï¼‰å…¨é›¶åˆå§‹åŒ–ï¼šå…¨é›¶åˆå§‹åŒ–ä¼šå¯¼è‡´ç½‘ç»œä¸é€šç¥ç»å…ƒçš„è¾“å‡ºç›¸åŒï¼Œç›¸åŒçš„è¾“å‡ºå¯¼è‡´æ¢¯åº¦æ›´æ–°å®Œå…¨ä¸€æ ·ï¼Œè¿™æ ·ä¾¿ä¼šä»¤æ›´æ–°åçš„å‚æ•°ä»ç„¶ä¿æŒä¸€æ ·çš„çŠ¶æ€ï¼Œä»è€Œæ— æ³•å¯¹æ¨¡å‹è¿›è¡Œè®­ç»ƒã€‚</p><p>ï¼ˆ2ï¼‰éšæœºåˆå§‹åŒ–ï¼šå°†å‚æ•°å€¼éšæœºè®¾å®šä¸ºæ¥è¿‘0çš„ä¸€ä¸ªå¾ˆå°çš„éšæœºæ•°ï¼ˆæœ‰æ­£æœ‰è´Ÿï¼‰ã€‚</p><p>é«˜æ–¯åˆ†å¸ƒï¼š</p><pre><code class="hljs python"><span class="hljs-comment"># origin method</span>w = <span class="hljs-number">0.001</span> * randn(n_in, n_out)<span class="hljs-comment"># Xavier method </span>w = (<span class="hljs-number">0.001</span> * randn(n_in, n_out)) / sqrt(n)<span class="hljs-comment"># He method</span>w = (<span class="hljs-number">0.001</span> * randn(n_in, n_out)) / sqrt(n/<span class="hljs-number">2</span>)<span class="hljs-comment"># å…¶ä¸­n=n_inæˆ–n=(n_in+n_out)/2</span></code></pre><p>å‡åŒ€åˆ†å¸ƒï¼š</p><pre><code class="hljs python"><span class="hljs-comment">#  Xavier method</span>low = -sqrt(<span class="hljs-number">3</span>/n)high = sqrt(<span class="hljs-number">3</span>/n)rand_param = low + (high - low) * rand(n_in, n_out)w = <span class="hljs-number">0.001</span> * rand_param <span class="hljs-comment"># He mothod</span>low = -sqrt(<span class="hljs-number">6</span>/n)high = sqrt(<span class="hljs-number">6</span>/n)rand_param = low + (high - low) * rand(n_in, n_out)w = <span class="hljs-number">0.001</span> * rand_param</code></pre><p>ï¼ˆ3ï¼‰é¢„è®­ç»ƒæ¨¡å‹åˆå§‹åŒ–</p><p>ï¼ˆ4ï¼‰ æ•°æ®æ•æ„Ÿçš„å‚æ•°åˆå§‹åŒ–æ–¹å¼   <a href="https://github.com/philkr/magic_init">github address</a></p><p>æ€»ç»“ï¼š </p><ul><li>ç½‘ç»œå‚æ•°åˆå§‹åŒ–çš„ä¼˜åŠ£åœ¨æå¤§ç¨‹åº¦ä¸Šå†³å®šäº†ç½‘ç»œçš„æœ€ç»ˆæ€§èƒ½ã€‚</li><li>æ¯”è¾ƒæ¨èçš„ç½‘ç»œåˆå§‹åŒ–æ–¹å¼ä¸ºHeæ–¹å¼ï¼Œå°†å‚æ•°åˆå§‹åŒ–ä¸ºæœä»é«˜æ–¯éƒ¨åˆ†æˆ–è€…å‡åŒ€åˆ†å¸ƒçš„è¾ƒå°éšæœºæ•°ï¼ŒåŒæ—¶å¯¹å‚æ•°æ–¹å·®éœ€è¦åŠ ä»¥è§„èŒƒåŒ–ã€‚</li><li>å¦å¤–å€ŸåŠ©é¢„è®­ç»ƒæ¨¡å‹ä¸­çš„å‚æ•°ä½œä¸ºæ–°ä»»åŠ¡çš„å‚æ•°åˆå§‹åŒ–æ–¹å¼ä¸€ç§ç®€ä¾¿å¼‚æ€§ä¸”ååˆ†æœ‰æ•ˆçš„æ¨¡å‹å‚æ•°åˆå§‹åŒ–æ–¹æ³•ã€‚</li></ul><p>xavier å‚æ•°åˆå§‹åŒ–æ–¹å¼çš„ç”±æ¥ï¼š</p><p>å‡è®¾sä¸ºæœªç»éçº¿æ€§å˜åŒ–çš„è¯¥å±‚ç½‘ç»œè¾“å‡ºç»“æœï¼Œwä¸ºè¯¥å±‚å‚æ•°ï¼Œxä¸ºè¯¥å±‚çš„è¾“å…¥æ•°æ®ï¼Œåˆ™ï¼š</p><script type="math/tex; mode=display">Var(s) = Var(\sum_i^nw_ix_i)   \\       = \sum_i^nVar(w_ix_i)   \\       = \sum_i^n[E(w_i)]^2Var(x_i) +[E(x_i)]^2Var(w_i) + Var(x_i)Var(x_i)     \\       = \sum_i^nVar(x_i)Var(w_i) \\       = (nVar(w))Var(x) \\</script><p>ä¸ºäº†ä¿è¯è¾“å‡ºæ•°æ® Var(s) å’Œè¾“å…¥æ•°æ®Var(x)çš„æ–¹å·®ä¸€è‡´ï¼Œéœ€ä»¤ nVarï¼ˆwï¼‰ = 1ï¼Œå³ $n \cdot Var(a\omega)=n\cdot a^2 \cdot Var(\omegaâ€™) = 1$ï¼Œ åˆ™ $a=\sqrt{(1/n)}$ï¼Œ å…¶ä¸­$\omegaâ€™$ä¸ºæ–¹å·®è§„èŒƒåŒ–åçš„å‚æ•°ã€‚</p><h3 id="å››-ç›®æ ‡å‡½æ•°"><a href="#å››-ç›®æ ‡å‡½æ•°" class="headerlink" title="å››. ç›®æ ‡å‡½æ•°"></a>å››. ç›®æ ‡å‡½æ•°</h3><h4 id="1-åˆ†ç±»ä»»åŠ¡çš„ç›®æ ‡å‡½æ•°"><a href="#1-åˆ†ç±»ä»»åŠ¡çš„ç›®æ ‡å‡½æ•°" class="headerlink" title="1. åˆ†ç±»ä»»åŠ¡çš„ç›®æ ‡å‡½æ•°"></a>1. åˆ†ç±»ä»»åŠ¡çš„ç›®æ ‡å‡½æ•°</h4><h5 id="1-äº¤å‰ç†µæŸå¤±å‡½æ•°-Softmax-æŸå¤±å‡½æ•°"><a href="#1-äº¤å‰ç†µæŸå¤±å‡½æ•°-Softmax-æŸå¤±å‡½æ•°" class="headerlink" title="(1) äº¤å‰ç†µæŸå¤±å‡½æ•°/Softmax æŸå¤±å‡½æ•°"></a>(1) äº¤å‰ç†µæŸå¤±å‡½æ•°/Softmax æŸå¤±å‡½æ•°</h5><p>äº¤å‰ç†µ(cross entropy)æŸå¤±å‡½æ•°åˆç§°Softmax æŸå¤±å‡½æ•°ï¼Œæ˜¯ç›®å‰å·ç§¯ç¥ç»ç½‘ç»œæœ€å¸¸ç”¨çš„åˆ†ç±»ç›®æ ‡å‡½æ•°ã€‚å…¶å½¢å¼ä¸ºï¼š</p><p>$L<em>{cross\ entropy\ loss} = L</em>{softmax\ loss} = -\frac{1}{N}\sum<em>{i=1}^{N}log(\frac{e^{h</em>{y<em>i}}}{\sum</em>{j=1}^{C}e^{h_j}})$</p><p>å³é€šè¿‡æŒ‡æ•°åŒ–å˜æ¢ä½¿ç½‘ç»œè¾“å‡º $h$ è½¬æ¢ä¸ºæ¦‚ç‡å½¢å¼ã€‚</p><h5 id="2-åˆé¡µæŸå¤±å‡½æ•°"><a href="#2-åˆé¡µæŸå¤±å‡½æ•°" class="headerlink" title="(2) åˆé¡µæŸå¤±å‡½æ•°"></a>(2) åˆé¡µæŸå¤±å‡½æ•°</h5><p>åœ¨æ”¯æŒå‘é‡æœºä¸­è¢«å¹¿æ³›ä½¿ç”¨çš„åˆé¡µæŸå¤±å‡½æ•°ï¼ˆhinge lossï¼‰æœ‰æ—¶ä¹Ÿä½œä¸ºç›®æ ‡å‡½æ•°åœ¨ç¥ç»ç½‘ç»œæ¨¡å‹ä¸­ä½¿ç”¨ï¼š</p><p>$L<em>{hinge\ loss} = \frac{1}{N}\sum</em>{i=1}^{N}max{(0, 1-h_{yi})}$</p><p>åˆé¡µæŸå¤±å‡½æ•°çš„è®¾è®¡ç†å¿µæ˜¯ï¼šå¯¹é”™è¯¯è¶Šå¤§çš„æ ·æœ¬æ–½åŠ è¶Šä¸¥é‡çš„æƒ©ç½šã€‚å¯æ˜¯è¿™ä¸€æŸå¤±å‡½æ•°å¯¹å™ªå£°çš„æŠµæŠ—èƒ½åŠ›è¾ƒå·®ã€‚å¦å¤–ï¼Œä¸€èˆ¬çš„åˆ†ç±»ä»»åŠ¡ä¸­çš„äº¤å‰ç†µæŸå¤±å‡½æ•°çš„åˆ†ç±»æ•ˆæœç•¥ä¼˜äºåˆé¡µæŸå¤±å‡½æ•°çš„åˆ†ç±»æ•ˆæœã€‚</p><h5 id="3-å¡é“æŸå¤±å‡½æ•°"><a href="#3-å¡é“æŸå¤±å‡½æ•°" class="headerlink" title="(3) å¡é“æŸå¤±å‡½æ•°"></a>(3) å¡é“æŸå¤±å‡½æ•°</h5><p>å¡é“æŸå¤±å‡½æ•°çš„å®šä¹‰ä¸ºï¼š</p><script type="math/tex; mode=display">L_{ramp\ loss} = L_{hinge\ loss} - \frac{1}{N}\sum_{i=1}^{M}max{(0, s-h{yi})}  \\= \frac{1}{N}\sum_{i=1}^{M}(max{(0, 1-h_{yi})} - max{(0, s-h_{yi})})  \\</script><p>å…¶ä¸­ , $s$ åˆ¶å®šäº†â€œæˆªæ–­ç‚¹â€çš„æ–‡èŒã€‚ç”±äºå¡é“æŸå¤±å‡½æ•°å®é™…åœ¨ $s$ å¤„â€œæˆªæ–­â€ åˆé¡µæŸå¤±å‡½æ•°ï¼Œå› æ­¤å¡é“æŸå¤±å‡½æ•°ä¹Ÿè¢«ç§°ä¸ºâ€œæˆªæ–­åˆé¡µæŸå¤±å‡½æ•°â€(truncated hinge loss function)</p><h5 id="4-å¤§é—´éš”äº¤å‰ç†µæŸå¤±å‡½æ•°"><a href="#4-å¤§é—´éš”äº¤å‰ç†µæŸå¤±å‡½æ•°" class="headerlink" title="(4) å¤§é—´éš”äº¤å‰ç†µæŸå¤±å‡½æ•°"></a>(4) å¤§é—´éš”äº¤å‰ç†µæŸå¤±å‡½æ•°</h5><p>ä¸Šé¢æåˆ°çš„ç½‘ç»œè¾“å‡ºç»“æœ $h$ å®é™…ä¸Šå¸‚å…¨è¿æ¥å±‚å‚æ•° $W$ ä¸è¯¥å±‚ç‰¹å¾å‘é‡ $x_i$çš„å†…ç§¯ï¼Œ å³ $h=W^Tx_i$ã€‚å› æ­¤ä¼ ç»Ÿçš„äº¤å‰ç†µæŸå¤±è¿˜å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p><script type="math/tex; mode=display">L_{softmax\ loss} = -\frac{1}{N}\sum_{i=1}^{N}log(\frac{e^{h_{y_i}}}{\sum_{j=1}^{C}e^{h_j}}) \\= -\frac{1}{N}\sum_{i=1}^{N}log(\frac{e^{W^T_{yi}x_i}}{\sum_{j=1}^{C}e^{W^T_jx_i}}) \\</script><p>å…¶ä¸­ï¼Œ $W_i^T$ ä¸º$W$ ç¬¬iåˆ—å‚æ•°å€¼ã€‚æ ¹æ®å†…ç§¯çš„å®šä¹‰ï¼Œä¸Šå¼å¯ä»¥å˜æ¢ä¸º</p><script type="math/tex; mode=display">L_{softmax\ loss} = -\frac{1}{N}\sum_{i=1}^{N}log(\frac{e^{||W_{yi}||||x_i||cos(\theta_{yi})}}{\sum_{j=1}^{C}e^{||W_{j}||||x_i||cos(\theta_j)}})</script><p>å¼ä¸­çš„ $\theta_j(0\leq\theta_j \leq \pi)$ ä¸ºå‘é‡ $W_i^T$ å’Œ $x_i$çš„å¤¹è§’ã€‚ä»¥äºŒåˆ†ç±»ä¸ºä¾‹ï¼Œå¯¹éš¶å±äºç¬¬ä¸€ä¸ªç±»åˆ«çš„æŸæ ·æœ¬ $x_i$è€Œè¨€ï¼Œ ä¸ºåˆ†ç±»æ­£ç¡®ï¼Œä¼ ç»Ÿçš„äº¤å‰ç†µæŸå¤±å‡½æ•°éœ€è¿«ä½¿å­¦åˆ°çš„å‚æ•°æ»¡è¶³ $W_1^Tx_i &gt; W_2^Tx_i$, äº¦å³$||W_1||||x_i|| cos(\theta) &gt; ||W2||||x_i||cos(\theta)$ã€‚å¤§é—´éš”äº¤å‰ç†µæŸå¤±å‡½æ•°ä¸ºäº†ä½¿ç‰¹å¾æ›´åŠ å…·æœ‰åˆ†è¾¨èƒ½åŠ›ï¼Œåˆ™å†æ¬¡åŸºç¡€ä¸Šè¦æ±‚äºŒè€…å·®å¼‚æ›´å¤§ï¼Œå³å¼•å…¥ $m$ â€œæ‹‰å¤§â€ä¸¤è€…å·®è·ï¼Œè¿™ä¾¿æ˜¯â€œå¤§é—´éš”â€åç§°çš„ç”±æ¥ã€‚$||W_1||||x_i||cos(m\theta_1) \geq ||W2||||x_i||cos(\theta_2) , (0\leq\theta_1\leq\frac{\pi}{m})$ã€‚å¼ä¸­ $m$ ä¸ºæ­£æ•´æ•°ï¼Œèµ·åˆ°æ§åˆ¶é—´éš”å¤§å°çš„ä½œç”¨ï¼Œ$m$ è¶Šå¤§ã€‚ç±»é—´é—´éš”è¶Šå¤§ï¼Œåä¹‹äº¦ç„¶ã€‚ç‰¹åˆ«åœ°ï¼Œ å½“ $m=1$ æ—¶ï¼Œ å¤§é—´éš”äº¤å‰ç†µæŸå¤±å‡½æ•°å³é€€åŒ–ä¸ºä¼ ç»Ÿäº¤å‰ç†µæŸå¤±å‡½æ•°ã€‚</p><p>ç»¼ä¸Šå¯å¾—ï¼š</p><script type="math/tex; mode=display">||W_1||||x_i||cos(\theta_1) \geq ||W_1||||x_i||cos(m\theta_1) \geq ||W2||||x_i||cos(\theta_2) , (0\leq\theta_1\leq\frac{\pi}{m})</script><p>å¯ä»¥å‘ç°ï¼Œä¸Šå¼ä¸ä»…æ»¡è¶³ä¼ ç»Ÿäº¤å‰ç†µæŸå¤±å‡½æ•°çš„çº¦æŸï¼Œåœ¨ç¡®ä¿åˆ†ç±»æ­£ç¡®çš„åŒæ—¶å¢å¤§äº†ä¸åŒç±»åˆ«é—´åˆ†ç±»çš„ç½®ä¿¡åº¦ï¼Œè¿™æœ‰åŠ©äºè¿›ä¸€æ­¥æå‡ç‰¹å¾åˆ†è¾¨èƒ½åŠ›ã€‚</p><p>å¤§é—´éš”äº¤å‰ç†µæŸå¤±å‡½æ•°çš„å®šä¹‰ä¸ºï¼š</p><script type="math/tex; mode=display">L_{large-margin\ softmax\ loss} = -\frac{1}{N}\sum^{1}_{i=1}log(\frac{e^{||W_i||||x_i||\phi(\theta_{y_i})}}{e^{||W_i||||x_i||\phi(\theta_{yi})}+\sum_{j\neq y_i}e^{||W_j||||x_i||\phi(\theta_{j})}})</script><p>å¯ä»¥å‘ç°ï¼Œä¸Šå¼ä¸$Softmax$ æŸå¤±å‡½æ•°çš„åŒºåˆ«ä»…ä»…åœ¨äºç¬¬ $i$ ç±»åˆ†ç±»é—´éš” â€œæ‹‰å¤§â€äº†ï¼šç”±  $cos(\theta<em>{y_i})$ å˜ä¸º $\phi(\theta</em>{y_i})$, å…¶ä¸­ï¼š</p><script type="math/tex; mode=display">\phi(\theta) = \begin{equation}  \left\{               \begin{array}{**lr**}               cos(m\theta), 0 \leq \theta \leq \frac{\pi}{m}&  \\               \mathcal{D}(\theta) , \frac{\pi}{m} < \theta \leq \pi &\\                  \end{array}  \right.  \end{equation}</script><p>å¼ä¸­ï¼Œ$\mathcal{D}(\theta)$ åªéœ€è¦æ»¡è¶³â€œå•è°ƒé€’å‡â€æ¡ä»¶ï¼Œ ä¸” $D(\frac{\pi}{m})=cos\frac{\pi}{m})$ã€‚</p><h5 id="5-ä¸­å¿ƒæŸå¤±å‡½æ•°"><a href="#5-ä¸­å¿ƒæŸå¤±å‡½æ•°" class="headerlink" title="(5) ä¸­å¿ƒæŸå¤±å‡½æ•°"></a>(5) ä¸­å¿ƒæŸå¤±å‡½æ•°</h5><p>å¤§äº¤å‰ç†µæŸå¤±å‡½æ•°ä¸»è¦è€ƒè™‘å¢å¤§ç±»é—´è·ç¦»ï¼Œè€Œä¸­å¿ƒæŸå¤±å‡½æ•°åˆ™åœ¨è€ƒè™‘ç±»é—´è·ç¦»çš„åŒæ—¶è¿˜å°†ä¸€äº›æ³¨æ„åŠ›æ”¾åœ¨å‡å°ç±»é—´å·®å¼‚ä¸Šã€‚ä¸­å¿ƒæŸå¤±å‡½æ•°çš„å®šä¹‰ä¸ºï¼š</p><script type="math/tex; mode=display">L_{center\ loss} = \frac{1}{2}\sum_{i=1}^{N}||x_i - c_{y_i}||_2^2</script><p>å…¶ä¸­ï¼Œ $c_{y_i}$ ä¸º ç¬¬ $y_i$ ç±»æ‰€æœ‰æ·±åº¦ç‰¹å¾å‡å€¼çš„ä¸­å¿ƒï¼Œæ•…åâ€œä¸­å¿ƒæŸå¤±å‡½æ•°â€ã€‚</p><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œç”±äºä¸­å¿ƒæŸå¤±å‡½æ•°æœ¬èº«è€ƒè™‘ç±»å†…å·®å¼‚ï¼Œå› æ­¤åº”è¯¥è®²ä¸­å¿ƒæŸå¤±å‡½æ•°ä¸å…¶ä»–ä¸»è¦è€ƒè™‘ç±»é—´è·ç¦»çš„æŸå¤±å‡½æ•°é…åˆä½¿ç”¨ï¼Œå¦‚äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼Œè¿™æ ·ç½‘ç»œæœ€ç»ˆç›®æ ‡å½¢å¼å¯è¡¨ç¤ºä¸ºï¼š</p><script type="math/tex; mode=display">L_{final} = L_{cross\ entropy\ loss} + \lambda L_{center\ loss}(h, y_i)  \\= -\frac{1}{N}\sum_{i=1}^{N}log(\frac{e_{h_{y_i}}}{\sum_{j=1}^{C}e^{h_j}})+\frac{\lambda}{2}\sum_{i=1}^{N}||x_i - c_{y_i}||_2^2</script><h4 id="2-å›å½’ä»»åŠ¡çš„ç›®æ ‡å‡½æ•°"><a href="#2-å›å½’ä»»åŠ¡çš„ç›®æ ‡å‡½æ•°" class="headerlink" title="2. å›å½’ä»»åŠ¡çš„ç›®æ ‡å‡½æ•°"></a>2. å›å½’ä»»åŠ¡çš„ç›®æ ‡å‡½æ•°</h4><h5 id="1-mathcal-L1-æŸå¤±å‡½æ•°"><a href="#1-mathcal-L1-æŸå¤±å‡½æ•°" class="headerlink" title="(1) $\mathcal{L1}$ æŸå¤±å‡½æ•°"></a>(1) $\mathcal{L1}$ æŸå¤±å‡½æ•°</h5><script type="math/tex; mode=display">L_{\mathcal{l1}} = \frac{1}{N}\sum_{i=1}^{N}\sum_{t=1}^{M}||y_t^i-\hat{y}t^i||</script><h5 id="2-mathcal-L2-æŸå¤±å‡½æ•°"><a href="#2-mathcal-L2-æŸå¤±å‡½æ•°" class="headerlink" title="(2) $\mathcal{L2}$ æŸå¤±å‡½æ•°"></a>(2) $\mathcal{L2}$ æŸå¤±å‡½æ•°</h5><script type="math/tex; mode=display">L_{\mathcal{l2}} = \frac{1}{N}\sum_{i=1}^{N}\sum_{t=1}^{M}(||y_t^i-\hat{y}t^i||)^2</script><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œ $\mathcal{l_1}$ ä¸ $\mathcal{l_2}$ æŸå¤±å‡½æ•°åœ¨å›å½’ç²¾åº¦ä¸Šå‡ ä¹ç›¸å·®æ— å‡ ã€‚ä¸è¿‡åœ¨ä¸€äº›æƒ…å†µå…ˆ $\mathcal{l_2}$ æŸå¤±å‡½æ•°ä¼šç•¥ä¼˜äº $\mathcal{l_1}$ ï¼ŒåŒæ—¶æ”¶æ•›é€Ÿåº¦æ–¹é¢ $l_2$ æŸå¤±å‡½æ•°ä¹Ÿç•¥å¿«äº $\mathcal{l_1}$ æŸå¤±å‡½æ•°ã€‚</p><h5 id="3-Tukeyâ€™s-biweight-æŸå¤±å‡½æ•°"><a href="#3-Tukeyâ€™s-biweight-æŸå¤±å‡½æ•°" class="headerlink" title="(3) Tukeyâ€™s biweight æŸå¤±å‡½æ•°"></a>(3) Tukeyâ€™s biweight æŸå¤±å‡½æ•°</h5><p>Tukeyâ€™s biweight æŸå¤±å‡½æ•°æ˜¯ä¸€ç±»éå‡¸å‡½æ•°ï¼Œå…¶å¯å…‹æœåœ¨å›å½’ä»»åŠ¡ä¸­çš„åˆ©ç¾¤åº—æˆ–è€…æ ·æœ¬å™ªå£°å¯¹æ•´ä½“å›å½’æ¨¡å‹çš„å¹²æ‰°å’Œå½±å“ï¼Œæ˜¯å›å½’ä»»åŠ¡ä¸­ä¸€ç§å¥å£®çš„æŸå¤±å‡½æ•°ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\mathcal{L_{Tukey's\ biweight\ loss}} =\begin{equation}  \left\{               \begin{array}{**lr**}               \frac{c^2}{6N}\sum_{i=1}^{N}\sum_{t=1}^{M}[1-(1-(\frac{l_t^i}{c})^2)], |l_t^i| \leq c  \\               \frac{c^2{M}}{6}, å…¶ä»– &\\                  \end{array}  \right.  \end{equation}</script><p>å¼ä¸­ï¼Œ å¸¸æ•°  $c$ æŒ‡å®šäº†å‡½æ•°æ‹ç‚¹çš„ä½ç½®ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè¯¥è¶…å‚æ•°å¹¶ä¸éœ€è¦è®¤ä¸ºæŒ‡å®šã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ å½“ $c=4.6851$ æ—¶ï¼Œ $Tukeyâ€™s\ biweight $æŸå¤±å‡½æ•°å¯å–å¾—ä¸ $\mathcal{l_2}$ æŸå¤±å‡½æ•°åœ¨æœ€å°åŒ–ç¬¦åˆæ ‡å‡†æ­£æ€åˆ†å¸ƒæ—¶çš„æ®‹å·®ç±»ä¼¼çš„(95%æ¸è¿›)å›å½’æ•ˆæœã€‚</p><h4 id="3-å…¶ä»–ä»»åŠ¡çš„æŸå¤±å‡½æ•°"><a href="#3-å…¶ä»–ä»»åŠ¡çš„æŸå¤±å‡½æ•°" class="headerlink" title="3. å…¶ä»–ä»»åŠ¡çš„æŸå¤±å‡½æ•°"></a>3. å…¶ä»–ä»»åŠ¡çš„æŸå¤±å‡½æ•°</h4><p>åœ¨ä¸€äº›å¦‚äººè„¸å¹´é¾„ä¼°è®¡ã€å¤´éƒ¨è§’åº¦è¯†åˆ«ç­‰ä»»åŠ¡æ ·æœ¬æ ‡è®°å…·æœ‰ä¸ç¡®å®šæ€§çš„ç‰¹æ®Šåœºæ™¯ä¸‹ï¼ŒåŸºäºæ ‡è®°åˆ†å¸ƒ(label distribution)çš„æŸå¤±å‡½æ•°ä¸å¤±ä¸ºä¸€ç§ä¼˜è´¨çš„é€‰æ‹©ã€‚å…·ä½“è€Œè¨€ï¼Œå‡è®¾ $h=(h_1, h_2, â€¦, h_C)^T$ ä¸ºæ¨¡å‹å¯¹äºè¾“å…¥æ ·æœ¬ $x_i$ çš„æœ€ç»ˆè¾“å‡ºç»“æœï¼Œé‚£ä¹ˆåœ¨åˆ©ç”¨æ ‡è®°åˆ†å¸ƒæŠ€æœ¯è§£å†³é—®é¢˜ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦å°† $h$ è½¬åŒ–ä¸ºä¸€ä¸ªåˆæ³•åˆ†å¸ƒã€‚ä»¥softmax ä¸ºä¾‹å¯ä»¥å°† $h$ è½¬åŒ–ä¸º:</p><script type="math/tex; mode=display">\hat{y}_k = \frac{e^{h_k}}{\sum_{j=1}^{C}{e^{h_j}}}</script><p>å…¶ä¸­ï¼Œ$k \in {1,2,3,â€¦,C}$ ä»£è¡¨æ ‡è®°å‘é‡çš„ç¬¬ $k$ ç»´ã€‚</p><p>å¯ä»¥ç”¨Kullback-Leibleræ•£åº¦(KL divergence)æ¥åº¦é‡ $\hat{y}$ä¸çœŸå®æ ‡è®° $y$ ä¹‹é—´çš„è¯¯å·®ï¼š$\mathcal{L}_{KL\ loss}=\sum_k{y_klog\frac{y_k}{\hat{y}_k}}$ã€‚</p><p>ç”±äº $y<em>k$ ä¸ºå¸¸é‡ï¼Œä¸Šå¼ç­‰ä»·äºï¼š$\mathcal{L}</em>{KL\ loss} = -\sum_{k}{y_k}{log{\hat{y}_k}}$ã€‚é€šè¿‡è¯¥å¼å¯ä»¥è¡¡é‡æ ·æœ¬æ ‡è®°åˆ†å¸ƒä¸çœŸå®éƒ¨åˆ†ä¹‹é—´çš„å·®å¼‚ï¼Œå¹¶åˆ©ç”¨è¯¥å·®å¼‚æŒ‡å¯¼æ¨¡å‹è®­ç»ƒã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>model_evaluation</title>
    <link href="/2019/03/10/model-evaluation/"/>
    <url>/2019/03/10/model-evaluation/</url>
    
    <content type="html"><![CDATA[<h3 id="Chapter-2-æ¨¡å‹è¯„ä¼°"><a href="#Chapter-2-æ¨¡å‹è¯„ä¼°" class="headerlink" title="Chapter 2 æ¨¡å‹è¯„ä¼°"></a>Chapter 2 æ¨¡å‹è¯„ä¼°</h3><h4 id="1-å‡†ç¡®ç‡å’Œå¹³æ–¹æ ¹è¯¯å·®çš„ç¼ºé™·"><a href="#1-å‡†ç¡®ç‡å’Œå¹³æ–¹æ ¹è¯¯å·®çš„ç¼ºé™·" class="headerlink" title="1. å‡†ç¡®ç‡å’Œå¹³æ–¹æ ¹è¯¯å·®çš„ç¼ºé™·"></a>1. å‡†ç¡®ç‡å’Œå¹³æ–¹æ ¹è¯¯å·®çš„ç¼ºé™·</h4><h5 id="å‡†ç¡®ç‡"><a href="#å‡†ç¡®ç‡" class="headerlink" title="å‡†ç¡®ç‡"></a>å‡†ç¡®ç‡</h5><p>â€‹     <strong>å‡†ç¡®ç‡æ˜¯æŒ‡åˆ†ç±»æ­£ç¡®çš„æ ·æœ¬å æ ·æœ¬ä¸ªæ•°çš„æ¯”ä¾‹</strong>ï¼Œå³ <strong>$Accuracy  = \frac{n<em>{correct}}{n</em>{total}}$</strong> ,å…¶ä¸­ $n<em>{correct}$ ä¸ºè¢«æ­£ç¡®åˆ†ç±»çš„æ ·æœ¬ä¸ªæ•°ï¼Œ $n</em>{total}$ ä¸ºæ€»æ ·æœ¬çš„ä¸ªæ•°ã€‚</p><p>â€‹     å‡†ç¡®ç‡æ˜¯åˆ†ç±»é—®é¢˜ä¸­æœ€ç®€å•ä¹Ÿæ˜¯æœ€ç›´è§‚çš„è¯„ä»·æŒ‡æ ‡ï¼Œ ä½†å­˜åœ¨æ˜æ˜¾ç¼ºé™·ã€‚å½“<strong>ä¸åŒç±»åˆ«çš„æ ·æœ¬æ¯”ä¾‹éå¸¸ä¸å‡è¡¡</strong>æ—¶ï¼Œå æ¯”è¾ƒå¤§çš„ç±»åˆ«å¾€å¾€ä¼šæˆä¸ºå½±å“å‡†ç¡®ç‡æœ€ä¸»è¦çš„å› ç´ ã€‚æ¯”å¦‚ï¼Œå½“è´Ÿæ ·æœ¬å 99%æ—¶ï¼Œåˆ†ç±»å™¨æŠŠæ‰€æœ‰æ ·æœ¬é¢„æµ‹ä¸ºè´Ÿæ ·æœ¬ä¹Ÿå¯ä»¥è·å¾—99% çš„å‡†ç¡®ç‡ã€‚ </p><p>â€‹      ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨æ›´ä¸ºæœ‰æ•ˆçš„<strong>å¹³å‡å‡†ç¡®ç‡</strong>(æ¯ä¸ªç±»åˆ«ä¸‹çš„æ ·æœ¬å‡†ç¡®ç‡çš„ç®—æœ¯å¹³å‡)ä½œä¸ºè¯„ä¼°çš„æŒ‡æ ‡ã€‚</p><h5 id="å¹³æ–¹æ ¹è¯¯å·®-RMSE"><a href="#å¹³æ–¹æ ¹è¯¯å·®-RMSE" class="headerlink" title="å¹³æ–¹æ ¹è¯¯å·® RMSE"></a>å¹³æ–¹æ ¹è¯¯å·® RMSE</h5><p>â€‹      RMSE å¹³æ–¹æ ¹è¯¯å·®ç»å¸¸è¢«ç”¨æ¥è¡¡é‡å›å½’æ¨¡å‹çš„å¥½åï¼Œå…¶è®¡ç®—å…¬å¼ä¸º $RMSE = \sqrt{\frac{1}{n}\sum^{n}<em>{i-1}{(y</em>{i}-\hat{y_{i}})^2}}$, å…¶ä¸­ $y_i$  æ˜¯ç¬¬iä¸ªæ ·æœ¬ç‚¹çš„çœŸå®å€¼å—ï¼Œ$\hat{y_i}$  æ˜¯ ç¬¬iä¸ªæ ·æœ¬çš„é¢„æµ‹å€¼ï¼Œn æ˜¯æ ·æœ¬ç‚¹çš„ä¸ªæ•°ã€‚</p><p>â€‹     ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒRMSE èƒ½å¤Ÿæ›´å¥½çš„åæ˜ å›å½’æ¨¡å‹é¢„æµ‹å€¼ä¸çœŸå®å€¼çš„åç¦»ç¨‹åº¦ã€‚ä½†åœ¨å®é™…é—®é¢˜ä¸­ï¼Œå¦‚æœå­˜åœ¨ä¸ªåˆ«åç¦»ç¨‹åº¦éå¸¸å¤§çš„<strong>ç¦»ç¾¤ç‚¹</strong>(Outlier),   å³ä½¿ç¦»ç¾¤ç‚¹æ•°é‡éå¸¸å°‘ï¼Œä¹Ÿä¼šè®©RSME æŒ‡æ ‡å˜å¾—éå¸¸å·®ã€‚</p><p>â€‹     é’ˆå¯¹è¿™ç§æƒ…å†µä»ä¸‰ä¸ªè§’åº¦è¿›è¡Œè§£å†³ã€‚ï¼ˆ1ï¼‰ å¦‚ä½•è®¤å®šè¿™äº›ç¦»ç¾¤ç‚¹æ˜¯â€œå™ªå£°ç‚¹â€çš„è¯ï¼Œå°±éœ€è¦åœ¨æ•°æ®é¢„å¤„ç†çš„é˜¶æ®µæŠŠè¿™äº›å™ªå£°<strong>è¿‡æ»¤</strong>æ‰ã€‚ï¼ˆ2ï¼‰å¦‚æœä¸è®¤ä¸ºè¿™äº›ç¦»ç¾¤ç‚¹æ˜¯â€œå™ªå£°ç‚¹â€çš„è¯ï¼Œéœ€è¦è¿›ä¸€æ­¥<strong>æé«˜æ¨¡å‹çš„é¢„æµ‹èƒ½åŠ›</strong>ï¼Œå°†ç¦»ç¾¤ç‚¹äº§ç”Ÿçš„æœºåˆ¶å»ºæ¨¡è¿›å»ã€‚ï¼ˆ3ï¼‰æ‰¾ä¸€ä¸ªæ›´åˆé€‚çš„æŒ‡æ ‡æ¥è¯„ä¼°æ¨¡å‹ã€‚æ¯”å¦‚å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®<strong>MAPE</strong>ï¼Œ å®ƒå®šä¹‰ä¸º  $MAPE  = \sum_{i=1}^{n}\lvert \frac{y_i - \hat{y_i}}{y_i}\rvert \times\frac{100}{n}$,  ç›¸æ¯”äº RSMEï¼Œ MAPE ç›¸å½“äºæŠŠè¿™ä¸ªç‚¹çš„è¯¯å·®è¿›è¡Œäº†å½’ä¸€åŒ–ï¼Œé™ä½äº†ä¸ªåˆ«ç¦»ç¾¤ç‚¹å¸¦æ¥çš„è¯¯å·®å½±å“ã€‚</p><h4 id="2-æ··æ·†çŸ©é˜µã€P-Ræ›²çº¿ã€ROC-æ›²çº¿"><a href="#2-æ··æ·†çŸ©é˜µã€P-Ræ›²çº¿ã€ROC-æ›²çº¿" class="headerlink" title="2. æ··æ·†çŸ©é˜µã€P-Ræ›²çº¿ã€ROC æ›²çº¿"></a>2. æ··æ·†çŸ©é˜µã€P-Ræ›²çº¿ã€ROC æ›²çº¿</h4><p><img src="/2019/03/10/model-evaluation/matrix.png" alt="æ··æ·†çŸ©é˜µ"></p><p>â€‹        <strong>ç²¾ç¡®ç‡ï¼š</strong> åˆ†ç±»æ­£ç¡®çš„æ­£æ ·æœ¬ä¸ªæ•°å åˆ†ç±»å™¨åˆ¤å®šä¸ºæ­£æ ·æœ¬çš„æ ·æœ¬ä¸ªæ•°çš„æ¯”ä¾‹ã€‚å³: $Precision = \frac{TP}{TP+FP}$ã€‚</p><p>â€‹        <strong>å¬å›ç‡ï¼š</strong> åˆ†ç±»æ­£ç¡®çš„æ­£æ ·æœ¬ä¸ªæ•°å çœŸæ­£æ­£æ ·æœ¬ä¸ªæ•°çš„æ¯”ä¾‹ã€‚å³ï¼š$Recall = \frac{TP}{TP+FN}$ã€‚</p><p>â€‹        Precision å€¼å’Œ Recall å€¼æ˜¯æ—¢çŸ›ç›¾åˆç»Ÿä¸€çš„ä¸¤ä¸ªæŒ‡æ ‡ï¼Œä¸ºäº†æé«˜Precisionå€¼ï¼Œåˆ†ç±»å™¨éœ€è¦å°½é‡åœ¨â€æ›´æœ‰æŠŠæ¡â€œæ—¶æ‰æŠŠæ ·æœ¬é¢„æµ‹ä¸ºæ­£æ ·æœ¬ï¼Œä½†æ­¤æ—¶ç”±äºè¿‡äºä¿å®ˆè€Œæ¼æ‰å¾ˆå¤šâ€æ²¡æœ‰æŠŠæ¡â€œçš„æ­£æ ·æœ¬ï¼Œå¯¼è‡´Recallå€¼é™ä½ã€‚</p><p>â€‹        P-R æ›²çº¿èƒ½å¤Ÿç»¼åˆè¯„ä¼°ä¸€ä¸ªæ’åºæ¨¡å‹çš„å¥½åã€‚P-R æ›²çº¿çš„æ¨ªè½´æ˜¯å¬å›ç‡ï¼Œçºµè½´æ˜¯ç²¾ç¡®ç‡ã€‚å¯¹äºä¸€ä¸ªæ’åºæ¨¡å‹æ¥è¯´ï¼Œ æŸP-Ræ›²çº¿ä¸Šçš„ä¸€ä¸ªç‚¹ä»£è¡¨ç€ï¼Œåœ¨æŸä¸€é˜ˆå€¼ä¸‹ï¼Œæ¨¡å‹å°†å¤§äºè¯¥é˜ˆå€¼çš„ç»“æœåˆ¤å®šä¸ºæ­£æ ·æœ¬ï¼Œå°äºè¯¥é˜ˆå€¼çš„ç»“æœåˆ¤å®šä¸ºè´Ÿæ ·æœ¬ï¼Œæ­¤æ—¶è¿”å›çš„ç»“æœå¯¹åº”çš„å¬å›ç‡å’Œç²¾ç¡®ç‡ã€‚æ•´æ¡P-Ræ›²çº¿æ˜¯é€šè¿‡å°†é˜ˆå€¼ä»é«˜åˆ°åº•ç§»åŠ¨è€Œç”Ÿæˆçš„ã€‚</p><p>â€‹        <strong>å‡é˜³æ€§ç‡</strong>ï¼šåˆ†ç±»é”™è¯¯çš„æ­£æ ·æœ¬(é¢„æµ‹ä¸ºæ­£æ ·æœ¬ï¼Œå®é™…æ˜¯æ­£æ ·æœ¬)å çœŸæ­£è´Ÿæ ·æœ¬çš„æ¯”ä¾‹ã€‚å³ $FPR = \frac{FP}{FP+TN}$ã€‚</p><p>â€‹        <strong>çœŸé˜³æ€§ç‡</strong>ï¼šåˆ†ç±»æ­£ç¡®çš„æ­£æ ·æœ¬å çœŸæ­£æ­£æ ·æœ¬ä¸ªæ•°çš„æ¯”ä¾‹ã€‚$TPR = \frac{TP}{TP+FN}$ã€‚</p><p>â€‹        ROC æ›²çº¿æ˜¯é€šè¿‡ä¸æ–­ç§»åŠ¨åˆ†ç±»å™¨åŒºåˆ†æ­£è´Ÿé¢„æµ‹ç»“æœçš„é˜ˆå€¼æ¥ç”Ÿæˆæ›²çº¿ä¸Šçš„ä¸€ç»„å…³é”®ç‚¹çš„ã€‚ä»æœ€é«˜çš„å¾—åˆ†å¼€å§‹ï¼ˆå®é™…ä¸Šæ˜¯ä»æ­£æ— ç©·å¼€å§‹ï¼Œå¯¹åº”ROC æ›²çº¿çš„é›¶ç‚¹ï¼‰ï¼Œ é€æ¸è°ƒæ•´åˆ°æœ€ä½å¾—åˆ†ï¼Œæ¯ä¸€ä¸ªé˜ˆå€¼éƒ½ä¼šå¯¹åº”ä¸€ä¸ªFPRå’ŒTPRï¼Œåœ¨ROCå›¾ä¸Šç»˜åˆ¶å‡ºæ¯ä¸ªé˜ˆå€¼å¯¹åº”çš„ä½ç½®ï¼Œå†è¿æ¥æ‰€æœ‰ç‚¹é…’å¾—åˆ°æœ€ç»ˆçš„ROC æ›²çº¿ã€‚å¦å¤–æ‰€è°“çš„AUC æ˜¯æŒ‡ROC æ›²çº¿ä¸‹çš„é¢ç§¯å¤§å°ï¼Œè¯¥å€¼èƒ½å¤Ÿé‡åŒ–åœ°ååº”åŸºäºROC æ›²çº¿è¡¡é‡å‡ºçš„æ¨¡å‹æ€§èƒ½ã€‚è®¡ç®—AUC çš„å€¼åªéœ€è¦æ²¿ç€ROCæ¨ªè½´ç§¯åˆ†å³å¯ã€‚ç”±äºROC æ›²çº¿ä¸€èˆ¬éƒ½å¤„äºy=x è¿™æ¡ç›´çº¿çš„ä¸Šæ–¹ï¼Œæ‰€ä»¥AUC çš„å–å€¼ä¸€èˆ¬åœ¨0.5-1 ä¹‹é—´ã€‚AUC è¶Šå¤§ï¼Œè¯´æ˜åˆ†ç±»å™¨è¶Šå¯èƒ½æŠŠçœŸæ­£çš„æ­£æ ·æœ¬æ’åœ¨å‰é¢ï¼Œåˆ†ç±»æ€§èƒ½è¶Šå¥½ã€‚</p><p>â€‹    ç›¸æ¯”äº P-R æ›²çº¿ï¼ŒROC æ›²çº¿æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå½“æ”¿åºœæ ·æœ¬çš„åˆ†å¸ƒå‘ç”Ÿå˜åŒ–æ—¶ï¼Œ ROC æ›²çº¿çš„å½¢çŠ¶èƒ½å¤ŸåŸºæœ¬ä¿æŒä¸å˜ï¼Œè€ŒP-R æ›²çº¿çš„å½¢çŠ¶ä¸€èˆ¬ä¼šå‘ç”Ÿæ¯”è¾ƒå‰§çƒˆçš„å˜åŒ–ã€‚æ‰€ä»¥ ROC æ›²çº¿çš„ä½¿ç”¨åœºæ™¯æ›´å¤šï¼Œè¢«å¹¿æ³›ç”¨äºæ’åºã€æ¨èã€å¹¿å‘Šç­‰é¢†åŸŸã€‚</p><p>â€‹        <strong>F1-Score</strong> ä¹Ÿèƒ½ç»¼åˆåæ˜ ä¸€ä¸ªæ’åºæ¨¡å‹çš„æ€§èƒ½ã€‚å®ƒæ˜¯ç²¾å‡†ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡å€¼ã€‚å®ƒçš„å®šä¹‰ä¸ºï¼š</p><script type="math/tex; mode=display">F1 = \frac{2*precision*recall}{precision+recall}</script><h4 id="3-ä½™å¼¦è·ç¦»çš„åº”ç”¨"><a href="#3-ä½™å¼¦è·ç¦»çš„åº”ç”¨" class="headerlink" title="3. ä½™å¼¦è·ç¦»çš„åº”ç”¨"></a>3. ä½™å¼¦è·ç¦»çš„åº”ç”¨</h4><p>â€‹        å¯¹äºä¸¤ä¸ªå‘é‡ Aå’Œ B ï¼Œå…¶ä½™å¼¦ç›¸ä¼¼åº¦çš„å®šä¹‰ä¸º $cos(A,B) = \frac{A\cdot B}{\Vert A \Vert_2 \Vert B \Vert_2}$ã€‚ å³ä¸¤ä¸ªå‘é‡å¤¹è§’çš„ä½™å¼¦ï¼Œå…³æ³¨çš„æ˜¯å‘é‡ä¹‹é—´çš„è§’åº¦å…³ç³»ï¼Œå¹¶ä¸å…³å¿ƒå®ƒä»¬çš„ç»å¯¹å¤§å°ï¼Œå…¶å–å€¼èŒƒå›´æ˜¯[-1, 1]ã€‚ ç›¸æ¯”è¾ƒè€Œè¨€ï¼Œæ¬§å¼è·ç¦»çš„æ•°å€¼å—ç»´åº¦çš„å½±å“ï¼ŒèŒƒå›´ä¸å›ºå®šï¼Œå¹¶ä¸”å«ä¹‰ä¹Ÿæ¯”è¾ƒæ¨¡ç³Šã€‚æ€»ä½“æ¥è¯´ï¼Œæ¬§å¼è·ç¦»ä½“ç°åœ¨æ•°å€¼ä¸Šçš„ç»å¯¹å·®å¼‚ï¼Œè€Œä½™å¼¦è·ç¦»åˆ™ä½“ç°æ–¹å‘ä¸Šçš„ç›¸å¯¹å·®å¼‚ã€‚æ¯”å¦‚ç»Ÿè®¡ä¸¤éƒ¨å‰§çš„ç”¨æˆ·è§‚çœ‹è¡Œä¸ºï¼Œç”¨æˆ·A çš„è§‚çœ‹å‘é‡æ˜¯ï¼ˆ0ï¼Œ1ï¼‰ï¼Œ è€Œç”¨æˆ·B çš„è§‚çœ‹å‘é‡ä¸ºï¼ˆ1ï¼Œ0ï¼‰ï¼›æ­¤æ—¶ä¸¤è€…çš„ä½™å¼¦è·ç¦»å¾ˆå¤§ï¼Œè€Œæ¬§å¼è·ç¦»å¾ˆå°ï¼›æˆ‘ä»¬åˆ†æä¸¤ä¸ªç”¨æˆ·ä¸åŒè§†é¢‘çš„åå¥½ï¼Œæ›´å…³æ³¨ç›¸å¯¹å·®å¼‚ï¼Œæ˜¾ç„¶åº”å½“ä½¿ç”¨ä½™å¼¦è·ç¦»ã€‚è€Œå½“æˆ‘ä»¬åˆ†æç”¨æˆ·æ´»è·ƒåº¦æ—¶ï¼Œä»¥ç™»å½•æ¬¡æ•°å’Œå¹³å‡è§‚çœ‹å¸‚åœºä½œä¸ºè°ƒæ•´ï¼Œä½™å¼¦è·ç¦»ä¼šè®¤ä¸ºï¼ˆ1ï¼Œ10ï¼‰ï¼ˆ10ï¼Œ100ï¼‰ ä¸¤ä¸ªç”¨æˆ·è·ç¦»å¾ˆè¿‘ï¼›ä½†æ˜¯æ˜¾ç„¶ä¸¤ä¸ªç”¨æˆ·æ´»è·ƒåº¦æœ‰ç€æå¤§å·®å¼‚çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬è¦å…³æ³¨æ•°å€¼çš„ç»å¯¹å·®å¼‚ï¼Œåº”å½“ä½¿ç”¨æ¬§å¼è·ç¦»ã€‚</p><p>â€‹        è€ƒæŸ¥ä¸€ä¸ªè·ç¦»æ˜¯å¦æ˜¯ä¸¥æ ¼å®šä¹‰çš„è·ç¦»ã€‚è¦ä»è·ç¦»çš„å®šä¹‰å‡ºå‘ï¼šåœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œå¦‚æœæ¯ä¸€å¯¹å…ƒç´ å‡å¯å”¯ä¸€å†³å®šä¸€ä¸ªå®æ•°ï¼Œä½¿å¾—ä¸‰æ¡è·ç¦»å…¬ç†ï¼ˆæ­£å®šæ€§ã€å¯¹ç§°æ€§ã€ä¸‰è§’ä¸ç­‰å¼ï¼‰æˆç«‹ï¼Œåˆ™è¯¥å®æ•°å¯ç§°ä¸ºè¿™å¯¹å…ƒç´ ä¹‹é—´çš„è·ç¦»ã€‚ä»¥ä½™å¼¦è·ç¦»ä¸ºä¾‹ï¼š</p><ul><li><p>æ­£å®šå‹ï¼š$dist(A, B) = 1-  cos\theta \ge 0 $ æ’æˆç«‹ï¼Œ ç‰¹åˆ«åœ°ï¼Œæœ‰  $dist(A, B) = 0 \Leftrightarrow \Vert A \Vert_2 \Vert B \Vert_2 = AB \Leftrightarrow A=B$</p><p>å› æ­¤ä½™å¼¦è·ç¦»æ»¡è¶³æ­£å®šæ€§ã€‚</p></li><li><p>å¯¹ç§°æ€§ï¼š </p></li><li><script type="math/tex; mode=display">dist(A, B) = 1- cos(A,B) = \frac{\Vert A \Vert_2 \Vert B \Vert_2 - A\cdot B}{\Vert A \Vert_2 \Vert B \Vert_2} = \frac{\Vert B \Vert_2 \Vert A \Vert_2 - A\cdot B}{\Vert A \Vert_2 \Vert B \Vert_2} = dist(B, A)</script><p>å› æ­¤ï¼Œä½™å¼¦è·ç¦»æ»¡è¶³å¯¹ç§°æ€§ã€‚</p></li><li><p>ä¸‰è§’ä¸ç­‰å¼ï¼šè¯¥æ€§è´¨å¹¶ä¸æˆç«‹ï¼Œä¸‹é¢ç»™å‡ºä¸€ä¸ªåä¾‹ã€‚ç»™å®š A = (1, 0)ï¼Œ B = (1, 1)ï¼ŒC=ï¼ˆ0ï¼Œ1ï¼‰ï¼Œåˆ™æœ‰</p><script type="math/tex; mode=display">dist(A, B) = 1 - \frac{\sqrt{2}}{2}</script><script type="math/tex; mode=display">dist(B, C) = 1 - \frac{\sqrt{2}}{2}</script><script type="math/tex; mode=display">dist(A,C) = 1</script><p>å› æ­¤æœ‰ $dist(A, B)+dist(B,C) = 2-\sqrt{2} &lt; 1 = dist(A, C)$</p></li></ul><p>åœ¨æœºå™¨å­¦ä¹ é¢†åŸŸï¼Œè¢«ä¿—ç§°ä¸ºè·ç¦»ï¼Œå´ä¸æ»¡è¶³ä¸‰æ¡è·ç¦»å…¬ç†çš„ä¸ä»…ä»…æœ‰ä½™å¼¦è·ç¦»ï¼Œè¿˜æœ‰KLè·ç¦»ï¼Œä¹Ÿå«ç›¸å¯¹ç†µï¼Œ å®ƒå¸¸ç”¨äºè®¡ç®—ä¸¤ä¸ªåˆ†å¸ƒä¹‹é—´çš„å·®å¼‚ï¼Œä½†ä¸æ»¡è¶³å¯¹ç§°æ€§å’Œä¸‰è§’ä¸ç­‰å¼ã€‚</p><h4 id="4-ä¸ºä»€ä¹ˆå¯¹æ¨¡å‹è¿›è¡Œè¿‡å……åˆ†çš„ç¦»çº¿è¯„ä¼°ä¹‹åï¼Œè¿˜è¦è¿›è¡Œåœ¨çº¿A-B-æµ‹è¯•ï¼Ÿå¦‚ä½•è¿›è¡ŒA-B-æµ‹è¯•ï¼Ÿ"><a href="#4-ä¸ºä»€ä¹ˆå¯¹æ¨¡å‹è¿›è¡Œè¿‡å……åˆ†çš„ç¦»çº¿è¯„ä¼°ä¹‹åï¼Œè¿˜è¦è¿›è¡Œåœ¨çº¿A-B-æµ‹è¯•ï¼Ÿå¦‚ä½•è¿›è¡ŒA-B-æµ‹è¯•ï¼Ÿ" class="headerlink" title="4. ä¸ºä»€ä¹ˆå¯¹æ¨¡å‹è¿›è¡Œè¿‡å……åˆ†çš„ç¦»çº¿è¯„ä¼°ä¹‹åï¼Œè¿˜è¦è¿›è¡Œåœ¨çº¿A/B æµ‹è¯•ï¼Ÿå¦‚ä½•è¿›è¡ŒA/B æµ‹è¯•ï¼Ÿ"></a>4. ä¸ºä»€ä¹ˆå¯¹æ¨¡å‹è¿›è¡Œè¿‡å……åˆ†çš„ç¦»çº¿è¯„ä¼°ä¹‹åï¼Œè¿˜è¦è¿›è¡Œåœ¨çº¿A/B æµ‹è¯•ï¼Ÿå¦‚ä½•è¿›è¡ŒA/B æµ‹è¯•ï¼Ÿ</h4><p>éœ€è¦è¿›è¡Œåœ¨çº¿ A/B æµ‹è¯•çš„<strong>åŸå› </strong>å¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰ç¦»çº¿è¯„ä¼°<strong>æ— æ³•å®Œå…¨æ¶ˆé™¤æ¨¡å‹è¿‡æ‹Ÿåˆçš„å½±å“</strong>ï¼Œå› æ­¤ï¼Œå¾—å‡ºçš„ç¦»çº¿è¯„ä¼°ç»“æœæ— æ³•å®Œå…¨æ›¿ä»£çº¿ä¸Šè¯„ä¼°ç»“æœã€‚</p><p>ï¼ˆ2ï¼‰ç¦»çº¿è¯„ä¼°<strong>æ— æ³•å®Œå…¨è¿˜åŸçº¿ä¸Šå·¥ç¨‹ç¯å¢ƒ</strong>ã€‚ä¸€èˆ¬æ¥è®²ï¼Œç¦»çº¿è¯„ä¼°å¾€å¾€ä¸ä¼šè€ƒè™‘çº¿ä¸Šç¯å¢ƒçš„å»¶è¿Ÿã€æ•°æ®ä¸¢å¤±ã€æ ‡ç­¾æ•°æ®ç¼ºå¤±ç­‰æƒ…å†µã€‚å› æ­¤ï¼Œç¦»çº¿è¯„ä¼°çš„ç»“æœæ˜¯ç†æƒ³å·¥ç¨‹ç¯å¢ƒä¸‹çš„ç»“æœã€‚</p><p>ï¼ˆ3ï¼‰çº¿ä¸Šç³»ç»Ÿçš„<strong>æŸäº›å•†ä¸šæŒ‡æ ‡</strong>åœ¨ç¦»çº¿è¯„ä¼°ä¸­æ— æ³•è®¡ç®—ã€‚ç¦»çº¿è¯„ä¼°ä¸€èˆ¬æ˜¯é’ˆå¯¹æ¨¡å‹æœ¬èº«è¿›è¡Œè¯„ä¼°ï¼Œè€Œä¸æ¨¡å‹ç›¸å…³çš„å…¶ä»–æŒ‡æ ‡ï¼Œç‰¹åˆ«æ˜¯å•†ä¸šæŒ‡æ ‡ï¼Œå¾€å¾€æ— æ³•ç›´æ¥è·å¾—ã€‚</p><p>è¿›è¡ŒA/B æµ‹è¯•çš„ä¸»è¦æ‰‹æ®µæ˜¯å°†ç”¨æˆ·åˆ’åˆ†ä¸ºå®éªŒç»„å’Œå¯¹ç…§ç»„ï¼Œå¯¹å®éªŒç»„çš„ç”¨æˆ·æ–½ä»¥æ–°æ¨¡å‹ï¼Œå¯¹å¯¹ç…§ç»„çš„ç”¨æˆ·æ–½ä»¥å°±æ¨¡å‹ã€‚åœ¨åˆ’åˆ†ç”¨æˆ·çš„è¿‡ç¨‹è¿‡ç¨‹ä¸­ï¼Œè¦æ³¨æ„æ ·æœ¬çš„ç‹¬ç«‹æ€§ï¼ˆåŒä¸€ç”¨æˆ·æ¯æ¬¡åªèƒ½åˆ’åˆ†åˆ°ä¸€ä¸ªåˆ†ç»„ä¸­ï¼‰å’Œé‡‡æ ·æ–¹å¼çš„æ— åæ€§ï¼ˆåˆ’åˆ†è¿‡ç¨‹ä¸­é€‰å–çš„usr_id æ˜¯ä¸€ä¸ªéšæœºæ•°ï¼‰ã€‚    </p><h4 id="5-æ¨¡å‹è¯„ä¼°ä¸­çš„éªŒè¯æ–¹æ³•"><a href="#5-æ¨¡å‹è¯„ä¼°ä¸­çš„éªŒè¯æ–¹æ³•" class="headerlink" title="ã€€5. æ¨¡å‹è¯„ä¼°ä¸­çš„éªŒè¯æ–¹æ³•"></a>ã€€5. æ¨¡å‹è¯„ä¼°ä¸­çš„éªŒè¯æ–¹æ³•</h4><p><strong>Holdoutæ£€éªŒï¼š</strong>ã€€å°†åŸå§‹çš„æ ·æœ¬é›†åˆéšæœºåˆ’åˆ†ä¸ºè®­ç»ƒé›†å’ŒéªŒè¯é›†ä¸¤éƒ¨åˆ†ã€‚è®­ç»ƒé›†ç”¨äºæ¨¡å‹è®­ç»ƒï¼Œã€€éªŒè¯é›†ç”¨äºæ¨¡å‹éªŒè¯ã€‚ã€€<strong>ç¼ºç‚¹</strong>ï¼šåœ¨éªŒè¯é›†ä¸Šè®¡ç®—å‡ºæ¥çš„æœ€åè¯„ä¼°æŒ‡æ ‡ä¸åŸå§‹åˆ†ç»„æœ‰å¾ˆå¤§å…³ç³»ã€‚</p><p><strong>äº¤å‰éªŒè¯ï¼š</strong>ã€€æœ€å¸¸è§çš„æ˜¯ï½‹-foldã€€äº¤å‰éªŒè¯ã€‚é¦–å…ˆå°†å…¨éƒ¨æ ·æœ¬åˆ’åˆ†æˆï½‹ä¸ªå¤§å°ç›¸ç­‰çš„æ ·æœ¬å­é›†ï¼›ä¾æ¬¡éå†è¿™ï½‹ä¸ªå­é›†ï¼Œæ¯æ¬¡æŠŠå½“å‰å­é›†ä½œä¸ºéªŒè¯é›†ï¼Œå…¶ä½™æ‰€æœ‰å­é›†ä½œä¸ºè®­ç»ƒé›†ï¼Œè¿›è¡Œæ¨¡å‹çš„è®­ç»ƒå’Œè¯„ä¼°ï¼›æœ€åæŠŠï½‹æ¬¡è¯„ä¼°æŒ‡æ ‡çš„å¹³å‡å€¼ä½œä¸ºæœ€ç»ˆçš„è¯„ä¼°æŒ‡æ ‡ã€‚åœ¨å®é™…å®éªŒä¸­ï¼Œï½‹ç»å¸¸å–10ã€‚</p><p><strong>è‡ªåŠ©æ³•(Bootstrap) : </strong> å¯¹äºæ€»æ•°ä¸ºï½ã€€çš„æ ·æœ¬é›†åˆï¼Œè¿›è¡Œï½æ¬¡æœ‰æ”¾å›çš„éšæœºé‡‡æ ·ï¼Œå¾—åˆ°å¤§å°ä¸ºï½çš„è®­ç»ƒé›†åˆã€‚ï½æ¬¡é‡‡æ ·è¿‡ç¨‹ä¸­ï¼Œæœ‰çš„æ ·æœ¬ä¼šè¢«é‡å¤é‡‡æ ·ï¼Œæœ‰çš„æ ·æœ¬æ²¡æœ‰è¢«æŠ½å‡ºè¿‡ï¼Œå°†è¿™äº›æ²¡æœ‰è¢«æŠ½å‡ºçš„æ ·æœ¬ä½œä¸ºéªŒè¯é›†ï¼Œè¿›è¡Œæ¨¡å‹éªŒè¯ã€‚</p><p>ã€€ã€€åœ¨è‡ªåŠ©é‡‡æ ·è¿‡ç¨‹ä¸­ã€‚å¯¹äºæ ·æœ¬è¿›è¡Œï½æ¬¡è‡ªåŠ©æŠ½æ ·ï¼Œå½“ï½è¶‹äºæ— ç©·å¤§æ—¶ï¼Œæœ€ç»ˆæœ‰å¤šå°‘æ•°æ®ä»æœªè¢«é€‰æ‹©è¿‡ï¼Ÿ</p><p>ä¸€ä¸ªæ ·æœ¬åœ¨ä¸€æ¬¡æŠ½æ ·è¿‡ç¨‹ä¸­æœªè¢«æŠ½ä¸­çš„æ¦‚ç‡ä¸ºã€€$1 - \frac{1}{n} $ï¼Œã€€ï½æ¬¡æŠ½æ ·å‡æœªè¢«æŠ½ä¸­çš„æ¦‚ç‡ä¸º $ï¼ˆï¼‘-\frac{1}{n})^n$ã€‚ å½“ï½è¶‹äºæ— ç©·å¤§æ—¶ï¼Œæ¦‚ç‡ä¸ºã€€</p><script type="math/tex; mode=display">{\lim_{n\to+\infty}}(1-\frac{1}{n})^n ã€€ = \lim_{n\to\infty}\frac{1}{(1+\frac{1}{n-1})^n}ã€€ = \frac{1}{\lim_{n\to\infty}(1+\frac{1}{n-1})^{n-1}} Ã—\frac{1}{\lim_{n\to\infty}(1+\frac{1}{n-1})}   = \frac{1}{e}    \approx 0.368</script><h4 id="6-è¶…å‚æ•°è°ƒä¼˜"><a href="#6-è¶…å‚æ•°è°ƒä¼˜" class="headerlink" title="ã€€6. è¶…å‚æ•°è°ƒä¼˜"></a>ã€€6. è¶…å‚æ•°è°ƒä¼˜</h4><p><strong>ç½‘æ ¼æœç´¢ï¼š</strong>ã€€ç½‘æ ¼æœç´¢å¯èƒ½æ˜¯æœ€ç®€å•ï¼Œåº”ç”¨æœ€å¹¿æ³›çš„è¶…å‚æ•°æœç´¢ç®—æ³•ï¼Œå®ƒé€šè¿‡æŸ¥æ‰¾æœç´¢èŒƒå›´å†…çš„æ‰€æœ‰çš„ç‚¹æ¥ç¡®å®šæœ€ä¼˜å€¼ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šå…ˆä½¿ç”¨è¾ƒå¹¿çš„æœç´¢èŒƒå›´å’Œè¾ƒå¤§çš„æ­¥é•¿ï¼Œæ¥å¯»æ‰¾å…¨å±€æœ€ä¼˜å€¼å¯èƒ½çš„ä½ç½®ï¼›ç„¶åä¼šé€æ¸ç¼©å°æœç´¢èŒƒå›´å’Œæ­¥é•¿ï¼Œæ¥å¯»æ‰¾æ›´ç²¾ç¡®çš„æœ€ä¼˜å€¼ã€‚</p><p><strong>éšæœºæœç´¢ï¼š</strong>ã€€åœ¨æœç´¢èŒƒå›´å†…éšæœºé€‰å–æ ·æœ¬ç‚¹è€Œä¸æ˜¯æµ‹è¯•ä¸Šç•Œå’Œä¸‹ç•Œä¹‹é—´ä¹‹é—´çš„æ‰€æœ‰å€¼ã€‚å®ƒçš„ç†è®ºä¾æ®æ˜¯å¦‚æœæ ·æœ¬ç‚¹è¶³å¤Ÿå¤§ï¼Œé‚£ä¹ˆé€šè¿‡éšæœºé‡‡æ ·ä¹Ÿèƒ½å¤§æ¦‚ç‡æ‰¾åˆ°å…¨å±€æœ€ä¼˜å€¼æˆ–è€…è¿‘ä¼¼å€¼ã€ã€‚</p><p><strong>è´å¶æ–¯ä¼˜åŒ–ç®—æ³•ï¼š</strong>è´å¶æ–¯ä¼˜åŒ–ç®—æ³•é€šè¿‡å¯¹ç›®æ ‡å‡½æ•°çš„å½¢çŠ¶è¿›è¡Œå­¦ä¹ ï¼Œæ‰¾åˆ°ä½¿ç›®æ ‡å‡½æ•°å‘å…¨å±€æœ€ä¼˜å€¼æå‡çš„å‚æ•°ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒçš„å­¦ä¹ ç›®æ ‡å‡½æ•°å½¢çŠ¶çš„æ–¹æ³•æ˜¯ï¼Œé¦–å…ˆæ ¹æ®å…ˆéªŒåˆ†å¸ƒï¼Œå‡è®¾ä¸€ä¸ªæœé›†å‡½æ•°ï¼›ç„¶åæ¯ä¸€æ¬¡ä½¿ç”¨æ–°çš„é‡‡æ ·ç‚¹æ¥æµ‹è¯•ç›®æ ‡å‡½æ•°æ—¶ï¼Œåˆ©ç”¨è¿™ä¸ªä¿¡æ¯æ¥æ›´æ–°ç›®æ ‡å‡½æ•°çš„å…ˆéªŒåˆ†å¸ƒï¼›æœ€åï¼Œç®—æ³•æµ‹è¯•ç”±åéªŒåˆ†å¸ƒç»™å‡ºçš„å…¨å±€æœ€ä¼˜æœ€å¯èƒ½å‡ºç°çš„ä½ç½®çš„ç‚¹ã€‚å¯¹äºè´å¶æ–¯ç®—æ³•ï¼Œæœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œä¸€æ—¦æ‰¾åˆ°ä¸€ä¸ªå±€éƒ¨æœ€ä¼˜å€¼ï¼Œå®ƒå°±ä¼šåœ¨è¯¥åŒºåŸŸä¸æ–­é‡‡æ ·ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“é™·å…¥å±€éƒ¨æœ€ä¼˜å€¼ã€‚ä¸ºäº†å¼¥è¡¥è¿™ä¸ªç¼ºé™·ï¼Œè´å¶æ–¯ä¼˜åŒ–ç®—æ³•ä¼šåœ¨æ¢ç´¢å’Œåˆ©ç”¨ç›´æ¥æ‰¾åˆ°ä¸€ä¸ªå¹³è¡¡ç‚¹ï¼Œâ€œæ¢ç´¢â€å°±æ˜¯åœ¨è¿˜æœªå–æ ·çš„åŒºåŸŸè·å–é‡‡æ ·ç‚¹ï¼›è€Œâ€œåˆ©ç”¨â€åˆ™æ˜¯æ ¹æ®åéªŒåˆ†å¸ƒåœ¨æœ€å¯èƒ½å‡ºç°çš„å…¨å±€åŒºåŸŸæœ€å€¼è¿›è¡Œé‡‡æ ·ã€‚</p><h4 id="7-åœ¨æ¨¡å‹è¯„ä¼°è¿‡ç¨‹ä¸­ï¼Œè¿‡æ‹Ÿåˆç°è±¡å’Œæ¬ æ‹Ÿåˆç°è±¡å…·ä½“æ˜¯æŒ‡ä»€ä¹ˆ"><a href="#7-åœ¨æ¨¡å‹è¯„ä¼°è¿‡ç¨‹ä¸­ï¼Œè¿‡æ‹Ÿåˆç°è±¡å’Œæ¬ æ‹Ÿåˆç°è±¡å…·ä½“æ˜¯æŒ‡ä»€ä¹ˆ" class="headerlink" title="ã€€7. åœ¨æ¨¡å‹è¯„ä¼°è¿‡ç¨‹ä¸­ï¼Œè¿‡æ‹Ÿåˆç°è±¡å’Œæ¬ æ‹Ÿåˆç°è±¡å…·ä½“æ˜¯æŒ‡ä»€ä¹ˆ?"></a>ã€€7. åœ¨æ¨¡å‹è¯„ä¼°è¿‡ç¨‹ä¸­ï¼Œè¿‡æ‹Ÿåˆç°è±¡å’Œæ¬ æ‹Ÿåˆç°è±¡å…·ä½“æ˜¯æŒ‡ä»€ä¹ˆ?</h4><p><strong>è¿‡æ‹Ÿåˆ</strong>æ˜¯æŒ‡æ¨¡å‹å¯¹äºè®­ç»ƒæ•°æ®æ‹Ÿåˆè¿‡å½“çš„æƒ…å†µï¼Œååº”åˆ°è¯„ä¼°æŒ‡æ ‡ä¸Šï¼Œå°±æ˜¯æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šè¡¨ç°å¾ˆå¥½ï¼Œä½†æ˜¯åœ¨æµ‹è¯•é›†å’Œæ–°æ•°æ®ä¸Šè¡¨ç°è¾ƒå·®ã€‚ <strong>æ¬ æ‹Ÿåˆ</strong>æ˜¯æŒ‡æ¨¡å‹åœ¨è®­ç»ƒå’Œé¢„æµ‹æ—¶è¡¨ç°éƒ½ä¸å¥½çš„æƒ…å†µã€‚</p><p><img src="/2019/03/10/model-evaluation/underfitting.png" alt="IMG"></p><h4 id="8-å¸¸è§çš„é™ä½è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆé£é™©çš„æ–¹æ³•"><a href="#8-å¸¸è§çš„é™ä½è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆé£é™©çš„æ–¹æ³•" class="headerlink" title="8. å¸¸è§çš„é™ä½è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆé£é™©çš„æ–¹æ³•"></a>8. å¸¸è§çš„é™ä½è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆé£é™©çš„æ–¹æ³•</h4><h5 id="é™ä½è¿‡æ‹Ÿåˆé£é™©çš„æ–¹æ³•"><a href="#é™ä½è¿‡æ‹Ÿåˆé£é™©çš„æ–¹æ³•" class="headerlink" title="ã€€é™ä½è¿‡æ‹Ÿåˆé£é™©çš„æ–¹æ³•"></a>ã€€é™ä½è¿‡æ‹Ÿåˆé£é™©çš„æ–¹æ³•</h5><p>ï¼ˆï¼‘ï¼‰ã€€è·å–æ›´å¤šçš„æ•°æ®é›†ï¼Œæˆ–è€…é€šè¿‡ä¸€å®šçš„è§„åˆ™æ¥æ‰©å……è®­ç»ƒæ•°æ®ï¼Œã€€å¦‚åœ¨å›¾åƒåˆ†ç±»é—®é¢˜ä¸Šï¼Œå¯ä»¥é€šè¿‡å¹³ç§»ã€æ—‹è½¬ã€ç¼©æ”¾ç­‰æ–¹æ³•æ¥æ‰©å……æ•°æ®ï¼›æ›´è¿›ä¸€æ­¥åœ°ï¼Œå¯ä»¥é€šè¿‡å¯¹æŠ—ç”Ÿæˆç½‘ç»œæ¥åˆæˆå¤§é‡çš„æ–°è®­ç»ƒæ•°æ®ã€‚</p><p>ï¼ˆï¼’ï¼‰é™ä½æ¨¡å‹çš„å¤æ‚åº¦ã€‚å½“æ•°æ®è¾ƒå°‘ï¼Œæ¨¡å‹è¿‡äºå¤æ‚æ˜¯äº§ç”Ÿè¿‡æ‹Ÿåˆçš„ä¸»è¦å› ç´ ï¼Œé€‚å½“é™ä½æ¨¡å‹å¤æ‚åº¦å¯ä»¥é¿å…æ¨¡å‹æ‹Ÿåˆè¿‡å¤šçš„é‡‡æ ·å™ªå£°ã€‚ä¾‹å¦‚ï¼Œåœ¨ç¥ç»ç½‘ç»œä¸­å‡å°‘ç½‘ç»œå±‚æ•°ã€ç¥ç»å…ƒä¸ªæ•°ç­‰ï¼›åœ¨å†³ç­–æ ‘æ¨¡å‹ä¸­é™ä½æ ‘çš„æ·±åº¦ã€è¿›è¡Œå‰ªæç­‰ã€‚</p><p>ï¼ˆï¼“ï¼‰æ­£åˆ™åŒ–æ–¹æ³•ã€‚ã€€ç»™æ¨¡å‹çš„å‚æ•°åŠ ä¸Šä¸€å®šçš„æ­£åˆ™çº¦æŸï¼Œæ¯”å¦‚ï¼Œå°†æƒå€¼çš„å¤§å°åŠ å…¥åˆ°æŸå¤±å‡½æ•°ä¸­ã€‚ä»¥L2æ­£åˆ™åŒ–ä¸ºä¾‹ï¼š$C = C<em>0 + \frac{\lambda}{2n}\dot\sum</em>{i}{w_i}^2$ã€‚ è¿™æ ·åœ¨ä¼˜åŒ–åŸæ¥ç›®æ ‡å‡½æ•°$C_0$ã€€çš„åŒæ—¶ï¼Œä¹Ÿèƒ½é¿å…æƒå€¼è¿‡å¤§å¸¦æ¥çš„è¿‡æ‹Ÿåˆé£é™©ã€‚</p><p>ï¼ˆï¼”ï¼‰é›†æˆå­¦ä¹ æ–¹æ³•ã€‚é›†æˆå­¦ä¹ æ˜¯æŠŠå¤šä¸ªæ¨¡å‹é›†æˆåœ¨ä¸€èµ·ï¼Œæ¥é™ä½æ¨¡å‹çš„è¿‡æ‹Ÿåˆé£é™©ã€‚</p><h5 id="é™ä½æ¬ æ‹Ÿåˆé£é™©çš„æ–¹æ³•"><a href="#é™ä½æ¬ æ‹Ÿåˆé£é™©çš„æ–¹æ³•" class="headerlink" title="ã€€é™ä½æ¬ æ‹Ÿåˆé£é™©çš„æ–¹æ³•"></a>ã€€é™ä½æ¬ æ‹Ÿåˆé£é™©çš„æ–¹æ³•</h5><p>ï¼ˆï¼‘ï¼‰æ·»åŠ æ–°ç‰¹å¾ã€‚ã€€å½“ç‰¹å¾ä¸è¶³æˆ–è€…ç°æœ‰ç‰¹å¾ä¸æ ·æœ¬æ ‡ç­¾çš„ç›¸å…³æ€§ä¸å¼ºæ—¶ï¼Œã€€æ¨¡å‹å®¹æ˜“å‡ºç°æ¬ æ‹Ÿåˆã€‚</p><p>ï¼ˆï¼’ï¼‰å¢åŠ æ¨¡å‹å¤æ‚åº¦ã€‚ç®€å•æ¨¡å‹çš„å­¦ä¹ èƒ½åŠ›è¾ƒå·®ï¼Œé€šè¿‡å¢åŠ æ¨¡å‹çš„å¤æ‚åº¦å¯ä»¥ä½¿æ¨¡å‹æ‹¥æœ‰è¾ƒå¼ºçš„æ‹Ÿåˆèƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œåœ¨çº¿æ€§æ¨¡å‹ä¸­æ·»åŠ é«˜æ¬¡é¡¹ï¼Œåœ¨ç¥ç»ç½‘ç»œä¸­æ·»åŠ ç½‘ç»œå±‚æ•°æˆ–ç¥ç»å…ƒä¸ªæ•°ç­‰ã€‚</p><p>ï¼ˆï¼“ï¼‰å‡å°æ­£åˆ™åŒ–æ´—æ¼±ã€‚æ­£åˆ™åŒ–æ˜¯ç”¨æ¥é˜²æ­¢è¿‡æ‹Ÿåˆçš„ï¼Œä½†å½“æ¨¡å‹ä¸­å‡ºç°æ¬ æ‹Ÿåˆç°è±¡æ—¶ï¼Œåˆ™éœ€è¦æœ‰é’ˆå¯¹æ€§åœ°å‡å°‘æ­£åˆ™åŒ–ç³»æ•°ã€‚</p><p><em>è¡¥å……ï¼šæ·»åŠ ç‰¹å¾æ—¶ï¼Œé€šè¿‡æŒ–æ˜â€œä¸Šä¸‹æ–‡ç‰¹å¾â€ã€â€œID ç±»ç‰¹å¾â€ã€â€œç»„åˆç‰¹å¾â€ç­‰æ–°çš„ç‰¹å¾ï¼Œå¾€å¾€èƒ½å–å¾—æ›´å¥½çš„æ•ˆæœï¼Œåœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œæœ‰å¾ˆå¤šæ¨¡å‹å¯ä»¥å¸®åŠ©å®Œæˆç‰¹å¾å·¥ç¨‹ï¼Œå¦‚å› å­åˆ†è§£æœºã€æ¢¯åº¦æå‡ç­–ç•¥æ ‘ã€Deep-crossingç­‰éƒ½å¯ä»¥æˆä¸ºä¸°å¯Œç‰¹å¾çš„æ–¹æ³•</em></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>pytorch API</title>
    <link href="/2019/03/08/Pytorch-API/"/>
    <url>/2019/03/08/Pytorch-API/</url>
    
    <content type="html"><![CDATA[<p>Pytorch API æ±‡æ€»æ•´ç†</p><a id="more"></a><h3 id="1-import-torch"><a href="#1-import-torch" class="headerlink" title="1. import torch"></a>1. import torch</h3><p>import &amp; vision</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch print(torch.__version__)</code></pre><h3 id="2-Tensor-type-ğŸŒŸ"><a href="#2-Tensor-type-ğŸŒŸ" class="headerlink" title="2. Tensor type ğŸŒŸ"></a>2. Tensor type ğŸŒŸ</h3><p>Pytorch ç»™å‡ºäº† 9 ç§ CPU Tensor ç±»å‹å’Œ 9 ç§ GPU Tensor ç±»å‹ã€‚Pytorch ä¸­é»˜è®¤çš„æ•°æ®ç±»å‹æ˜¯ torch.FloatTensor, å³ torch.Tensor ç­‰åŒäº torch.FloatTensorã€‚</p><div class="table-container"><table><thead><tr><th>Data type</th><th>dtype</th><th>CPU tensor</th><th>GPU tensor</th></tr></thead><tbody><tr><td>32-bit floating point</td><td>torch.float32 or torch.float</td><td>torch.FloatTensor</td><td>torch.cuda.FloatTensor</td></tr><tr><td>64-bit floating point</td><td>torch.float64 or torch.double</td><td>torch.DoubleTensor</td><td>torch.cuda.DoubleTensor</td></tr><tr><td>16-bit floating point</td><td>torch.float16 or torch.half</td><td>torch.HalfTensor</td><td>torch.cuda.HalfTensor</td></tr><tr><td>8-bit integer (unsigned)</td><td>torch.uint8</td><td>torch.ByteTensor</td><td>torch.cuda.ByteTensor</td></tr><tr><td>8-bit integer (signed)</td><td>torch.int8</td><td>torch.CharTensor</td><td>torch.cuda.CharTensor</td></tr><tr><td>16-bit integer (signed)</td><td>torch.int16 or torch.short</td><td>torch.ShortTensor</td><td>torch.cuda.ShortTensor</td></tr><tr><td>32-bit integer (signed)</td><td>torch.int32 or torch.int</td><td>torch.IntTensor</td><td>torch.cuda.IntTensor</td></tr><tr><td>64-bit integer (signed)</td><td>torch.int64 or torch.long</td><td>torch.LongTensor</td><td>torch.cuda.LongTensor</td></tr><tr><td>Boolean</td><td>torch.bool</td><td>torch.BoolTensor</td><td>torch.cuda.BoolTensor</td></tr></tbody></table></div><h5 id="è®¾ç½®é»˜è®¤Tensor-ç±»å‹"><a href="#è®¾ç½®é»˜è®¤Tensor-ç±»å‹" class="headerlink" title="è®¾ç½®é»˜è®¤Tensor ç±»å‹"></a>è®¾ç½®é»˜è®¤Tensor ç±»å‹</h5><p>Pytorch å¯ä»¥é€šè¿‡ <code>set_default_tensor_type</code> å‡½æ•°<strong>è®¾ç½®é»˜è®¤ä½¿ç”¨çš„Tensorç±»å‹</strong>ï¼Œ åœ¨å±€éƒ¨ä½¿ç”¨å®Œåå¦‚æœéœ€è¦å…¶ä»–ç±»å‹ï¼Œåˆ™è¿˜éœ€è¦é‡æ–°è®¾ç½®ä¼šæ‰€éœ€çš„ç±»å‹ </p><pre><code class="hljs elm"><span class="hljs-title">torch</span>.set_default_tensor_<span class="hljs-keyword">type</span>(&#x27;torch.<span class="hljs-type">DoubleTensor</span>&#x27;)</code></pre><h5 id="CPU-GPU-äº’è½¬"><a href="#CPU-GPU-äº’è½¬" class="headerlink" title="CPU/GPU äº’è½¬"></a>CPU/GPU äº’è½¬</h5><p>CPU Tensor å’Œ GPU Tensor çš„åŒºåˆ«åœ¨äºï¼Œ å‰è€…å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè€Œåè€…å­˜å‚¨åœ¨æ˜¾å­˜ä¸­ã€‚ä¸¤è€…ä¹‹é—´çš„è½¬æ¢å¯ä»¥é€šè¿‡ <code>.cpu()</code>ã€<code>.cuda()</code>å’Œ <code>.to(device)</code> æ¥å®Œæˆ  </p><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>device = torch.device(<span class="hljs-string">&quot;cuda:0&quot;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;cpu&quot;</span>)  <span class="hljs-meta">&gt;&gt;&gt; </span>a = torch.rand(<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)<span class="hljs-meta">&gt;&gt;&gt; </span>a = a.cuda() <span class="hljs-comment"># CPU -&gt; GPU</span><span class="hljs-meta">&gt;&gt;&gt; </span>a.type()<span class="hljs-string">&#x27;torch.cuda.FloatTensor&#x27;</span><span class="hljs-meta">&gt;&gt;&gt; </span>a = a.cpu() <span class="hljs-comment"># GPU -&gt; CPU</span><span class="hljs-meta">&gt;&gt;&gt; </span>a.type()<span class="hljs-string">&#x27;torch.FloatTensor&#x27;</span><span class="hljs-meta">&gt;&gt;&gt; </span>a = a.to(device) <span class="hljs-comment"># to device</span><span class="hljs-meta">&gt;&gt;&gt; </span>a.type()<span class="hljs-string">&#x27;torch.cuda.FloatTensor&#x27;</span></code></pre><h5 id="åˆ¤å®š-Tensor-ç±»å‹çš„å‡ ç§æ–¹å¼"><a href="#åˆ¤å®š-Tensor-ç±»å‹çš„å‡ ç§æ–¹å¼" class="headerlink" title="åˆ¤å®š Tensor ç±»å‹çš„å‡ ç§æ–¹å¼:"></a>åˆ¤å®š Tensor ç±»å‹çš„å‡ ç§æ–¹å¼:</h5><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>atensor([[<span class="hljs-number">0.6065</span>, <span class="hljs-number">0.0122</span>, <span class="hljs-number">0.4473</span>],        [<span class="hljs-number">0.5937</span>, <span class="hljs-number">0.5530</span>, <span class="hljs-number">0.4663</span>]], device=<span class="hljs-string">&#x27;cuda:0&#x27;</span>)<span class="hljs-meta">&gt;&gt;&gt; </span>a.is_cuda  <span class="hljs-comment"># å¯ä»¥æ˜¾ç¤ºæ˜¯å¦åœ¨æ˜¾å­˜ä¸­</span><span class="hljs-literal">True</span><span class="hljs-meta">&gt;&gt;&gt; </span>a.dtype   <span class="hljs-comment"># Tensor å†…éƒ¨dataçš„ç±»å‹</span>torch.float32<span class="hljs-meta">&gt;&gt;&gt; </span>a.type()<span class="hljs-string">&#x27;torch.cuda.FloatTensor&#x27;</span>  <span class="hljs-comment"># å¯ä»¥ç›´æ¥æ˜¾ç¤º Tensor ç±»å‹ = is_cuda + dtype</span></code></pre><h5 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h5><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>atensor([[<span class="hljs-number">0.6065</span>, <span class="hljs-number">0.0122</span>, <span class="hljs-number">0.4473</span>],        [<span class="hljs-number">0.5937</span>, <span class="hljs-number">0.5530</span>, <span class="hljs-number">0.4663</span>]], device=<span class="hljs-string">&#x27;cuda:0&#x27;</span>)<span class="hljs-meta">&gt;&gt;&gt; </span>a.type(torch.DoubleTensor)   <span class="hljs-comment"># ä½¿ç”¨ type() å‡½æ•°è¿›è¡Œè½¬æ¢</span>tensor([[<span class="hljs-number">0.6065</span>, <span class="hljs-number">0.0122</span>, <span class="hljs-number">0.4473</span>],        [<span class="hljs-number">0.5937</span>, <span class="hljs-number">0.5530</span>, <span class="hljs-number">0.4663</span>]], dtype=torch.float64)<span class="hljs-meta">&gt;&gt;&gt; </span>a = a.double()  <span class="hljs-comment"># ç›´æ¥ä½¿ç”¨ int()ã€long() ã€float() ã€å’Œ double() ç­‰ç›´æ¥è¿›è¡Œæ•°æ®ç±»å‹è½¬æ¢è¿›è¡Œ</span>tensor([[<span class="hljs-number">0.6065</span>, <span class="hljs-number">0.0122</span>, <span class="hljs-number">0.4473</span>],        [<span class="hljs-number">0.5937</span>, <span class="hljs-number">0.5530</span>, <span class="hljs-number">0.4663</span>]], device=<span class="hljs-string">&#x27;cuda:0&#x27;</span>, dtype=torch.float64)<span class="hljs-meta">&gt;&gt;&gt; </span>b = torch.randn(<span class="hljs-number">4</span>,<span class="hljs-number">5</span>)<span class="hljs-meta">&gt;&gt;&gt; </span>b.type_as(a)  <span class="hljs-comment"># ä½¿ç”¨ type_as å‡½æ•°, å¹¶ä¸éœ€è¦æ˜ç¡®å…·ä½“æ˜¯å“ªç§ç±»å‹</span>tensor([[ <span class="hljs-number">0.2129</span>,  <span class="hljs-number">0.1877</span>, <span class="hljs-number">-0.0626</span>,  <span class="hljs-number">0.4607</span>, <span class="hljs-number">-1.0375</span>],        [ <span class="hljs-number">0.7222</span>, <span class="hljs-number">-0.3502</span>,  <span class="hljs-number">0.1288</span>,  <span class="hljs-number">0.6786</span>,  <span class="hljs-number">0.5062</span>],        [<span class="hljs-number">-0.4956</span>, <span class="hljs-number">-0.0793</span>,  <span class="hljs-number">0.7590</span>, <span class="hljs-number">-1.0932</span>, <span class="hljs-number">-0.1084</span>],        [<span class="hljs-number">-2.2198</span>,  <span class="hljs-number">0.3827</span>,  <span class="hljs-number">0.2735</span>,  <span class="hljs-number">0.5642</span>,  <span class="hljs-number">0.6771</span>]], device=<span class="hljs-string">&#x27;cuda:0&#x27;</span>,       dtype=torch.float64)</code></pre><h5 id="numpy-array-ä¸-torch-Tensor-äº’è½¬"><a href="#numpy-array-ä¸-torch-Tensor-äº’è½¬" class="headerlink" title="numpy array ä¸ã€€torch Tensorã€€äº’è½¬"></a>numpy array ä¸ã€€torch Tensorã€€äº’è½¬</h5><pre><code class="hljs python">torch.Tensor ä¸ np.ndarray è½¬æ¢<span class="hljs-comment"># torch.Tensor -&gt; np.ndarray.</span>ndarray = tensor.cpu().numpy()<span class="hljs-comment"># np.ndarray -&gt; torch.Tensor.</span>tensor = torch.from_numpy(ndarray).float()tensor = torch.from_numpy(ndarray.copy()).float()  <span class="hljs-comment"># If ndarray has negative stride</span></code></pre><h5 id="Tensor-ç›¸å…³ä¿¡æ¯è·å–"><a href="#Tensor-ç›¸å…³ä¿¡æ¯è·å–" class="headerlink" title="Tensor ç›¸å…³ä¿¡æ¯è·å–"></a>Tensor ç›¸å…³ä¿¡æ¯è·å–</h5><pre><code class="hljs python">t.size()/tã€.shape   <span class="hljs-comment"># ä¸¤è€…ç­‰ä»·ï¼Œ è¿”å› t çš„å½¢çŠ¶, å¯ä»¥ä½¿ç”¨ t.size()[1] æˆ– t.size(1) æŸ¥çœ‹åˆ—æ•°</span>t.numel() / t.nelement()  <span class="hljs-comment"># ä¸¤è€…ç­‰ä»·, è¿”å› tensor ä¸­å…ƒç´ æ€»ä¸ªæ•°</span>t.item()  <span class="hljs-comment"># å–å‡ºå•ä¸ª tensor çš„å€¼</span>t.dim()  <span class="hljs-comment"># ç»´åº¦</span></code></pre><h3 id="3-Tensor-Create"><a href="#3-Tensor-Create" class="headerlink" title="3. Tensor Create"></a>3. Tensor Create</h3><h5 id="æœ€åŸºæœ¬çš„Tensoråˆ›å»ºæ–¹å¼"><a href="#æœ€åŸºæœ¬çš„Tensoråˆ›å»ºæ–¹å¼" class="headerlink" title="æœ€åŸºæœ¬çš„Tensoråˆ›å»ºæ–¹å¼"></a>æœ€åŸºæœ¬çš„Tensoråˆ›å»ºæ–¹å¼</h5><pre><code class="hljs python">troch.Tensor(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>) <span class="hljs-comment"># ä¼šä½¿ç”¨é»˜è®¤çš„ç±»å‹åˆ›å»º Tensor, </span>                   <span class="hljs-comment"># å¯ä»¥é€šè¿‡ torch.set_default_tensor_type(&#x27;torch.DoubleTensor&#x27;) è¿›è¡Œä¿®æ”¹</span>torch.DoubleTensor(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>) <span class="hljs-comment"># æŒ‡å®šç±»å‹åˆ›å»º Tensor</span>torch.Tensor([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]])  <span class="hljs-comment"># é€šè¿‡ list åˆ›å»º Tensor</span>                                <span class="hljs-comment"># å°† Tensorè½¬æ¢ä¸ºlistå¯ä»¥ä½¿ç”¨: t.tolist()</span>torch.from_numpy(np.array([<span class="hljs-number">2</span>, <span class="hljs-number">3.3</span>]) ) <span class="hljs-comment"># é€šè¿‡ numpy array åˆ›å»º tensor</span></code></pre><h5 id="ç¡®å®šåˆå§‹å€¼çš„æ–¹å¼åˆ›å»º"><a href="#ç¡®å®šåˆå§‹å€¼çš„æ–¹å¼åˆ›å»º" class="headerlink" title="ç¡®å®šåˆå§‹å€¼çš„æ–¹å¼åˆ›å»º"></a>ç¡®å®šåˆå§‹å€¼çš„æ–¹å¼åˆ›å»º</h5><pre><code class="hljs python">torch.ones(sizes)  <span class="hljs-comment"># å…¨ 1 Tensor     </span>torch.zeros(sizes)  <span class="hljs-comment"># å…¨ 0 Tensor</span>torch.eye(sizes)  <span class="hljs-comment"># å¯¹è§’çº¿ä¸º1ï¼Œä¸è¦æ±‚è¡Œåˆ—ä¸€è‡´</span>torch.full(sizes, value) <span class="hljs-comment"># æŒ‡å®š value</span></code></pre><h5 id="åˆ†å¸ƒ"><a href="#åˆ†å¸ƒ" class="headerlink" title="åˆ†å¸ƒ"></a>åˆ†å¸ƒ</h5><pre><code class="hljs python">torch.rand(sizes)  <span class="hljs-comment"># å‡åŒ€åˆ†å¸ƒ   </span>torch.randn(sizes)   <span class="hljs-comment"># æ ‡å‡†åˆ†å¸ƒ</span><span class="hljs-comment"># æ­£æ€åˆ†å¸ƒ: è¿”å›ä¸€ä¸ªå¼ é‡ï¼ŒåŒ…å«ä»ç»™å®šå‚æ•° means, std çš„ç¦»æ•£æ­£æ€åˆ†å¸ƒä¸­æŠ½å–éšæœºæ•°ã€‚ </span><span class="hljs-comment"># å‡å€¼ means æ˜¯ä¸€ä¸ªå¼ é‡ï¼ŒåŒ…å«æ¯ä¸ªè¾“å‡ºå…ƒç´ ç›¸å…³çš„æ­£æ€åˆ†å¸ƒçš„å‡å€¼ -&gt; ä»¥æ­¤å¼ é‡çš„å‡å€¼ä½œä¸ºå‡å€¼</span><span class="hljs-comment"># æ ‡å‡†å·® std æ˜¯ä¸€ä¸ªå¼ é‡ï¼ŒåŒ…å«æ¯ä¸ªè¾“å‡ºå…ƒç´ ç›¸å…³çš„æ­£æ€åˆ†å¸ƒçš„æ ‡å‡†å·® -&gt; ä»¥æ­¤å¼ é‡çš„æ ‡å‡†å·®ä½œä¸ºæ ‡å‡†å·®ã€‚ </span><span class="hljs-comment"># å‡å€¼å’Œæ ‡å‡†å·®çš„å½¢çŠ¶ä¸é¡»åŒ¹é…ï¼Œä½†æ¯ä¸ªå¼ é‡çš„å…ƒç´ ä¸ªæ•°é¡»ç›¸åŒ</span>torch.normal(mean=torch.arange(<span class="hljs-number">1.</span>, <span class="hljs-number">11.</span>), std=torch.arange(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-0.1</span>))tensor([<span class="hljs-number">-0.1987</span>,  <span class="hljs-number">3.1957</span>,  <span class="hljs-number">3.5459</span>,  <span class="hljs-number">2.8150</span>,  <span class="hljs-number">5.5398</span>,  <span class="hljs-number">5.6116</span>,  <span class="hljs-number">7.5512</span>,  <span class="hljs-number">7.8650</span>,         <span class="hljs-number">9.3151</span>, <span class="hljs-number">10.1827</span>])torch.uniform(<span class="hljs-keyword">from</span>,to) <span class="hljs-comment"># å‡åŒ€åˆ†å¸ƒ </span>torch.arange(s, e, steps)  <span class="hljs-comment"># ä» s åˆ° eï¼Œæ­¥é•¿ä¸º step</span>torch.linspace(s, e, num)   <span class="hljs-comment"># ä» s åˆ° e, å‡åŒ€åˆ‡åˆ†ä¸º num ä»½</span><span class="hljs-comment"># ! æ³¨æ„linespaceå’Œarangeçš„åŒºåˆ«ï¼Œå‰è€…çš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯ç”Ÿæˆçš„Tensorä¸­å…ƒç´ çš„æ•°é‡ï¼Œè€Œåè€…çš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯æ­¥é•¿ã€‚</span>torch.randperm(m) <span class="hljs-comment"># 0 åˆ° m-1 çš„éšæœºåºåˆ—</span><span class="hljs-comment"># ! shuffle æ“ä½œ</span>tensor[torch.randperm(tensor.size(<span class="hljs-number">0</span>))]</code></pre><h5 id="å¤åˆ¶"><a href="#å¤åˆ¶" class="headerlink" title="å¤åˆ¶"></a>å¤åˆ¶</h5><p>Pytorch æœ‰å‡ ç§ä¸åŒçš„å¤åˆ¶æ–¹å¼ï¼Œæ³¨æ„åŒºåˆ†</p><div class="table-container"><table><thead><tr><th>Operation</th><th>New/Shared memory</th><th>Still in computation graph</th></tr></thead><tbody><tr><td>tensor.clone()</td><td>New</td><td>Yes</td></tr><tr><td>tensor.detach()</td><td>Shared</td><td>No</td></tr><tr><td>tensor.detach.clone()</td><td>New</td><td>No</td></tr></tbody></table></div><h3 id="4-ç´¢å¼•ã€æ¯”è¾ƒã€æ’åº"><a href="#4-ç´¢å¼•ã€æ¯”è¾ƒã€æ’åº" class="headerlink" title="4. ç´¢å¼•ã€æ¯”è¾ƒã€æ’åº"></a>4. ç´¢å¼•ã€æ¯”è¾ƒã€æ’åº</h3><h5 id="ç´¢å¼•æ“ä½œ"><a href="#ç´¢å¼•æ“ä½œ" class="headerlink" title="ç´¢å¼•æ“ä½œ"></a>ç´¢å¼•æ“ä½œ</h5><pre><code class="hljs python">a.item() <span class="hljs-comment">#ã€€ä»åªåŒ…å«ä¸€ä¸ªå…ƒç´ çš„å¼ é‡ä¸­æå–å€¼</span>a[row, column]   <span class="hljs-comment"># row è¡Œï¼Œ cloumn åˆ—</span>a[index]   <span class="hljs-comment"># ç¬¬index è¡Œ</span>a[:,index]   <span class="hljs-comment"># ç¬¬ index åˆ—</span>a[<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>]  <span class="hljs-comment"># ç¬¬é›¶è¡Œï¼Œ æœ€åä¸€ä¸ªå…ƒç´ </span>a[:index]  <span class="hljs-comment"># å‰ index è¡Œ</span>a[:row, <span class="hljs-number">0</span>:<span class="hljs-number">1</span>]  <span class="hljs-comment"># å‰ row è¡Œï¼Œ 0å’Œ1åˆ—</span>a[a&gt;<span class="hljs-number">1</span>]  <span class="hljs-comment"># é€‰æ‹© a &gt; 1çš„å…ƒç´ ï¼Œ ç­‰ä»·äº a.masked_select(a&gt;1)</span>torch.nonzero(a) <span class="hljs-comment"># é€‰æ‹©éé›¶å…ƒç´ çš„åæ ‡ï¼Œå¹¶è¿”å›</span>a.clamp(x, y)  <span class="hljs-comment"># å¯¹ Tensor å…ƒç´ è¿›è¡Œé™åˆ¶ï¼Œ å°äºxç”¨xä»£æ›¿ï¼Œ å¤§äºyç”¨yä»£æ›¿</span>torch.where(condition, x, y)  <span class="hljs-comment"># æ»¡è¶³condition çš„ä½ç½®è¾“å‡ºxï¼Œ å¦åˆ™è¾“å‡ºy</span><span class="hljs-meta">&gt;&gt;&gt; </span>atensor([[ <span class="hljs-number">6.</span>, <span class="hljs-number">-2.</span>],        [ <span class="hljs-number">8.</span>,  <span class="hljs-number">0.</span>]])<span class="hljs-meta">&gt;&gt;&gt; </span>torch.where(a &gt; <span class="hljs-number">1</span>, torch.full_like(a, <span class="hljs-number">1</span>), a)  <span class="hljs-comment"># å¤§äº1 çš„éƒ¨åˆ†ç›´æ¥ç”¨1ä»£æ›¿ï¼Œ å…¶ä»–ä¿ç•™åŸå€¼</span>tensor([[ <span class="hljs-number">1.</span>, <span class="hljs-number">-2.</span>],        [ <span class="hljs-number">1.</span>,  <span class="hljs-number">0.</span>]])<span class="hljs-comment">#ã€€å¾—åˆ°éé›¶å…ƒç´ </span>torch.nonzero(tensor)               <span class="hljs-comment"># éé›¶å…ƒç´ çš„ç´¢å¼•</span>torch.nonzero(tensor == <span class="hljs-number">0</span>)          <span class="hljs-comment"># é›¶å…ƒç´ çš„ç´¢å¼•</span>torch.nonzero(tensor).size(<span class="hljs-number">0</span>)       <span class="hljs-comment"># éé›¶å…ƒç´ çš„ä¸ªæ•°</span>torch.nonzero(tensor == <span class="hljs-number">0</span>).size(<span class="hljs-number">0</span>)  <span class="hljs-comment"># é›¶å…ƒç´ çš„ä¸ªæ•°</span></code></pre><h5 id="æ¯”è¾ƒæ“ä½œ"><a href="#æ¯”è¾ƒæ“ä½œ" class="headerlink" title="æ¯”è¾ƒæ“ä½œ"></a>æ¯”è¾ƒæ“ä½œ</h5><pre><code class="hljs python">gt &gt;    lt &lt;     ge &gt;=     le &lt;=   eq ==    ne != topk(input, k) -&gt; (Tensor, LongTensor)sort(input) -&gt; (Tensor, LongTensor)max/min =&gt; max(tensor)      max(tensor, dim)    max(tensor1, tensor2)</code></pre><p>sort å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°, å…¶ä¸­ å‚æ•° 0 ä¸ºæŒ‰ç…§è¡Œæ’åºã€1ä¸ºæŒ‰ç…§åˆ—æ’åº: True ä¸ºé™åºï¼Œ False ä¸ºå‡åºï¼Œ è¿”å›å€¼æœ‰ä¸¤ä¸ªï¼Œ ç¬¬ä¸€ä¸ªæ˜¯æ’åºç»“æœï¼Œ ç¬¬äºŒä¸ªæ˜¯æ’åºåºå·</p><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> torch<span class="hljs-meta">&gt;&gt;&gt; </span>a = torch.randn(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>)<span class="hljs-meta">&gt;&gt;&gt; </span>atensor([[<span class="hljs-number">-1.8500</span>, <span class="hljs-number">-0.2005</span>,  <span class="hljs-number">1.4475</span>],        [<span class="hljs-number">-1.7795</span>, <span class="hljs-number">-0.4968</span>, <span class="hljs-number">-1.8965</span>],        [ <span class="hljs-number">0.5798</span>, <span class="hljs-number">-0.1554</span>,  <span class="hljs-number">1.6395</span>]])<span class="hljs-meta">&gt;&gt;&gt; </span>a.sort(<span class="hljs-number">0</span>, <span class="hljs-literal">True</span>)[<span class="hljs-number">0</span>] tensor([[ <span class="hljs-number">0.5798</span>, <span class="hljs-number">-0.1554</span>,  <span class="hljs-number">1.6395</span>],        [<span class="hljs-number">-1.7795</span>, <span class="hljs-number">-0.2005</span>,  <span class="hljs-number">1.4475</span>],        [<span class="hljs-number">-1.8500</span>, <span class="hljs-number">-0.4968</span>, <span class="hljs-number">-1.8965</span>]])<span class="hljs-meta">&gt;&gt;&gt; </span>a.sort(<span class="hljs-number">0</span>, <span class="hljs-literal">True</span>)[<span class="hljs-number">1</span>]tensor([[<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>],        [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],        [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]])<span class="hljs-meta">&gt;&gt;&gt; </span>a.sort(<span class="hljs-number">1</span>, <span class="hljs-literal">True</span>)[<span class="hljs-number">1</span>]tensor([[<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>],        [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>],        [<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]])<span class="hljs-meta">&gt;&gt;&gt; </span>a.sort(<span class="hljs-number">1</span>, <span class="hljs-literal">True</span>)[<span class="hljs-number">0</span>]tensor([[ <span class="hljs-number">1.4475</span>, <span class="hljs-number">-0.2005</span>, <span class="hljs-number">-1.8500</span>],        [<span class="hljs-number">-0.4968</span>, <span class="hljs-number">-1.7795</span>, <span class="hljs-number">-1.8965</span>],        [ <span class="hljs-number">1.6395</span>,  <span class="hljs-number">0.5798</span>, <span class="hljs-number">-0.1554</span>]])</code></pre><h3 id="5-Element-wise-å’Œ-å½’å¹¶æ“ä½œ"><a href="#5-Element-wise-å’Œ-å½’å¹¶æ“ä½œ" class="headerlink" title="5. Element-wise å’Œ å½’å¹¶æ“ä½œ"></a>5. Element-wise å’Œ å½’å¹¶æ“ä½œ</h3><p>Element-wiseï¼šè¾“å‡ºçš„ Tensor å½¢çŠ¶ä¸åŸå§‹çš„å½¢çŠ¶ä¸€è‡´</p><pre><code class="hljs python">abs / sqrt / div / exp / fmod / log / pow...cos / sin / asin / atan2 / cosh...ceil / round / floor / truncclamp(input, min, max)sigmoid / tanh...</code></pre><p>å½’å¹¶æ“ä½œï¼šè¾“å‡ºçš„ Tensor å½¢çŠ¶å°äºåŸå§‹çš„ Tensorå½¢çŠ¶</p><pre><code class="hljs python">mean/sum/median/mode   <span class="hljs-comment"># å‡å€¼/å’Œ/ ä¸­ä½æ•°/ä¼—æ•°</span>norm/dist  <span class="hljs-comment"># èŒƒæ•°/è·ç¦»</span>std/var  <span class="hljs-comment"># æ ‡å‡†å·®/æ–¹å·®</span>cumsum/cumprd <span class="hljs-comment"># ç´¯åŠ /ç´¯ä¹˜</span></code></pre><h3 id="6-å˜å½¢æ“ä½œ"><a href="#6-å˜å½¢æ“ä½œ" class="headerlink" title="6. å˜å½¢æ“ä½œ"></a>6. å˜å½¢æ“ä½œ</h3><h5 id="view-resize-reshape-è°ƒæ•´Tensorçš„å½¢çŠ¶"><a href="#view-resize-reshape-è°ƒæ•´Tensorçš„å½¢çŠ¶" class="headerlink" title="view/resize/reshape  è°ƒæ•´Tensorçš„å½¢çŠ¶"></a>view/resize/reshape  è°ƒæ•´Tensorçš„å½¢çŠ¶</h5><ul><li>å…ƒç´ æ€»æ•°å¿…é¡»ç›¸åŒ  </li><li>view å’Œ reshape å¯ä»¥ä½¿ç”¨ -1 è‡ªåŠ¨è®¡ç®—ç»´åº¦</li><li>å…±äº«å†…å­˜</li></ul><p>!!!  <code>view()</code> æ“ä½œæ˜¯éœ€è¦ Tensor åœ¨å†…å­˜ä¸­è¿ç»­çš„ï¼Œ è¿™ç§æƒ…å†µä¸‹éœ€è¦ä½¿ç”¨ <code>contiguous()</code> æ“ä½œå…ˆå°†å†…å­˜å˜ä¸ºè¿ç»­ã€‚ å¯¹äºreshape æ“ä½œï¼Œ å¯ä»¥çœ‹åšæ˜¯ <code>Tensor.contiguous().view()</code>.</p><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a = torch.Tensor(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)<span class="hljs-meta">&gt;&gt;&gt; </span>atensor([[<span class="hljs-number">6.0000e+00</span>, <span class="hljs-number">8.0000e+00</span>],        [<span class="hljs-number">1.0000e+00</span>, <span class="hljs-number">1.8367e-40</span>]])<span class="hljs-meta">&gt;&gt;&gt; </span>a.resize(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>)tensor([[<span class="hljs-number">6.0000e+00</span>],        [<span class="hljs-number">8.0000e+00</span>],        [<span class="hljs-number">1.0000e+00</span>],        [<span class="hljs-number">1.8367e-40</span>]])</code></pre><h5 id="transpose-permute-å„ç»´åº¦ä¹‹é—´çš„å˜æ¢ï¼Œ"><a href="#transpose-permute-å„ç»´åº¦ä¹‹é—´çš„å˜æ¢ï¼Œ" class="headerlink" title="transpose / permute  å„ç»´åº¦ä¹‹é—´çš„å˜æ¢ï¼Œ"></a>transpose / permute  å„ç»´åº¦ä¹‹é—´çš„å˜æ¢ï¼Œ</h5><p>transpose å¯ä»¥å°†æŒ‡å®šçš„ä¸¤ä¸ªç»´åº¦çš„å…ƒç´ è¿›è¡Œè½¬ç½®ï¼Œ permute åˆ™å¯ä»¥æŒ‰ç…§æŒ‡å®šçš„ç»´åº¦è¿›è¡Œç»´åº¦å˜æ¢</p><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>xtensor([[[<span class="hljs-number">-0.9699</span>, <span class="hljs-number">-0.3375</span>, <span class="hljs-number">-0.0178</span>]],        [[ <span class="hljs-number">1.4260</span>, <span class="hljs-number">-0.2305</span>, <span class="hljs-number">-0.2883</span>]]])<span class="hljs-meta">&gt;&gt;&gt; </span>x.shapetorch.Size([<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>])<span class="hljs-meta">&gt;&gt;&gt; </span>x.transpose(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>) <span class="hljs-comment"># shape =&gt; torch.Size([1, 2, 3])</span>tensor([[[<span class="hljs-number">-0.9699</span>, <span class="hljs-number">-0.3375</span>, <span class="hljs-number">-0.0178</span>],         [ <span class="hljs-number">1.4260</span>, <span class="hljs-number">-0.2305</span>, <span class="hljs-number">-0.2883</span>]]])<span class="hljs-meta">&gt;&gt;&gt; </span>x.permute(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>) <span class="hljs-comment"># shape =&gt; torch.Size([1, 2, 3])</span>tensor([[[<span class="hljs-number">-0.9699</span>, <span class="hljs-number">-0.3375</span>, <span class="hljs-number">-0.0178</span>],         [ <span class="hljs-number">1.4260</span>, <span class="hljs-number">-0.2305</span>, <span class="hljs-number">-0.2883</span>]]])<span class="hljs-meta">&gt;&gt;&gt; </span></code></pre><h5 id="squeeze-dim-unsquence-dim"><a href="#squeeze-dim-unsquence-dim" class="headerlink" title="squeeze(dim) / unsquence(dim)"></a>squeeze(dim) / unsquence(dim)</h5><p>å¤„ç†sizeä¸º1çš„ç»´åº¦ï¼Œ å‰è€…ç”¨äºå»é™¤sizeä¸º1çš„ç»´åº¦ï¼Œ è€Œåè€…åˆ™æ˜¯å°†æŒ‡å®šçš„ç»´åº¦çš„sizeå˜ä¸º1</p><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a = torch.arange(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>)<span class="hljs-meta">&gt;&gt;&gt; </span>atensor([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]) <span class="hljs-comment"># shape =&gt; torch.Size([3])</span><span class="hljs-meta">&gt;&gt;&gt; </span>a.unsqueeze(<span class="hljs-number">0</span>) <span class="hljs-comment"># shape =&gt; torch.Size([1, 3])</span><span class="hljs-meta">&gt;&gt;&gt; </span>a.unqueeze(<span class="hljs-number">0</span>).squeeze(<span class="hljs-number">0</span>) <span class="hljs-comment"># shape =&gt; torch.Size([3])</span></code></pre><h5 id="expand-expand-as-repeatå¤åˆ¶å…ƒç´ æ¥æ‰©å±•ç»´åº¦"><a href="#expand-expand-as-repeatå¤åˆ¶å…ƒç´ æ¥æ‰©å±•ç»´åº¦" class="headerlink" title="expand / expand_as / repeatå¤åˆ¶å…ƒç´ æ¥æ‰©å±•ç»´åº¦"></a>expand / expand_as / repeatå¤åˆ¶å…ƒç´ æ¥æ‰©å±•ç»´åº¦</h5><p>æœ‰æ—¶éœ€è¦é‡‡ç”¨å¤åˆ¶çš„å½¢å¼æ¥æ‰©å±• Tensor çš„ç»´åº¦ï¼Œ è¿™æ—¶å¯ä»¥ä½¿ç”¨ <code>expand</code>ï¼Œ <code>expand()</code> å‡½æ•°å°† size ä¸º 1çš„ç»´åº¦å¤åˆ¶æ‰©å±•ä¸ºæŒ‡å®šå¤§å°ï¼Œ ä¹Ÿå¯ä»¥ç”¨ <code>expand_as()</code>å‡½æ•°æŒ‡å®šä¸º ç¤ºä¾‹ Tensor çš„ç»´åº¦ã€‚</p><p>!! <code>expand</code> æ‰©å¤§ tensor ä¸éœ€è¦åˆ†é…æ–°å†…å­˜ï¼Œåªæ˜¯ä»…ä»…æ–°å»ºä¸€ä¸ª tensor çš„è§†å›¾ï¼Œå…¶ä¸­é€šè¿‡å°† stride è®¾ä¸º0ï¼Œä¸€ç»´å°†ä¼šæ‰©å±•ä½æ›´é«˜ç»´ã€‚</p><p><code>repeat</code> æ²¿ç€æŒ‡å®šçš„ç»´åº¦é‡å¤ tensorã€‚ ä¸åŒäº <code>expand()</code>ï¼Œå¤åˆ¶çš„æ˜¯ tensor ä¸­çš„æ•°æ®ã€‚</p><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a = torch.rand(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>)<span class="hljs-meta">&gt;&gt;&gt; </span>atensor([[[<span class="hljs-number">0.3094</span>],         [<span class="hljs-number">0.4812</span>]],        [[<span class="hljs-number">0.0950</span>],         [<span class="hljs-number">0.8652</span>]]])<span class="hljs-meta">&gt;&gt;&gt; </span>a.expand(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>) <span class="hljs-comment"># å°†ç¬¬2ç»´çš„ç»´åº¦ç”±1å˜ä¸º3ï¼Œ åˆ™å¤åˆ¶è¯¥ç»´çš„å…ƒç´ ï¼Œå¹¶æ‰©å±•ä¸º3</span>tensor([[[<span class="hljs-number">0.3094</span>, <span class="hljs-number">0.3094</span>, <span class="hljs-number">0.3094</span>],         [<span class="hljs-number">0.4812</span>, <span class="hljs-number">0.4812</span>, <span class="hljs-number">0.4812</span>]],        [[<span class="hljs-number">0.0950</span>, <span class="hljs-number">0.0950</span>, <span class="hljs-number">0.0950</span>],         [<span class="hljs-number">0.8652</span>, <span class="hljs-number">0.8652</span>, <span class="hljs-number">0.8652</span>]]])<span class="hljs-meta">&gt;&gt;&gt; </span>a.repeat(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>) <span class="hljs-comment"># å°†ç¬¬äºŒä½å¤åˆ¶ä¸€æ¬¡</span>tensor([[[<span class="hljs-number">0.3094</span>],         [<span class="hljs-number">0.4812</span>],         [<span class="hljs-number">0.3094</span>],         [<span class="hljs-number">0.4812</span>]],        [[<span class="hljs-number">0.0950</span>],         [<span class="hljs-number">0.8652</span>],         [<span class="hljs-number">0.0950</span>],         [<span class="hljs-number">0.8652</span>]]])</code></pre><h5 id="ä½¿ç”¨åˆ‡ç‰‡æ“ä½œæ‰©å±•å¤šä¸ªç»´åº¦"><a href="#ä½¿ç”¨åˆ‡ç‰‡æ“ä½œæ‰©å±•å¤šä¸ªç»´åº¦" class="headerlink" title="ä½¿ç”¨åˆ‡ç‰‡æ“ä½œæ‰©å±•å¤šä¸ªç»´åº¦"></a>ä½¿ç”¨åˆ‡ç‰‡æ“ä½œæ‰©å±•å¤šä¸ªç»´åº¦</h5><pre><code class="hljs fortran">b = a[:,<span class="hljs-keyword">None</span>, <span class="hljs-keyword">None</span>,:] # <span class="hljs-keyword">None</span> å¤„çš„ç»´åº¦ä¸ºï¼‘</code></pre><h3 id="7-ç»„åˆä¸åˆ†å—"><a href="#7-ç»„åˆä¸åˆ†å—" class="headerlink" title="7. ç»„åˆä¸åˆ†å—"></a>7. ç»„åˆä¸åˆ†å—</h3><p><strong>ç»„åˆæ“ä½œ</strong> æ˜¯å°†ä¸åŒçš„ Tensor å åŠ èµ·æ¥ã€‚ ä¸»è¦æœ‰ <code>cat()</code> å’Œ <code>torch.stack()</code> ä¸¤ä¸ªå‡½æ•°ï¼Œcat å³ concatenate çš„æ„æ€ï¼Œ æ˜¯æŒ‡æ²¿ç€å·²æœ‰çš„æ•°æ®çš„æŸä¸€ç»´åº¦è¿›è¡Œæ‹¼æ¥ï¼Œ æ“ä½œåçš„æ•°æ®çš„æ€»ç»´æ•°ä¸å˜ï¼Œ åœ¨è¿›è¡Œæ‹¼æ¥æ—¶ï¼Œ é™¤äº†æ‹¼æ¥çš„ç»´åº¦ä¹‹å¤–ï¼Œ å…¶ä»–ç»´åº¦å¿…é¡»ç›¸åŒã€‚ è€Œ<code>torch. stack()</code> å‡½æ•°ä¼šæ–°å¢ä¸€ä¸ªç»´åº¦ï¼Œ å¹¶æŒ‰ç…§æŒ‡å®šçš„ç»´åº¦è¿›è¡Œå åŠ ã€‚</p><pre><code class="hljs shell">torch.cat(list_of_tensors, dim=0)ã€€  # k ä¸ª (m,n) -&gt; (k*m, n)torch.stack(list_of_tensors, dim=0)   # k ä¸ª (m,n) -&gt; (k*m*n)</code></pre><p><strong>åˆ†å—æ“ä½œ</strong> æ˜¯æŒ‡å°† Tensor åˆ†å‰²æˆä¸åŒçš„å­ Tensorï¼Œä¸»è¦æœ‰ <code>torch.chunk()</code> ä¸ <code>torch.split()</code> ä¸¤ä¸ªå‡½æ•°ï¼Œå‰è€…éœ€è¦æŒ‡å®šåˆ†å—çš„æ•°é‡ï¼Œè€Œåè€…åˆ™éœ€è¦æŒ‡å®šæ¯ä¸€å—çš„å¤§å°ï¼Œä»¥æ•´å½¢æˆ–è€…listæ¥è¡¨ç¤ºã€‚</p><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a = torch.Tensor([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], [<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>]])<span class="hljs-meta">&gt;&gt;&gt; </span>torch.chunk(a, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>)(tensor([[<span class="hljs-number">1.</span>, <span class="hljs-number">2.</span>, <span class="hljs-number">3.</span>]]), tensor([[<span class="hljs-number">4.</span>, <span class="hljs-number">5.</span>, <span class="hljs-number">6.</span>]]))<span class="hljs-meta">&gt;&gt;&gt; </span>torch.chunk(a, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>)(tensor([[<span class="hljs-number">1.</span>, <span class="hljs-number">2.</span>],        [<span class="hljs-number">4.</span>, <span class="hljs-number">5.</span>]]), tensor([[<span class="hljs-number">3.</span>],        [<span class="hljs-number">6.</span>]]))<span class="hljs-meta">&gt;&gt;&gt; </span>torch.split(a, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>)(tensor([[<span class="hljs-number">1.</span>, <span class="hljs-number">2.</span>, <span class="hljs-number">3.</span>],        [<span class="hljs-number">4.</span>, <span class="hljs-number">5.</span>, <span class="hljs-number">6.</span>]]),)<span class="hljs-meta">&gt;&gt;&gt; </span>torch.split(a, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], <span class="hljs-number">1</span>)(tensor([[<span class="hljs-number">1.</span>],        [<span class="hljs-number">4.</span>]]), tensor([[<span class="hljs-number">2.</span>, <span class="hljs-number">3.</span>],        [<span class="hljs-number">5.</span>, <span class="hljs-number">6.</span>]]))</code></pre><h3 id="8-linear-algebra"><a href="#8-linear-algebra" class="headerlink" title="8. linear algebra"></a>8. linear algebra</h3><pre><code class="hljs python">trace  <span class="hljs-comment"># å¯¹è§’çº¿å…ƒç´ ä¹‹å’Œ(çŸ©é˜µçš„è¿¹)</span>diag  <span class="hljs-comment"># å¯¹è§’çº¿å…ƒç´ </span>triu/tril  <span class="hljs-comment"># çŸ©é˜µçš„ä¸Šä¸‰è§’/ä¸‹ä¸‰è§’</span>addmm/addbmm/addmv/addr/badbmm...  <span class="hljs-comment"># çŸ©é˜µè¿ç®—</span>t <span class="hljs-comment"># è½¬ç½®</span>dor/cross <span class="hljs-comment"># å†…ç§¯/å¤–ç§¯</span>inverse <span class="hljs-comment"># çŸ©é˜µæ±‚é€†</span>svd  <span class="hljs-comment"># å¥‡å¼‚å€¼åˆ†è§£</span>torch.mm(tensor1, tensor2)   <span class="hljs-comment"># çŸ©é˜µä¹˜æ³•  (m*n) * (n*p) -&gt; (m*p)</span>torch.bmm(tensor1, tensor2) <span class="hljs-comment"># batchçš„çŸ©é˜µä¹˜æ³•: (b*m*n) * (b*n*p) -&gt; (b*m*p).</span>torch.mv(tensor, vec) <span class="hljs-comment">#ã€€çŸ©é˜µå‘é‡ä¹˜æ³• (m*n) * (n) = (m)</span>tensor1 * tensor2 <span class="hljs-comment"># Element-wise multiplication.</span></code></pre><h3 id="9-åŸºæœ¬æœºåˆ¶"><a href="#9-åŸºæœ¬æœºåˆ¶" class="headerlink" title="9. åŸºæœ¬æœºåˆ¶"></a>9. åŸºæœ¬æœºåˆ¶</h3><h5 id="å¹¿æ’­æœºåˆ¶"><a href="#å¹¿æ’­æœºåˆ¶" class="headerlink" title="å¹¿æ’­æœºåˆ¶"></a>å¹¿æ’­æœºåˆ¶</h5><p>ä¸åŒå½¢çŠ¶çš„ Tensor è¿›è¡Œè®¡ç®—æ—¶ï¼Œ å¯ä»¥è‡ªåŠ¨æ‰©å±•åˆ°è¾ƒå¤§çš„ç›¸åŒå½¢çŠ¶å†è¿›è¡Œè®¡ç®—ã€‚ å¹¿æ’­æœºåˆ¶çš„å‰ææ˜¯ä¸€ä¸ª Tensor  è‡³å°‘æœ‰ä¸€ä¸ªç»´åº¦ï¼Œä¸”ä»å°¾éƒ¨éå† Tensor æ—¶ï¼Œä¸¤è€…ç»´åº¦å¿…é¡»ç›¸ç­‰ï¼Œ å…¶ä¸­ä¸ƒä¸ªè¦ä¹ˆæ˜¯1ï¼Œ è¦ä¹ˆä¸å­˜åœ¨</p><h5 id="å‘é‡åŒ–æ“ä½œ"><a href="#å‘é‡åŒ–æ“ä½œ" class="headerlink" title="å‘é‡åŒ–æ“ä½œ"></a>å‘é‡åŒ–æ“ä½œ</h5><p>å¯ä»¥åœ¨åŒä¸€æ—¶é—´è¿›è¡Œæ‰¹é‡åœ°å¹¶è¡Œè®¡ç®—ï¼Œä¾‹å¦‚çŸ©é˜µè¿ç®—ï¼Œä»¥è¾¾åˆ°æ›´é«˜çš„è®¡ç®—æ•ˆç‡çš„ä¸€ç§æ–¹å¼:</p><h5 id="å…±äº«å†…å­˜æœºåˆ¶"><a href="#å…±äº«å†…å­˜æœºåˆ¶" class="headerlink" title="å…±äº«å†…å­˜æœºåˆ¶"></a>å…±äº«å†…å­˜æœºåˆ¶</h5><p>(1) ç›´æ¥é€šè¿‡ Tensor æ¥åˆå§‹åŒ–å¦ä¸€ä¸ª Tensorï¼Œ æˆ–è€…é€šè¿‡ Tensor çš„ç»„åˆã€åˆ†å—ã€ç´¢å¼•ã€å˜å½¢æ¥åˆå§‹åŒ–å¦ä¸€ä¸ªTensorï¼Œ åˆ™è¿™ä¸¤ä¸ª Tensor å…±äº«å†…å­˜:</p><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a = torch.randn(<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)<span class="hljs-meta">&gt;&gt;&gt; </span>b = a<span class="hljs-meta">&gt;&gt;&gt; </span>c = a.view(<span class="hljs-number">6</span>)<span class="hljs-meta">&gt;&gt;&gt; </span>b[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>] = <span class="hljs-number">0</span><span class="hljs-meta">&gt;&gt;&gt; </span>c[<span class="hljs-number">3</span>] = <span class="hljs-number">4</span><span class="hljs-meta">&gt;&gt;&gt; </span>atensor([[ <span class="hljs-number">0.0000</span>,  <span class="hljs-number">0.3898</span>, <span class="hljs-number">-0.7641</span>],        [ <span class="hljs-number">4.0000</span>,  <span class="hljs-number">0.6859</span>, <span class="hljs-number">-1.5179</span>]])</code></pre><p>(2) å¯¹äºä¸€äº›æ“ä½œé€šè¿‡åŠ åç¼€  â€œ_â€  å®ç° inplace æ“ä½œï¼Œ å¦‚ <code>add_()</code> å’Œ <code>resize_()</code> ç­‰ï¼Œ è¿™æ ·æ“ä½œåªè¦è¢«æ‰§è¡Œï¼Œ æœ¬èº«çš„ Tensor å°±ä¼šè¢«æ”¹å˜ã€‚</p><pre><code class="hljs angelscript">&gt;&gt;&gt; atensor([[ <span class="hljs-number">0.0000</span>,  <span class="hljs-number">0.3898</span>, <span class="hljs-number">-0.7641</span>],        [ <span class="hljs-number">4.0000</span>,  <span class="hljs-number">0.6859</span>, <span class="hljs-number">-1.5179</span>]])&gt;&gt;&gt; a.add_(a)tensor([[ <span class="hljs-number">0.0000</span>,  <span class="hljs-number">0.7796</span>, <span class="hljs-number">-1.5283</span>],        [ <span class="hljs-number">8.0000</span>,  <span class="hljs-number">1.3719</span>, <span class="hljs-number">-3.0358</span>]])</code></pre><p>(3) Tensorä¸ Numpy å¯ä»¥é«˜æ•ˆçš„å®Œæˆè½¬æ¢ï¼Œ å¹¶ä¸”è½¬æ¢å‰åçš„å˜é‡å…±äº«å†…å­˜ã€‚åœ¨è¿›è¡Œ Pytorch ä¸æ”¯æŒçš„æ“ä½œçš„æ—¶å€™ï¼Œ ç”šè‡³å¯ä»¥æ›²çº¿æ•‘å›½ï¼Œ å°† Tensor è½¬æ¢ä¸º Numpy ç±»å‹ï¼Œæ“ä½œåå†è½¬åŒ–ä¸º Tensor</p><pre><code class="hljs clean"># tensor &lt;--&gt; numpyb = a.numpy() # tensor -&gt; numpya = torch.from_numpy(a) # numpy -&gt; tensor</code></pre><p>!!! éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>torch.tensor()</code> æ€»æ˜¯ä¼šè¿›è¡Œæ•°æ®æ‹·è´ï¼Œæ–° tensor å’ŒåŸæ¥çš„æ•°æ®ä¸å†å…±äº«å†…å­˜ã€‚æ‰€ä»¥å¦‚æœä½ æƒ³å…±äº«å†…å­˜çš„è¯ï¼Œå»ºè®®ä½¿ç”¨ <code>torch.from_numpy()</code> æˆ–è€… <code>tensor.detach()</code> æ¥æ–°å»ºä¸€ä¸ª tensor, äºŒè€…å…±äº«å†…å­˜ã€‚</p><h3 id="10-nn"><a href="#10-nn" class="headerlink" title="10. nn"></a>10. nn</h3><pre><code class="hljs python"><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn<span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F</code></pre><h5 id="pad-å¡«å……"><a href="#pad-å¡«å……" class="headerlink" title="pad å¡«å……"></a>pad å¡«å……</h5><pre><code class="hljs python">nn.ConstantPad2d(padding, value)</code></pre><h5 id="å·ç§¯å’Œåå·ç§¯"><a href="#å·ç§¯å’Œåå·ç§¯" class="headerlink" title="å·ç§¯å’Œåå·ç§¯"></a>å·ç§¯å’Œåå·ç§¯</h5><pre><code class="hljs python">nn.Conv2d(in_channels, out_channels, kernel_size, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>, dilation=<span class="hljs-number">1</span>, groups=<span class="hljs-number">1</span>, bias=<span class="hljs-literal">True</span>)nn.ConvTranspose2d(in_channels, out_channels, kernel_size, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>, output_padding=<span class="hljs-number">0</span>, groups=<span class="hljs-number">1</span>, bias=<span class="hljs-literal">True</span>, dilation=<span class="hljs-number">1</span>)</code></pre><pre><code class="hljs python"><span class="hljs-comment">#ã€€æœ€å¸¸ç”¨çš„ä¸¤ç§å·ç§¯å±‚è®¾è®¡ 3x3 &amp; 1x1</span>conv = torch.nn.Conv2d(in_channels, out_channels, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span>, bias=<span class="hljs-literal">True</span>)conv = torch.nn.Conv2d(in_channels, out_channels, kernel_size=<span class="hljs-number">1</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>, bias=<span class="hljs-literal">True</span>)</code></pre><h5 id="æ± åŒ–å±‚"><a href="#æ± åŒ–å±‚" class="headerlink" title="æ± åŒ–å±‚"></a>æ± åŒ–å±‚</h5><pre><code class="hljs python">nn.MaxPool2d(kernel_size, stride=<span class="hljs-literal">None</span>, padding=<span class="hljs-number">0</span>, dilation=<span class="hljs-number">1</span>, return_indices=<span class="hljs-literal">False</span>, ceil_mode=<span class="hljs-literal">False</span>)nn.AvgPool2d(kernel_size, stride=<span class="hljs-literal">None</span>, padding=<span class="hljs-number">0</span>, ceil_mode=<span class="hljs-literal">False</span>, count_include_pad=<span class="hljs-literal">True</span>)nn.AdaptiveMaxPool2d(output_size, return_indices=<span class="hljs-literal">False</span>)nn.AdaptiveAvgPool2d(output_size)  <span class="hljs-comment"># global avg pool: output_size=1</span>nn.MaxUnpool2d(kernel_size, stride=<span class="hljs-literal">None</span>, padding=<span class="hljs-number">0</span>)</code></pre><h5 id="å…¨è¿æ¥å±‚"><a href="#å…¨è¿æ¥å±‚" class="headerlink" title="å…¨è¿æ¥å±‚"></a>å…¨è¿æ¥å±‚</h5><pre><code class="hljs python">nn.Linear(in_features, out_features, bias=<span class="hljs-literal">True</span>)</code></pre><h5 id="é˜²æ­¢è¿‡æ‹Ÿåˆç›¸å…³å±‚"><a href="#é˜²æ­¢è¿‡æ‹Ÿåˆç›¸å…³å±‚" class="headerlink" title="é˜²æ­¢è¿‡æ‹Ÿåˆç›¸å…³å±‚"></a>é˜²æ­¢è¿‡æ‹Ÿåˆç›¸å…³å±‚</h5><pre><code class="hljs python">nn.Dropout2d(p=<span class="hljs-number">0.5</span>, inplace=<span class="hljs-literal">False</span>)nn.AlphaDropout(p=<span class="hljs-number">0.5</span>)nn.BatchNorm2d(num_features, eps=<span class="hljs-number">1e-05</span>, momentum=<span class="hljs-number">0.1</span>, affine=<span class="hljs-literal">True</span>, track_running_stats=<span class="hljs-literal">True</span>)</code></pre><h5 id="æ¿€æ´»å‡½æ•°"><a href="#æ¿€æ´»å‡½æ•°" class="headerlink" title="æ¿€æ´»å‡½æ•°"></a>æ¿€æ´»å‡½æ•°</h5><pre><code class="hljs python">nn.Softplus(beta=<span class="hljs-number">1</span>, threshold=<span class="hljs-number">20</span>)nn.Tanh()nn.ReLU(inplace=<span class="hljs-literal">False</span>)    nn.ReLU6(inplace=<span class="hljs-literal">False</span>)nn.LeakyReLU(negative_slope=<span class="hljs-number">0.01</span>, inplace=<span class="hljs-literal">False</span>)nn.PReLU(num_parameters=<span class="hljs-number">1</span>, init=<span class="hljs-number">0.25</span>)nn.SELU(inplace=<span class="hljs-literal">False</span>)nn.ELU(alpha=<span class="hljs-number">1.0</span>, inplace=<span class="hljs-literal">False</span>)</code></pre><h5 id="RNN"><a href="#RNN" class="headerlink" title="RNN"></a>RNN</h5><pre><code class="hljs python">nn.RNNCell(input_size, hidden_size, bias=<span class="hljs-literal">True</span>, nonlinearity=<span class="hljs-string">&#x27;tanh&#x27;</span>)nn.RNN(*args, **kwargs)nn.LSTMCell(input_size, hidden_size, bias=<span class="hljs-literal">True</span>)nn.LSTM(*args, **kwargs)nn.GRUCell(input_size, hidden_size, bias=<span class="hljs-literal">True</span>)nn.GRU(*args, **kwargs)</code></pre><h5 id="Embedding"><a href="#Embedding" class="headerlink" title="Embedding"></a>Embedding</h5><pre><code class="hljs python">nn.Embedding(num_embeddings, embedding_dim, padding_idx=<span class="hljs-literal">None</span>, max_norm=<span class="hljs-literal">None</span>, norm_type=<span class="hljs-number">2</span>, scale_grad_by_freq=<span class="hljs-literal">False</span>, sparse=<span class="hljs-literal">False</span>, _weight=<span class="hljs-literal">None</span>)</code></pre><h5 id="Sequential"><a href="#Sequential" class="headerlink" title="Sequential"></a>Sequential</h5><pre><code class="hljs python">nn.Sequential(*args)</code></pre><h5 id="loss-functon"><a href="#loss-functon" class="headerlink" title="loss functon"></a>loss functon</h5><pre><code class="hljs python">nn.BCELoss(weight=<span class="hljs-literal">None</span>, size_average=<span class="hljs-literal">True</span>, reduce=<span class="hljs-literal">True</span>)nn.CrossEntropyLoss(weight=<span class="hljs-literal">None</span>, size_average=<span class="hljs-literal">True</span>, ignore_index=<span class="hljs-number">-100</span>, reduce=<span class="hljs-literal">True</span>)<span class="hljs-comment"># CrossEntropyLoss ç­‰ä»·äº log_softmax + NLLLoss</span>nn.L1Loss(size_average=<span class="hljs-literal">True</span>, reduce=<span class="hljs-literal">True</span>)nn.KLDivLoss(size_average=<span class="hljs-literal">True</span>, reduce=<span class="hljs-literal">True</span>)nn.MSELoss(size_average=<span class="hljs-literal">True</span>, reduce=<span class="hljs-literal">True</span>)nn.NLLLoss(weight=<span class="hljs-literal">None</span>, size_average=<span class="hljs-literal">True</span>, ignore_index=<span class="hljs-number">-100</span>, reduce=<span class="hljs-literal">True</span>)nn.NLLLoss2d(weight=<span class="hljs-literal">None</span>, size_average=<span class="hljs-literal">True</span>, ignore_index=<span class="hljs-number">-100</span>, reduce=<span class="hljs-literal">True</span>)nn.SmoothL1Loss(size_average=<span class="hljs-literal">True</span>, reduce=<span class="hljs-literal">True</span>)nn.SoftMarginLoss(size_average=<span class="hljs-literal">True</span>, reduce=<span class="hljs-literal">True</span>)nn.TripletMarginLoss(margin=<span class="hljs-number">1.0</span>, p=<span class="hljs-number">2</span>, eps=<span class="hljs-number">1e-06</span>, swap=<span class="hljs-literal">False</span>, size_average=<span class="hljs-literal">True</span>, reduce=<span class="hljs-literal">True</span>)nn.CosineEmbeddingLoss(margin=<span class="hljs-number">0</span>, size_average=<span class="hljs-literal">True</span>, reduce=<span class="hljs-literal">True</span>)</code></pre><h5 id="functional"><a href="#functional" class="headerlink" title="functional"></a>functional</h5><pre><code class="hljs python">nn.functional <span class="hljs-comment"># nnä¸­çš„å¤§å¤šæ•°layerï¼Œåœ¨functionalä¸­éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹ç›¸å¯¹åº”çš„å‡½æ•°ã€‚</span>              <span class="hljs-comment"># nn.functionalä¸­çš„å‡½æ•°å’Œnn.Moduleçš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œ</span>              <span class="hljs-comment"># ç”¨nn.Moduleå®ç°çš„layersæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç±»ï¼Œéƒ½æ˜¯ç”± class layer(nn.Module)å®šä¹‰ï¼Œ</span>              <span class="hljs-comment"># ä¼šè‡ªåŠ¨æå–å¯å­¦ä¹ çš„å‚æ•°ã€‚è€Œnn.functionalä¸­çš„å‡½æ•°æ›´åƒæ˜¯çº¯å‡½æ•°ï¼Œ</span>              <span class="hljs-comment"># ç”±def function(input)å®šä¹‰ã€‚</span></code></pre><h5 id="init"><a href="#init" class="headerlink" title="init"></a>init</h5><pre><code class="hljs python">torch.nn.init.uniformtorch.nn.init.normaltorch.nn.init.kaiming_uniformtorch.nn.init.kaiming_normaltorch.nn.init.xavier_normaltorch.nn.init.xavier_uniformtorch.nn.init.sparse</code></pre><h5 id="net"><a href="#net" class="headerlink" title="net"></a>net</h5><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">net_name</span>(<span class="hljs-params">nn.Module</span>):</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span>        super(net_name, self).__init__()        self.layer_name = xxxx    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">self, x</span>):</span>         x = self.layer_name(x)                <span class="hljs-keyword">return</span> xnet.parameters()   <span class="hljs-comment"># è·å–å‚æ•° </span>net.named_parameters  <span class="hljs-comment"># è·å–å‚æ•°åŠåç§°</span>net.zero_grad()  <span class="hljs-comment"># ç½‘ç»œæ‰€æœ‰æ¢¯åº¦æ¸…é›¶, grad åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­æ˜¯ç´¯åŠ çš„(accumulated)ï¼Œ</span>                 <span class="hljs-comment"># è¿™æ„å‘³ç€æ¯ä¸€æ¬¡è¿è¡Œåå‘ä¼ æ’­ï¼Œæ¢¯åº¦éƒ½ä¼šç´¯åŠ ä¹‹å‰çš„æ¢¯åº¦ï¼Œæ‰€ä»¥åå‘ä¼ æ’­ä¹‹å‰éœ€æŠŠæ¢¯åº¦æ¸…é›¶ã€‚</span></code></pre><h3 id="11-optim-gt-form-torch-import-optim"><a href="#11-optim-gt-form-torch-import-optim" class="headerlink" title="11. optim -&gt; form torch import optim"></a>11. optim -&gt; form torch import optim</h3><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch.optim <span class="hljs-keyword">as</span> optimoptim.SGD(params, lr=<span class="hljs-number">0.01</span>, momentum=<span class="hljs-number">0</span>, dampening=<span class="hljs-number">0</span>, weight_decay=<span class="hljs-number">0</span>, nesterov=<span class="hljs-literal">False</span>)optim.ASGD(params, lr=<span class="hljs-number">0.01</span>, lambd=<span class="hljs-number">0.0001</span>, alpha=<span class="hljs-number">0.75</span>, t0=<span class="hljs-number">1000000.0</span>, weight_decay=<span class="hljs-number">0</span>)optim.LBFGS(params, lr=<span class="hljs-number">1</span>, max_iter=<span class="hljs-number">20</span>, max_eval=<span class="hljs-literal">None</span>, tolerance_grad=<span class="hljs-number">1e-05</span>, tolerance_change=<span class="hljs-number">1e-09</span>, history_size=<span class="hljs-number">100</span>, line_search_fn=<span class="hljs-literal">None</span>)optim.RMSprop(params, lr=<span class="hljs-number">0.01</span>, alpha=<span class="hljs-number">0.99</span>, eps=<span class="hljs-number">1e-08</span>, weight_decay=<span class="hljs-number">0</span>, momentum=<span class="hljs-number">0</span>, centered=<span class="hljs-literal">False</span>)optim.Rprop(params, lr=<span class="hljs-number">0.01</span>, etas=(<span class="hljs-number">0.5</span>, <span class="hljs-number">1.2</span>), step_sizes=(<span class="hljs-number">1e-06</span>, <span class="hljs-number">50</span>))optim.Adadelta(params, lr=<span class="hljs-number">1.0</span>, rho=<span class="hljs-number">0.9</span>, eps=<span class="hljs-number">1e-06</span>, weight_decay=<span class="hljs-number">0</span>)optim.Adagrad(params, lr=<span class="hljs-number">0.01</span>, lr_decay=<span class="hljs-number">0</span>, weight_decay=<span class="hljs-number">0</span>, initial_accumulator_value=<span class="hljs-number">0</span>)optim.Adam(params, lr=<span class="hljs-number">0.001</span>, betas=(<span class="hljs-number">0.9</span>, <span class="hljs-number">0.999</span>), eps=<span class="hljs-number">1e-08</span>, weight_decay=<span class="hljs-number">0</span>, amsgrad=<span class="hljs-literal">False</span>)optim.Adamax(params, lr=<span class="hljs-number">0.002</span>, betas=(<span class="hljs-number">0.9</span>, <span class="hljs-number">0.999</span>), eps=<span class="hljs-number">1e-08</span>, weight_decay=<span class="hljs-number">0</span>)optim.SparseAdam(params, lr=<span class="hljs-number">0.001</span>, betas=(<span class="hljs-number">0.9</span>, <span class="hljs-number">0.999</span>), eps=<span class="hljs-number">1e-08</span>)optim.Optimizer(params, defaults)optimizer.zero_grad()  <span class="hljs-comment"># ç­‰ä»·äº net.zero_grad() </span>optimizer.step()</code></pre><h3 id="12-learning-rate"><a href="#12-learning-rate" class="headerlink" title="12.  learning rate"></a>12.  learning rate</h3><pre><code class="hljs python"><span class="hljs-comment"># Reduce learning rate when validation accuarcy plateau.</span>scheduler = torch.optim.lr_scheduler.ReduceLROnPlateau(optimizer, mode=<span class="hljs-string">&#x27;max&#x27;</span>, patience=<span class="hljs-number">5</span>, verbose=<span class="hljs-literal">True</span>)<span class="hljs-comment"># Cosine annealing learning rate.</span>scheduler = torch.optim.lr_scheduler.CosineAnnealingLR(optimizer, T_max=<span class="hljs-number">80</span>)<span class="hljs-comment"># Reduce learning rate by 10 at given epochs.</span>scheduler = torch.optim.lr_scheduler.MultiStepLR(optimizer, milestones=[<span class="hljs-number">50</span>, <span class="hljs-number">70</span>], gamma=<span class="hljs-number">0.1</span>)<span class="hljs-comment"># Learning rate warmup by 10 epochs.</span>scheduler = torch.optim.lr_scheduler.LambdaLR(optimizer, lr_lambda=<span class="hljs-keyword">lambda</span> t: t / <span class="hljs-number">10</span>)<span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>):    scheduler.step()    train(...); val(...)</code></pre><h3 id="12-save-and-load-model"><a href="#12-save-and-load-model" class="headerlink" title="12. save and load model"></a>12. save and load model</h3><pre><code class="hljs python">torch.save(model.state_dict(), <span class="hljs-string">&#x27;xxxx_params.pth&#x27;</span>)model.load_state_dict(t.load(<span class="hljs-string">&#x27;xxxx_params.pth&#x27;</span>))torch.save(model, <span class="hljs-string">&#x27;xxxx.pth&#x27;</span>)model.torch.load(<span class="hljs-string">&#x27;xxxx.pth&#x27;</span>)all_data = dict(    optimizer = optimizer.state_dict(),    model = model.state_dict(),    info = <span class="hljs-string">u&#x27;model and optim parameter&#x27;</span>)t.save(all_data, <span class="hljs-string">&#x27;xxx.pth&#x27;</span>)all_data = t.load(<span class="hljs-string">&#x27;xxx.pth&#x27;</span>)all_data.keys()</code></pre><h3 id="13-torchvision"><a href="#13-torchvision" class="headerlink" title="13. torchvision"></a>13. torchvision</h3><h5 id="models"><a href="#models" class="headerlink" title="models"></a>models</h5><pre><code class="hljs python"><span class="hljs-keyword">from</span> torchvision <span class="hljs-keyword">import</span> modelsresnet34 = models.resnet34(pretrained=<span class="hljs-literal">True</span>, num_classes=<span class="hljs-number">1000</span>)</code></pre><h5 id="data-augmentation"><a href="#data-augmentation" class="headerlink" title="data augmentation"></a>data augmentation</h5><pre><code class="hljs python"><span class="hljs-keyword">from</span> torchvision <span class="hljs-keyword">import</span> transforms<span class="hljs-comment"># transforms.CenterCrop           transforms.Grayscale           transforms.ColorJitter          </span><span class="hljs-comment"># transforms.Lambda               transforms.Compose             transforms.LinearTransformation </span><span class="hljs-comment"># transforms.FiveCrop             transforms.Normalize           transforms.functional           </span><span class="hljs-comment"># transforms.Pad                  transforms.RandomAffine        transforms.RandomHorizontalFlip  </span><span class="hljs-comment"># transforms.RandomApply          transforms.RandomOrder         transforms.RandomChoice         </span><span class="hljs-comment"># transforms.RandomResizedCrop    transforms.RandomCrop          transforms.RandomRotation        </span><span class="hljs-comment"># transforms.RandomGrayscale      transforms.RandomSizedCrop     transforms.RandomVerticalFlip   </span><span class="hljs-comment"># transforms.ToTensor             transforms.Resize              transforms.transforms                                           </span><span class="hljs-comment"># transforms.TenCrop              transforms.Scale               transforms.ToPILImage</span></code></pre><h5 id="è‡ªå®šä¹‰-dataset"><a href="#è‡ªå®šä¹‰-dataset" class="headerlink" title="è‡ªå®šä¹‰ dataset"></a>è‡ªå®šä¹‰ dataset</h5><pre><code class="hljs python"><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> Dataset<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">my_data</span>(<span class="hljs-params">Dataset</span>):</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, image_path, annotation_path, transform=None</span>):</span>        <span class="hljs-comment"># åˆå§‹åŒ–ï¼Œ è¯»å–æ•°æ®é›†</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__len__</span>(<span class="hljs-params">self</span>):</span>        <span class="hljs-comment"># è·å–æ•°æ®é›†çš„æ€»å¤§å°</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__getitem__</span>(<span class="hljs-params">self, id</span>):</span>        <span class="hljs-comment"># å¯¹äºåˆ¶å®šçš„ id, è¯»å–è¯¥æ•°æ®å¹¶è¿”å›    </span></code></pre><p><strong>datasets</strong></p><pre><code class="hljs python"><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> Dataset, Dataloader<span class="hljs-keyword">from</span> torchvision.transforms <span class="hljs-keyword">as</span> transformstransform = transforms.Compose([        transforms.ToTensor(), <span class="hljs-comment"># convert to Tensor</span>        transforms.Normalize((<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>), (<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>))]) <span class="hljs-comment"># normalization</span>dataset = ImageFolder(root, transform=transform, target_transform=<span class="hljs-literal">None</span>, loader=default_loader)dataloader = DataLoader(dataset, <span class="hljs-number">2</span>, collate_fn=my_collate_fn, num_workers=<span class="hljs-number">1</span>,shuffle=<span class="hljs-literal">True</span>)<span class="hljs-keyword">for</span> batch_datas, batch_labels <span class="hljs-keyword">in</span> dataloader:    ...</code></pre><h5 id="img-process"><a href="#img-process" class="headerlink" title="img process"></a>img process</h5><pre><code class="hljs python">img = make_grid(next(dataiter)[<span class="hljs-number">0</span>], <span class="hljs-number">4</span>) save_image(img, <span class="hljs-string">&#x27;a.png&#x27;</span>)</code></pre><h5 id="data-Visualization"><a href="#data-Visualization" class="headerlink" title="data Visualization"></a>data Visualization</h5><pre><code class="hljs python"><span class="hljs-keyword">from</span> torchvision.transforms <span class="hljs-keyword">import</span> ToPILImageshow = ToPILImage()  <span class="hljs-comment"># å¯ä»¥æŠŠTensorè½¬æˆImageï¼Œæ–¹ä¾¿å¯è§†åŒ–</span>(data, label) = trainset[<span class="hljs-number">100</span>]show((data + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>).resize((<span class="hljs-number">100</span>, <span class="hljs-number">100</span>))  <span class="hljs-comment"># åº”è¯¥ä¼šè‡ªåŠ¨ä¹˜ä»¥ 255 çš„</span></code></pre><h3 id="14-Code-Samples"><a href="#14-Code-Samples" class="headerlink" title="14. Code Samples"></a>14. Code Samples</h3><pre><code class="hljs python"><span class="hljs-comment"># torch.device object used throughout this script</span>device = torch.device(<span class="hljs-string">&quot;cuda&quot;</span> <span class="hljs-keyword">if</span> use_cuda <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;cpu&quot;</span>)model = MyRNN().to(device)<span class="hljs-comment"># train</span>total_loss = <span class="hljs-number">0</span><span class="hljs-keyword">for</span> input, target <span class="hljs-keyword">in</span> train_loader:    input, target = input.to(device), target.to(device)    hidden = input.new_zeros(*h_shape)  <span class="hljs-comment"># has the same device &amp; dtype as `input`</span>    ...  <span class="hljs-comment"># get loss and optimize</span>    total_loss += loss.item()           <span class="hljs-comment"># get Python number from 1-element Tensor</span><span class="hljs-comment"># evaluate</span><span class="hljs-keyword">with</span> torch.no_grad():                   <span class="hljs-comment"># operations inside don&#x27;t track history</span>    <span class="hljs-keyword">for</span> input, target <span class="hljs-keyword">in</span> test_loader:        ...</code></pre><h3 id="15-jit-amp-torchscript"><a href="#15-jit-amp-torchscript" class="headerlink" title="15. jit &amp; torchscript"></a>15. jit &amp; torchscript</h3><pre><code class="hljs python"><span class="hljs-keyword">from</span> torch.jit <span class="hljs-keyword">import</span> script, tracetorch.jit.trace(model, torch.rand(<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">224</span>,<span class="hljs-number">224</span>)) ã€€<span class="hljs-comment"># export model</span><span class="hljs-meta">@torch.jit.script</span></code></pre><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;torch/torch.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;torch/script.h&gt;</span></span><span class="hljs-meta"># img blob -&gt; img tensor</span>torch::Tensor img_tensor = torch::from_blob(image.data, &#123;<span class="hljs-number">1</span>, image.rows, image.cols, <span class="hljs-number">3</span>&#125;, torch::kByte);img_tensor = img_tensor.permute(&#123;<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;);img_tensor = img_tensor.toType(torch::kFloat);img_tensor = img_tensor.div(<span class="hljs-number">255</span>);<span class="hljs-meta"># load model</span><span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;torch::jit::script::Module&gt; <span class="hljs-keyword">module</span> = torch::jit::load(<span class="hljs-string">&quot;resnet.pt&quot;</span>);<span class="hljs-meta"># forward</span>torch::Tensor output = <span class="hljs-keyword">module</span>-&gt;forward(&#123;img_tensor&#125;).toTensor();</code></pre><h3 id="16-onnx"><a href="#16-onnx" class="headerlink" title="16. onnx"></a>16. onnx</h3><pre><code class="hljs python">torch.onnx.export(model, dummy data, xxxx.proto) <span class="hljs-comment"># exports an ONNX formatted</span>model = onnx.load(<span class="hljs-string">&quot;alexnet.proto&quot;</span>)               <span class="hljs-comment"># load an ONNX model</span>onnx.checker.check_model(model)                  <span class="hljs-comment"># check that the model</span>onnx.helper.printable_graph(model.graph)         <span class="hljs-comment"># print a human readableã€€representation of the graph</span></code></pre><h3 id="17-Distributed-Training"><a href="#17-Distributed-Training" class="headerlink" title="17. Distributed Training"></a>17. Distributed Training</h3><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch.distributed <span class="hljs-keyword">as</span> dist          <span class="hljs-comment"># distributed communication</span><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process       <span class="hljs-comment"># memory sharing processes</span></code></pre>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>The next step of machine learning</title>
    <link href="/2019/03/08/The-next-step-of-machine-learning/"/>
    <url>/2019/03/08/The-next-step-of-machine-learning/</url>
    
    <content type="html"><![CDATA[<p>ğŸ” The next step of machine learning (æœºå™¨å­¦ä¹ ä¸‹ä¸€æ­¥çš„å¯èƒ½çš„å‘å±•æ–¹å‘)</p><a id="more"></a><h3 id="The-next-step-of-machine-learningï¼š"><a href="#The-next-step-of-machine-learningï¼š" class="headerlink" title="The next step of machine learningï¼š"></a>The next step of machine learningï¼š</h3><h5 id="1-Anomaly-Detectionï¼ˆè®©æœºå™¨çŸ¥é“æˆ‘ä¸çŸ¥é“ï¼‰"><a href="#1-Anomaly-Detectionï¼ˆè®©æœºå™¨çŸ¥é“æˆ‘ä¸çŸ¥é“ï¼‰" class="headerlink" title="1.Anomaly Detectionï¼ˆè®©æœºå™¨çŸ¥é“æˆ‘ä¸çŸ¥é“ï¼‰"></a>1.Anomaly Detectionï¼ˆè®©æœºå™¨çŸ¥é“æˆ‘ä¸çŸ¥é“ï¼‰</h5><h5 id="2-Explainable-AIï¼ˆå¯è§£é‡Šæ€§AIï¼‰"><a href="#2-Explainable-AIï¼ˆå¯è§£é‡Šæ€§AIï¼‰" class="headerlink" title="2.Explainable AIï¼ˆå¯è§£é‡Šæ€§AIï¼‰"></a>2.Explainable AIï¼ˆå¯è§£é‡Šæ€§AIï¼‰</h5><h5 id="3-Adversarial-attackï¼ˆå¯¹æŠ—æ”»å‡»ï¼‰"><a href="#3-Adversarial-attackï¼ˆå¯¹æŠ—æ”»å‡»ï¼‰" class="headerlink" title="3.Adversarial attackï¼ˆå¯¹æŠ—æ”»å‡»ï¼‰"></a>3.Adversarial attackï¼ˆå¯¹æŠ—æ”»å‡»ï¼‰</h5><h5 id="4-Life-long-Learningï¼ˆç»ˆèº«å­¦ä¹ ï¼‰"><a href="#4-Life-long-Learningï¼ˆç»ˆèº«å­¦ä¹ ï¼‰" class="headerlink" title="4.Life-long Learningï¼ˆç»ˆèº«å­¦ä¹ ï¼‰"></a>4.Life-long Learningï¼ˆç»ˆèº«å­¦ä¹ ï¼‰</h5><h5 id="5-Meta-learning-Learning-to-learnï¼ˆå­¦ä¼šå¦‚ä½•å­¦ä¹ ï¼‰"><a href="#5-Meta-learning-Learning-to-learnï¼ˆå­¦ä¼šå¦‚ä½•å­¦ä¹ ï¼‰" class="headerlink" title="5.Meta-learning/Learning to learnï¼ˆå­¦ä¼šå¦‚ä½•å­¦ä¹ ï¼‰"></a>5.Meta-learning/Learning to learnï¼ˆå­¦ä¼šå¦‚ä½•å­¦ä¹ ï¼‰</h5><h5 id="6-Few-shot-learning-Zero-shot-Learningï¼ˆå°æ ·æœ¬å­¦ä¹ ï¼‰"><a href="#6-Few-shot-learning-Zero-shot-Learningï¼ˆå°æ ·æœ¬å­¦ä¹ ï¼‰" class="headerlink" title="6.Few-shot learning/Zero-shot Learningï¼ˆå°æ ·æœ¬å­¦ä¹ ï¼‰"></a>6.Few-shot learning/Zero-shot Learningï¼ˆå°æ ·æœ¬å­¦ä¹ ï¼‰</h5><h5 id="7-how-to-use-reinforcement-Learning-effectivelyï¼Ÿï¼ˆæœ‰æ•ˆä½¿ç”¨å¢å¼ºå­¦ä¹ ï¼‰"><a href="#7-how-to-use-reinforcement-Learning-effectivelyï¼Ÿï¼ˆæœ‰æ•ˆä½¿ç”¨å¢å¼ºå­¦ä¹ ï¼‰" class="headerlink" title="7.how to use reinforcement Learning  effectivelyï¼Ÿï¼ˆæœ‰æ•ˆä½¿ç”¨å¢å¼ºå­¦ä¹ ï¼‰"></a>7.how to use reinforcement Learning  effectivelyï¼Ÿï¼ˆæœ‰æ•ˆä½¿ç”¨å¢å¼ºå­¦ä¹ ï¼‰</h5><h5 id="8-Network-Compressionï¼ˆç¥ç»ç½‘ç»œå‹ç¼©ï¼‰"><a href="#8-Network-Compressionï¼ˆç¥ç»ç½‘ç»œå‹ç¼©ï¼‰" class="headerlink" title="8.Network Compressionï¼ˆç¥ç»ç½‘ç»œå‹ç¼©ï¼‰"></a>8.Network Compressionï¼ˆç¥ç»ç½‘ç»œå‹ç¼©ï¼‰</h5><h5 id="9-Unsupervised-Domain-Adaptationï¼ˆé¢†åŸŸè‡ªé€‚åº”ï¼‰"><a href="#9-Unsupervised-Domain-Adaptationï¼ˆé¢†åŸŸè‡ªé€‚åº”ï¼‰" class="headerlink" title="9.Unsupervised Domain Adaptationï¼ˆé¢†åŸŸè‡ªé€‚åº”ï¼‰"></a>9.Unsupervised Domain Adaptationï¼ˆé¢†åŸŸè‡ªé€‚åº”ï¼‰</h5><h5 id="10-Weak-Supervision-unsupervised-learning-å¾®ç›‘ç£-æ— ç›‘ç£"><a href="#10-Weak-Supervision-unsupervised-learning-å¾®ç›‘ç£-æ— ç›‘ç£" class="headerlink" title="10.Weak Supervision/unsupervised learning(å¾®ç›‘ç£/æ— ç›‘ç£)"></a>10.Weak Supervision/unsupervised learning(å¾®ç›‘ç£/æ— ç›‘ç£)</h5><h5 id="11-Video-understanding-ï¼ˆè§†é¢‘ç†è§£ï¼‰"><a href="#11-Video-understanding-ï¼ˆè§†é¢‘ç†è§£ï¼‰" class="headerlink" title="11.Video understanding ï¼ˆè§†é¢‘ç†è§£ï¼‰"></a>11.Video understanding ï¼ˆè§†é¢‘ç†è§£ï¼‰</h5><h5 id="12-Graph-networkï¼ˆå›¾ç½‘ç»œï¼‰"><a href="#12-Graph-networkï¼ˆå›¾ç½‘ç»œï¼‰" class="headerlink" title="12.Graph networkï¼ˆå›¾ç½‘ç»œï¼‰"></a>12.Graph networkï¼ˆå›¾ç½‘ç»œï¼‰</h5><h5 id="13-Transfer-learningï¼ˆè¿ç§»å­¦ä¹ ï¼‰"><a href="#13-Transfer-learningï¼ˆè¿ç§»å­¦ä¹ ï¼‰" class="headerlink" title="13.Transfer learningï¼ˆè¿ç§»å­¦ä¹ ï¼‰"></a>13.Transfer learningï¼ˆè¿ç§»å­¦ä¹ ï¼‰</h5>]]></content>
    
    
    
    <tags>
      
      <tag>Explore</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Deep Learning Toolbox</title>
    <link href="/2018/09/08/Deep-Learning-Toolbox/"/>
    <url>/2018/09/08/Deep-Learning-Toolbox/</url>
    
    <content type="html"><![CDATA[<h2 id="ğŸ”§-Deep-Learning-toolbox"><a href="#ğŸ”§-Deep-Learning-toolbox" class="headerlink" title="ğŸ”§ Deep Learning toolbox"></a>ğŸ”§ Deep Learning toolbox</h2><a id="more"></a><h4 id="ğŸ“š-Datasets-search"><a href="#ğŸ“š-Datasets-search" class="headerlink" title="ğŸ“š Datasets search"></a>ğŸ“š Datasets search</h4><ol><li><p><a href="https://www.kaggle.com"><strong>Kaggle</strong></a> </p></li><li><p><a href="https://toolbox.google.com/datasetsearch"><strong>Google Datasets Search Engine</strong></a></p></li><li><p><a href="https://msropendata.com"><strong>Microsoft Datasets</strong></a></p></li><li><p><a href="https://www.visualdata.io"><strong>Computer Vision Datasets</strong></a></p></li><li><p><a href="https://github.com/awesomedata/awesome-public-datasets"><strong>Github awesomedata</strong></a></p></li><li><p><a href="https://archive.ics.uci.edu/ml/datasets.html"><strong>UCI Machine Learning Repository.</strong></a></p></li><li><p><a href="https://registry.opendata.aws"><strong>Amazon Datasets</strong></a></p></li><li><p><strong>Government Datasets:</strong> <a href="https://data.europa.eu/euodp/data/dataset"><strong>EU</strong></a>                 <a href="https://www.data.gov/"><strong>US</strong></a>                 <a href="https://catalogue.data.govt.nz/dataset"><strong>NZL</strong></a>                <a href="https://data.gov.in/"><strong>IND</strong></a>  </p></li></ol><h4 id="ğŸ”-Visualizing-neural-network-architectures"><a href="#ğŸ”-Visualizing-neural-network-architectures" class="headerlink" title="ğŸ” Visualizing neural network architectures"></a>ğŸ” Visualizing neural network architectures</h4><ol><li><a href="https://github.com/lutzroeder/Netron"><strong>Netron:</strong></a>  now supports <strong>ONNX</strong>, <strong>Keras</strong>, <strong>CoreML</strong>, <strong>Caffe2</strong>, <strong>Mxnet</strong>, <strong>Pytorch</strong> and <strong>Tensorflow</strong>.</li><li><a href="https://ethereon.github.io/netscope/#/editor"><strong>Netscope:</strong></a>  or  <strong>GraphViz</strong>:   <strong>Caffe</strong>       </li><li><a href="https://github.com/tensorflow/tensorboard"><strong>TensorBoard:</strong></a>   <strong>Tensorflow</strong>  </li><li><a href="https://github.com/szagoruyko/pytorchviz"><strong>Graphviz:</strong></a>   <strong>Pytorch</strong>   </li><li><a href="https://github.com/Murugan-natarajan/mxnet/blob/7cd06109643664442045457a6c318c26d1c728ae/docs/how_to/visualize_graph.md"><strong>mxnet.viz:</strong></a>  <strong>mxnet</strong>   </li><li><a href="https://keras.io/utils/#print_summary"><strong>model.summary():</strong></a>    <strong>keras</strong></li></ol><h4 id="ğŸ·-Lable-Tool"><a href="#ğŸ·-Lable-Tool" class="headerlink" title="ğŸ· Lable Tool"></a>ğŸ· Lable Tool</h4><ol><li><p><a href="https://github.com/opencv/cvat"><strong>CVAT:</strong></a>Computer Vision Annotation Tool (CVAT) is a web-based tool which helps to annotate video and images for Computer Vision algorithms</p></li><li><p><a href="https://github.com/wkentaro/labelme"><strong>Labelme:</strong></a> Image Polygonal Annotation with Python</p></li><li><a href="https://github.com/tzutalin/labelImg"><strong>LabelImg</strong></a>ï¼šLabelImg is a graphical image annotation tool and label object bounding boxes in images </li><li><a href="https://github.com/AlexeyAB/Yolo_mark"><strong>Yolo_mark:</strong></a>GUI for marking bounded boxes of objects in images for training neural network Yolo v3 and v2</li><li><a href="https://github.com/cvhciKIT/sloth"><strong>Sloth:</strong></a>Sloth is a tool for labeling image and video data for computer vision research.</li><li><a href="http://www.cs.columbia.edu/~vondrick/vatic/"><strong>Vatic:</strong></a>  vatic is a <strong>free, online, interactive video annotation tool</strong> for computer vision research that crowdsources work to Amazonâ€™s Mechanical Turk.</li><li><a href="https://github.com/Microsoft/VoTT/"><strong>VoTT:</strong></a>Visual Object Tagging Tool: An electron app for building end to end Object Detection Models from Images and Videos.</li><li><a href="https://github.com/fidler-lab/polyrnn-pp-pytorch"><strong>Polygon-RNN++:</strong></a> Polygon-RNN++ allows you to train new Polygon-RNN++ models, and run our demo tool on local machines. </li></ol>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Toolbox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gitå¸¸è§é—®é¢˜</title>
    <link href="/2018/08/17/git%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/"/>
    <url>/2018/08/17/git%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h4 id="1-Git-åŸºæœ¬æµç¨‹"><a href="#1-Git-åŸºæœ¬æµç¨‹" class="headerlink" title="1. Git åŸºæœ¬æµç¨‹"></a>1. Git åŸºæœ¬æµç¨‹</h4><p><img src="/2018/08/17/git%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/gitflow.png" alt></p><h4 id="2-git-commit-è§„èŒƒ"><a href="#2-git-commit-è§„èŒƒ" class="headerlink" title="2. git commit è§„èŒƒ:"></a>2. git commit è§„èŒƒ:</h4><p>å¸¸ç”¨çš„ Git commit è§„èŒƒï¼Œæ²¡æœ‰å¼ºåˆ¶çš„è§„å®šï¼Œä¸»è¦æ˜¯ç¿»é˜…ä»¥å‰çš„æ—¥å¿—ä¼šæ›´æ¸…æ™°ã€‚</p><p><strong>åŸºæœ¬æ ¼å¼:</strong></p><pre><code class="hljs shell">git commit -m &quot;type: description&quot;</code></pre><p><strong>ä¸€ä¸ªæ¯”è¾ƒè¯¦ç»†çš„æ ¼å¼:</strong></p><pre><code class="hljs shell">&lt;type&gt;: (If applied, this commit will...) &lt;subject&gt; (Max 50 char)|&lt;----  Using a Maximum Of 50 Characters  ----&gt;|Explain why this change is being made|&lt;----   Try To Limit Each Line to a Maximum Of 72 Characters   ----&gt;|Provide links or keys to any relevant tickets, articles or other resourcesExample: Github issue #23</code></pre><p><strong>type</strong> æ˜¯ commit çš„ç±»åˆ«ï¼Œåªå…è®¸å¦‚ä¸‹å‡ ç§æ ‡è¯†ï¼š</p><ul><li><strong>fix: ä¿®å¤bug</strong></li><li><strong>feat/add:</strong> æ–°åŠŸèƒ½ (new feature) </li><li>update: æ›´æ–°</li><li>refactor : æŸä¸ªå·²æœ‰åŠŸèƒ½é‡æ„</li><li>perf : æ€§èƒ½ä¼˜åŒ–</li><li>style : ä»£ç æ ¼å¼æ”¹å˜ (formatting, missing semi colons, etc; no code change)</li><li>test: å¢åŠ æµ‹è¯•ä»£ç  (adding or refactoring tests; no production code change)</li><li>docs : æ–‡æ¡£æ”¹å˜  (changes to documentation)</li><li>revert: æ’¤é”€ä¸Šä¸€æ¬¡çš„commit</li><li>build: æ„å»ºå·¥å…·æˆ–æ„å»ºè¿‡ç¨‹ç­‰çš„å˜åŠ¨ï¼Œå¦‚ï¼šå…³è”åŒ…å‡çº§ç­‰</li><li><strong>chore</strong>    (updating grunt tasks etc; no production code change)</li></ul><p><strong>description</strong> æ˜¯å¯¹æœ¬æ¬¡æäº¤çš„ç®€çŸ­æè¿°ï¼š</p><ul><li>ä¸è¶…è¿‡50ä¸ªå­—ç¬¦ã€‚</li><li>æ¨èä»¥åŠ¨è¯å¼€å¤´ï¼Œå¦‚ï¼š è®¾ç½®ã€ä¿®æ”¹ã€å¢åŠ ã€åˆ å‡ã€æ’¤é”€ç­‰</li></ul><p>å‚è€ƒ: <a href="https://gist.github.com/adeekshith/cd4c95a064977cdc6c50">https://gist.github.com/adeekshith/cd4c95a064977cdc6c50</a></p><h4 id="3-git-æäº¤ç©ºæ–‡ä»¶å¤¹"><a href="#3-git-æäº¤ç©ºæ–‡ä»¶å¤¹" class="headerlink" title="3. git æäº¤ç©ºæ–‡ä»¶å¤¹"></a>3. git æäº¤ç©ºæ–‡ä»¶å¤¹</h4><p>åœ¨ç©ºæ–‡ä»¶å¤¹ä¸‹å»ºç«‹ .gitkeep</p><pre><code class="hljs shell">touch .gitkeep</code></pre><p>å†…å®¹å¦‚ä¸‹:</p><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> Ignore everything <span class="hljs-keyword">in</span> this directory </span>* <span class="hljs-meta">#</span><span class="bash"> Except this file !.gitkeep </span></code></pre><h4 id="4-åˆ é™¤-mac-ä¸‹é¢è‡ªåŠ¨ç”Ÿæˆçš„-DS-store"><a href="#4-åˆ é™¤-mac-ä¸‹é¢è‡ªåŠ¨ç”Ÿæˆçš„-DS-store" class="headerlink" title="4. åˆ é™¤ mac ä¸‹é¢è‡ªåŠ¨ç”Ÿæˆçš„ .DS_store"></a>4. åˆ é™¤ mac ä¸‹é¢è‡ªåŠ¨ç”Ÿæˆçš„ .DS_store</h4><p>åˆ é™¤æ‰€æœ‰éšè—.DS_storeæ–‡ä»¶ï¼Œæ‰“å¼€å‘½ä»¤è¡Œçª—å£</p><pre><code class="hljs cpp">sudo find . -name <span class="hljs-string">&quot;.DS_Store&quot;</span> -depth -exec rm &#123;&#125; \;</code></pre><p>è®¾ç½®ä¸å†äº§ç”Ÿé€‰é¡¹, æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p><pre><code class="hljs shell">defaults write com.apple.desktopservices DSDontWriteNetworkStores true</code></pre><h4 id="5-é€šè¿‡ä¿®æ”¹-hosts-æé«˜-github-è®¿é—®é€Ÿåº¦"><a href="#5-é€šè¿‡ä¿®æ”¹-hosts-æé«˜-github-è®¿é—®é€Ÿåº¦" class="headerlink" title="5. é€šè¿‡ä¿®æ”¹ hosts æé«˜ github è®¿é—®é€Ÿåº¦"></a>5. é€šè¿‡ä¿®æ”¹ hosts æé«˜ github è®¿é—®é€Ÿåº¦</h4><p>å…ˆå» <strong>IPAddress.com æˆ–è€… <a href="http://tool.chinaz.com/dns">http://tool.chinaz.com/dns</a></strong> ç½‘ç«™ï¼ŒæŸ¥è¯¢3ä¸ªä¸GitHubç›¸å…³ç½‘å€å¯¹åº”çš„IPåœ°å€ï¼š</p><p>â€‹    1ã€github.com</p><p>â€‹    2ã€assets-cdn.github.com</p><p>â€‹    3ã€github.global.ssl.fastly.net</p><p>é¡µé¢ä¸Šä¼šæŸ¥çœ‹åˆ°è¿™3ä¸ªåœ°å€å¯¹åº”çš„ IP åœ°å€ï¼ŒæŠŠæŸ¥è¯¢åˆ°çš„IPå’Œåœ°å€åŠ åˆ° hosts æ–‡ä»¶ä¸‹, æ¯”å¦‚:</p><pre><code class="hljs shell">13.250.177.223   github.com</code></pre><p>æˆ‘çš„ç³»ç»Ÿä¸‹hostsæ–‡ä»¶ä¸èƒ½ç›´æ¥ä¿å­˜ï¼Œé‚£å°± copy åˆ°å…¶å®ƒè·¯å¾„ä¸‹ï¼Œä¿®æ”¹ä¿å­˜åå† ctrl+xï¼Œctrl+v å›å»ï¼›</p><p>å†æ¸…ä¸€ä¸‹ç³»ç»ŸDNSç¼“å­˜ï¼Œ</p><p>win: cmdå‘½ä»¤æ‰“å¼€DOSçª—å£ï¼Œè¾“å…¥</p><pre><code class="hljs shell">ipconfig/flushdns</code></pre><p>ubuntu ä¸‹:</p><p>å®‰è£…å¹¶é‡æ–°å¯åŠ¨ nscd å®ˆæŠ¤ç¨‹åºã€‚</p><pre><code class="hljs shell">sudo aptitude install nscdsudo /etc/init.d/nscd restart</code></pre><h4 id="6-å¦‚ä½•è®¾ç½®ä¸è¢«è¿½è¸ªçš„æ–‡ä»¶"><a href="#6-å¦‚ä½•è®¾ç½®ä¸è¢«è¿½è¸ªçš„æ–‡ä»¶" class="headerlink" title="6. å¦‚ä½•è®¾ç½®ä¸è¢«è¿½è¸ªçš„æ–‡ä»¶"></a>6. å¦‚ä½•è®¾ç½®ä¸è¢«è¿½è¸ªçš„æ–‡ä»¶</h4><p>â€‹    æœ‰äº›æ–‡ä»¶æ˜¯ä¸æƒ³è¢«è¿½è¸ªçš„ï¼Œ å¯ä»¥ä¿®æ”¹  <strong>.git/info/exclude</strong> æ–‡ä»¶ï¼Œ ä»¥ # å¼€å¤´ï¼Œæ·»åŠ è§„åˆ™å³å¯ã€‚</p><p>è¿™é‡Œæä¾›ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„ .gitignore æ–‡ä»¶, å°†å…¶å‘½åä¸º .gitignore ç„¶åæ”¾åˆ°æ ¹ç›®å½•å³å¯ã€‚</p><h4 id="7-server-certificate-verification-failed-CAfile-etc-ssl-certs-ca-certificates-crt-CRLfile-none"><a href="#7-server-certificate-verification-failed-CAfile-etc-ssl-certs-ca-certificates-crt-CRLfile-none" class="headerlink" title="7. server certificate verification failed. CAfile:/etc/ssl/certs/ca-certificates.crt CRLfile: none"></a>7. server certificate verification failed. CAfile:/etc/ssl/certs/ca-certificates.crt CRLfile: none</h4><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">GIT_SSL_NO_VERIFY</span>=1</code></pre>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>cmakeä½¿ç”¨</title>
    <link href="/2018/08/17/cmake%E4%BD%BF%E7%94%A8/"/>
    <url>/2018/08/17/cmake%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>cmake åŸºæœ¬ä½¿ç”¨</p><a id="more"></a><h3 id="ä¸€-å®ä¾‹é¡¹ç›®"><a href="#ä¸€-å®ä¾‹é¡¹ç›®" class="headerlink" title="ä¸€. å®ä¾‹é¡¹ç›®"></a>ä¸€. å®ä¾‹é¡¹ç›®</h3><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> project1  <span class="hljs-comment"># use project2/project3 instead of project1</span></span><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> build</span><span class="hljs-meta">$</span><span class="bash"> cmake ..</span><span class="hljs-meta">$</span><span class="bash"> make</span><span class="hljs-meta">$</span><span class="bash"> ./hello <span class="hljs-comment"># </span></span>Hello World.</code></pre><ul><li><strong>project 1:</strong>  ä½¿ç”¨cmake ç¼–è¯‘é¡¹ç›®</li><li><strong>project 2:</strong> ä½¿ç”¨åŠ¨æ€é“¾æ¥åº“</li><li><strong>project 3ï¼š</strong> å°†srcå’Œinclude åˆ†åˆ«æ”¾åˆ°ä¸åŒçš„æ–‡ä»¶å¤¹ä¸‹</li><li><strong>project4:</strong> ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“</li></ul><h3 id="äºŒ-åŸºæœ¬è¯­æ³•"><a href="#äºŒ-åŸºæœ¬è¯­æ³•" class="headerlink" title="äºŒ. åŸºæœ¬è¯­æ³•"></a>äºŒ. åŸºæœ¬è¯­æ³•</h3><h5 id="1-CMake-åŸºæœ¬ä½¿ç”¨"><a href="#1-CMake-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="1. CMake åŸºæœ¬ä½¿ç”¨"></a>1. CMake åŸºæœ¬ä½¿ç”¨</h5><pre><code class="hljs cmake"><span class="hljs-keyword">cmake_minimum_required</span> (VERSION <span class="hljs-number">2.8</span>)<span class="hljs-keyword">project</span> (Demo1)<span class="hljs-keyword">add_executable</span>(Demo main.cpp)</code></pre><h5 id="2-å¤šä¸ªæ–‡ä»¶åŒæ—¶ç¼–è¯‘"><a href="#2-å¤šä¸ªæ–‡ä»¶åŒæ—¶ç¼–è¯‘" class="headerlink" title="2. å¤šä¸ªæ–‡ä»¶åŒæ—¶ç¼–è¯‘"></a>2. å¤šä¸ªæ–‡ä»¶åŒæ—¶ç¼–è¯‘</h5><pre><code class="hljs cmake"><span class="hljs-comment"># ä½¿ç”¨ aux_source_directory(&lt;dir&gt; &lt;variable&gt;)</span><span class="hljs-keyword">aux_source_directory</span>(src DIR_SRCS)<span class="hljs-keyword">add_library</span>(xxxxx SHARED <span class="hljs-variable">$&#123;SRC_FILES&#125;</span>)<span class="hljs-comment"># glob</span><span class="hljs-keyword">file</span>(GLOB_RECURSE SRC_FILES src/*.cpp) <span class="hljs-keyword">add_library</span>(xxxxx SHARED <span class="hljs-variable">$&#123;SRC_FILES&#125;</span>)<span class="hljs-comment"># (3)å¤šä¸ªæ–‡ä»¶åŒæ—¶å†™</span><span class="hljs-keyword">set</span>(SRC_FILES    src/util/xxx.cpp    src/util/xxxxx_xxxxxxx.cpp    src/xxxx.cpp    )<span class="hljs-keyword">add_library</span>(xxxxx SHARED <span class="hljs-variable">$&#123;SRC_FILES&#125;</span>)</code></pre><h5 id="3-ç”ŸæˆåŠ¨æ€åº“æˆ–è€…å…±äº«åº“"><a href="#3-ç”ŸæˆåŠ¨æ€åº“æˆ–è€…å…±äº«åº“" class="headerlink" title="3. ç”ŸæˆåŠ¨æ€åº“æˆ–è€…å…±äº«åº“"></a>3. ç”ŸæˆåŠ¨æ€åº“æˆ–è€…å…±äº«åº“</h5><pre><code class="hljs cmake"><span class="hljs-comment"># é™æ€åº“</span><span class="hljs-keyword">add_library</span>(slzheliib STATIC libStatic.cpp)<span class="hljs-comment"># å…±äº«åº“</span><span class="hljs-keyword">add_library</span>(dlib SHARED libShared.cpp)</code></pre><h5 id="4-ä½¿ç”¨ç¬¬ä¸‰æ–¹åŒ…-ä»¥-opencv-å’Œ-FFTW-ä¸ºä¾‹"><a href="#4-ä½¿ç”¨ç¬¬ä¸‰æ–¹åŒ…-ä»¥-opencv-å’Œ-FFTW-ä¸ºä¾‹" class="headerlink" title="4. ä½¿ç”¨ç¬¬ä¸‰æ–¹åŒ…(ä»¥ opencv å’Œ FFTW ä¸ºä¾‹)"></a>4. ä½¿ç”¨ç¬¬ä¸‰æ–¹åŒ…(ä»¥ opencv å’Œ FFTW ä¸ºä¾‹)</h5><pre><code class="hljs cmake"><span class="hljs-comment"># ç¼–è¯‘: add_executable(Demo demo.cpp)</span><span class="hljs-keyword">find_package</span>( OpenCV REQUIRED)<span class="hljs-keyword">if</span> (OpenCV_FOUND)    <span class="hljs-keyword">include_directories</span>(<span class="hljs-variable">$&#123;OpenCV_INCLUDE_DIRS&#125;</span>)    <span class="hljs-keyword">target_link_libraries</span>(Demo <span class="hljs-variable">$&#123;Opencv_LIBS&#125;</span>)<span class="hljs-keyword">endif</span> (OpenCV_FOUND)</code></pre><pre><code class="hljs cmake"><span class="hljs-comment"># å¦å¤–ä¸€ç§æ–¹å¼(é€šè¿‡ xxx.cmake è¿›è¡Œ)ã€€</span><span class="hljs-comment"># cmakeç›¸å½“äºä¸Šä¸€ç§æ–¹å¼ä¸­çš„find_packageå’Œinclude_directories</span><span class="hljs-comment"># è¿™é‡Œä»¥ FFTW ä¸ºä¾‹</span><span class="hljs-keyword">include</span>(cmake/FindFFTW.cmake)<span class="hljs-keyword">target_link_libraries</span>(udwt-gumbel <span class="hljs-variable">$&#123;OpenCV_LIBS&#125;</span> <span class="hljs-variable">$&#123;FFTW_LIBRARIES&#125;</span>)</code></pre><h5 id="5-å¦‚ä½•ä¼˜åŒ–ç¼–è¯‘é€‰é¡¹-Debug-Releaseæ¨¡å¼-ï¼š"><a href="#5-å¦‚ä½•ä¼˜åŒ–ç¼–è¯‘é€‰é¡¹-Debug-Releaseæ¨¡å¼-ï¼š" class="headerlink" title="5. å¦‚ä½•ä¼˜åŒ–ç¼–è¯‘é€‰é¡¹(Debug/Releaseæ¨¡å¼)ï¼š"></a>5. å¦‚ä½•ä¼˜åŒ–ç¼–è¯‘é€‰é¡¹(Debug/Releaseæ¨¡å¼)ï¼š</h5><p>â€‹    Debugé€šå¸¸ç§°ä¸ºè°ƒè¯•ç‰ˆæœ¬ï¼Œå®ƒåŒ…å«è°ƒè¯•ä¿¡æ¯ï¼Œå¹¶ä¸”ä¸ä½œä»»ä½•ä¼˜åŒ–ï¼Œä¾¿äºç¨‹åºå‘˜è°ƒè¯•ç¨‹åºã€‚Release ç§°ä¸ºå‘å¸ƒç‰ˆæœ¬ï¼Œå®ƒå¾€å¾€æ˜¯è¿›è¡Œäº†å„ç§ä¼˜åŒ–ï¼Œä½¿å¾—ç¨‹åºåœ¨ä»£ç å¤§å°å’Œè¿è¡Œé€Ÿåº¦ä¸Šéƒ½æ˜¯æœ€ä¼˜çš„ï¼Œä»¥ä¾¿ç”¨æˆ·å¾ˆå¥½åœ°ä½¿ç”¨ã€‚</p><ul><li>åœ¨CMakeLists.txtä¸‹åŠ å…¥</li></ul><pre><code class="hljs cmake"><span class="hljs-comment"># cmake -DCMAKE_BUILD_TYPE=Debug/Release ..</span><span class="hljs-keyword">SET</span>(CMAKE_BUILD_TYPE <span class="hljs-string">&quot;Release&quot;</span>)<span class="hljs-keyword">if</span> (CMAKE_BUILD_TYPE <span class="hljs-keyword">STREQUAL</span> <span class="hljs-string">&quot;Debug&quot;</span>)    <span class="hljs-keyword">set</span>(CMAKE_CXX_FLAGS_DEBUG <span class="hljs-string">&quot;$ENV&#123;CXXFLAGS&#125; -O0 -Wall -g -ggdb&quot;</span>)    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;CMAKE_BUILD_TYPE = Debug&quot;</span>)<span class="hljs-keyword">else</span>()    <span class="hljs-keyword">set</span>(CMAKE_CXX_FLAGS_RELEASE <span class="hljs-string">&quot;$ENV&#123;CXXFLAGS&#125; -O3 -Wall&quot;</span>)    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;CMAKE_BUILD_TYPE = Release&quot;</span>)<span class="hljs-keyword">endif</span>()</code></pre><p>â€‹        <strong>CMakeä¸­æœ‰ä¸€ä¸ªå˜é‡ CMAKE_BUILD_TYPE ,å¯ä»¥çš„å–å€¼æ˜¯Noneã€Debugã€Releaseã€RelWithDebInfoå’ŒMinSizeRelã€‚å½“è¿™ä¸ªå˜é‡å€¼ä¸ºDebugçš„æ—¶å€™,CMakeä¼šä½¿ç”¨å˜é‡ CMAKE_CXX_FLAGS_DEBUG å’Œ CMAKE_C_FLAGS_DEBUG ä¸­çš„å­—ç¬¦ä¸²ä½œä¸ºç¼–è¯‘é€‰é¡¹ç”Ÿæˆ Makefile</strong></p><div class="table-container"><table><thead><tr><th>CMAKE_BUILD_TYPE</th><th>å¯¹åº”çš„cç¼–è¯‘é€‰é¡¹å˜é‡</th><th>å¯¹åº”çš„c++ç¼–è¯‘é€‰é¡¹å˜é‡</th></tr></thead><tbody><tr><td>None</td><td>CMAKE_C_FLAGS</td><td>CMAKE_CXX_FLAGS</td></tr><tr><td>Debug</td><td>CMAKE_C_FLAGS_DEBUG</td><td>CMAKE_CXX_FLAGS_DEBUG</td></tr><tr><td>Release</td><td>CMAKE_C_FLAGS_RELEASE</td><td>CMAKE_CXX_FLAGS_RELEASE</td></tr><tr><td>RelWithDebInfo</td><td>CMAKE_C_FLAGS_RELWITHDEBINFO</td><td>CMAKE_CXX_FLAGS_RELWITHDEBINFO</td></tr><tr><td>MinSizeRel</td><td>CMAKE_C_FLAGS_MINSIZEREL</td><td>CMAKE_CXX_FLAGS_MINSIZEREL</td></tr></tbody></table></div><p>â€‹    å¦‚æœå°†ä¼˜åŒ–ç¨‹åº¦è°ƒåˆ°æœ€é«˜éœ€è¦è®¾ç½®<code>-O3</code>ï¼Œæœ€ä½çš„æ˜¯<code>-O0</code>å³ä¸åšä¼˜åŒ–ï¼Œæ·»åŠ è°ƒè¯•ä¿¡æ¯çš„å‚æ•°æ˜¯<code>-g  -ggdb</code>ï¼Œå¦‚æœä¸æ·»åŠ è¿™ä¸ªå‚æ•°ï¼Œè°ƒè¯•ä¿¡æ¯å°±ä¸ä¼šè¢«åŒ…å«åœ¨ç”Ÿæˆçš„äºŒè¿›åˆ¶ä¸­ã€‚</p><p>ï¼ˆ1ï¼‰<code>-O</code>ï¼Œ<code>-O1</code> è¿™ä¸¤ä¸ªå‘½ä»¤çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œç›®çš„éƒ½æ˜¯åœ¨ä¸å½±å“ç¼–è¯‘é€Ÿåº¦çš„å‰æä¸‹ï¼Œå°½é‡é‡‡ç”¨ä¸€äº›ä¼˜åŒ–ç®—æ³•é™ä½ä»£ç å¤§å°å’Œå¯æ‰§è¡Œä»£ç çš„è¿è¡Œé€Ÿåº¦ã€‚ </p><p>ï¼ˆ2ï¼‰<code>-O2</code> è¯¥ä¼˜åŒ–é€‰é¡¹ä¼šç‰ºç‰²éƒ¨åˆ†ç¼–è¯‘é€Ÿåº¦ï¼Œé™¤äº†æ‰§è¡Œ<code>-O1</code>æ‰€æ‰§è¡Œçš„æ‰€æœ‰ä¼˜åŒ–ä¹‹å¤–ï¼Œè¿˜ä¼šé‡‡ç”¨å‡ ä¹æ‰€æœ‰çš„ç›®æ ‡é…ç½®æ”¯æŒçš„ä¼˜åŒ–ç®—æ³•ï¼Œç”¨ä»¥æé«˜ç›®æ ‡ä»£ç çš„è¿è¡Œé€Ÿåº¦ã€‚ </p><p>ï¼ˆ3ï¼‰ <code>-O3</code> è¯¥é€‰é¡¹é™¤äº†æ‰§è¡Œ<code>-O2</code>æ‰€æœ‰çš„ä¼˜åŒ–é€‰é¡¹ä¹‹å¤–ï¼Œä¸€èˆ¬éƒ½æ˜¯é‡‡å–å¾ˆå¤šå‘é‡åŒ–ç®—æ³•ï¼Œæé«˜ä»£ç çš„å¹¶è¡Œæ‰§è¡Œç¨‹åº¦ï¼Œåˆ©ç”¨ç°ä»£CPUä¸­çš„æµæ°´çº¿ï¼ŒCacheç­‰ã€‚è¿™ä¸ªé€‰é¡¹ä¼šæé«˜æ‰§è¡Œä»£ç çš„å¤§å°ï¼Œå½“ç„¶ä¼šé™ä½ç›®æ ‡ä»£ç çš„æ‰§è¡Œæ—¶é—´ã€‚</p><p>ï¼ˆ4ï¼‰<code>-Os</code> è¿™ä¸ªä¼˜åŒ–æ ‡è¯†å’Œ<code>-O3</code>æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œå½“ç„¶ä¸¤è€…çš„ç›®æ ‡ä¸ä¸€æ ·ï¼Œ<code>-O3</code>çš„ç›®æ ‡æ˜¯å®æ„¿å¢åŠ ç›®æ ‡ä»£ç çš„å¤§å°ï¼Œä¹Ÿè¦æ‹¼å‘½çš„æé«˜è¿è¡Œé€Ÿåº¦ï¼Œä½†æ˜¯è¿™ä¸ªé€‰é¡¹æ˜¯åœ¨<code>-O2</code>çš„åŸºç¡€ä¹‹ä¸Šï¼Œå°½é‡çš„é™ä½ç›®æ ‡ä»£ç çš„å¤§å°ï¼Œè¿™å¯¹äºå­˜å‚¨å®¹é‡å¾ˆå°çš„è®¾å¤‡æ¥è¯´éå¸¸é‡è¦ã€‚ä¸ºäº†é™ä½ç›®æ ‡ä»£ç å¤§å°ï¼Œä¼šç¦ç”¨ä¸‹åˆ—ä¼˜åŒ–é€‰é¡¹ï¼Œä¸€èˆ¬å°±æ˜¯å‹ç¼©å†…å­˜ä¸­çš„å¯¹é½ç©ºç™½(alignment padding)</p><p>ï¼ˆ5ï¼‰<code>-Ofast</code> è¯¥é€‰é¡¹å°†ä¸ä¼šä¸¥æ ¼éµå¾ªè¯­è¨€æ ‡å‡†ï¼Œé™¤äº†å¯ç”¨æ‰€æœ‰çš„<code>-O3</code>ä¼˜åŒ–é€‰é¡¹ä¹‹å¤–ï¼Œä¹Ÿä¼šé’ˆå¯¹æŸäº›è¯­è¨€å¯ç”¨éƒ¨åˆ†ä¼˜åŒ–ã€‚å¦‚ï¼š<code>-ffast-math</code> .</p><p>ï¼ˆ6ï¼‰<code>-Og</code>: è¯¥æ ‡è¯†ä¼šç²¾å¿ƒæŒ‘é€‰éƒ¨åˆ†ä¸<code>-g</code>é€‰é¡¹ä¸å†²çªçš„ä¼˜åŒ–é€‰é¡¹ï¼Œå½“ç„¶å°±èƒ½æä¾›åˆç†çš„ä¼˜åŒ–æ°´å¹³ï¼ŒåŒæ—¶äº§ç”Ÿè¾ƒå¥½çš„å¯è°ƒè¯•ä¿¡æ¯å’Œå¯¹è¯­è¨€æ ‡å‡†çš„éµå¾ªç¨‹åº¦ã€‚</p><h5 id="6-è®¾å®šä½¿ç”¨-C-11"><a href="#6-è®¾å®šä½¿ç”¨-C-11" class="headerlink" title="6. è®¾å®šä½¿ç”¨ C++11"></a>6. è®¾å®šä½¿ç”¨ C++11</h5><pre><code class="hljs cmake"><span class="hljs-comment"># Use C++11</span><span class="hljs-keyword">set</span>(CMAKE_CXX_STANDARD <span class="hljs-number">11</span>)<span class="hljs-keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="hljs-keyword">ON</span>)<span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;C++11 support has been enabled by default.&quot;</span>)</code></pre><h5 id="7-è‡ªå®šä¹‰ç¼–è¯‘é€‰é¡¹-ä»¥-OpenMP-å’Œ-SSEä¸ºä¾‹"><a href="#7-è‡ªå®šä¹‰ç¼–è¯‘é€‰é¡¹-ä»¥-OpenMP-å’Œ-SSEä¸ºä¾‹" class="headerlink" title="7. è‡ªå®šä¹‰ç¼–è¯‘é€‰é¡¹(ä»¥ OpenMP å’Œ SSEä¸ºä¾‹)"></a>7. è‡ªå®šä¹‰ç¼–è¯‘é€‰é¡¹(ä»¥ OpenMP å’Œ SSEä¸ºä¾‹)</h5><pre><code class="hljs cmake"><span class="hljs-comment"># Use OpenMP</span><span class="hljs-keyword">option</span>(USE_OPENMP      <span class="hljs-string">&quot;Set to ON to build use openmp&quot;</span>  <span class="hljs-keyword">ON</span>)<span class="hljs-keyword">if</span> (USE_OPENMP)    <span class="hljs-keyword">find_package</span>(OpenMP QUIET)    <span class="hljs-keyword">if</span> (OPENMP_FOUND)        <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;Use OpenMP&quot;</span>)        <span class="hljs-keyword">add_definitions</span>(-DUSE_OPENMP)        <span class="hljs-keyword">set</span>(CMAKE_C_FLAGS <span class="hljs-string">&quot;$&#123;CMAKE_C_FLAGS&#125; $&#123;OpenMP_C_FLAGS&#125;&quot;</span>)        <span class="hljs-keyword">set</span>(CMAKE_CXX_FLAGS <span class="hljs-string">&quot;$&#123;CMAKE_CXX_FLAGS&#125; $&#123;OpenMP_CXX_FLAGS&#125;&quot;</span>)        <span class="hljs-keyword">set</span>(CMAKE_EXE_LINKER_FLAGS <span class="hljs-string">&quot;$&#123;CMAKE_EXE_LINKER_FLAGS&#125; $&#123;OpenMP_EXE_LINKER_FLAGS&#125;&quot;</span>)    <span class="hljs-keyword">endif</span>()<span class="hljs-keyword">endif</span>()<span class="hljs-comment"># Use SSE</span><span class="hljs-keyword">option</span>(USE_SSE         <span class="hljs-string">&quot;Set to ON to build use SSE&quot;</span>  <span class="hljs-keyword">ON</span>)<span class="hljs-keyword">if</span> (USE_SSE)    <span class="hljs-keyword">add_definitions</span>(-DUSE_SSE)    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;Use SSE&quot;</span>)    <span class="hljs-keyword">set</span>(CMAKE_CXX_FLAGS <span class="hljs-string">&quot;$&#123;CMAKE_CXX_FLAGS&#125; -msse4.1&quot;</span>)<span class="hljs-keyword">endif</span>()</code></pre><h5 id="8-æ·»åŠ ç‰ˆæœ¬å·"><a href="#8-æ·»åŠ ç‰ˆæœ¬å·" class="headerlink" title="8. æ·»åŠ ç‰ˆæœ¬å·"></a>8. æ·»åŠ ç‰ˆæœ¬å·</h5><pre><code class="hljs cmake"><span class="hljs-comment"># Version (DEMO is Project Name)</span><span class="hljs-keyword">set</span> (DEMO_VERSION_MAJOR <span class="hljs-number">0</span>)<span class="hljs-keyword">set</span> (DEMO_VERSION_MINOR <span class="hljs-number">1</span>)<span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;PROJECT VERSION IS $&#123;DEMO_VERSION_MAJOR&#125;.$&#123;DEMO_VERSION_MINOR&#125;&quot;</span>)</code></pre><h5 id="9-è®¾ç½®å­æ–‡ä»¶å¤¹"><a href="#9-è®¾ç½®å­æ–‡ä»¶å¤¹" class="headerlink" title="9. è®¾ç½®å­æ–‡ä»¶å¤¹"></a>9. è®¾ç½®å­æ–‡ä»¶å¤¹</h5><p>åœ¨ä¸»é¡¹ç›®çš„ <code>CMakeLists.txt</code> ä¸­, å¯ä»¥ä½¿ç”¨ <code>add_subdirectory</code> æ¥æ·»åŠ  å­æ–‡ä»¶å¤¹, ç„¶ååœ¨å­æ–‡ä»¶å¤¹ä¸­ä¹Ÿè¦æœ‰ä¸€ä¸ª <code>CMakeLists.txt</code> æ–‡ä»¶.</p><pre><code class="hljs cmake"><span class="hljs-keyword">add_subdirectory</span>(benchmark)<span class="hljs-keyword">add_subdirectory</span>(src)<span class="hljs-keyword">add_subdirectory</span>(tools)</code></pre><p>é¡¹ç›®çš„åŸºæœ¬ç›®å½•ä¸º:</p><pre><code class="hljs cmake">.â”œâ”€â”€ srcâ”‚Â Â  â”œâ”€â”€ CMakeLists.txtâ”‚Â Â  â””â”€â”€ xxx.cppâ”œâ”€â”€ toolsâ”‚Â Â  â”œâ”€â”€ CMakeLists.txtâ”‚Â Â  â””â”€â”€ xxx.cppâ”œâ”€â”€ benchmarkâ”‚Â Â  â”œâ”€â”€ CMakeLists.txtâ”‚Â Â  â””â”€â”€ xxx.cppâ”œâ”€â”€ main.cppâ””â”€â”€ CMakeLists.txt</code></pre><h5 id="10-æµ‹è¯•"><a href="#10-æµ‹è¯•" class="headerlink" title="10. æµ‹è¯•"></a>10. æµ‹è¯•</h5><pre><code class="hljs cmake"><span class="hljs-keyword">enable_testing</span>()<span class="hljs-keyword">add_test</span> (test_5_2 Demo <span class="hljs-number">5</span> <span class="hljs-number">2</span>)<span class="hljs-keyword">set_tests_properties</span> (test_5_2 PROPERTIES PASS_REGULAR_EXPRESSION <span class="hljs-string">&quot;is 25&quot;</span>)<span class="hljs-keyword">add_test</span> (test_2_10 Demo <span class="hljs-number">2</span> <span class="hljs-number">10</span>)<span class="hljs-keyword">set_tests_properties</span> (test_2_10 PROPERTIES PASS_REGULAR_EXPRESSION <span class="hljs-string">&quot;is 1024&quot;</span>)</code></pre><p>set_tests_properties ä¸­çš„ <code>PASS_REGULAR_EXPRESSION</code> ç”¨æ¥æµ‹è¯•è¾“å‡ºæ˜¯å¦åŒ…å«åé¢è·Ÿç€çš„å­—ç¬¦ä¸²ã€‚</p><h5 id="11-è®¾ç½®å®‰è£…ä¸ä¸ç”Ÿæˆå®‰è£…åŒ…"><a href="#11-è®¾ç½®å®‰è£…ä¸ä¸ç”Ÿæˆå®‰è£…åŒ…" class="headerlink" title="11.è®¾ç½®å®‰è£…ä¸ä¸ç”Ÿæˆå®‰è£…åŒ…"></a>11.è®¾ç½®å®‰è£…ä¸ä¸ç”Ÿæˆå®‰è£…åŒ…</h5><p>ç”Ÿæˆçš„ Demo æ–‡ä»¶å°†ä¼šè¢«å¤åˆ¶åˆ° <code>/usr/local/bin</code> ä¸­ï¼Œè€Œ demo.h å’Œåˆ™ä¼šè¢«å¤åˆ¶åˆ° <code>/usr/local/include</code> ä¸­ã€‚é¡ºå¸¦ä¸€æçš„æ˜¯ï¼Œè¿™é‡Œçš„ <code>/usr/local/</code> æ˜¯é»˜è®¤å®‰è£…åˆ°çš„æ ¹ç›®å½•ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ <code>CMAKE_INSTALL_PREFIX</code> å˜é‡çš„å€¼æ¥æŒ‡å®šè¿™äº›æ–‡ä»¶åº”è¯¥æ‹·è´åˆ°å“ªä¸ªæ ¹ç›®å½•ã€‚</p><pre><code class="hljs cmake"><span class="hljs-keyword">install</span> (TARGETS Demo DESTINATION bin) <span class="hljs-keyword">install</span> (FILES demo.h DESTINATION <span class="hljs-keyword">include</span>)</code></pre><h5 id="12-æŒ‡å®šè¾“å‡ºç›®å½•"><a href="#12-æŒ‡å®šè¾“å‡ºç›®å½•" class="headerlink" title="12. æŒ‡å®šè¾“å‡ºç›®å½•"></a>12. æŒ‡å®šè¾“å‡ºç›®å½•</h5><pre><code class="hljs cmake"><span class="hljs-keyword">SET</span>(EXECUTABLE_OUTPUT_PATH <span class="hljs-variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/bin)       <span class="hljs-comment"># è®¾ç½®å¯æ‰§è¡Œæ–‡ä»¶çš„è¾“å‡ºç›®å½•</span><span class="hljs-keyword">SET</span>(LIBRARY_OUTPUT_PATH <span class="hljs-variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/lib)           <span class="hljs-comment"># è®¾ç½®åº“æ–‡ä»¶çš„è¾“å‡ºç›®å½•</span></code></pre><h5 id="13-ä½¿ç”¨ç¬¬ä¸‰æ–¹è½¯ä»¶-ä½†æ˜¯ä¸å®‰è£…-ä»¥opencvä¸ºä¾‹"><a href="#13-ä½¿ç”¨ç¬¬ä¸‰æ–¹è½¯ä»¶-ä½†æ˜¯ä¸å®‰è£…-ä»¥opencvä¸ºä¾‹" class="headerlink" title="13.  ä½¿ç”¨ç¬¬ä¸‰æ–¹è½¯ä»¶,  ä½†æ˜¯ä¸å®‰è£…(ä»¥opencvä¸ºä¾‹)"></a>13.  ä½¿ç”¨ç¬¬ä¸‰æ–¹è½¯ä»¶,  ä½†æ˜¯ä¸å®‰è£…(ä»¥opencvä¸ºä¾‹)</h5><p>å°†æ‰€éœ€çš„å¤´æ–‡ä»¶æ”¾åœ¨  <code>include</code>  æ–‡ä»¶å¤¹ä¸­, å°†éœ€è¦çš„ å…±äº«åº“ <code>*.so</code> æ”¾åœ¨ <code>lib</code> æ–‡ä»¶å¤¹ä¸­.</p><pre><code class="hljs cmake"><span class="hljs-keyword">include_directories</span>(<span class="hljs-keyword">include</span>)<span class="hljs-keyword">set</span>(opencv_lib   <span class="hljs-variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/lib/libopencv_highgui.so.<span class="hljs-number">3.3</span>   <span class="hljs-variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/lib/libopencv_videoio.so.<span class="hljs-number">3.3</span>   <span class="hljs-variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/lib/libopencv_imgcodecs.so.<span class="hljs-number">3.3</span>   <span class="hljs-variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/lib/libopencv_imgproc.so.<span class="hljs-number">3.3</span>   <span class="hljs-variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/lib/libopencv_core.so.<span class="hljs-number">3.3</span>)<span class="hljs-keyword">target_link_libraries</span>(demo <span class="hljs-variable">$&#123;opencv_lib&#125;</span>)</code></pre><h3 id="ä¸‰-Cmakeå¸¸è§é—®é¢˜"><a href="#ä¸‰-Cmakeå¸¸è§é—®é¢˜" class="headerlink" title="ä¸‰. Cmakeå¸¸è§é—®é¢˜"></a>ä¸‰. Cmakeå¸¸è§é—®é¢˜</h3><h5 id="1-Question-make-Nothing-to-be-done-for-all-Solution"><a href="#1-Question-make-Nothing-to-be-done-for-all-Solution" class="headerlink" title="1. Question : make: Nothing to be done for `all` Solution"></a>1. <strong>Question</strong> : <strong>make: Nothing to be done for `all` Solution</strong></h5><p>è¿™å¥æç¤ºæ˜¯è¯´æ˜ä½ å·²ç»ç¼–è¯‘å¥½äº†ï¼Œè€Œä¸”æ²¡æœ‰å¯¹ä»£ç è¿›è¡Œä»»ä½•æ”¹åŠ¨ã€‚è‹¥æƒ³é‡æ–°ç¼–è¯‘ï¼Œå¯ä»¥å…ˆåˆ é™¤ä»¥å‰ç¼–è¯‘äº§ç”Ÿçš„ç›®æ ‡æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ make cleanï¼Œç„¶åå†ä½¿ç”¨ makeã€‚</p><h5 id="2-Question-gcc-make-cmake-çš„è”ç³»ä¸åŒºåˆ«"><a href="#2-Question-gcc-make-cmake-çš„è”ç³»ä¸åŒºåˆ«" class="headerlink" title="2. Question: gcc/make/cmake çš„è”ç³»ä¸åŒºåˆ«"></a>2. Question: gcc/make/cmake çš„è”ç³»ä¸åŒºåˆ«</h5><p>â€‹      gccæ˜¯GNU Compiler Collectionï¼ˆå°±æ˜¯GNUç¼–è¯‘å™¨å¥—ä»¶ï¼‰ï¼Œä¹Ÿå¯ä»¥ç®€å•è®¤ä¸ºæ˜¯ç¼–è¯‘å™¨ï¼Œå®ƒå¯ä»¥ç¼–è¯‘å¾ˆå¤šç§ç¼–ç¨‹è¯­è¨€ï¼ˆæ‹¬Cã€C++ã€Objective-Cã€Fortranã€Javaç­‰ç­‰ï¼‰ã€‚<strong>å½“ä½ çš„ç¨‹åºåªæœ‰ä¸€ä¸ªæºæ–‡ä»¶æ—¶ï¼Œç›´æ¥å°±å¯ä»¥ç”¨gccå‘½ä»¤ç¼–è¯‘å®ƒ</strong>ã€‚ä½†æ˜¯å½“ä½ çš„ç¨‹åºåŒ…å«å¾ˆå¤šä¸ªæºæ–‡ä»¶æ—¶ï¼Œç”¨gccå‘½ä»¤é€ä¸ªå»ç¼–è¯‘æ—¶ï¼Œä½ å°±å¾ˆå®¹æ˜“æ··ä¹±è€Œä¸”å·¥ä½œé‡å¤§ã€‚è¿™æ—¶å¯ä»¥ä½¿ç”¨make å·¥å…·ï¼Œ<strong>makeå·¥å…·å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªæ™ºèƒ½çš„æ‰¹å¤„ç†å·¥å…·ï¼Œå®ƒæœ¬èº«å¹¶æ²¡æœ‰ç¼–è¯‘å’Œé“¾æ¥çš„åŠŸèƒ½ï¼Œè€Œæ˜¯ç”¨ç±»ä¼¼äºæ‰¹å¤„ç†çš„æ–¹å¼â€”â€” é€šè¿‡è°ƒç”¨makefileæ–‡ä»¶ä¸­ç”¨æˆ·æŒ‡å®šçš„å‘½ä»¤æ¥è¿›è¡Œç¼–è¯‘å’Œé“¾æ¥çš„</strong>ã€‚ç®€å•çš„è¯´å°±åƒä¸€é¦–æ­Œçš„ä¹è°±ï¼Œmakeå·¥å…·å°±åƒæŒ‡æŒ¥å®¶ï¼ŒæŒ‡æŒ¥å®¶æ ¹æ®ä¹è°±æŒ‡æŒ¥æ•´ä¸ªä¹å›¢æ€ä¹ˆæ ·æ¼”å¥ï¼Œmakeå·¥å…·å°±æ ¹æ®makefileä¸­çš„å‘½ä»¤è¿›è¡Œç¼–è¯‘å’Œé“¾æ¥çš„ã€‚makefileå‘½ä»¤ä¸­å°±åŒ…å«äº†è°ƒç”¨gccï¼ˆä¹Ÿå¯ä»¥æ˜¯åˆ«çš„ç¼–è¯‘å™¨ï¼‰å»ç¼–è¯‘æŸä¸ªæºæ–‡ä»¶çš„å‘½ä»¤ã€‚</p><p>â€‹        makefileåœ¨ä¸€äº›ç®€å•çš„å·¥ç¨‹å®Œå…¨å¯ä»¥äººå·¥æ‰‹å†™ï¼Œä½†æ˜¯å½“å·¥ç¨‹éå¸¸å¤§çš„æ—¶å€™ï¼Œæ‰‹å†™makefileä¹Ÿæ˜¯éå¸¸éº»çƒ¦çš„ï¼Œå¦‚æœæ¢äº†ä¸ªå¹³å°makefileåˆè¦é‡æ–°ä¿®æ”¹ã€‚è¿™æ—¶å€™å°±å‡ºç°äº†Cmakeè¿™ä¸ªå·¥å…·ï¼Œ<strong>cmakeå°±å¯ä»¥æ›´åŠ ç®€å•çš„ç”Ÿæˆmakefileæ–‡ä»¶ç»™ä¸Šé¢é‚£ä¸ªmakeç”¨</strong>ã€‚å½“ç„¶cmakeè¿˜æœ‰å…¶ä»–åŠŸèƒ½ï¼Œå°±æ˜¯<strong>å¯ä»¥è·¨å¹³å°</strong>ç”Ÿæˆå¯¹åº”å¹³å°èƒ½ç”¨çš„makefileï¼Œä½ ä¸ç”¨å†è‡ªå·±å»ä¿®æ”¹äº†ã€‚å¯æ˜¯cmakeæ ¹æ®ä»€ä¹ˆç”Ÿæˆmakefileå‘¢ï¼Ÿå®ƒåˆè¦<strong>æ ¹æ®ä¸€ä¸ªå«CMakeLists.txtæ–‡ä»¶ï¼ˆå­¦åï¼šç»„æ€æ¡£ï¼‰å»ç”Ÿæˆmakefile</strong>ã€‚åˆ°æœ€åCMakeLists.txtæ–‡ä»¶è°å†™å•Šï¼Ÿäº²ï¼Œæ˜¯ä½ è‡ªå·±æ‰‹å†™çš„ã€‚ä¸‰è€…çš„å…³ç³»å¯ä»¥å¦‚ä¸‹é¢çš„ç®€å›¾æ‰€ç¤ºï¼š</p><p><img src="/2018/08/17/cmake%E4%BD%BF%E7%94%A8/cmake.png" alt="p4107"></p><h5 id="3-å¸¸è§çš„è·¯å¾„"><a href="#3-å¸¸è§çš„è·¯å¾„" class="headerlink" title="3. å¸¸è§çš„è·¯å¾„"></a>3. å¸¸è§çš„è·¯å¾„</h5><p><strong>PROJECT_SOURCE_DIR:</strong> å«æœ‰ <code>project()</code> æŒ‡ä»¤çš„<code>CMakeLists.txt</code> æ–‡ä»¶å¤¹ã€‚</p><p><strong>CMAKE_CURRENT_SOURCE_DIR:</strong> ç›®å‰æ­£åœ¨å¤„ç†çš„CMakeLists.txt æ‰€åœ¨ä½ç½®ã€‚</p><h5 id="4-æŒ‡å®šè¾“å‡ºè·¯å¾„"><a href="#4-æŒ‡å®šè¾“å‡ºè·¯å¾„" class="headerlink" title="4. æŒ‡å®šè¾“å‡ºè·¯å¾„"></a>4. æŒ‡å®šè¾“å‡ºè·¯å¾„</h5><pre><code class="hljs cmake"><span class="hljs-keyword">SET</span>(EXECUTABLE_OUTPUT_PATH <span class="hljs-variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/../bin)       <span class="hljs-comment">#è®¾ç½®å¯æ‰§è¡Œæ–‡ä»¶çš„è¾“å‡ºç›®å½•</span><span class="hljs-keyword">SET</span>(LIBRARY_OUTPUT_PATH <span class="hljs-variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/../lib)           <span class="hljs-comment">#è®¾ç½®åº“æ–‡ä»¶çš„è¾“å‡ºç›®å½•</span></code></pre><h3 id="å››-å‚è€ƒé“¾æ¥"><a href="#å››-å‚è€ƒé“¾æ¥" class="headerlink" title="å››. å‚è€ƒé“¾æ¥"></a>å››. å‚è€ƒé“¾æ¥</h3><p>[0] <a href="https://cmake.org">CMakeå®˜æ–¹ç½‘ç«™</a></p><p>[1] <a href="https://www.hahack.com/codes/cmake/">CMake å…¥é—¨å®æˆ˜</a></p><p>[2]  <a href="https://cmake.org/cmake-tutorial/">CMake-tutorial</a></p><p>[3] ã€ŠCMake Praticeã€‹</p><p>[4]  <a href="https://cmake.org/mailing-lists/">cmake-maillist</a></p><p>[5]  <a href="https://github.com/onqtam/awesome-cmake">awesome-camke</a></p><p>[6] ã€ŠMastering CMakeã€‹</p>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>gccå’Œg++ä½¿ç”¨</title>
    <link href="/2018/08/17/gcc%E5%92%8Cg++%E4%BD%BF%E7%94%A8/"/>
    <url>/2018/08/17/gcc%E5%92%8Cg++%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>gcc/g++ å’Œ makefile çš„åŸºæœ¬ç”¨æ³•</p><a id="more"></a><h4 id="gcc-g-æµç¨‹"><a href="#gcc-g-æµç¨‹" class="headerlink" title="gcc/g++æµç¨‹"></a>gcc/g++æµç¨‹</h4><p><strong>é¢„å¤„ç†</strong>ã€€ï¼&gt;  <strong>ç¼–è¯‘</strong>ã€€ï¼&gt;ã€€<strong>æ±‡ç¼–</strong>ã€€ï¼&gt;  <strong>é“¾æ¥</strong></p><h4 id="å¸¸è§é€‰é¡¹"><a href="#å¸¸è§é€‰é¡¹" class="headerlink" title="å¸¸è§é€‰é¡¹"></a>å¸¸è§é€‰é¡¹</h4><h6 id="ç›®å½•é€‰é¡¹"><a href="#ç›®å½•é€‰é¡¹" class="headerlink" title="ç›®å½•é€‰é¡¹"></a>ç›®å½•é€‰é¡¹</h6><p><strong>-L[dir]</strong>     ã€€æŒ‡å®šæœç´¢ç›®å½•</p><p>é»˜è®¤ä¼šåœ¨<code>/lib</code>å’Œ<code>/usr/lib</code>å’Œ<code>/usr/local/lib</code>ä¸‰ä¸ªç›®å½•è¿›è¡Œæœç´¢</p><p>ğŸ‘‰  åŠ¨æ€æ·»åŠ æ–¹æ³•ã€€<code>pkg-config [pkg_name] â€”libs</code></p><p><strong>-l[libname]</strong>      æŒ‡å®šç¨‹åºè¦é“¾æ¥çš„åº“ï¼Œ-lå‚æ•°ç´§æ¥ç€å°±æ˜¯åº“å</p><p>ä¾‹å¦‚ï¼š åº“åæ˜¯<code>m</code>ï¼Œã€€åº“æ–‡ä»¶åã€€<code>libm.so</code>ã€€ é“¾æ¥ã€€<code>-lm</code></p><h6 id="å¤´æ–‡ä»¶è®¾ç½®"><a href="#å¤´æ–‡ä»¶è®¾ç½®" class="headerlink" title="å¤´æ–‡ä»¶è®¾ç½®"></a>å¤´æ–‡ä»¶è®¾ç½®</h6><p><strong>-I</strong>            æŒ‡å®šå¤´æ–‡ä»¶ç›®å½•</p><p><code>/usr/include</code>ç›®å½•ä¸€èˆ¬æ˜¯ä¸ç”¨æŒ‡å®šçš„ï¼ŒgccçŸ¥é“å»é‚£é‡Œæ‰¾ï¼Œä½†æ˜¯å¦‚æœå¤´æ–‡ä»¶ä¸åœ¨ <code>/usr/icnclude</code> é‡Œæˆ‘ä»¬å°±è¦ç”¨-Iå‚æ•°æŒ‡å®šäº†ï¼Œæ¯”å¦‚å¤´æ–‡ä»¶æ”¾åœ¨ <code>/myinclude</code>ç›®å½•é‡Œï¼Œé‚£ç¼–è¯‘å‘½ä»¤è¡Œå°±è¦åŠ ä¸Š    <code>-I /myinclude</code></p><p><strong>â€”include [lib]</strong>      ç”¨æ¥åŒ…å«å¤´æ–‡ä»¶</p><p>ä¸€èˆ¬æƒ…å†µä¸‹åŒ…å«å¤´æ–‡ä»¶éƒ½åœ¨æºç é‡Œç”¨<code>ï¼ƒinclude xxxxxx</code>å®ç°ï¼Œ <code>--include</code>  å‚æ•°å¾ˆå°‘ç”¨ã€‚</p><h6 id="è¿æ¥å™¨é€‰é¡¹"><a href="#è¿æ¥å™¨é€‰é¡¹" class="headerlink" title="è¿æ¥å™¨é€‰é¡¹"></a>è¿æ¥å™¨é€‰é¡¹</h6><p><strong>-share</strong>        å…±äº«åº“:å°½é‡ä½¿ç”¨åŠ¨æ€åº“</p><p><strong>-static</strong> ã€€    é™æ€åº“: ç¦æ­¢ä½¿ç”¨åŠ¨æ€åº“</p><h6 id="è­¦å‘Šé€‰é¡¹"><a href="#è­¦å‘Šé€‰é¡¹" class="headerlink" title="è­¦å‘Šé€‰é¡¹"></a>è­¦å‘Šé€‰é¡¹</h6><p><strong>-w</strong>            ç¦æ­¢æ‰€æœ‰è­¦å‘Šä¿¡æ¯</p><p><strong>-Wall</strong>             å¼€å¯å¤§éƒ¨åˆ†è­¦å‘Šæç¤º</p><p><strong>-Werror</strong>        è§†è­¦å‘Šä¸ºé”™è¯¯</p><h6 id="æŒ‡å®šä¼˜åŒ–çº§åˆ«"><a href="#æŒ‡å®šä¼˜åŒ–çº§åˆ«" class="headerlink" title="æŒ‡å®šä¼˜åŒ–çº§åˆ«"></a>æŒ‡å®šä¼˜åŒ–çº§åˆ«</h6><p>åŒ…å«<code>-O1</code>/<code>-O2</code>  å’Œ<code>-O3</code>ç­‰çº§åˆ«ï¼Œæ¨èä½¿ç”¨<code>-O3</code>ã€€è¿›è¡Œä¼˜åŒ–</p><h6 id="ç”Ÿæˆä½ç½®æ— å…³ç›®æ ‡ç "><a href="#ç”Ÿæˆä½ç½®æ— å…³ç›®æ ‡ç " class="headerlink" title="ç”Ÿæˆä½ç½®æ— å…³ç›®æ ‡ç "></a>ç”Ÿæˆä½ç½®æ— å…³ç›®æ ‡ç </h6><p><strong>-fpic</strong>            é€‚ç”¨äºå…±äº«åº“</p><p><strong>-fPIC</strong>ã€€          é€‚ç”¨äºåŠ¨æ€é“¾æ¥åº“</p><h6 id="è¯­è¨€é€‰é¡¹"><a href="#è¯­è¨€é€‰é¡¹" class="headerlink" title="è¯­è¨€é€‰é¡¹"></a>è¯­è¨€é€‰é¡¹</h6><p><strong>-ansi</strong>         #ã€€æ”¯æŒç¬¦åˆï¼¡ï¼®ï¼³ï¼©æ ‡å‡†çš„ï¼£ç¨‹åº</p><p><strong>-std=c99</strong>      # c99æ ‡å‡†</p><p><strong>-std=C++11</strong>    #ã€€æ”¯æŒã€€c++11ã€€æ ‡å‡†  &lt;-</p><h6 id="å¸¸è§ç¯å¢ƒå˜é‡"><a href="#å¸¸è§ç¯å¢ƒå˜é‡" class="headerlink" title="å¸¸è§ç¯å¢ƒå˜é‡"></a>å¸¸è§ç¯å¢ƒå˜é‡</h6><p><strong>PKG_CONFIG_PATH</strong>ï¼šç”¨æ¥æŒ‡å®špkg-configç”¨åˆ°çš„pcæ–‡ä»¶çš„è·¯å¾„ï¼Œé»˜è®¤æ˜¯/usr/lib/pkgconfigï¼Œpcæ–‡ä»¶æ˜¯æ–‡æœ¬æ–‡ä»¶ï¼Œæ‰©å±•åæ˜¯.pcï¼Œé‡Œé¢å®šä¹‰å¼€å‘åŒ…çš„å®‰è£…è·¯å¾„ï¼ŒLibså‚æ•°å’ŒCflagså‚æ•°ç­‰ç­‰ã€‚</p><p><strong>CC</strong>ï¼šç”¨æ¥æŒ‡å®šcç¼–è¯‘å™¨ã€‚</p><p><strong>CXX</strong>ï¼šç”¨æ¥æŒ‡å®šcxxç¼–è¯‘å™¨ã€‚</p><p><strong>LIBS</strong>ï¼šè·Ÿä¸Šé¢çš„â€”libsä½œç”¨å·®ä¸å¤šã€‚</p><p><strong>CFLAGS</strong>:è·Ÿä¸Šé¢çš„â€”cflagsä½œç”¨å·®ä¸å¤šã€‚</p><p><strong>CCï¼ŒCXXï¼ŒLIBSï¼ŒCFLAGS</strong> æ‰‹åŠ¨ç¼–è¯‘æ—¶ä¸€èˆ¬ç”¨ä¸ä¸Šï¼Œåœ¨åšconfigureæ—¶æœ‰æ—¶ç”¨åˆ°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸ç”¨ç®¡ã€‚</p><p>ç¯å¢ƒå˜é‡è®¾å®šæ–¹æ³•ï¼š<strong>export  ENV_NAME=xxx</strong></p><h4 id="makefile-åŸºæœ¬æ ¼å¼"><a href="#makefile-åŸºæœ¬æ ¼å¼" class="headerlink" title="makefile åŸºæœ¬æ ¼å¼"></a>makefile åŸºæœ¬æ ¼å¼</h4><pre><code class="hljs cmake"><span class="hljs-comment"># æŒ‡å®šç¼–è¯‘å™¨</span><span class="hljs-comment"># è®¾ç½®ç¼–è¯‘é€‰é¡¹</span><span class="hljs-comment"># åº“ &amp; å¤´æ–‡ä»¶</span><span class="hljs-comment"># å˜é‡è®¾ç½®</span><span class="hljs-comment"># è¯­å¥ï¼š</span><span class="hljs-comment"># ç¼–è¯‘ç›®æ ‡ï¼šä¾èµ–æ–‡ä»¶</span><span class="hljs-comment">#     è¿è¡Œè„šæœ¬</span><span class="hljs-comment"># æ¸…ç†è„šæœ¬</span></code></pre><h4 id="makefile-æ¨¡æ¿"><a href="#makefile-æ¨¡æ¿" class="headerlink" title="makefile æ¨¡æ¿"></a>makefile æ¨¡æ¿</h4><pre><code class="hljs makefile">CC = g++ CFLAGS += -g -O3 -WallINC += -I. `pkg-config --cflags opencv`ã€€LIBS += `pkg-config --libs opencv`ã€€ã€€TARGET = main.binOBJS += main.o \        config.o <span class="hljs-section">all:<span class="hljs-variable">$(TARGET)</span></span><span class="hljs-variable">$(TARGET)</span>:<span class="hljs-variable">$(OBJS)</span>    <span class="hljs-variable">$(CC)</span> <span class="hljs-variable">$(INC)</span> <span class="hljs-variable">$(CFLAGS)</span> <span class="hljs-variable">$(OBJS)</span> -o <span class="hljs-variable">$(TARGET)</span> <span class="hljs-variable">$(LIBS)</span><span class="hljs-variable">$(OBJS)</span>:%.o:%.cpp    <span class="hljs-variable">$(CC)</span> <span class="hljs-variable">$(INC)</span> <span class="hljs-variable">$(CFLAGS)</span> -c <span class="hljs-variable">$&lt;</span> -o <span class="hljs-variable">$@</span><span class="hljs-meta"><span class="hljs-meta-keyword">.PHONY</span>:clean</span><span class="hljs-section">clean:ã€€</span>    rm -r *.o <span class="hljs-variable">$(TARGET)</span></code></pre><p>å‚è€ƒ:</p><p>&lt;è·Ÿæˆ‘ä¸€èµ·å†™ Makefile&gt; é™ˆçš“</p>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>LinuxåŸºç¡€çŸ¥è¯†</title>
    <link href="/2018/08/17/Linux%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    <url>/2018/08/17/Linux%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</url>
    
    <content type="html"><![CDATA[<p>Linux ä¸€äº›æœ€æœ€æœ€åŸºæœ¬çš„å¸¸è¯†</p><a id="more"></a><h4 id="1-GNU-vs-BSD"><a href="#1-GNU-vs-BSD" class="headerlink" title="1. GNU vs BSD"></a>1. GNU vs BSD</h4><h5 id="å…¸å‹çš„ç±»-unix-æ“ä½œç³»ç»ŸåŒ…æ‹¬ä¸¤ä¸ªç‰ˆæœ¬ï¼š"><a href="#å…¸å‹çš„ç±»-unix-æ“ä½œç³»ç»ŸåŒ…æ‹¬ä¸¤ä¸ªç‰ˆæœ¬ï¼š" class="headerlink" title="å…¸å‹çš„ç±» unix æ“ä½œç³»ç»ŸåŒ…æ‹¬ä¸¤ä¸ªç‰ˆæœ¬ï¼š"></a>å…¸å‹çš„ç±» unix æ“ä½œç³»ç»ŸåŒ…æ‹¬ä¸¤ä¸ªç‰ˆæœ¬ï¼š</h5><ul><li>BSD ç‰ˆæœ¬ï¼ˆ BSDs &amp; Mac OSï¼‰</li><li>GNU ç‰ˆæœ¬ï¼ˆLinuxï¼‰</li></ul><h5 id="Linuxå†…æ ¸-vs-å‘è¡Œç‰ˆ"><a href="#Linuxå†…æ ¸-vs-å‘è¡Œç‰ˆ" class="headerlink" title="Linuxå†…æ ¸ vs å‘è¡Œç‰ˆ"></a>Linuxå†…æ ¸ vs å‘è¡Œç‰ˆ</h5><p>â€‹        linuxå†…æ ¸æ˜¯ä¸€ç§å¼€æ”¾æºç çš„æ“ä½œç³»ç»Ÿï¼Œæä¾›ç¡¬ä»¶æŠ½è±¡å±‚ã€ç¡¬ç›˜åŠæ–‡ä»¶ç³»ç»Ÿæ§åˆ¶åŠå¤šä»»åŠ¡åŠŸèƒ½çš„ç³»ç»Ÿæ ¸å¿ƒç¨‹åºã€‚<br>â€‹        linuxå‘è¡Œç‰ˆåŸºäºlinuxå†…æ ¸æºç ï¼Œå°†Linuxç³»ç»Ÿçš„å†…æ ¸ä¸å¤–å›´å®ç”¨ç¨‹åºã€è½¯ä»¶å’Œæ–‡æ¡£åŒ…è£…èµ·æ¥ï¼Œå¹¶æä¾›ä¸€äº›ç³»ç»Ÿå®‰è£…ç•Œé¢å’Œç³»ç»Ÿé…ç½®ã€è®¾å®šä¸ç®¡ç†å·¥å…·ï¼Œå°±æ„æˆäº†ä¸€ç§å‘è¡Œç‰ˆæœ¬(distribution)ã€‚</p><p>å„ç§å‘è¡Œç‰ˆå¯ä»¥ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç³»ç»Ÿï¼š</p><ul><li>ä»¥ RPM æ–¹å¼å®‰è£…è½¯ä»¶çš„ç³»ç»Ÿï¼ŒåŒ…æ‹¬Red Hatï¼Œ Fedoraï¼Œ SuSE ç­‰ã€‚</li><li>ä»¥ Debian çš„ dpkgæ–¹å¼å®‰è£…çš„è½¯ä»¶çš„ç³»ç»Ÿï¼ŒåŒ…æ‹¬ Debianï¼Œ Ubuntuï¼ŒB2D ç­‰ã€‚</li></ul><h4 id="2-æ–‡ä»¶çš„ç›®å½•"><a href="#2-æ–‡ä»¶çš„ç›®å½•" class="headerlink" title="2. æ–‡ä»¶çš„ç›®å½•"></a>2. æ–‡ä»¶çš„ç›®å½•</h4><pre><code class="hljs shell">/              æ ¹ç›®å½•â”œâ”€â”€ bin     å­˜æ”¾ç”¨æˆ·äºŒè¿›åˆ¶æ–‡ä»¶  # â”œâ”€â”€ boot    å­˜æ”¾å†…æ ¸å¼•å¯¼é…ç½®æ–‡ä»¶  #â”œâ”€â”€ dev     å­˜æ”¾è®¾å¤‡æ–‡ä»¶  # â”œâ”€â”€ etc     å­˜æ”¾ç³»ç»Ÿé…ç½®æ–‡ä»¶  # â”œâ”€â”€ home    ç”¨æˆ·ä¸»ç›®å½•  # â”œâ”€â”€ lib     åŠ¨æ€å…±äº«åº“â”œâ”€â”€ lost+found  æ–‡ä»¶ç³»ç»Ÿæ¢å¤æ—¶çš„æ¢å¤æ–‡ä»¶â”œâ”€â”€ media   å¯å¸è½½å­˜å‚¨ä»‹è´¨æŒ‚è½½ç‚¹â”œâ”€â”€ mnt     æ–‡ä»¶ç³»ç»Ÿä¸´æ—¶æŒ‚è½½ç‚¹  # â”œâ”€â”€ opt     é™„åŠ çš„åº”ç”¨ç¨‹åºåŒ…â”œâ”€â”€ proc    ç³»ç»Ÿå†…å­˜çš„æ˜ å°„ç›®å½•ï¼Œæä¾›å†…æ ¸ä¸è¿›ç¨‹ä¿¡æ¯  # â”œâ”€â”€ root    root ç”¨æˆ·ä¸»ç›®å½•  #â”œâ”€â”€ sbin    å­˜æ”¾ç³»ç»ŸäºŒè¿›åˆ¶æ–‡ä»¶  # â”œâ”€â”€ srv     å­˜æ”¾æœåŠ¡ç›¸å…³æ•°æ®â”œâ”€â”€ sys     sys è™šæ‹Ÿæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹â”œâ”€â”€ tmp     å­˜æ”¾ä¸´æ—¶æ–‡ä»¶â”œâ”€â”€ usr     å­˜æ”¾ç”¨æˆ·åº”ç”¨ç¨‹åºâ””â”€â”€ var     å­˜æ”¾é‚®ä»¶ã€ç³»ç»Ÿæ—¥å¿—ç­‰å˜åŒ–æ–‡ä»¶   #</code></pre><h4 id="3-è½¯è¿æ¥å’Œç¡¬é“¾æ¥"><a href="#3-è½¯è¿æ¥å’Œç¡¬é“¾æ¥" class="headerlink" title="3. è½¯è¿æ¥å’Œç¡¬é“¾æ¥"></a>3. è½¯è¿æ¥å’Œç¡¬é“¾æ¥</h4><h5 id="ç¡¬é“¾æ¥"><a href="#ç¡¬é“¾æ¥" class="headerlink" title="ç¡¬é“¾æ¥"></a>ç¡¬é“¾æ¥</h5><p>ç¡¬é“¾æ¥å°±æ˜¯åŒä¸€ä¸ªæ–‡ä»¶ä½¿ç”¨äº†å¤šä¸ªåˆ«åï¼Œä»–ä»¬æœ‰å…±åŒçš„ inodeå’Œ data blockå—ã€‚ç¡¬é“¾æ¥å¯ç”±å‘½ä»¤ <code>ln</code> åˆ›å»ºç¡¬é“¾æ¥ï¼š</p><pre><code class="hljs ebnf"><span class="hljs-attribute">ln oldfile newfile</span></code></pre><ul><li>åªèƒ½å¯¹å·²å­˜åœ¨çš„æ–‡ä»¶è¿›è¡Œåˆ›å»ºï¼›ä¸èƒ½å¯¹ç›®å½•è¿›è¡Œåˆ›å»ºï¼Œåªå¯å¯¹æ–‡ä»¶åˆ›å»ºï¼›</li><li>åˆ é™¤ä¸€ä¸ªç¡¬é“¾æ¥æ–‡ä»¶å¹¶ä¸å½±å“å…¶ä»–æœ‰ç›¸åŒ inode å·çš„æ–‡ä»¶ã€‚</li></ul><h5 id="è½¯é“¾æ¥"><a href="#è½¯é“¾æ¥" class="headerlink" title="è½¯é“¾æ¥"></a>è½¯é“¾æ¥</h5><p>è½¯é“¾æ¥å°±æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œåªæ˜¯æ•°æ®å—å†…å®¹æ˜¯å¦ä¸€æ–‡ä»¶çš„è·¯å¾„åçš„æŒ‡å‘ã€‚è½¯é“¾æ¥æœ‰ç€è‡ªå·±çš„ inode å·ä»¥åŠç”¨æˆ·æ•°æ®å—ã€‚å¯ä»¥ä½¿ç”¨<code>ln -s</code> åˆ›å»ºè½¯é“¾æ¥ï¼š</p><pre><code class="hljs shell">ln -s oldfile newfile</code></pre><ul><li>è½¯é“¾æ¥æœ‰è‡ªå·±çš„æ–‡ä»¶å±æ€§åŠæƒé™ç­‰ï¼›</li><li>å¯å¯¹ä¸å­˜åœ¨çš„æ–‡ä»¶æˆ–ç›®å½•åˆ›å»ºè½¯é“¾æ¥ï¼›è½¯é“¾æ¥å¯å¯¹æ–‡ä»¶æˆ–ç›®å½•åˆ›å»ºï¼›</li><li>åˆ›å»ºè½¯é“¾æ¥æ—¶ï¼Œé“¾æ¥è®¡æ•° <strong>i_nlink</strong> ä¸ä¼šå¢åŠ ï¼›</li><li>åˆ é™¤è½¯é“¾æ¥å¹¶ä¸å½±å“è¢«æŒ‡å‘çš„æ–‡ä»¶ï¼Œä½†è‹¥è¢«æŒ‡å‘çš„åŸæ–‡ä»¶è¢«åˆ é™¤ï¼Œåˆ™ç›¸å…³è½¯è¿æ¥è¢«ç§°ä¸ºæ­»é“¾æ¥ï¼ˆå³ <strong>dangling link</strong>ï¼Œè‹¥è¢«æŒ‡å‘è·¯å¾„æ–‡ä»¶è¢«é‡æ–°åˆ›å»ºï¼Œæ­»é“¾æ¥å¯æ¢å¤ä¸ºæ­£å¸¸çš„è½¯é“¾æ¥ï¼‰ã€‚</li></ul><p><img src="/2018/08/17/Linux%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/hard_soft_link.png" alt="hard link vs soft link"></p><h4 id="4-ç¯å¢ƒå˜é‡"><a href="#4-ç¯å¢ƒå˜é‡" class="headerlink" title="4. ç¯å¢ƒå˜é‡"></a>4. ç¯å¢ƒå˜é‡</h4><p>æŸ¥çœ‹ç¯å¢ƒå˜é‡ï¼š<code>echo $PATH</code></p><p> å°†æŒ‡å®šè·¯å¾„åˆ°ç³»ç»Ÿè·¯å¾„(ä¸€æ¬¡æ€§)ï¼š <code>export PATH=$PATH:/path/to/dir</code>  </p><p>å°†æŒ‡å®šè·¯å¾„åˆ°ç³»ç»Ÿè·¯å¾„(é•¿æœŸ)ï¼š</p><pre><code class="hljs shell">vim ~/.bashrcexport PATH=$PATH:/path/to/dirsource ~/.bashrc</code></pre><h4 id="5-å¸¸è§çš„å¼€æºè®¸å¯è¯é€‰æ‹©"><a href="#5-å¸¸è§çš„å¼€æºè®¸å¯è¯é€‰æ‹©" class="headerlink" title="5. å¸¸è§çš„å¼€æºè®¸å¯è¯é€‰æ‹©"></a>5. å¸¸è§çš„å¼€æºè®¸å¯è¯é€‰æ‹©</h4><p><img src="/2018/08/17/Linux%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/license.png" alt="License"></p><p>[å‚è€ƒèµ„æ–™]</p><ol><li><a href="https://www.ibm.com/developerworks/cn/linux/l-cn-hardandsymb-links/">https://www.ibm.com/developerworks/cn/linux/l-cn-hardandsymb-links/</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Linuxå¸¸è§é—®é¢˜</title>
    <link href="/2018/08/17/Linux%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/"/>
    <url>/2018/08/17/Linux%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>ä¸»è¦ç”¨æ¥è®°å½•ä¸€äº› ubuntu(linux) ä½¿ç”¨è¿‡ç¨‹ä¸­ç¢°åˆ°çš„é—®é¢˜</p><a id="more"></a><h4 id="1-å¦‚ä½•æŒ‚è½½ç£ç›˜"><a href="#1-å¦‚ä½•æŒ‚è½½ç£ç›˜" class="headerlink" title="1. å¦‚ä½•æŒ‚è½½ç£ç›˜"></a>1. å¦‚ä½•æŒ‚è½½ç£ç›˜</h4><p>ï¼ˆï¼‘ï¼‰ æ‰¾åˆ°æœªåˆ†é…çš„ç£ç›˜ï¼Œã€€è¿™é‡Œæ˜¯ã€€<code>/dev/sdb</code></p><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo fdisk -l  <span class="hljs-comment"># æ‰¾åˆ°æœªåˆ†é…çš„ç£ç›˜</span></span>Disk /dev/sdb: 1.8 TiB, 2000398934016 bytes, 3907029168 sectorsUnits: sectors of 1 * 512 = 512 bytesSector size (logical/physical): 512 bytes / 4096 bytesI/O size (minimum/optimal): 4096 bytes / 4096 bytesDisklabel type: dosDisk identifier: 0x76738fb3</code></pre><p>ï¼ˆï¼’ï¼‰å¯¹è¯¥ç£ç›˜ä½¿ç”¨fdisk å‘½ä»¤å»ºç«‹åˆ†åŒº:</p><pre><code class="hljs shell">sudo fdisk /dev/sdb<span class="hljs-meta">#</span><span class="bash"> m -&gt; n -&gt; ä¸€è·¯å›è½¦ã€€ï¼&gt; w(ä¿å­˜é€€å‡º)</span><span class="hljs-meta">$</span><span class="bash"> sudo fdisk -l <span class="hljs-comment">#ã€€æ­¤æ—¶å¯ä»¥å‘ç°è®¾å¤‡</span></span>Device     Boot Start        End    Sectors  Size Id Type/dev/sdb1        2048 3907029167 3907027120  1.8T 83 Linux</code></pre><p>ï¼ˆï¼“ï¼‰æ ¼å¼åŒ–åˆ†åŒºï¼Œã€€å¹¶å»ºç«‹æ–‡ä»¶ç³»ç»Ÿ</p><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo mkfs -t ext4 /dev/sdb1  <span class="hljs-comment"># -tã€€æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿæ ¼å¼</span></span></code></pre><p>ï¼ˆï¼”ï¼‰æŒ‚è½½ç£ç›˜åˆ°æŒ‡å®šä½ç½®</p><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> mount /dev/sdb1 /home/data/</span><span class="hljs-meta">#</span><span class="bash"> åŒºåˆ† sdbå’Œsdb1, sdbè¡¨ç¤ºç£ç›˜ï¼Œã€€sdb1åˆ™è¡¨ç¤ºè¯¥ç£ç›˜ä¸Šçš„åˆ†åŒº</span></code></pre><h4 id="2-å¦‚ä½•æŸ¥è¯¢ç«¯å£æ‰€è¿è¡Œçš„ç¨‹åº"><a href="#2-å¦‚ä½•æŸ¥è¯¢ç«¯å£æ‰€è¿è¡Œçš„ç¨‹åº" class="headerlink" title="2. å¦‚ä½•æŸ¥è¯¢ç«¯å£æ‰€è¿è¡Œçš„ç¨‹åº"></a>2. å¦‚ä½•æŸ¥è¯¢ç«¯å£æ‰€è¿è¡Œçš„ç¨‹åº</h4><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo netstat -antp | grep 7000</span>tcp6       0      0 :::7000                 :::*                    LISTEN      12464/frps      <span class="hljs-meta">$</span><span class="bash"> ps 12464</span>  PID TTY      STAT   TIME COMMAND12464 pts/0    Sl     0:00 ./frps<span class="hljs-meta">$</span><span class="bash"> lsof -i:7000   <span class="hljs-comment"># lsof:list open files -&gt; -i </span></span>COMMAND   PID   USER   FD   TYPE  DEVICE SIZE/OFF NODE NAMEfrps    12464 ubuntu    3u  IPv6 7542760      0t0  TCP *:afs3-fileserver (LISTEN)<span class="hljs-meta">$</span><span class="bash"> ps -fe | grep 12464</span>ubuntu   12464  6446  0 00:29 pts/0    00:00:00 ./frpsubuntu   12707  6446  0 00:32 pts/0    00:00:00 grep --color=auto 12464</code></pre><h4 id="3-gdm3ã€lightdm-å’Œ-kdm-çš„è®¤è¯†"><a href="#3-gdm3ã€lightdm-å’Œ-kdm-çš„è®¤è¯†" class="headerlink" title="3. gdm3ã€lightdm å’Œ kdm çš„è®¤è¯†"></a>3. gdm3ã€lightdm å’Œ kdm çš„è®¤è¯†</h4><p>Q:  å½“æˆ‘çš„ win10/mac ç”µè„‘æƒ³è¦æ§åˆ¶ ubuntu ç”µè„‘æ—¶ï¼Œä¸€åˆ‡æ“ä½œæ— è¯¯çš„æƒ…å†µä¸‹ï¼Œåœ¨ç‚¹å‡» â€œè¿œç¨‹ååŠ©â€ æŒ‰é’®æ—¶ï¼Œè¿›å»åè¿‡ä¸€ä¼šå„¿å°±ä¼šå‡ºç°â€œè¿æ¥å·²æ–­å¼€â€çš„æç¤ºã€‚<br>Sï¼š åœ¨æ‰“å¼€å‘æ—¥è‘µå®¢æˆ·ç«¯çš„æƒ…å†µä¸‹ï¼Œæ‰“å¼€å‘½ä»¤ ubuntu è¡Œçª—å£</p><pre><code class="hljs shell">sudo apt-get updatesudo apt-get upgradesudo install lightdm</code></pre><p>é‡å¯Ubuntuç³»ç»Ÿå³å¯è¿œç¨‹æˆåŠŸ</p><p>Rï¼š äº†è§£ä¸€ä¸‹gdm3ã€lightdmã€kdm</p><p>ç»´åŸºç™¾ç§‘ï¼šæ˜¾ç¤ºç®¡ç†å™¨å‘ç”¨æˆ·æ˜¾ç¤ºç™»å½•å±å¹•ã€‚ å½“ç”¨æˆ·æˆåŠŸè¾“å…¥ç”¨æˆ·åå’Œå¯†ç çš„æœ‰æ•ˆç»„åˆæ—¶ï¼Œä¼šè¯å¼€å§‹ã€‚</p><ul><li>gdm3 æ˜¯ gdmçš„ç»§æ‰¿è€…ï¼Œå®ƒæ˜¯GNOMEæ˜¾ç¤ºç®¡ç†å™¨ã€‚ æ›´æ–°çš„gdm3 ä½¿ç”¨äº†æœ€å°çš„gnome-shell ç‰ˆæœ¬ï¼Œå¹¶æä¾›äº†ä¸GNOME3ä¼šè¯ç›¸åŒçš„å¤–è§‚å’Œæ„Ÿè§‰ã€‚</li><li>lightDMï¼Œå³ï¼šLight Display Managerï¼Œæ˜¯ä¸€ä¸ªå…¨æ–°çš„ã€è½»é‡çš„Linuxæ¡Œé¢çš„æ¡Œé¢æ˜¾ç¤ºç®¡ç†å™¨</li><li>kdm æ˜¯ kde ç®¡ç†å™¨çš„æ˜¾ç¤ºã€‚ ä½†åœ¨ KDE5ä¸­ï¼Œå®ƒè¢«å¦å†³ä¸º SDDMï¼Œå®ƒæ›´é€‚åˆä½œä¸ºæ˜¾ç¤ºç®¡ç†å™¨ï¼Œå› æ­¤åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯åœ¨å±å¹•ã€‚</li></ul><p>ç®€å•ç†è§£ï¼Œè¿™ä¸‰ä¸ªåªæ˜¯ä¸åŒç‰ˆæœ¬çš„æ˜¾ç¤ºç®¡ç†å™¨è€Œå·²ï¼Œå½“ä½ çš„ ubuntu ç³»ç»Ÿå®‰è£…äº†å¤šä¸ªæ˜¾ç¤ºç®¡ç†å™¨æ—¶ï¼Œ(ä»¥ lightdm åˆ‡æ¢åˆ° gdm3 ä¸ºä¾‹ï¼‰å¯ä»¥ç”¨ <code>sudo dpkg-reconfigure gdm3</code> æ¥è¿›è¡Œåˆ‡æ¢ã€‚</p><h4 id="4-xrandr-ä½¿ç”¨"><a href="#4-xrandr-ä½¿ç”¨" class="headerlink" title="4. xrandr ä½¿ç”¨"></a>4. xrandr ä½¿ç”¨</h4><p>è£…äº†ä¸€ä¸ªä¾§å±ï¼Œ éœ€è¦ä½¿ç”¨ xrandr æ¥è¿›è¡Œç›¸å…³è®¾ç½®ï¼š</p><ul><li><p>xrandr : åˆ—å‡ºå¯ç”¨çš„æ˜¾ç¤ºè®¾å¤‡</p><pre><code class="hljs shell">zhaozhichao@zhaozhichao-MS-7B24:~/Desktop/sany/classification$ xrandrScreen 0: minimum 8 x 8, current 3000 x 1920, maximum 32767 x 32767DP-0 connected primary 1920x1080+1080+520 (normal left inverted right x axis y axis) 598mm x 336mm   1920x1080     60.00*+   1600x900      60.00     1280x1024     75.02    60.02     1152x864      75.00     1024x768      75.03    60.00     800x600       75.00    60.32     640x480       75.00    59.94  DP-1 disconnected (normal left inverted right x axis y axis)HDMI-0 disconnected (normal left inverted right x axis y axis)DP-2 disconnected (normal left inverted right x axis y axis)DP-3 disconnected (normal left inverted right x axis y axis)DP-4 connected 1080x1920+0+0 left (normal left inverted right x axis y axis) 598mm x 336mm   1920x1080     60.00*+   1600x900      60.00     1280x1024     75.02    60.02     1152x864      75.00     1024x768      75.03    60.00     800x600       75.00    60.32     640x480       75.00    59.94  DP-5 disconnected (normal left inverted right x axis y axis)USB-C-0 disconnected (normal left inverted right x axis y axis)</code></pre></li><li><p>è®¾ç½®åˆ†è¾¨ç‡</p><pre><code class="hljs shell">xrandr --output eDP1 --mode 1280x1024_60.00</code></pre></li><li><p>åŒå±è®¾ç½®</p><pre><code class="hljs shell">xrandr --output DP-4 --left-of  DP-0 --auto // DP-4 ä½œä¸º DP-0 çš„å·¦å±å¹•æ˜¾ç¤º                                              //  --left-of                                                // --right-of</code></pre></li><li><p>å±å¹•å…‹éš†</p><pre><code class="hljs shell">xrandr --output VGA-0 --same-as DVI-D-0 --auto</code></pre></li><li><p>è®¾ç½® å·¦æ—‹è½¬/å³æ—‹è½¬/æ­£å‘</p><pre><code class="hljs shell">xrandr --output DP-0 --rotate normal // leftã€rightã€normal</code></pre></li><li><p>è®¾ç½®ä¸»å±å¹•</p><pre><code class="hljs shell">xrandr --output HDMI2 --auto --primary</code></pre></li></ul><h4 id="5-Uç›˜-ç¡¬ç›˜-mount-æ•…éšœ"><a href="#5-Uç›˜-ç¡¬ç›˜-mount-æ•…éšœ" class="headerlink" title="5. Uç›˜/ç¡¬ç›˜ mount æ•…éšœ"></a>5. Uç›˜/ç¡¬ç›˜ mount æ•…éšœ</h4><pre><code class="hljs applescript">$ sudo mount /dev/sdb1 /mnt$MFTMirr <span class="hljs-keyword">does</span> <span class="hljs-keyword">not</span> match $MFT (<span class="hljs-built_in">record</span> <span class="hljs-number">0</span>).Failed <span class="hljs-keyword">to</span> mount &#x27;/dev/sdb1&#x27;: Input/output <span class="hljs-keyword">error</span>NTFS <span class="hljs-keyword">is</span> either inconsistent, <span class="hljs-keyword">or</span> there <span class="hljs-keyword">is</span> a hardware fault, <span class="hljs-keyword">or</span> <span class="hljs-keyword">it</span>&#x27;s aSoftRAID/FakeRAID hardware. In <span class="hljs-keyword">the</span> <span class="hljs-keyword">first</span> case <span class="hljs-built_in">run</span> chkdsk /f <span class="hljs-keyword">on</span> Windows<span class="hljs-keyword">then</span> reboot <span class="hljs-keyword">into</span> Windows twice. The usage <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> /f parameter <span class="hljs-keyword">is</span> veryimportant! If <span class="hljs-keyword">the</span> device <span class="hljs-keyword">is</span> a SoftRAID/FakeRAID <span class="hljs-keyword">then</span> <span class="hljs-keyword">first</span> <span class="hljs-built_in">activate</span><span class="hljs-keyword">it</span> <span class="hljs-keyword">and</span> mount a different device under <span class="hljs-keyword">the</span> /dev/mapper/ directory, (e.g./dev/mapper/nvidia_eahaabcc1). Please see <span class="hljs-keyword">the</span> &#x27;dmraid&#x27; documentation<span class="hljs-keyword">for</span> more details.</code></pre><p>Sï¼š åˆ©ç”¨ ntfsprogs utility åŒ…é‡Œçš„å·¥å…· ntfsfix ä¿®ç†ä¸€ä¸‹ï¼Œæ„Ÿè§‰åº”è¯¥æ˜¯æŠŠç±»ä¼¼é“¾æ¥å·ä»€ä¹ˆçš„ä¿®ç†å¥½ï¼š</p><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo ntfsfix /dev/sdb1</span>Mounting volume... FAILEDAttempting to correct errors...Processing $MFT and $MFTMirr...Reading $MFT... OKReading $MFTMirr... OKComparing $MFTMirr to $MFT... FAILEDCorrecting differences in $MFTMirr record 0...OKProcessing of $MFT and $MFTMirr completed successfully.Setting required flags on partition... OKGoing to empty the journal ($LogFile)... OKNTFS volume version is 3.1.NTFS partition /dev/sdb1 was processed successfully.</code></pre><h4 id="6-åŒºåˆ†-profile-å’Œ-bashrc"><a href="#6-åŒºåˆ†-profile-å’Œ-bashrc" class="headerlink" title="6. åŒºåˆ† profile å’Œ bashrc"></a>6. åŒºåˆ† profile å’Œ bashrc</h4><div class="table-container"><table><thead><tr><th></th><th>ç”Ÿæ•ˆæ—¶é—´</th><th>é’ˆå¯¹ç”¨æˆ·</th></tr></thead><tbody><tr><td>/etc/profile</td><td>é‡å¯ç”Ÿæ•ˆ</td><td>æ‰€æœ‰ç”¨æˆ·</td></tr><tr><td>/etc/bashrc</td><td>é‡æ–°æ‰“å¼€ä¸€ä¸ª bash ç”Ÿæ•ˆ</td><td>æ‰€æœ‰ç”¨æˆ·</td></tr><tr><td>~/.bash_profileæˆ– ~/.profile</td><td>é‡å¯ç”Ÿæ•ˆ</td><td>å½“å‰ç”¨æˆ·</td></tr><tr><td>~/.bashrc</td><td>é‡æ–°æ‰“å¼€ä¸€ä¸ª bash ç”Ÿæ•ˆ</td><td>å½“å‰ç”¨æˆ·</td></tr></tbody></table></div><h4 id="7-etc-ld-so-conf-ä¸ldconfig"><a href="#7-etc-ld-so-conf-ä¸ldconfig" class="headerlink" title="7. /etc/ld.so.conf ä¸ldconfig"></a>7. /etc/ld.so.conf ä¸ldconfig</h4><p><strong>ldconfigå‘½ä»¤</strong> çš„ç”¨é€”ä¸»è¦æ˜¯åœ¨<strong>é»˜è®¤æœå¯»ç›®å½•/libå’Œ/usr/libä»¥åŠåŠ¨æ€åº“é…ç½®æ–‡ä»¶/etc/ld.so.confå†…æ‰€åˆ—çš„ç›®å½•ä¸‹ï¼Œæœç´¢å‡ºå¯å…±äº«çš„åŠ¨æ€é“¾æ¥åº“ï¼ˆæ ¼å¼å¦‚lib*.so*ï¼‰,è¿›è€Œåˆ›å»ºå‡ºåŠ¨æ€è£…å…¥ç¨‹åº(ld.so)æ‰€éœ€çš„è¿æ¥å’Œç¼“å­˜æ–‡ä»¶</strong><br>å¾€ <code>/lib</code> å’Œ <code>/usr/lib</code> é‡Œé¢åŠ ä¸œè¥¿ï¼Œæ˜¯ä¸ç”¨ä¿®æ”¹ <code>/etc/ld.so.conf</code> çš„ï¼Œä½†æ˜¯å®Œäº†ä¹‹åè¦è°ƒä¸€ä¸‹ <code>ldconfig</code>ï¼Œä¸ç„¶è¿™ä¸ª library ä¼šæ‰¾ä¸åˆ°ã€‚<br>æƒ³å¾€ä¸Šé¢ä¸¤ä¸ªç›®å½•ä»¥å¤–åŠ ä¸œè¥¿çš„æ—¶å€™ï¼Œä¸€å®šè¦ä¿®æ”¹ <code>/etc/ld.so.conf</code>ï¼Œç„¶åå†è°ƒç”¨ <code>ldconfig</code>ï¼Œä¸ç„¶ä¹Ÿä¼šæ‰¾ä¸åˆ°ã€‚æ¯”è¾ƒå¸¸è§„çš„æ“ä½œæ˜¯ï¼Œè‡ªå·±ç”Ÿæˆäº†ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼Œç„¶åå°†è·¯å¾„æ·»åŠ åˆ° <code>/etc/ld.so.conf</code>ï¼Œ ç„¶åæ‰§è¡Œ <code>ldconfig</code>ã€‚ è¿™æ ·å°±å¯ä»¥åœ¨ç³»ç»Ÿä¸­è°ƒç”¨è¯¥åŠ¨æ€é“¾æ¥åº“äº†ã€‚</p><h4 id="8-NVIDIA-ç›¸å…³è½¯ä»¶çš„çŸ¥è¯†"><a href="#8-NVIDIA-ç›¸å…³è½¯ä»¶çš„çŸ¥è¯†" class="headerlink" title="8. NVIDIA ç›¸å…³è½¯ä»¶çš„çŸ¥è¯†"></a>8. NVIDIA ç›¸å…³è½¯ä»¶çš„çŸ¥è¯†</h4><p><strong>GPU</strong>:  ç¡¬ä»¶ï¼Œ ä¸»æµçš„æ˜¯ Nvidia çš„ GPU(ç°åœ¨æµè¡Œçš„æ˜¯ RTX 2080Ti)ï¼Œ æ·±åº¦å­¦ä¹ æœ¬èº«éœ€è¦å¤§é‡è®¡ç®—ã€‚ GPU çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼Œ åœ¨è¿‡å»å‡ å¹´é‡Œæ°å½“äº†æ»¡è¶³äº†æ·±åº¦å­¦ä¹ çš„éœ€æ±‚ã€‚ AMD çš„ GPU åŸºæœ¬æ²¡æœ‰ä»€ä¹ˆæ”¯æŒï¼Œ å¯ä»¥ä¸ç”¨è€ƒè™‘ã€‚<br><strong>NVIDIA Driver</strong>: ç¡¬ä»¶æ¥å£ï¼Œ æ²¡æœ‰æ˜¾å¡é©±åŠ¨ï¼Œ å°±ä¸èƒ½è¯†åˆ« GPU ç¡¬ä»¶ï¼Œ ä¸èƒ½è°ƒç”¨å…¶è®¡ç®—èµ„æºã€‚<br><strong>CUDA</strong>: æ˜¯ NVIDIA æ¨å‡ºçš„åªèƒ½ç”¨äºè‡ªå®¶GPUçš„å¹¶è¡Œè®¡ç®—æ¡†æ¶ã€‚åªæœ‰å®‰è£…è¿™ä¸ªæ¡†æ¶æ‰èƒ½å¤Ÿè¿›è¡Œå¤æ‚çš„å¹¶è¡Œè®¡ç®—ã€‚ä¸»æµçš„æ·±åº¦å­¦ä¹ æ¡†æ¶ä¹Ÿéƒ½æ˜¯åŸºäºCUDAè¿›è¡ŒGPUå¹¶è¡ŒåŠ é€Ÿçš„ï¼Œå‡ ä¹æ— ä¸€ä¾‹å¤–ã€‚<br><strong>cudnn</strong>: é’ˆå¯¹æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œçš„åŠ é€Ÿåº“ã€‚<br><strong>Tensorflowã€pytorchã€mxnetã€paddle</strong>: åœ¨ CUDA å’Œ cudnn ä¹‹ä¸Šçš„æ·±åº¦å­¦ä¹ æ¡†æ¶ã€‚</p><h4 id="9-æ˜¾å¡å®‰è£…çš„çŸ¥è¯†"><a href="#9-æ˜¾å¡å®‰è£…çš„çŸ¥è¯†" class="headerlink" title="9. æ˜¾å¡å®‰è£…çš„çŸ¥è¯†"></a>9. æ˜¾å¡å®‰è£…çš„çŸ¥è¯†</h4><p>(1)  <strong>ç¡¬ä»¶</strong>ï¼šæ’ä¸Š GPU<br>(2)  <strong>é©±åŠ¨</strong>:  [å»å®˜ç½‘ä¸‹è½½å¯¹åº”çš„é©±åŠ¨ç¨‹åº]</p><p>a. é¦–å…ˆå±è”½ nouveau</p><pre><code class="hljs shell">sudo vim /etc/modprobe.d/blacklist-nouveau.conf</code></pre><p>åœ¨å…¶ä¸­åŠ å…¥</p><pre><code class="hljs shell">blacklist nouveau</code></pre><p>b. æŒ‰ç…§ ctrl + alt + F1 è¿›å…¥ tty1, ç„¶åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å…³æ‰ X server</p><pre><code class="hljs awk">sudo <span class="hljs-regexp">/etc/i</span>nit.d/lightdm stop</code></pre><p>c. å®‰è£…å¯¹åº”çš„é©±åŠ¨ç¨‹åº<br>d. é‡å¯ X server</p><pre><code class="hljs shell">sudo /etc/init.d/light restart</code></pre><p>ï¼ˆ3ï¼‰ <strong>CUDA &amp; cudnn</strong></p><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> Download CUDA   https://developer.nvidia.com/cuda-downloads</span><span class="hljs-meta">$</span><span class="bash"> chmod a+x cuda-repo-ubuntu1804-10-1-local-10.1.168-418.67_1.0-1_amd64.deb </span><span class="hljs-meta">$</span><span class="bash"> sudo dpkg -i ./cuda-repo-ubuntu1804-10-1-local-10.1.168-418.67_1.0-1_amd64.deb </span><span class="hljs-meta">$</span><span class="bash"> sudo apt-key add /var/cuda-repo-10-1-local-10.1.168-418.67/7fa2af80.pub</span><span class="hljs-meta">$</span><span class="bash"> sudo apt-get update</span><span class="hljs-meta">$</span><span class="bash"> sudo apt-get install cuda-10-1 -y</span><span class="hljs-meta">#</span><span class="bash"> Download cudnn from https://developer.nvidia.com/cudnn</span><span class="hljs-meta">$</span><span class="bash"> sudo cp cuda/include/cudnn.h /usr/<span class="hljs-built_in">local</span>/cuda/include</span><span class="hljs-meta">$</span><span class="bash"> sudo cp cuda/lib64/libcudnn* /usr/<span class="hljs-built_in">local</span>/cuda/lib64</span><span class="hljs-meta">$</span><span class="bash"> sudo chmod a+r /usr/<span class="hljs-built_in">local</span>/cuda/include/cudnn.h /usr/<span class="hljs-built_in">local</span>/cuda/lib64/libcudnn*</span></code></pre><p>åˆ«å¿˜è®° æ‰§è¡Œä»¥ä¸‹ sudo ldconfig</p><h4 id="10-ubuntu-å¾ªç¯ç™»å½•é—®é¢˜"><a href="#10-ubuntu-å¾ªç¯ç™»å½•é—®é¢˜" class="headerlink" title="10. ubuntu å¾ªç¯ç™»å½•é—®é¢˜"></a>10. ubuntu å¾ªç¯ç™»å½•é—®é¢˜</h4><p>è¿™ä¸ªé—®é¢˜æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é—®é¢˜ï¼Œ æˆ‘è¿™æ¬¡ç¢°åˆ°çš„æƒ…å†µæ˜¯æ–°å¢åŠ çš„è´¦æˆ·ä¸èƒ½æ­£å¸¸ç™»é™†, è¿™é‡Œæ˜¯ç”±äºuseraddçš„æ—¶å€™æ²¡æœ‰å…³è”åˆ°å¯¹åº”çš„/homeä¸‹çš„æ–‡ä»¶å¤¹æ‰€è‡´, å¤„ç†å¦‚ä¸‹:</p><p>ï¼ˆ1ï¼‰ä½¿ç”¨: <code>userdel -r ç”¨æˆ·å</code> åˆ é™¤ç”¨æˆ·</p><p>ï¼ˆ2ï¼‰ä½¿ç”¨  <code>useradd -m ç”¨æˆ·å</code> æ·»åŠ ç”¨æˆ· -&gt;  ä¼šåœ¨/homeç›®å½•ä¸‹åˆ›å»ºåŒåæ–‡ä»¶å¤¹</p><p>ï¼ˆ3ï¼‰æ·»åŠ ç”¨æˆ·åˆ°sudoer</p><ul><li><code>sudo visudo</code></li><li>åœ¨<code>%sudo</code>è¡Œä¸‹é¢<code>user ALL=(ALL) ALL</code></li></ul><h4 id="11-linux-productivity-tools"><a href="#11-linux-productivity-tools" class="headerlink" title="11. linux productivity tools"></a>11. linux productivity tools</h4><p>æœ‹å‹åˆ†äº«äº†ä¸€ä»½ linux productivity toolsï¼Œ ç”¨ç©ºå»å­¦ä¹ å­¦ä¹ </p><p>å‚è€ƒç½‘å€ä¸ºï¼š<a href="https://news.ycombinator.com/item?id=23229241">https://news.ycombinator.com/item?id=23229241</a></p><h4 id="12-linux-å¼€æœºè‡ªå¯åŠ¨"><a href="#12-linux-å¼€æœºè‡ªå¯åŠ¨" class="headerlink" title="12. linux å¼€æœºè‡ªå¯åŠ¨"></a>12. linux å¼€æœºè‡ªå¯åŠ¨</h4><p><strong>æ–¹å¼ä¸€. ä½¿ç”¨è‡ªå¸¦å¼€æœºè„šæœ¬</strong></p><p>ä½¿ç”¨ <code>/etc/rc.local</code> æ–‡ä»¶ï¼Œåœ¨ ubuntu18.04 ä¸­å¯ä»¥è‡ªå·±æ–°å»ºè¿™ä¸ªæ–‡ä»¶ã€‚</p><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/</span>rc.local</code></pre><p>æ–‡ä»¶çš„å…·ä½“å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼Œå°†å¼€æœºè‡ªå¯åŠ¨å‘½ä»¤åŠ åœ¨ exit 0 ä¹‹å‰ã€‚</p><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/sh -e</span><span class="hljs-meta">#</span><span class="hljs-meta">#</span><span class="bash"> rc.local</span><span class="hljs-meta">#</span><span class="hljs-meta">#</span><span class="bash"> This script is executed at the end of each multiuser runlevel.</span><span class="hljs-meta">#</span><span class="bash"> Make sure that the script will <span class="hljs-string">&quot;exit 0&quot;</span> on success or any other</span><span class="hljs-meta">#</span><span class="bash"> value on error.</span><span class="hljs-meta">#</span><span class="hljs-meta">#</span><span class="bash"> In order to <span class="hljs-built_in">enable</span> or <span class="hljs-built_in">disable</span> this script just change the execution</span><span class="hljs-meta">#</span><span class="bash"> bits.</span><span class="hljs-meta">#</span><span class="hljs-meta">#</span><span class="bash"> By default this script does nothing.</span>exit 0</code></pre><p>ä¿®æ”¹æ‰§è¡Œæƒé™å³å¯</p><pre><code class="hljs shell">chmod +x /etc/rc.local</code></pre><p><strong>æ–¹å¼äºŒ. æ·»åŠ å¼€æœºè„šæœ¬</strong></p><p>(1) åœ¨ã€€<code>/etc/init.d/</code> ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶ auto_start.shï¼Œã€€å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼Œè®²å¾…æ‰§è¡Œå‘½ä»¤å¡«å†™åœ¨ exit 0 ä¹‹å‰ã€‚ã€€</p><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash  </span><span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">command</span> content      </span>exit 0</code></pre><p>(2) æ›´æ”¹è„šæœ¬æƒé™:</p><pre><code class="hljs shell">sudo chmod +x auto_start.sh</code></pre><p>(3) å°†è„šæœ¬æ·»åŠ åˆ°å¯åŠ¨è„šæœ¬, æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤å³å¯ï¼Œåœ¨è¿™é‡Œ90è¡¨æ˜ä¸€ä¸ªä¼˜å…ˆçº§ï¼Œè¶Šé«˜è¡¨ç¤ºæ‰§è¡Œçš„è¶Šæ™šã€‚</p><pre><code class="hljs shell">cd /etc/init.d/  sudo update-rc.d auto_start.sh defaults 90</code></pre><p>Note:ã€€å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç§»é™¤å¼€æœºè„šæœ¬ï¼š</p><pre><code class="hljs shell">sudo update-rc.d -f new_service.sh remove</code></pre><h4 id="13-NVIDIA-å¸¸è§å‘½ä»¤"><a href="#13-NVIDIA-å¸¸è§å‘½ä»¤" class="headerlink" title="13. NVIDIA å¸¸è§å‘½ä»¤"></a>13. NVIDIA å¸¸è§å‘½ä»¤</h4><h6 id="nvidia-smi"><a href="#nvidia-smi" class="headerlink" title="nvidia-smi"></a>nvidia-smi</h6><p>åœ¨è¿›è¡Œæ·±åº¦å­¦ä¹ å®éªŒæ—¶ï¼ŒGPU çš„å®æ—¶çŠ¶æ€ç›‘æµ‹ååˆ†æœ‰å¿…è¦ã€‚ä»Šå¤©è¯¦ç»†è§£è¯»ä¸€ä¸‹ <code>nvidia-smi</code> å‘½ä»¤ã€‚</p><pre><code class="hljs shell">Fri Aug  2 10:10:08 2019       +-----------------------------------------------------------------------------+| NVIDIA-SMI 410.48                 Driver Version: 410.48                    ||-------------------------------+----------------------+----------------------+| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC || Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. ||===============================+======================+======================||   0  GeForce RTX 208...  Off  | 00000000:01:00.0  On |                  N/A || 31%   43C    P8    12W / 250W |    223MiB / 10981MiB |      4%      Default |+-------------------------------+----------------------+----------------------+                                                                               +-----------------------------------------------------------------------------+| Processes:                                                       GPU Memory ||  GPU       PID   Type   Process name                             Usage      ||=============================================================================||    0      1614      G   /usr/lib/xorg/Xorg                            14MiB ||    0      4804      G   /usr/lib/xorg/Xorg                           207MiB |+-----------------------------------------------------------------------------+</code></pre><p>ä¸Šå›¾æ˜¯æœåŠ¡å™¨ä¸Š GeForce GTX 1080 Ti çš„ä¿¡æ¯ï¼Œä¸‹é¢ä¸€ä¸€è§£è¯»å‚æ•°ã€‚ ä¸Šé¢çš„è¡¨æ ¼ä¸­çš„ä¿¡æ¯ä¸ä¸‹é¢çš„å››ä¸ªæ¡†çš„ä¿¡æ¯æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼š</p><p><strong>GPU</strong>ï¼šGPU ç¼–å·ï¼›            <strong>Name</strong>ï¼šGPU å‹å·ï¼›  <strong>Persistence-M</strong>ï¼šæŒç»­æ¨¡å¼çš„çŠ¶æ€ã€‚<br><strong>Fan</strong>ï¼šé£æ‰‡è½¬é€Ÿ(0~100%)  <strong>Temp</strong>ï¼šæ¸©åº¦(æ‘„æ°åº¦)  <strong>Perf</strong>ï¼šæ€§èƒ½çŠ¶æ€ï¼Œä»P0(å°)åˆ°P12(å¤§)ã€€<strong>Pwr:Usage/Cap</strong>ï¼šèƒ½è€—</p><p><strong>Bus-Id</strong>ï¼šGPUæ€»çº¿ã€€ã€€ã€€ã€€<strong>Disp.A</strong>ï¼šDisplay Activeï¼Œè¡¨ç¤ºGPUçš„æ˜¾ç¤ºæ˜¯å¦åˆå§‹åŒ–ï¼›<br><strong>Memory Usage</strong>ï¼šæ˜¾å­˜ä½¿ç”¨ç‡ï¼› </p><p><strong>Volatile GPU-Util</strong>ï¼šæµ®åŠ¨çš„GPUåˆ©ç”¨ç‡ã€€ã€€ã€€<strong>Uncorr. ECC</strong>ï¼šError Correcting Codeï¼Œé”™è¯¯æ£€æŸ¥ä¸çº æ­£<br><strong>Compute M</strong>ï¼šcompute modeï¼Œè®¡ç®—æ¨¡å¼ã€‚</p><p><strong>ä¸‹æ–¹çš„ Processes è¡¨ç¤ºæ¯ä¸ªè¿›ç¨‹å¯¹ GPU çš„æ˜¾å­˜ä½¿ç”¨ç‡</strong></p><h6 id="nvidia-smi-L"><a href="#nvidia-smi-L" class="headerlink" title="nvidia-smi -L"></a>nvidia-smi -L</h6><p>ç¬¬äºŒä¸ªå‘½ä»¤ï¼š<code>nvidia-smi -L</code>, è¯¥å‘½ä»¤ç”¨äºåˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ NVIDIA è®¾å¤‡ä¿¡æ¯ã€‚</p><h6 id="watch-n1-nvidia-smi"><a href="#watch-n1-nvidia-smi" class="headerlink" title="watch -n1 nvidia-smi"></a>watch -n1 nvidia-smi</h6><p>æ¯1ç§’æ£€æŸ¥ä¸€æ¬¡GPUçš„ä½¿ç”¨æƒ…å†µ</p><h6 id="æŸ¥çœ‹CUDA-å’Œ-cudnn-ç‰ˆæœ¬ä¿¡æ¯"><a href="#æŸ¥çœ‹CUDA-å’Œ-cudnn-ç‰ˆæœ¬ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹CUDAã€€å’Œ cudnnã€€ç‰ˆæœ¬ä¿¡æ¯"></a>æŸ¥çœ‹CUDAã€€å’Œ cudnnã€€ç‰ˆæœ¬ä¿¡æ¯</h6><p>æŸ¥çœ‹ CUDA ç‰ˆæœ¬ï¼š</p><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> cat /usr/<span class="hljs-built_in">local</span>/cuda/version.txt</span>CUDA Version 10.0.130</code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤:</p><pre><code class="hljs shell">nvcc --version</code></pre><p>æŸ¥çœ‹ CUDNN ç‰ˆæœ¬ï¼š</p><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> cat /usr/<span class="hljs-built_in">local</span>/cuda/include/cudnn.h | grep CUDNN_MAJOR -A 2</span>rep CUDNN_MAJOR -A 2<span class="hljs-meta">#</span><span class="bash">define CUDNN_MAJOR 7</span><span class="hljs-meta">#</span><span class="bash">define CUDNN_MINOR 5</span><span class="hljs-meta">#</span><span class="bash">define CUDNN_PATCHLEVEL 0</span>--<span class="hljs-meta">#</span><span class="bash">define CUDNN_VERSION (CUDNN_MAJOR * 1000 + CUDNN_MINOR * 100 + CUDNN_PATCHLEVEL)</span><span class="hljs-meta">#</span><span class="bash">include <span class="hljs-string">&quot;driver_types.h&quot;</span></span></code></pre>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ubuntuå¸¸è§çš„è½¯ä»¶å®‰è£…æ–¹å¼</title>
    <link href="/2018/06/17/ubuntu%E5%B8%B8%E8%A7%81%E7%9A%84%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F/"/>
    <url>/2018/06/17/ubuntu%E5%B8%B8%E8%A7%81%E7%9A%84%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<p>ubuntu ä¸€äº›å®‰è£…å‘½ä»¤çš„åŒºåˆ†ï¼Œ æ¯”å¦‚ apt-getã€aptã€snapã€dpkg ç­‰ã€‚</p><a id="more"></a><h4 id="1-apt-vs-apt-get"><a href="#1-apt-vs-apt-get" class="headerlink" title="1. apt vs apt-get"></a>1. apt vs apt-get</h4><p>ã€€ã€€æœ€å¸¸ç”¨çš„ Linux åŒ…ç®¡ç†å‘½ä»¤åˆ†æ•£åœ¨ <code>apt-get</code>ã€<code>apt-cache</code> å’Œ<code>apt-config</code> è¿™ä¸‰æ¡å‘½ä»¤å½“ä¸­ã€‚<code>apt</code> å‘½ä»¤çš„å¼•å…¥å°±æ˜¯<strong>ä¸ºäº†è§£å†³å‘½ä»¤è¿‡äºåˆ†æ•£çš„é—®é¢˜</strong>ï¼Œå®ƒåŒ…æ‹¬äº† apt-get å‘½ä»¤å‡ºç°ä»¥æ¥ä½¿ç”¨æœ€å¹¿æ³›çš„åŠŸèƒ½é€‰é¡¹ï¼Œä»¥åŠ apt-cache å’Œ apt-config å‘½ä»¤ä¸­å¾ˆå°‘ç”¨åˆ°çš„åŠŸèƒ½ã€‚åœ¨ä½¿ç”¨ apt å‘½ä»¤æ—¶ï¼Œç”¨æˆ·ä¸å¿…å†ç”± apt-get è½¬åˆ° apt-cache æˆ– apt-configï¼Œè€Œä¸” apt æ›´åŠ ç»“æ„åŒ–ï¼Œå¹¶ä¸ºç”¨æˆ·æä¾›äº†ç®¡ç†è½¯ä»¶åŒ…æ‰€éœ€çš„å¿…è¦é€‰é¡¹ã€‚</p><p><strong>ç®€å•æ¥è¯´å°±æ˜¯ï¼šapt = apt-getã€apt-cache å’Œ apt-config ä¸­æœ€å¸¸ç”¨å‘½ä»¤é€‰é¡¹çš„é›†åˆã€‚</strong></p><h6 id="aptä¸apt-getä¹‹é—´çš„åŒºåˆ«"><a href="#aptä¸apt-getä¹‹é—´çš„åŒºåˆ«" class="headerlink" title="aptä¸apt-getä¹‹é—´çš„åŒºåˆ«"></a>aptä¸apt-getä¹‹é—´çš„åŒºåˆ«</h6><p>ã€€ã€€é€šè¿‡ apt å‘½ä»¤ï¼Œç”¨æˆ·å¯ä»¥åœ¨åŒä¸€åœ°æ–¹é›†ä¸­å¾—åˆ°æ‰€æœ‰å¿…è¦çš„å·¥å…·ï¼Œapt çš„ä¸»è¦ç›®çš„æ˜¯æä¾›ä¸€ç§ä»¥ã€Œè®©ç»ˆç«¯ç”¨æˆ·æ»¡æ„ã€çš„æ–¹å¼æ¥å¤„ç† Linux è½¯ä»¶åŒ…çš„æœ‰æ•ˆæ–¹å¼ã€‚</p><p>ã€€ã€€apt å…·æœ‰æ›´ç²¾å‡ä½†è¶³å¤Ÿçš„å‘½ä»¤é€‰é¡¹ï¼Œè€Œä¸”å‚æ•°é€‰é¡¹çš„ç»„ç»‡æ–¹å¼æ›´ä¸ºæœ‰æ•ˆã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒé»˜è®¤å¯ç”¨çš„å‡ ä¸ªç‰¹æ€§å¯¹æœ€ç»ˆç”¨æˆ·ä¹Ÿéå¸¸æœ‰å¸®åŠ©ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ä½¿ç”¨ apt å‘½ä»¤å®‰è£…æˆ–åˆ é™¤ç¨‹åºæ—¶çœ‹åˆ°è¿›åº¦æ¡ï¼Œapt è¿˜ä¼šåœ¨æ›´æ–°å­˜å‚¨åº“æ•°æ®åº“æ—¶æç¤ºç”¨æˆ·å¯å‡çº§çš„è½¯ä»¶åŒ…ä¸ªæ•°ã€‚</p><p>ã€€ã€€å¦‚æœä½ ä½¿ç”¨ apt çš„å…¶å®ƒå‘½ä»¤é€‰é¡¹ï¼Œä¹Ÿå¯ä»¥å®ç°ä¸ä½¿ç”¨ apt-get æ—¶ç›¸åŒçš„æ“ä½œã€‚</p><h6 id="aptå’Œapt-getå‘½ä»¤ä¹‹é—´çš„åŒºåˆ«"><a href="#aptå’Œapt-getå‘½ä»¤ä¹‹é—´çš„åŒºåˆ«" class="headerlink" title="aptå’Œapt-getå‘½ä»¤ä¹‹é—´çš„åŒºåˆ«"></a>aptå’Œapt-getå‘½ä»¤ä¹‹é—´çš„åŒºåˆ«</h6><p>â€‹      è™½ç„¶ apt ä¸ apt-get æœ‰ä¸€äº›ç±»ä¼¼çš„å‘½ä»¤é€‰é¡¹ï¼Œä½†å®ƒå¹¶ä¸èƒ½å®Œå…¨å‘ä¸‹å…¼å®¹ apt-get å‘½ä»¤ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ç”¨ apt æ›¿æ¢éƒ¨åˆ† apt-get ç³»åˆ—å‘½ä»¤ï¼Œä½†ä¸æ˜¯å…¨éƒ¨ã€‚</p><div class="table-container"><table><thead><tr><th style="text-align:left">apt å‘½ä»¤</th><th style="text-align:left">å–ä»£çš„å‘½ä»¤</th><th style="text-align:left">å‘½ä»¤çš„åŠŸèƒ½</th></tr></thead><tbody><tr><td style="text-align:left">apt install</td><td style="text-align:left">apt-get install</td><td style="text-align:left">å®‰è£…è½¯ä»¶åŒ…</td></tr><tr><td style="text-align:left">apt remove</td><td style="text-align:left">apt-get remove</td><td style="text-align:left">ç§»é™¤è½¯ä»¶åŒ…</td></tr><tr><td style="text-align:left">apt purge</td><td style="text-align:left">apt-get purge</td><td style="text-align:left">ç§»é™¤è½¯ä»¶åŒ…åŠé…ç½®æ–‡ä»¶</td></tr><tr><td style="text-align:left">apt update</td><td style="text-align:left">apt-get update</td><td style="text-align:left">åˆ·æ–°å­˜å‚¨åº“ç´¢å¼•</td></tr><tr><td style="text-align:left">apt upgrade</td><td style="text-align:left">apt-get upgrade</td><td style="text-align:left">å‡çº§æ‰€æœ‰å¯å‡çº§çš„è½¯ä»¶åŒ…</td></tr><tr><td style="text-align:left">apt autoremove</td><td style="text-align:left">apt-get autoremove</td><td style="text-align:left">è‡ªåŠ¨åˆ é™¤ä¸éœ€è¦çš„åŒ…</td></tr><tr><td style="text-align:left">apt full-upgrade</td><td style="text-align:left">apt-get dist-upgrade</td><td style="text-align:left">åœ¨å‡çº§è½¯ä»¶åŒ…æ—¶è‡ªåŠ¨å¤„ç†ä¾èµ–å…³ç³»</td></tr><tr><td style="text-align:left">apt search</td><td style="text-align:left">apt-cache search</td><td style="text-align:left">æœç´¢åº”ç”¨ç¨‹åº</td></tr><tr><td style="text-align:left">apt show</td><td style="text-align:left">apt-cache show</td><td style="text-align:left">æ˜¾ç¤ºå®‰è£…ç»†èŠ‚</td></tr></tbody></table></div><p>å½“ç„¶ï¼Œapt è¿˜æœ‰ä¸€äº›è‡ªå·±çš„å‘½ä»¤ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">æ–°çš„aptå‘½ä»¤</th><th style="text-align:left">å‘½ä»¤çš„åŠŸèƒ½</th></tr></thead><tbody><tr><td style="text-align:left">apt list</td><td style="text-align:left">åˆ—å‡ºåŒ…å«æ¡ä»¶çš„åŒ…ï¼ˆå·²å®‰è£…ï¼Œå¯å‡çº§ç­‰ï¼‰</td></tr><tr><td style="text-align:left">apt edit-sources</td><td style="text-align:left">ç¼–è¾‘æºåˆ—è¡¨</td></tr></tbody></table></div><p>éœ€è¦å¤§å®¶æ³¨æ„çš„æ˜¯ï¼šapt å‘½ä»¤ä¹Ÿè¿˜åœ¨ä¸æ–­å‘å±•ï¼Œ å› æ­¤ï¼Œä½ å¯èƒ½ä¼šåœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­çœ‹åˆ°æ–°çš„é€‰é¡¹ã€‚</p><h6 id="apt-getå·²å¼ƒç”¨ï¼Ÿ"><a href="#apt-getå·²å¼ƒç”¨ï¼Ÿ" class="headerlink" title="apt-getå·²å¼ƒç”¨ï¼Ÿ"></a>apt-getå·²å¼ƒç”¨ï¼Ÿ</h6><p>â€‹      ç›®å‰è¿˜æ²¡æœ‰ä»»ä½• Linux å‘è¡Œç‰ˆå®˜æ–¹æ”¾å‡º apt-get å°†è¢«åœç”¨çš„æ¶ˆæ¯ï¼Œè‡³å°‘å®ƒè¿˜æœ‰æ¯” apt æ›´å¤šã€æ›´ç»†åŒ–çš„æ“ä½œåŠŸèƒ½ã€‚å¯¹äºä½çº§æ“ä½œï¼Œä»ç„¶éœ€è¦ apt-getã€‚</p><h6 id="æˆ‘åº”è¯¥ä½¿ç”¨aptè¿˜æ˜¯apt-getï¼Ÿ"><a href="#æˆ‘åº”è¯¥ä½¿ç”¨aptè¿˜æ˜¯apt-getï¼Ÿ" class="headerlink" title="æˆ‘åº”è¯¥ä½¿ç”¨aptè¿˜æ˜¯apt-getï¼Ÿ"></a>æˆ‘åº”è¯¥ä½¿ç”¨aptè¿˜æ˜¯apt-getï¼Ÿ</h6><p>â€‹      æ—¢ç„¶ä¸¤ä¸ªå‘½ä»¤éƒ½æœ‰ç”¨ï¼Œé‚£ä¹ˆæˆ‘è¯¥ä½¿ç”¨ apt è¿˜æ˜¯ apt-get å‘¢ï¼Ÿä½œä¸ºä¸€ä¸ªå¸¸è§„ Linux ç”¨æˆ·ï¼Œå»ºè®®å¤§å®¶å°½å¿«é€‚åº”å¹¶å¼€å§‹é¦–å…ˆä½¿ç”¨ aptã€‚ä¸ä»…å› ä¸ºå¹¿å¤§ Linux å‘è¡Œå•†éƒ½åœ¨æ¨è aptï¼Œæ›´ä¸»è¦çš„è¿˜æ˜¯å®ƒæä¾›äº† Linux åŒ…ç®¡ç†çš„å¿…è¦é€‰é¡¹ã€‚</p><p>â€‹     æœ€é‡è¦çš„æ˜¯ï¼Œapt å‘½ä»¤é€‰é¡¹æ›´å°‘æ›´æ˜“è®°ï¼Œå› æ­¤ä¹Ÿæ›´æ˜“ç”¨ï¼Œæ‰€ä»¥æ²¡ç†ç”±ç»§ç»­åšæŒ apt-getã€‚</p><h6 id="dpkg"><a href="#dpkg" class="headerlink" title="dpkg"></a>dpkg</h6><p>dpkgæ˜¯ç”¨æ¥å®‰è£….debæ–‡ä»¶,ä½†ä¸ä¼šè§£å†³æ¨¡å—çš„ä¾èµ–å…³ç³»,ä¸”ä¸ä¼šå…³å¿ƒubuntuçš„è½¯ä»¶ä»“åº“å†…çš„è½¯ä»¶,å¯ä»¥ç”¨äºå®‰è£…æœ¬åœ°çš„debæ–‡ä»¶ã€‚</p><h6 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h6><p>æœ€åç»“å¤§å®¶æä¾›ä¸¤ç‚¹ä½¿ç”¨ä¸Šçš„å»ºè®®ï¼š</p><ul><li>apt å¯ä»¥çœ‹ä½œ apt-get å’Œ apt-cache å‘½ä»¤çš„å­é›†, å¯ä»¥ä¸ºåŒ…ç®¡ç†æä¾›å¿…è¦çš„å‘½ä»¤é€‰é¡¹ã€‚</li><li>apt-get è™½ç„¶æ²¡è¢«å¼ƒç”¨ï¼Œä½†ä½œä¸ºæ™®é€šç”¨æˆ·ï¼Œè¿˜æ˜¯åº”è¯¥é¦–å…ˆä½¿ç”¨ aptã€‚</li></ul><p>ä»¥ä¸ŠåŸæ–‡é“¾æ¥ï¼š<a href="https://www.sysgeek.cn/apt-vs-apt-get/">https://www.sysgeek.cn/apt-vs-apt-get/</a></p><h4 id="2-apt-åŸºæœ¬å‘½ä»¤"><a href="#2-apt-åŸºæœ¬å‘½ä»¤" class="headerlink" title="2. apt åŸºæœ¬å‘½ä»¤"></a>2. apt åŸºæœ¬å‘½ä»¤</h4><pre><code class="hljs shell">sudo apt install [xxx.deb] # å®‰è£…sudo apt --fix-broken installã€€ã€€#ã€€ä¿®å¤ä¾èµ–<span class="hljs-meta">#</span><span class="bash"> apt update vs upgrade</span>sudo apt updateã€€ã€€# åªæ£€æŸ¥ï¼Œä¸æ›´æ–°ï¼ˆå·²å®‰è£…çš„è½¯ä»¶åŒ…æ˜¯å¦æœ‰å¯ç”¨çš„æ›´æ–°ï¼Œç»™å‡ºæ±‡æ€»æŠ¥å‘Šï¼‰sudo apt upgrade #  æ›´æ–°å·²å®‰è£…çš„è½¯ä»¶åŒ…sudo apt remove     # åˆ é™¤å·²å®‰è£…çš„è½¯ä»¶åŒ…ï¼ˆä¿ç•™é…ç½®æ–‡ä»¶ï¼‰sudo apt purge      # åˆ é™¤å·²å®‰è£…åŒ…ï¼ˆä¸ä¿ç•™é…ç½®æ–‡ä»¶)ï¼Œåˆ é™¤è½¯ä»¶åŒ…ï¼ŒåŒæ—¶åˆ é™¤ç›¸åº”ä¾èµ–è½¯ä»¶åŒ…ã€‚                         # å¦‚æœæƒ³è¦å½»åº•æ¸…ç†è½¯ä»¶ï¼Œã€€å»ºè®®ä½¿ç”¨ã€€purge å‘½ä»¤sudo apt clean    # æ­¤å‘½ä»¤ä¼šå°† /var/cache/apt/archives/ ä¸‹çš„ æ‰€æœ‰ deb åˆ æ‰ï¼Œ                 # ç›¸å½“äºæ¸…ç†ä¸‹è½½çš„è½¯ä»¶å®‰è£…åŒ…ã€‚sudo apt autoremove   # åˆ é™¤å·²å®‰è£…çš„è½¯ä»¶åŒ…ï¼ˆä¿ç•™é…ç½®æ–‡ä»¶ï¼‰ï¼Œä¸ä¼šåˆ é™¤ä¾èµ–è½¯ä»¶åŒ…ï¼Œä¸”ä¿ç•™é…ç½®æ–‡ä»¶ã€‚ï¼ˆè¿™ä¸ªå‘½ä»¤å®¹æ˜“å¯¼è‡´ç³»ç»Ÿæ— æ³•è¿›å…¥ç³»ç»Ÿæ¡Œé¢, åœ¨æ¡Œé¢ç‰ˆçš„Ubuntuç³»ç»Ÿä¸‹å°½é‡ä¸è¦ä½¿ç”¨</code></pre><h4 id="3-å¸¸è§çš„è½¯ä»¶ç¼–è¯‘å®‰è£…æ–¹æ³•"><a href="#3-å¸¸è§çš„è½¯ä»¶ç¼–è¯‘å®‰è£…æ–¹æ³•" class="headerlink" title="3. å¸¸è§çš„è½¯ä»¶ç¼–è¯‘å®‰è£…æ–¹æ³•"></a>3. å¸¸è§çš„è½¯ä»¶ç¼–è¯‘å®‰è£…æ–¹æ³•</h4><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> download</span><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">clone</span> [github/path/to/packge]</span><span class="hljs-meta">#</span><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> [package]</span><span class="hljs-meta">$</span><span class="bash"> mkdir build</span><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> build</span><span class="hljs-meta">#</span><span class="bash"> build &amp; install</span><span class="hljs-meta">$</span><span class="bash"> cmake ..</span><span class="hljs-meta">$</span><span class="bash"> make </span><span class="hljs-meta">$</span><span class="bash"> sudo make install</span></code></pre><h4 id="ï¼”-snap"><a href="#ï¼”-snap" class="headerlink" title="ï¼”. snap"></a>ï¼”. snap</h4><p>ã€€ã€€Snapæ˜¯Ubuntuæ¯å…¬å¸Canonicaläº2016å¹´4æœˆå‘å¸ƒã€€Ubuntu16.04ã€€æ—¶å€™å¼•å…¥çš„ä¸€ç§å®‰å…¨çš„ã€æ˜“äºç®¡ç†çš„ã€æ²™ç›’åŒ–çš„è½¯ä»¶åŒ…æ ¼å¼ï¼Œä¸ä¼ ç»Ÿçš„dpkg/aptæœ‰ç€å¾ˆå¤§çš„åŒºåˆ«ã€‚Snapå¯ä»¥è®©å¼€å‘è€…å°†ä»–ä»¬çš„è½¯ä»¶æ›´æ–°åŒ…éšæ—¶å‘å¸ƒç»™ç”¨æˆ·ï¼Œè€Œä¸å¿…ç­‰å¾…å‘è¡Œç‰ˆçš„æ›´æ–°å‘¨æœŸï¼›ã€€å…¶æ¬¡Snapåº”ç”¨å¯ä»¥åŒæ—¶å®‰è£…å¤šä¸ªç‰ˆæœ¬çš„è½¯ä»¶ï¼Œæ¯”å¦‚å®‰è£…Python2.7å’ŒPython3.3ã€‚ã€€snapè½¯ä»¶åŒ…ä¸€èˆ¬å®‰è£…åœ¨/snapç›®å½•ä¸‹ã€‚</p><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo snap install [snap_name]ã€€<span class="hljs-comment">#ã€€å®‰è£…snapåŒ…</span></span><span class="hljs-meta">$</span><span class="bash"> sudo snap find [snap_name] <span class="hljs-comment">#ã€€æœç´¢å®‰è£…çš„snapåŒ…</span></span><span class="hljs-meta">$</span><span class="bash"> sudo snap refresh [snap_name] <span class="hljs-comment">#ã€€æ›´æ–°snapåŒ…</span></span><span class="hljs-meta">$</span><span class="bash"> sudo snap remove [snap_name] <span class="hljs-comment">#ã€€åˆ é™¤ snap åŒ…</span></span><span class="hljs-meta">$</span><span class="bash"> snap list <span class="hljs-comment">#ã€€åˆ—å‡ºå·²ç»å®‰è£…çš„snapåŒ…</span></span></code></pre><h4 id="5-Python-packgae-å®‰è£…æ–¹å¼"><a href="#5-Python-packgae-å®‰è£…æ–¹å¼" class="headerlink" title="5. Python packgae å®‰è£…æ–¹å¼"></a>5. Python packgae å®‰è£…æ–¹å¼</h4><h6 id="pip-pip3"><a href="#pip-pip3" class="headerlink" title="pip/pip3"></a>pip/pip3</h6><p>æ¯”è¾ƒå¸¸è§çš„å®‰è£…python package çš„æ–¹æ³•    </p><h6 id="conda"><a href="#conda" class="headerlink" title="conda"></a>conda</h6><p>â€‹    condaçš„åŒ…ç®¡ç†æ¯”è¾ƒå¥½ç†è§£äº†ï¼Œè¿™éƒ¨åˆ†åŠŸèƒ½ä¸pipç±»ä¼¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœéœ€è¦å®‰è£…scipyï¼Œ å¯ä»¥ä½¿ç”¨ï¼š<code>conda install scipy</code>ã€‚condaä¼šä»ä»è¿œç¨‹æœç´¢scipyçš„ç›¸å…³ä¿¡æ¯å’Œä¾èµ–é¡¹ç›®ã€‚ä¾‹å¦‚ï¼Œscipy ä¾èµ–äºnumpyï¼Œä¸€æ¬¡å¦‚æœä½ åªå®‰è£… scipyï¼Œåˆ™condaè¿˜ä¼šå®‰è£… numpyã€‚ä½ è¿˜å¯ä»¥åŒæ—¶å®‰è£…å¤šä¸ªåŒ…ã€‚ç±»ä¼¼ <code>conda install numpy scipy pandas</code> çš„å‘½ä»¤ä¼šåŒæ—¶å®‰è£…æ‰€æœ‰è¿™äº›åŒ…ã€‚å¦å¤–è¿˜å¯ä»¥é€šè¿‡æ·»åŠ ç‰ˆæœ¬å·ï¼ˆä¾‹å¦‚ <code>conda install numpy=1.10</code>ï¼‰æ¥æŒ‡å®šæ‰€éœ€çš„åŒ…ç‰ˆæœ¬ã€‚</p><p>â€‹    Condaçš„å¤§éƒ¨åˆ†å‘½ä»¤éƒ½å¾ˆç›´è§‚ï¼Œè¦å¸è½½å®‰è£…åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ <code>conda remove package_name</code>ã€‚è¦æ›´æ–°å®‰è£…åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ <code>conda update package_name</code>, è¦æ›´æ–°ç¯å¢ƒä¸­æ‰€æœ‰åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ <code>conda update -all</code>ã€‚è¦æŸ¥çœ‹å·²ç»å®‰è£…çš„åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ <code>conda list</code>, æœ€æ–°ç‰ˆçš„condaæ˜¯ä»site-packagesæ–‡ä»¶å¤¹ä¸­æœç´¢å·²ç»å®‰è£…çš„åŒ…ï¼Œä¸ä¾èµ–äºpipï¼Œå› æ­¤å¯ä»¥æ˜¾ç¤ºå‡ºé€šè¿‡å„ç§æ–¹å¼å®‰è£…çš„åŒ…ã€‚ æœ€åï¼Œå¦‚æœæˆ‘ä»¬ä¸çŸ¥é“è¦æ‰¾çš„åŒ…çš„ç¡®åˆ‡åç§°ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨<code>conda search search_term</code> å°è¯•è¿›è¡Œæœç´¢ã€‚ä¾‹å¦‚ï¼Œè¦å®‰è£… Beatiful Soupï¼Œä½†æ˜¯æˆ‘ä»¬ä¸æ¸…æ¥šç¡®åˆ‡çš„åŒ…åç§°ï¼Œå› æ­¤å¯ä»¥å°è¯•<code>conda search beatifulsoup</code>ã€‚</p><h6 id="apt-get-install-Python-package"><a href="#apt-get-install-Python-package" class="headerlink" title="apt-get install Python package"></a>apt-get install Python package</h6><p>(1) å®‰è£…python2 package</p><pre><code class="hljs shell">sudo apt-get install python-[package]</code></pre><p>(2) å®‰è£…python3 package</p><pre><code class="hljs shell">sudo apt-get install python3-[package]</code></pre><h4 id="6-apt-get-å’Œ-yum-åŒºåˆ«"><a href="#6-apt-get-å’Œ-yum-åŒºåˆ«" class="headerlink" title="6. apt-get å’Œ yum åŒºåˆ«"></a>6. apt-get å’Œ yum åŒºåˆ«</h4><p>ä¸€èˆ¬æ¥è¯´è‘—åçš„linuxç³»ç»ŸåŸºæœ¬ä¸Šåˆ†ä¸¤å¤§ç±»ï¼š</p><ol><li>RedHatç³»åˆ—ï¼šRedhatã€CentOSã€Fedoraç­‰</li><li>Debianç³»åˆ—ï¼šDebianã€Ubuntuç­‰</li></ol><h6 id="RedHat-ç³»åˆ—"><a href="#RedHat-ç³»åˆ—" class="headerlink" title="RedHat ç³»åˆ—"></a>RedHat ç³»åˆ—</h6><ol><li>å¸¸è§çš„å®‰è£…åŒ…æ ¼å¼ rpmåŒ…,å®‰è£…rpmåŒ…çš„å‘½ä»¤æ˜¯â€œrpm -å‚æ•°â€ </li><li>åŒ…ç®¡ç†å·¥å…· yum </li><li>æ”¯æŒtaråŒ…</li></ol><h6 id="Debianç³»åˆ—"><a href="#Debianç³»åˆ—" class="headerlink" title="Debianç³»åˆ—"></a>Debianç³»åˆ—</h6><ol><li>å¸¸è§çš„å®‰è£…åŒ…æ ¼å¼ debåŒ…,å®‰è£…debåŒ…çš„å‘½ä»¤æ˜¯â€œdpkg -å‚æ•°â€ </li><li>åŒ…ç®¡ç†å·¥å…· apt-get </li><li>æ”¯æŒtaråŒ…</li></ol>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Linux_commands</title>
    <link href="/2018/06/05/Linux-commands/"/>
    <url>/2018/06/05/Linux-commands/</url>
    
    <content type="html"><![CDATA[<p>Linux å¸¸è§å‘½ä»¤ï¼šåŸºæœ¬æ–‡ä»¶å’Œç›®å½•æ“ä½œã€æ–‡ä»¶çš„åˆ›å»ºå’ŒæŸ¥é˜…ã€æœç´¢å‘½ä»¤ã€ç£ç›˜çš„å‹ç¼©å’Œè§£å‹ç¼©ã€ç³»ç»Ÿä¿¡æ¯ã€è¿›ç¨‹ç®¡ç†ã€ç”¨æˆ·æƒé™ä¸ç”¨æˆ·ç®¡ç†ã€ç½‘ç»œä¼ è¾“ã€å®‰è£…å¸è½½ã€å¼€å…³æœºã€çª—å£ç®¡ç†ç­‰ã€‚</p><a id="more"></a><h4 id="1-åŸºæœ¬æ–‡ä»¶ä¸ç›®å½•æ“ä½œ"><a href="#1-åŸºæœ¬æ–‡ä»¶ä¸ç›®å½•æ“ä½œ" class="headerlink" title="1. åŸºæœ¬æ–‡ä»¶ä¸ç›®å½•æ“ä½œ"></a>1. åŸºæœ¬æ–‡ä»¶ä¸ç›®å½•æ“ä½œ</h4><pre><code class="hljs shell">ls    # åˆ—å‡ºæ–‡ä»¶   [-a] åˆ—å‡ºå…¨éƒ¨æ–‡ä»¶(åŒ…æ‹¬éšè—æ–‡ä»¶)      [-l]  åˆ—å‡ºé•¿æ•°æ®ä¸²ï¼ŒåŒ…å«å±æ€§ä¸æƒé™ç­‰ä¿¡æ¯      # æŸ¥çœ‹å½“å‰æ–‡ä»¶ä¸‹çš„ç›®å½•ä¸ªæ•°  find ./ | wc -lcd dir  # åˆ‡æ¢åˆ°æŒ‡å®šç›®å½• cd ..   # åˆ‡æ¢åˆ°ä¸Šä¸€çº§ç›®å½•          cd ~    # åˆ‡æ¢åˆ°è‡ªå·±çš„ä¸»æ–‡ä»¶å¤¹       cd -    # åˆ‡æ¢åˆ°åˆšæ‰ç›®å½•pwd    # æ˜¾ç¤ºå½“å‰ç›®å½•mkdir [dirname]    # åˆ›å»ºæ–°æ–‡ä»¶å¤¹      rm [file]  #  åˆ é™¤æ–‡ä»¶æˆ–è€…ç›®å½•     [-r]  åˆ é™¤ç›®å½•    [-f] å¼ºåˆ¶cp [srcfile] [dstfile]   # å¤åˆ¶æ–‡ä»¶         [-r] ç”¨äºå¤åˆ¶ç›®å½•  mv [srcfile] [dstfile]   # å°†æ–‡ä»¶ç§»åŠ¨åˆ°æŒ‡å®šç›®å½•ï¼Œä¸ä½¿ç”¨ [-r] å³å¯ç§»åŠ¨ç›®å½•ï¼ŒåŒä¸€ç›®å½•åˆ™ä¸ºé‡å‘½åtree . # æ˜¾ç¤ºç›®å½•æ ‘     -L   æŒ‡å®šæ˜¾ç¤ºæœ€å¤§å±‚æ•°  sudo apt-get install tree</code></pre><h4 id="2-æ–‡ä»¶åˆ›å»ºä¸æŸ¥é˜…"><a href="#2-æ–‡ä»¶åˆ›å»ºä¸æŸ¥é˜…" class="headerlink" title="2. æ–‡ä»¶åˆ›å»ºä¸æŸ¥é˜…"></a>2. æ–‡ä»¶åˆ›å»ºä¸æŸ¥é˜…</h4><pre><code class="hljs shell">touch filename #  åˆ›å»ºæ–°æ–‡ä»¶   cat file    # æ­£å‘æŸ¥çœ‹æ–‡ä»¶å…¨éƒ¨å†…å®¹     tac file    # åå‘æŸ¥çœ‹æ–‡ä»¶å…¨éƒ¨å†…å®¹    [-n] å¸¦è¡Œå·æ˜¾ç¤ºæ–‡ä»¶head -n file  # æŸ¥çœ‹æ–‡ä»¶å‰nè¡Œ      tail -n file  # æŸ¥çœ‹fileçš„ånè¡Œless file   # æŒ‰é¡µæŸ¥çœ‹æ–‡ä»¶[Page Down]    ä¸‹ç¿»ä¸€é¡µ  [Page Up]  ä¸Šç¿»ä¸€é¡µ    /  å‘ä¸‹æŸ¥è¯¢   ?  å‘ä¸ŠæŸ¥è¯¢   q é€€å‡ºmore file  # æŒ‰é¡µæŸ¥çœ‹æ–‡ä»¶ [Enter]   å‘ä¸‹ä¸€è¡Œ    [Space]å‘ä¸‹ä¸€é¡µ    qé€€å‡º /æŸ¥è¯¢    :f   æ˜¾ç¤ºæ–‡ä»¶åå’Œå½“å‰è¡Œæ•°</code></pre><h4 id="3-æœç´¢å‘½ä»¤"><a href="#3-æœç´¢å‘½ä»¤" class="headerlink" title="3. æœç´¢å‘½ä»¤"></a>3. æœç´¢å‘½ä»¤</h4><pre><code class="hljs shell">locate [filename]    # ç³»ç»Ÿå…¨å±€èŒƒå›´å†…å®šä½æ–‡ä»¶,  ä»/var.lib/mlocateæ•°æ®åº“ä¸­æŸ¥æ‰¾æ–‡ä»¶ï¼Œ                     # ä½†æ˜¯è¯¥æ•°æ®åº“æ¯å¤©æ›´æ–°ä¸€æ¬¡ï¼Œæ‰€ä»¥å¯ä»¥é¦–å…ˆä½¿ç”¨sudo updatedbæ›´æ–°ä¸€ä¸‹æ•°æ®åº“ï¼Œ                     # æ‰èƒ½æŸ¥è¯¢æœ€è¿‘çš„æ–‡ä»¶        whereis [commands]    æœç´¢å‘½ä»¤ä½ç½®(å‘½ä»¤+å¸®åŠ©æ–‡æ¡£)   which  æœç´¢å‘½ä»¤ä½ç½®(å‘½ä»¤+åˆ«å)find  [search_file]  [search_condition]      æœç´¢æ–‡ä»¶ï¼Œåº”è¯¥é¿å…å¤§èŒƒå›´æœç´¢<span class="hljs-meta">#</span><span class="bash"> ç»“åˆé€šé…ç¬¦ä½¿ç”¨ï¼š * ä»»æ„å†…å®¹ ? ä»»æ„ä¸€ä¸ªå­—ç¬¦ []    ä»»æ„ä¸€ä¸ª[]å†…çš„å†…å®¹ </span>grep [search_string]  [search_file]     -v åå‘æœç´¢  -i å¿½ç•¥å¤§å°å†™</code></pre><h4 id="4-ç£ç›˜ä¸å‹ç¼©-è§£å‹ç¼©å‘½ä»¤-F"><a href="#4-ç£ç›˜ä¸å‹ç¼©-è§£å‹ç¼©å‘½ä»¤-F" class="headerlink" title="4. ç£ç›˜ä¸å‹ç¼©/è§£å‹ç¼©å‘½ä»¤ [F]"></a>4. ç£ç›˜ä¸å‹ç¼©/è§£å‹ç¼©å‘½ä»¤ [F]</h4><h5 id="1-æŸ¥çœ‹ç£ç›˜ç©ºé—´"><a href="#1-æŸ¥çœ‹ç£ç›˜ç©ºé—´" class="headerlink" title="(1) æŸ¥çœ‹ç£ç›˜ç©ºé—´"></a>(1) æŸ¥çœ‹ç£ç›˜ç©ºé—´</h5><pre><code class="hljs shell">du -h --max-depth=1 #ã€€æ˜¾ç¤ºå½“å‰ç›®å½•ç£ç›˜å ç”¨, --max-depth=1 æ˜¾ç¤ºçº§åˆ«df -h  # æ£€æŸ¥linuxæœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ç©ºé—´å ç”¨æƒ…å†µ<span class="hljs-meta">#</span><span class="bash"> -h ä»¥äººä»¬è¾ƒæ˜“è¯»çš„å®¹é‡æ ¼å¼ (G/M) æ˜¾ç¤º</span></code></pre><h5 id="2-å‹ç¼©ä¸è§£å‹ç¼©"><a href="#2-å‹ç¼©ä¸è§£å‹ç¼©" class="headerlink" title="(2) å‹ç¼©ä¸è§£å‹ç¼©"></a>(2) å‹ç¼©ä¸è§£å‹ç¼©</h5><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> .zip</span>zip  å‹ç¼©æ–‡ä»¶å.zip  æºæ–‡ä»¶   # å‹ç¼© zip æ–‡ä»¶  [-r] å‹ç¼©ç›®å½•unzip å‹ç¼©æ–‡ä»¶.zip   # è§£å‹<span class="hljs-meta">#</span><span class="bash"> .tar.gz</span>tar -zcvf file.tar.gz æºç›®å½•  å‹ç¼©  [-c] æ‰“åŒ…  [-v] æ˜¾ç¤ºè¿‡ç¨‹ [-f] æŒ‡å®šæ‰“åŒ…åçš„æ–‡ä»¶åtar -zxvf file.tar.gz    è§£å‹<span class="hljs-meta">#</span><span class="bash"> .tar.bz2</span>tar -jcvf file.tar.gz æºç›®å½•   å‹ç¼©  [-c] æ‰“åŒ…  [-v] æ˜¾ç¤ºè¿‡ç¨‹ [-f] æŒ‡å®šæ‰“åŒ…åçš„æ–‡ä»¶åtar -jxcf file.tar.gz   è§£å‹</code></pre><h4 id="5-ç³»ç»Ÿä¿¡æ¯"><a href="#5-ç³»ç»Ÿä¿¡æ¯" class="headerlink" title="5. ç³»ç»Ÿä¿¡æ¯"></a>5. ç³»ç»Ÿä¿¡æ¯</h4><h5 id="æ—¶é—´"><a href="#æ—¶é—´" class="headerlink" title="æ—¶é—´"></a>æ—¶é—´</h5><pre><code class="hljs shell">date   #  æ˜¾ç¤ºå½“å‰æ—¶é—´å’Œæ—¥æœŸ    cal   # æ˜¾ç¤ºå½“æœˆæ—¥å†       uptime  # æ˜¾ç¤ºç³»ç»Ÿå¼€æœºæ—¶é—´</code></pre><h5 id="ç³»ç»Ÿ"><a href="#ç³»ç»Ÿ" class="headerlink" title="ç³»ç»Ÿ"></a>ç³»ç»Ÿ</h5><pre><code class="hljs shell">lsb_release [-a]    # æŸ¥çœ‹linux ç‰ˆæœ¬   uname   [-a]  # æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬  last # æŸ¥çœ‹ç™»å½•ä¿¡æ¯whoami   # æŸ¥çœ‹å½“å‰ç”¨æˆ·ålsof  # åˆ—å‡ºè¿›ç¨‹è°ƒç”¨æˆ–è€…æ‰“å¼€çš„æ–‡ä»¶ä¿¡æ¯vmstat [åˆ·æ–°å»¶æ—¶  åˆ·æ–°æ¬¡æ•°]  # æŸ¥çœ‹ç³»ç»Ÿèµ„æº w # æŸ¥çœ‹ç”¨æˆ·ç™»å½•ä¿¡æ¯</code></pre><h5 id="ç¡¬ä»¶"><a href="#ç¡¬ä»¶" class="headerlink" title="ç¡¬ä»¶"></a>ç¡¬ä»¶</h5><pre><code class="hljs shell">cat /proc/cpuinfo     #  æŸ¥çœ‹CPU ä¿¡æ¯  cat /proc/meminfo     # æŸ¥çœ‹å†…å­˜ä¿¡æ¯df   # æ˜¾ç¤ºç£ç›˜å ç”¨æƒ…å†µ    [-h] æŒ‰ç…§äººä»¬å¸¸è§çš„ KB,MB,GB æ ¼å¼æ˜¾ç¤ºdu   # æ˜¾ç¤ºç›®å½•ç©ºé—´å ç”¨æƒ…å†µ    [-h] æŒ‰ç…§äººä»¬å¸¸è§çš„ KB,MB,GB æ ¼å¼æ˜¾ç¤º   [--max-depth]  æŒ‡å®šæ˜¾ç¤ºç›®å½•æ·±åº¦nvidia-smi  #  æ˜¾ç¤ºnvidia æ˜¾å¡çš„è¿è¡Œæƒ…å†µ</code></pre><h4 id="6-è¿›ç¨‹ç®¡ç†"><a href="#6-è¿›ç¨‹ç®¡ç†" class="headerlink" title="6. è¿›ç¨‹ç®¡ç†"></a>6. è¿›ç¨‹ç®¡ç†</h4><pre><code class="hljs shell">ps    # æ˜¾ç¤ºå½“å‰æ´»åŠ¨è¿›ç¨‹   [aux]  ä»¥BSDç³»ç»Ÿæ ¼å¼æ˜¾ç¤º  [-ef] ä»¥linuxæ ‡å‡†æ ¼å¼æ˜¾ç¤ºtop    # æ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹  kill pid   # æ€æ­»è¿›ç¨‹id  [-9]  å¼ºåˆ¶æ€æ­»killall [è¿›ç¨‹å]  # æŒ‰ç…§è¿›ç¨‹åæ€æ­»è¿›ç¨‹    pkill [è¿›ç¨‹å]  # æŒ‰ç…§è¿›ç¨‹åæ€æ­»è¿›ç¨‹kill %[job num]  # æŒ‰ç…§å·¥ä½œå·æ€æ­»è¿›ç¨‹bg     # åˆ—å‡ºå·²åœæ­¢æˆ–è€…åå°çš„è¿›ç¨‹       fg     # å°†æœ€è¿‘çš„ä½œä¸šå¸¦åˆ°å‰å°   fg  n  # å°†ä½œä¸šnå¸¦åˆ°å‰å° [command] &amp;  #  æŠŠå‘½ä»¤æ”¾å…¥åå°ï¼Œå¹¶åœ¨åå°æ‰§è¡Œ  jobs  # æ˜¾ç¤ºåå°è¿›ç¨‹[command];[Enter];[ctrl] + z  # æŠŠå‘½ä»¤æ”¾åœ¨åå°ï¼Œå¹¶æš‚åœ</code></pre><h4 id="7-æ–‡ä»¶æƒé™ä¸ç”¨æˆ·ç®¡ç†-F"><a href="#7-æ–‡ä»¶æƒé™ä¸ç”¨æˆ·ç®¡ç†-F" class="headerlink" title="7. æ–‡ä»¶æƒé™ä¸ç”¨æˆ·ç®¡ç†  [F]"></a>7. æ–‡ä»¶æƒé™ä¸ç”¨æˆ·ç®¡ç†  [F]</h4><h5 id="1-æ›´æ”¹æ–‡ä»¶æƒé™-ï¼š"><a href="#1-æ›´æ”¹æ–‡ä»¶æƒé™-ï¼š" class="headerlink" title="(1) æ›´æ”¹æ–‡ä»¶æƒé™ ï¼š"></a>(1) æ›´æ”¹æ–‡ä»¶æƒé™ ï¼š</h5><pre><code class="hljs shell">chmod [u|g|o][+|-|=][r|w|x]   file|dir    chmod octal file|dir<span class="hljs-meta">#</span><span class="bash"> u ç”¨æˆ·    g  æ‰€å±ç¾¤ç»„   o å…¶ä»–      r=<span class="hljs-built_in">read</span>(4)     w=write(2)      x=execute(1)</span></code></pre><h5 id="2-ç”¨æˆ·å’Œç”¨æˆ·ç»„ç®¡ç†"><a href="#2-ç”¨æˆ·å’Œç”¨æˆ·ç»„ç®¡ç†" class="headerlink" title="(2) ç”¨æˆ·å’Œç”¨æˆ·ç»„ç®¡ç†"></a>(2) ç”¨æˆ·å’Œç”¨æˆ·ç»„ç®¡ç†</h5><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> user</span>useradd -m username   # æ–°å»ºç”¨æˆ·   [-m] å»ºç«‹ç”¨æˆ·å®¶ç›®å½•passwd username       # ä¸ºæ–°å»ºç”¨æˆ·è®¾ç½®å¯†ç su [username]         # åˆ‡æ¢ç”¨æˆ·ï¼Œ ç¼ºçœåˆ™ä¸º root ç”¨æˆ·userdel -r username   # åˆ é™¤ç”¨æˆ·  [-r] åˆ é™¤ç”¨æˆ·å®¶ç›®å½•more /etc/passwd  # æŸ¥çœ‹æ‰€ç”¨ç”¨æˆ·åŠå…¶æƒé™</code></pre><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> groups</span>groups                           # æŸ¥çœ‹ç”¨æˆ·æ‰€å±äºçš„ç»„usermod -G groupNmame username   # å°†ç”¨æˆ·åŠ å…¥åˆ°ç»„usermod -g groupName username    # å˜æ›´ç”¨æˆ·æ‰€å±çš„æ ¹ç»„more /etc/group  # æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·ç»„åŠå…¶æƒé™</code></pre><pre><code class="hljs shell">chown username dirOrFile  # æ›´æ”¹æ–‡ä»¶çš„æ‹¥æœ‰è€…   -R æ–‡ä»¶å¤¹</code></pre><h5 id="3-ç¯å¢ƒå˜é‡"><a href="#3-ç¯å¢ƒå˜é‡" class="headerlink" title="(3) ç¯å¢ƒå˜é‡"></a>(3) ç¯å¢ƒå˜é‡</h5><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> bashrcä¸profileéƒ½ç”¨äºä¿å­˜ç”¨æˆ·çš„ç¯å¢ƒä¿¡æ¯</span><span class="hljs-meta">#</span><span class="bash"> profileåªèƒ½åœ¨ç™»å…¥çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡ï¼›</span><span class="hljs-meta">#</span><span class="bash"> bashrc åœ¨æ¯æ¬¡æ‰§è¡Œ <span class="hljs-built_in">source</span> æ—¶éƒ½ä¼šä½¿ç”¨å®ƒä¸€æ¬¡</span>source ~/.bashrc</code></pre><h4 id="8-ç½‘ç»œä¼ è¾“-F"><a href="#8-ç½‘ç»œä¼ è¾“-F" class="headerlink" title="8. ç½‘ç»œä¼ è¾“ [F]"></a>8. ç½‘ç»œä¼ è¾“ [F]</h4><pre><code class="hljs shell">netstat         # æŸ¥çœ‹ç½‘ç»œçŠ¶æ€ -t TCP ç«¯å£  -u UDP åè®®ç«¯å£   -l åœ¨ç›‘å¬çŠ¶æ€  -a æ‰€æœ‰ç«¯å£lsof -i:[Port]  # åˆ—å‡ºç«¯å£å ç”¨æƒ…å†µipconfig        # æŸ¥çœ‹ä¸é…ç½®ç½‘ç»œçŠ¶æ€route -n        # æŸ¥çœ‹è·¯ç”±çŠ¶æ€traceroute IP    # æ¢æµ‹å‰å¾€IPçš„è·¯ç”±è·¯å¾„ssh [-P port] user@hostname    # ä»¥userç”¨æˆ·èº«ä»½è¿æ¥åˆ° hostname, ç«¯å£ä¸º portwget file  # ä¸‹è½½file          -c è¡¨ç¤ºæ–­ç‚¹ç»­ä¼   -o æŒ‡å®šæ—¥å¿—æ–‡ä»¶scp  -r  src/path   dst/path     #  ä¸‹è½½å’Œä¸Šä¼ æ–‡ä»¶æˆ–ç›®å½•   -P ç«¯å£host domain # domain -&gt; IPhost IP # IP -&gt; domainping host    #   æ¢æµ‹æŒ‡å®šIPæˆ–è€…åŸŸåçš„ç½‘ç»œçŠ¶å†µ   -c æŒ‡å®šæ¬¡æ•°</code></pre><h4 id="9-å®‰è£…å¸è½½"><a href="#9-å®‰è£…å¸è½½" class="headerlink" title="9. å®‰è£…å¸è½½"></a>9. å®‰è£…å¸è½½</h4><h5 id="æºä»£ç å®‰è£…"><a href="#æºä»£ç å®‰è£…" class="headerlink" title="æºä»£ç å®‰è£…"></a>æºä»£ç å®‰è£…</h5><pre><code class="hljs shell">./configure # è½¯ä»¶é…ç½®å’Œæ£€æŸ¥make # ç¼–è¯‘make install   # å®‰è£…</code></pre><h5 id="äºŒè¿›åˆ¶åŒ…å®‰è£…-ï¼š-apt-get-ubuntu-deb-package"><a href="#äºŒè¿›åˆ¶åŒ…å®‰è£…-ï¼š-apt-get-ubuntu-deb-package" class="headerlink" title="äºŒè¿›åˆ¶åŒ…å®‰è£… ï¼š apt-get (ubuntu - deb package)"></a>äºŒè¿›åˆ¶åŒ…å®‰è£… ï¼š apt-get (ubuntu - deb package)</h5><pre><code class="hljs shell">apt-get install [package_name]      ä½¿ç”¨ apt-getå®‰è£…åŒ…apt-get remove [package_name]    ä½¿ç”¨ apt-getå¸è½½åŒ…</code></pre><h5 id="ç§˜é’¥ç”Ÿæˆ"><a href="#ç§˜é’¥ç”Ÿæˆ" class="headerlink" title="ç§˜é’¥ç”Ÿæˆ"></a>ç§˜é’¥ç”Ÿæˆ</h5><pre><code class="hljs shell">ssh-keygen -f key_name   -C &quot;description&quot;</code></pre><h4 id="11-å¸¸è§çš„å¼€å…³æœºå‘½ä»¤"><a href="#11-å¸¸è§çš„å¼€å…³æœºå‘½ä»¤" class="headerlink" title="11. å¸¸è§çš„å¼€å…³æœºå‘½ä»¤"></a>11. å¸¸è§çš„å¼€å…³æœºå‘½ä»¤</h4><h5 id="å…³æœºå‘½ä»¤"><a href="#å…³æœºå‘½ä»¤" class="headerlink" title="å…³æœºå‘½ä»¤"></a>å…³æœºå‘½ä»¤</h5><pre><code class="hljs shell">shutdown -h now   # å…³æœºï¼ˆä¿å­˜å½“å‰æ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼Œç›¸å¯¹å®‰å…¨ï¼‰âœ¨<span class="hljs-meta">#</span><span class="bash"> å…¶å®ƒï¼š </span>halt         poweroff        init 0</code></pre><h5 id="é‡å¯å‘½ä»¤"><a href="#é‡å¯å‘½ä»¤" class="headerlink" title="é‡å¯å‘½ä»¤"></a>é‡å¯å‘½ä»¤</h5><pre><code class="hljs shell">shutdown -h now      # é‡å¯ (ä¿å­˜å½“å‰æ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼Œç›¸å¯¹å®‰å…¨)  âœ¨rebootinit 6</code></pre><h5 id="é€€å‡ºç™»å½•ï¼š"><a href="#é€€å‡ºç™»å½•ï¼š" class="headerlink" title="é€€å‡ºç™»å½•ï¼š"></a>é€€å‡ºç™»å½•ï¼š</h5><pre><code class="hljs shell">logout  # å»ºè®®æ¯æ¬¡ç¦»å¼€æœåŠ¡å™¨çš„æ—¶å€™é€€å‡ºç™»å½• âœ¨</code></pre><h4 id="12-çª—å£ç®¡ç†å‘½ä»¤"><a href="#12-çª—å£ç®¡ç†å‘½ä»¤" class="headerlink" title="12.  çª—å£ç®¡ç†å‘½ä»¤"></a>12.  çª—å£ç®¡ç†å‘½ä»¤</h4><h5 id="æ ‡ç­¾ç®¡ç†"><a href="#æ ‡ç­¾ç®¡ç†" class="headerlink" title="æ ‡ç­¾ç®¡ç†"></a>æ ‡ç­¾ç®¡ç†</h5><pre><code class="hljs shell">[Ctrl] + [Shift]  + T   #  æ–°å»ºä¸€ä¸ªternimal æ ‡ç­¾ [Ctrl] + [Shift] + W    #  å…³é—­ terminal æ ‡ç­¾ Ctrl + PD / Ctrl + PU   #  åˆ‡æ¢ terminal æ ‡ç­¾é¡µ Alt+n   #   åˆ‡æ¢åˆ°æ ‡ç­¾é¡µn</code></pre><h5 id="çª—å£ç®¡ç†"><a href="#çª—å£ç®¡ç†" class="headerlink" title="çª—å£ç®¡ç†"></a>çª—å£ç®¡ç†</h5><pre><code class="hljs shell">Ctrl + Shift + N    # æ–°å»ºterminalçª—å£Ctrl + shift + Q     # å…³é—­ terminal çª—å£  Alt + Tab    # åœ¨çª—å£ä¹‹é—´åˆ‡æ¢F11    # çª—å£å…¨å±(exit é€€å‡º)</code></pre><h4 id="13-å…¶å®ƒ"><a href="#13-å…¶å®ƒ" class="headerlink" title="13. å…¶å®ƒ"></a>13. å…¶å®ƒ</h4><h5 id="1-å¸¸è§çš„çƒ­é”®"><a href="#1-å¸¸è§çš„çƒ­é”®" class="headerlink" title="(1) å¸¸è§çš„çƒ­é”®"></a>(1) å¸¸è§çš„çƒ­é”®</h5><pre><code class="hljs shell">[Ctrl] + c  # åœæ­¢å½“å‰å‘½ä»¤     [Ctrl] + d  # æ³¨é”€å½“å‰ä¼šè¯     [Ctrl]+z   # ç»“æŸäº¤äº’  [â†‘]         # é‡å¤ä¸Šä¸€æ¡å‘½ä»¤         [Tab]       # å‘½ä»¤è¡¥é½/æ–‡ä»¶è¡¥é½</code></pre><h5 id="2-å¸®åŠ©å‘½ä»¤ï¼š"><a href="#2-å¸®åŠ©å‘½ä»¤ï¼š" class="headerlink" title="(2) å¸®åŠ©å‘½ä»¤ï¼š"></a>(2) å¸®åŠ©å‘½ä»¤ï¼š</h5><pre><code class="hljs shell">man [cmd]  # æŸ¥è¯¢å‘½ä»¤commandçš„è¯´æ˜æ–‡æ¡£   [n]  æŒ‡å®šåˆ†ç±»  -k å…³é”®å­—[command] --help info [cmd]whatis [cmd] # ç®€è¦è¯´æ˜å‘½ä»¤çš„ä½œç”¨which [cmd] # æŸ¥çœ‹ç¨‹åºçš„binaryæ–‡ä»¶æ‰€åœ¨è·¯å¾„whereis [cmd] # æŸ¥çœ‹ç¨‹åºçš„æœç´¢è·¯å¾„sudo ldconfigsource history  # æŸ¥çœ‹å†å²è®°å½•</code></pre><h5 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h5><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> é‡å®šå‘</span><span class="hljs-meta">&gt;</span><span class="bash">   <span class="hljs-comment"># æ ‡å‡†è¾“å‡ºé‡å®šå‘(è¦†ç›–)  </span></span><span class="hljs-meta">2&gt;</span><span class="bash">  <span class="hljs-comment"># æ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘(è¦†ç›–)   </span></span><span class="hljs-meta">&gt;</span><span class="bash">&gt;  <span class="hljs-comment"># æ ‡å‡†è¾“å‡ºé‡å®šå‘(è¿½åŠ ) </span></span><span class="hljs-meta">2&gt;</span><span class="bash">&gt; <span class="hljs-comment"># æ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘(è¿½åŠ ) </span></span>[command] &gt;&gt; [file1] 2&gt;&gt; [file2] # å°†æ­£ç¡®è¾“å‡ºè¿½åŠ åˆ°file1ï¼Œé”™è¯¯è¾“å‡ºè¿½åŠ åˆ°file2<span class="hljs-meta">#</span><span class="bash"> å¤šå‘½ä»¤é¡ºåºæ‰§è¡Œ:     </span>;  # æ— å…³è”é¡ºåºæ‰§è¡Œ   ;        ä¸  &amp;&amp;        æˆ–  ||&amp;&amp; # ä¸||  # æˆ–|   # å°†å‘½ä»¤1çš„æ­£ç¡®è¾“å‡ºä½œä¸ºå‘½ä»¤2 çš„è¾“å…¥</code></pre><p>é€šç”¨çš„å‚æ•°</p><pre><code class="hljs shell">-a  # æ‰€æœ‰ all    -l  # é•¿æ ¼å¼ long-r  # é€’å½’  recursive-h  # äººç±»å¯è¯» human-t  # ç±»å‹ type</code></pre><p>å‚è€ƒèµ„æ–™ï¼š</p><ol><li><p><a href="https://fosswire.com/post/2007/08/unixlinux-command-cheat-sheet/">Linux Command cheatsheet</a></p></li><li><p><a href="http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/index.html">http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/index.html</a></p></li><li><p><a href="https://github.com/chassing/linux-sysadmin-interview-questions">https://github.com/chassing/linux-sysadmin-interview-questions</a></p></li><li><p><a href="http://www.imooc.com/course/programdetail/pid/45">http://www.imooc.com/course/programdetail/pid/45</a></p></li><li><p><a href="http://billie66.github.io/TLCL/book/">http://billie66.github.io/TLCL/book/</a></p></li></ol>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>git</title>
    <link href="/2018/06/01/Git-usage/"/>
    <url>/2018/06/01/Git-usage/</url>
    
    <content type="html"><![CDATA[<p>Git åŸºæœ¬ç”¨æ³•</p><a id="more"></a><h3 id="1-å®‰è£…å’Œé…ç½®"><a href="#1-å®‰è£…å’Œé…ç½®" class="headerlink" title="1. å®‰è£…å’Œé…ç½®"></a>1. å®‰è£…å’Œé…ç½®</h3><pre><code class="hljs shell">sudo apt-get install git  # å®‰è£… git</code></pre><pre><code class="hljs shell">git config --global user.name &quot;Your Name&quot; # è®¾ç½®ç”¨æˆ·ågit config --global user.email &quot;email@example.com&quot;  # è®¾ç½® email<span class="hljs-meta">#</span><span class="bash">  --global è¡¨ç¤ºç³»ç»Ÿç”¨æˆ·çº§åˆ«ï¼Œä¿å­˜äº  ~/.gitconfig   </span><span class="hljs-meta">#</span><span class="bash">  ç¼ºçœåˆ™ä¸ºé¡¹ç›®çº§åˆ«/ä»“åº“çº§åˆ«ï¼Œ ä¿å­˜äºå½“å‰ç›®å½•ä¸‹çš„ã€€.git/config</span></code></pre><pre><code class="hljs shell">ssh-keygen -t rsa -b 4096 -C &quot;your_email@domain.com&quot; <span class="hljs-meta">#</span><span class="bash"> ç”Ÿæˆç§˜é’¥å¯¹ï¼Œ å…¬é’¥æ”¾git, ç§é’¥æ”¾æœ¬åœ°(ä¸€èˆ¬æ”¾ç½®åœ¨ ~/.ssh)</span></code></pre><h3 id="2-åŸºæœ¬ç”¨æ³•"><a href="#2-åŸºæœ¬ç”¨æ³•" class="headerlink" title="2. åŸºæœ¬ç”¨æ³•"></a>2. åŸºæœ¬ç”¨æ³•</h3><p><img src="/2018/06/01/Git-usage/git1.jpg" alt></p><p>åŸºæœ¬çš„æ¦‚å¿µï¼š</p><p><strong>HEAD</strong>: åœ¨ Git ä¸­ï¼ŒHEADæŒ‡é’ˆæ˜¯ä¸€ä¸ªæŒ‡å‘ä½ æ­£åœ¨å·¥ä½œä¸­çš„æœ¬åœ°åˆ†æ”¯çš„æŒ‡é’ˆã€‚</p><p><strong>master</strong>ï¼šåˆ†æ”¯å¹¶ä¸æ˜¯ä¸€ä¸ªç‰¹æ®Šåˆ†æ”¯ã€‚ å®ƒå°±è·Ÿå…¶å®ƒåˆ†æ”¯å®Œå…¨æ²¡æœ‰åŒºåˆ«ã€‚ ä¹‹æ‰€ä»¥å‡ ä¹æ¯ä¸€ä¸ªä»“åº“éƒ½æœ‰ master åˆ†æ”¯ï¼Œæ˜¯å› ä¸º git init å‘½ä»¤é»˜è®¤åˆ›å»ºå®ƒï¼Œå¹¶ä¸”å¤§å¤šæ•°äººéƒ½æ‡’å¾—å»æ”¹åŠ¨å®ƒã€‚<br><strong>origin</strong>ï¼šæ˜¯å½“ä½ è¿è¡Œ git clone æ—¶é»˜è®¤çš„è¿œç¨‹ä»“åº“åå­—ã€‚</p><p><strong>Workspace</strong>ï¼šå·¥ä½œåŒº                                               <strong>Index / Stage</strong>ï¼šæš‚å­˜åŒº<br><strong>Repository</strong>ï¼šä»“åº“åŒºï¼ˆæˆ–æœ¬åœ°ä»“åº“ï¼‰                    <strong>Remote</strong>ï¼šè¿œç¨‹ä»“åº“</p><pre><code class="hljs shell">git init  # å½“å‰ç›®å½•ä¸‹ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª.gitçš„ç›®å½•ï¼Œç”¨æ¥è·Ÿè¸ªç®¡ç†ç‰ˆæœ¬åº“</code></pre><pre><code class="hljs shell">git add &lt;filename&gt; # æ·»åŠ æ–‡ä»¶git rm &lt;filename&gt;  # åˆ é™¤æ–‡ä»¶   -r åˆ é™¤æ–‡ä»¶å¤¹git commit -m &quot;wrote a commit msg&quot;  #ã€€ä»æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“git rm --cached &lt;filename&gt;  # èˆå¼ƒæš‚å­˜åŒºå†…å®¹git push origin master #ã€€ä»æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“</code></pre><pre><code class="hljs shell">git clone /path/to/repository  # åˆ›å»ºä¸€ä¸ªè¿œç¨‹ä»“åº“çš„æœ¬åœ°å…‹éš†ç‰ˆæœ¬git clone usename@host:/path/to/repository # è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ä»“åº“git checkout -- &lt;filename&gt;  # æ›¿æ¢æœ¬åœ°æ”¹åŠ¨ï¼Œã€€å°†ä»“åº“ä¸­çš„æ–‡ä»¶æ›¿æ¢æ‰å·¥ä½œç›®å½•ä¸­çš„æ–‡ä»¶git pull &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;è¿œç¨‹åˆ†æ”¯å&gt;:&lt;æœ¬åœ°åˆ†æ”¯å&gt; ã€€# å–å›è¿œç¨‹ä¸»æœºæŸä¸ªåˆ†æ”¯çš„æ›´æ–°ï¼Œå†ä¸æœ¬åœ°çš„æŒ‡å®šåˆ†æ”¯åˆå¹¶</code></pre><pre><code class="hljs shell">git status  # æ˜¾ç¤ºå·¥ä½œç›®å½•å’Œæš‚å­˜åŒºçš„çŠ¶æ€ï¼ˆæ˜¾ç¤ºæ‰€åœ¨åˆ†æ”¯ã€å·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„çŠ¶æ€ï¼‰</code></pre><h3 id="3-ç‰ˆæœ¬å›é€€å’Œå‰è¿›"><a href="#3-ç‰ˆæœ¬å›é€€å’Œå‰è¿›" class="headerlink" title="3. ç‰ˆæœ¬å›é€€å’Œå‰è¿›"></a>3. ç‰ˆæœ¬å›é€€å’Œå‰è¿›</h3><pre><code class="hljs shell">git log # æŸ¥çœ‹æäº¤å†å²(åŒ…æ‹¬ã€€ID, author, dataç­‰ä¿¡æ¯)  ï¼ƒã€€--pretty=oneline  ä¸€æ¡æ—¥å¿—åªæ˜¾ç¤ºä¸€è¡Œ    --online æ›´åŠ ç®€æ´çš„æ–¹å¼æ˜¾ç¤ºgit reflog # æ˜¾ç¤ºç‰ˆæœ¬ç§»åŠ¨æ­¥æ•° HEAD@&#123;ç§»åŠ¨åˆ°å½“å‰ç‰ˆæœ¬éœ€è¦çš„æ­¥æ•°&#125;</code></pre><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ç‰ˆæœ¬å›é€€ä¸å‰è¿›</span>git reset --hard Index_value # åŸºäºç´¢å¼•å€¼ è¿›è¡Œç‰ˆæœ¬å›é€€å’Œå‰è¿›<span class="hljs-meta">#</span><span class="bash"> --soft ä»…ä»…åœ¨æœ¬åœ°åº“ç§»åŠ¨ HEAD æŒ‡é’ˆ  ã€€ã€€</span><span class="hljs-meta">#</span><span class="bash"> --mixed åœ¨æœ¬åœ°åº“ç§»åŠ¨ HEAD æŒ‡é’ˆï¼Œ å¹¶é‡ç½®æš‚å­˜åŒº</span><span class="hljs-meta">#</span><span class="bash"> --hard åœ¨æœ¬åœ°åº“ç§»åŠ¨HEAD æŒ‡é’ˆï¼Œå¹¶é‡ç½®æš‚å­˜åŒºå’Œå·¥ä½œåŒº</span>git reset --hard HEAD # èˆå¼ƒå·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„ä¿®æ”¹ï¼Œç›´æ¥ç”¨æœ¬åœ°åº“æ›¿æ¢</code></pre><pre><code class="hljs shell">git diff filename # é»˜è®¤æ¯”è¾ƒçš„æ˜¯å·¥ä½œåŒºå’Œæš‚å­˜åŒºgit diff [HEAD] filename # æ¯”è¾ƒå·¥ä½œåŒºå’Œæœ¬åœ°åº“[HEAD]ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹[HEAD]ä¸å†å²è®°å½•è¿›è¡Œæ¯”è¾ƒ</code></pre><h3 id="4-åˆ†æ”¯ç®¡ç†"><a href="#4-åˆ†æ”¯ç®¡ç†" class="headerlink" title="4. åˆ†æ”¯ç®¡ç†"></a>4. åˆ†æ”¯ç®¡ç†</h3><p><img src="/2018/06/01/Git-usage/gitflow.png" alt></p><p>å…¶ä¸­æ¶‰åŠåˆ°çš„ä¸»è¦åˆ†æ”¯ç±»å‹æœ‰ï¼š</p><ul><li><p><strong>masteråˆ†æ”¯</strong>ï¼Œå³ä¸»åˆ†æ”¯ã€‚ä»»ä½•é¡¹ç›®éƒ½å¿…é¡»æœ‰ä¸ªè¿™ä¸ªåˆ†æ”¯ã€‚<strong>å¯¹é¡¹ç›®è¿›è¡Œtagæˆ–å‘å¸ƒç‰ˆæœ¬ç­‰æ“ä½œï¼Œéƒ½å¿…é¡»åœ¨è¯¥åˆ†æ”¯ä¸Šè¿›è¡Œ</strong>ã€‚</p></li><li><p><strong>developåˆ†æ”¯</strong>ï¼Œå³å¼€å‘åˆ†æ”¯ï¼Œ<strong>ä»masteråˆ†æ”¯ä¸Šæ£€å‡º</strong>ã€‚<strong>å›¢é˜Ÿæˆå‘˜ä¸€èˆ¬ä¸ä¼šç›´æ¥æ›´æ”¹è¯¥åˆ†æ”¯ï¼Œè€Œæ˜¯åˆ†åˆ«ä»è¯¥åˆ†æ”¯æ£€å‡ºè‡ªå·±çš„featureåˆ†æ”¯ï¼Œå¼€å‘å®Œæˆåå°†featureåˆ†æ”¯ä¸Šçš„æ”¹åŠ¨mergeå›developåˆ†æ”¯</strong>ã€‚<strong>åŒæ—¶releaseåˆ†æ”¯ç”±æ­¤åˆ†æ”¯æ£€å‡º</strong>ã€‚</p><pre><code class="hljs shell">git branch develop   # ä»å½“å‰åˆ†æ”¯ä¸Šæ–°å»ºdevelopåˆ†æ”¯git checkout develop    # æ£€å‡ºdevelopåˆ†æ”¯<span class="hljs-meta">#</span><span class="bash"> ... æ­¤å¤„å¯è¿›è¡ŒåŠŸèƒ½å¼€å‘ï¼Œå¹¶addå’Œcommitåˆ°developåˆ†æ”¯</span>git push origin develop    # æ¨é€developåˆ†æ”¯åˆ°è¿œç«¯çš„origin</code></pre></li><li><p><strong>releaseåˆ†æ”¯</strong>ï¼Œå³å‘å¸ƒåˆ†æ”¯ï¼Œ<strong>ä»developåˆ†æ”¯ä¸Šæ£€å‡º,è¯¥åˆ†æ”¯ç”¨ä½œå‘ç‰ˆå‰çš„æµ‹è¯•ï¼Œå¯è¿›è¡Œç®€å•çš„bugä¿®å¤</strong>ã€‚å¦‚æœbugä¿®å¤æ¯”è¾ƒå¤æ‚ï¼Œå¯mergeå›developåˆ†æ”¯åç”±å…¶ä»–åˆ†æ”¯è¿›è¡Œbugä¿®å¤ã€‚æ­¤åˆ†æ”¯æµ‹è¯•å®Œæˆåï¼Œéœ€è¦åŒæ—¶mergeåˆ°masterå’Œdevelopåˆ†æ”¯ä¸Šã€‚</p></li><li><p><strong>featureåˆ†æ”¯</strong>ï¼Œå³åŠŸèƒ½åˆ†æ”¯ï¼Œ<strong>ä»developåˆ†æ”¯ä¸Šæ£€å‡ºã€‚å›¢é˜Ÿæˆå‘˜ä¸­æ¯ä¸ªäººéƒ½ç»´æŠ¤ä¸€ä¸ªè‡ªå·±çš„featureåˆ†æ”¯ï¼Œå¹¶è¿›è¡Œå¼€å‘å·¥ä½œï¼Œå¼€å‘å®Œæˆåå°†æ­¤åˆ†æ”¯mergeå›developåˆ†æ”¯</strong>ã€‚æ­¤åˆ†æ”¯ä¸€èˆ¬ç”¨æ¥å¼€å‘æ–°åŠŸèƒ½æˆ–è¿›è¡Œé¡¹ç›®ç»´æŠ¤ç­‰ã€‚</p><pre><code class="hljs shell">git clone /path/to/repositorygit checkout developã€€# æ£€å‡º developåˆ†æ”¯git checkout -b feature-hu develop    # ä»developåˆ†æ”¯æ–°å»ºå¹¶æ£€å‡ºfeatureåˆ†æ”¯... # è¿™é‡Œå¯ä»¥è¿›è¡Œä¸€äº›åŠŸèƒ½å¼€å‘ï¼Œå¹¶ä¸æ–­çš„addå’Œcommitgit checkout develop    # åˆ‡æ¢å›developåˆ†æ”¯git pull origin develop    # æ›´æ–°è¿œç«¯ä»£ç ï¼Œçœ‹developåˆ†æ”¯æ˜¯å¦æœ‰æ›´æ–°ï¼ˆæ— æ›´æ–°ï¼‰git checkout feature-hu    # åˆ‡æ¢å›featureåˆ†æ”¯git rebase develop    # åˆå¹¶developåˆ†æ”¯åˆ°featureåˆ†æ”¯ï¼Œå¹¶è§£å†³å†²çªï¼ˆæ— å†²çªï¼‰git checkout develop    # åˆ‡æ¢å›developåˆ†æ”¯git merge --no-ff feature-hu    # åˆå¹¶featureåˆ†æ”¯åˆ°developåˆ†æ”¯git push origin develop   # æ¨é€developåˆ†æ”¯åˆ°è¿œç«¯</code></pre></li><li><p><strong>fixåˆ†æ”¯</strong>ï¼Œå³è¡¥ä¸åˆ†æ”¯ï¼Œ<strong>ç”±developåˆ†æ”¯æ£€å‡ºï¼Œç”¨ä½œbugä¿®å¤</strong>ï¼Œbugä¿®å¤å®Œæˆéœ€mergeå›developåˆ†æ”¯ï¼Œå¹¶å°†å…¶åˆ é™¤ã€‚æ‰€ä»¥è¯¥åˆ†æ”¯å±äºä¸´æ—¶æ€§åˆ†æ”¯ã€‚</p></li><li><p><strong>hotfixåˆ†æ”¯</strong>ï¼Œå³çƒ­è¡¥ä¸åˆ†æ”¯ã€‚å’Œfixåˆ†æ”¯çš„åŒºåˆ«åœ¨äºï¼Œ<strong>è¯¥åˆ†æ”¯ç”±masteråˆ†æ”¯æ£€å‡ºï¼Œè¿›è¡Œçº¿ä¸Šç‰ˆæœ¬çš„bugä¿®å¤</strong>ï¼Œä¿®å¤å®Œæˆåmergeå›masteråˆ†æ”¯ï¼Œå¹¶mergeåˆ°developåˆ†æ”¯ä¸Šï¼Œmergeå®Œæˆåä¹Ÿå¯ä»¥å°†å…¶åˆ é™¤ï¼Œä¹Ÿå±äºä¸´æ—¶æ€§åˆ†æ”¯ã€‚</p><pre><code class="hljs shell">git checkout master    # åˆ‡æ¢å›masteråˆ†æ”¯git checkout -b hotfix master    # æ–°å»ºhotfixåˆ†æ”¯ï¼Œå¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯......                 # åšä¸€äº›bugä¿®å¤å·¥ä½œgit checkout master    # åˆ‡æ¢å›masteråˆ†æ”¯git merge --no-ff hotfix    # åˆå¹¶hotfixåˆ†æ”¯ï¼Œæ­¤æ—¶bugå·²è¢«ä¿®å¤ï¼ˆæ— å†²çªï¼‰git tag v0.2.1    # æ–°å»ºtag v0.2git push origin master    # æ¨é€masteråˆ†æ”¯ä»£ç åˆ°è¿œç«¯git push origin --tags    # æ¨é€tagåˆ°è¿œç«¯</code></pre></li></ul><p>å¸¸è§åˆ†æ”¯ç®¡ç†å‘½ä»¤å°ç»“ï¼š</p><pre><code class="hljs shell">git branch -v  # æŸ¥çœ‹åˆ†æ”¯git branch &lt;branch_name&gt;   # ä»å½“å‰åˆ†æ”¯æ–°å»ºä¸€ä¸ªåˆ†æ”¯git checkout &lt;branch_name&gt;   # åˆ‡æ¢åˆ°æŒ‡å®šåˆ†æ”¯git checkout -b &lt;branch_name&gt;  # æ–°å»ºåˆ†æ”¯å¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯ <span class="hljs-meta">#</span><span class="bash"> git checkout -b = git branch + git checkout</span>git checkout -d &lt;branch_name&gt; # åˆ é™¤æŒ‡å®šåˆ†æ”¯git push &lt;origin&gt; &lt;branch_name&gt; # æ¨é€æŸä¸ªåˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“</code></pre><pre><code class="hljs nginx"><span class="hljs-attribute">git</span> merge --<span class="hljs-literal">no</span>-ff &lt;branch_name&gt; <span class="hljs-comment"># å°†æŒ‡å®šåˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯</span>git rebase   <span class="hljs-comment"># </span></code></pre><pre><code class="hljs shell">git tag v0.2 # ä¸ºå½“å‰åˆ†æ”¯æ‰“ taggit push origin --tags # å°†tagæ¨é€åˆ°è¿œç¨‹ä»“åº“</code></pre><p><strong>å¦‚ä½•è§£å†³å†²çª</strong></p><pre><code class="hljs vala"><span class="hljs-meta"># è§£å†³å†²çª</span><span class="hljs-meta"># step 1: æ‰‹åŠ¨ä¿®æ”¹å†²çªæ–‡ä»¶</span><span class="hljs-meta"># step 2ï¼š git add filename</span><span class="hljs-meta"># step 3: git commit -m &quot;commit message&quot;</span></code></pre><h3 id="5-è¿œç¨‹æ“ä½œ"><a href="#5-è¿œç¨‹æ“ä½œ" class="headerlink" title="5. è¿œç¨‹æ“ä½œ"></a>5. è¿œç¨‹æ“ä½œ</h3><p><img src="/2018/06/01/Git-usage/git5.png" alt></p><h5 id="å›¢é˜Ÿå†…éƒ¨åä½œï¼š"><a href="#å›¢é˜Ÿå†…éƒ¨åä½œï¼š" class="headerlink" title="å›¢é˜Ÿå†…éƒ¨åä½œï¼š"></a>å›¢é˜Ÿå†…éƒ¨åä½œï¼š</h5><pre><code class="hljs shell">git remote add origin https://xxxx.xxxx.xxxx.xxxx  # æŒ‡å®šè¿œç¨‹åº“çš„åˆ«ågit push -u è¿œç¨‹åº“åç§° æœ¬åœ°åº“åç§°git clone https://xxxx.xxxx.xxxx.xxxx   # clone åˆ°æœ¬åœ°åº“git fetch [è¿œç¨‹åœ°å€åˆ«å][è¿œç¨‹åˆ†æ”¯å]  #git merge [è¿œç¨‹åœ°å€åˆ«å/è¿œç¨‹åˆ†æ”¯å] git pull <span class="hljs-meta">#</span><span class="bash"> git fetchæ˜¯å°†è¿œç¨‹ä¸»æœºçš„æœ€æ–°å†…å®¹æ‹‰åˆ°æœ¬åœ°ï¼Œç”¨æˆ·åœ¨æ£€æŸ¥äº†ä»¥åå†³å®šæ˜¯å¦åˆå¹¶åˆ°å·¥ä½œæœ¬æœºåˆ†æ”¯ä¸­ã€‚</span><span class="hljs-meta">#</span><span class="bash"> è€Œ git pull åˆ™æ˜¯å°†è¿œç¨‹ä¸»æœºçš„æœ€æ–°å†…å®¹æ‹‰ä¸‹æ¥åç›´æ¥åˆå¹¶ï¼Œ</span><span class="hljs-meta">#</span><span class="bash"> å³ï¼šgit pull = git fetch + git merge</span></code></pre><h5 id="è·¨å›¢é˜Ÿåä½œï¼š"><a href="#è·¨å›¢é˜Ÿåä½œï¼š" class="headerlink" title="è·¨å›¢é˜Ÿåä½œï¼š"></a>è·¨å›¢é˜Ÿåä½œï¼š</h5><p>éœ€è¦åœ¨ä»£ç æ‰˜ç®¡ä¸­å¿ƒå®Œæˆ<code>fork</code>ã€<code>pull request</code>ã€ <code>å®¡æ ¸</code>ã€<code>merge</code> ç­‰æ“ä½œ</p><p><img src="/2018/06/01/Git-usage/git6.png" alt></p><h3 id="6-å®‰è£…-GitLab"><a href="#6-å®‰è£…-GitLab" class="headerlink" title="6. å®‰è£… GitLab"></a>6. å®‰è£… GitLab</h3><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å®‰è£…</span><span class="hljs-meta">$</span><span class="bash"> curl -sS http://packages.gitlab.com.cn/install/gitlab-ce/script.deb.sh | sudo bash</span><span class="hljs-meta">$</span><span class="bash"> sudo apt-get install gitlab-ce</span><span class="hljs-meta">#</span><span class="bash"> é…ç½®</span><span class="hljs-meta">$</span><span class="bash"> gitlab-ctl reconfigure </span><span class="hljs-meta">#</span><span class="bash"> å¯åŠ¨</span><span class="hljs-meta">$</span><span class="bash"> gitlab-ctl start </span><span class="hljs-meta">#</span><span class="bash"> åœ¨æµè§ˆå™¨è¾“å…¥å¯¹åº”çš„IPåœ°å€å³å¯è®¿é—®gitlabåå°ï¼Œå¯èƒ½éœ€è¦å…³é—­é˜²ç«å¢™</span><span class="hljs-meta">#</span><span class="bash"> ï¼ˆ1ï¼‰å¯¹rootç”¨æˆ·è®¾ç½®å¯†ç </span><span class="hljs-meta">#</span><span class="bash"> ï¼ˆ2ï¼‰ç™»é™†ï¼šç”¨æˆ·åé»˜è®¤ä¸ºroot  </span><span class="hljs-meta">#</span><span class="bash"> ï¼ˆ3ï¼‰åœ¨åå°è¿›è¡Œæ·»åŠ ç”¨æˆ·ç­‰æ“ä½œã€è®¾ç½®å¯†ç ç­‰æ“ä½œ</span></code></pre><h3 id="7-å…¶ä»–"><a href="#7-å…¶ä»–" class="headerlink" title="7. å…¶ä»–"></a>7. å…¶ä»–</h3><p>ï¼ˆ1ï¼‰ å¦‚ä½•è®¾ç½®ä¸è¢«è¿½è¸ªçš„æ–‡ä»¶<br>     æœ‰äº›æ–‡ä»¶æ˜¯ä¸æƒ³è¢«è¿½è¸ªçš„ï¼Œ å¯ä»¥ä¿®æ”¹  <code>.git/info/exclude</code> æ–‡ä»¶ï¼Œ ä»¥ # å¼€å¤´ï¼Œæ·»åŠ è§„åˆ™å³å¯ã€‚</p><p>ï¼ˆ2ï¼‰server certificate verification failed. CAfile:/etc/ssl/certs/ca-certificates.crt CRLfile: none</p><pre><code class="hljs shell">export GIT_SSL_NO_VERIFY=1</code></pre><h3 id="8-å‚è€ƒèµ„æ–™"><a href="#8-å‚è€ƒèµ„æ–™" class="headerlink" title="8. å‚è€ƒèµ„æ–™"></a>8. å‚è€ƒèµ„æ–™</h3><ul><li><p>git ç®€æ˜æŒ‡å—  <a href="https://rogerdudler.github.io/git-guide/index.zh.html">https://rogerdudler.github.io/git-guide/index.zh.html</a></p></li><li><p>git-scm-zh: <a href="https://git-scm.com/book/zh/v2">https://git-scm.com/book/zh/v2</a></p></li><li>å¸¸è§ã€€UI ç•Œé¢: <a href="https://www.sourcetreeapp.com/">SourceTree</a>      <a href="https://tortoisegit.org/">tortoisegit</a>     <a href="https://www.git-tower.com/mac">Tower</a></li><li>gitflow <a href="https://nvie.com/posts/a-successful-git-branching-model/">https://nvie.com/posts/a-successful-git-branching-model/</a></li><li><p>gitflow å¤‡å¿˜æ¸…å• <a href="https://danielkummer.github.io/git-flow-cheatsheet/index.zh_CN.html">https://danielkummer.github.io/git-flow-cheatsheet/index.zh_CN.html</a></p></li><li><p>äº’åŠ¨å¼å­¦ä¹ gitçš„ç½‘ç«™ï¼šã€€<a href="https://learngitbranching.js.org/">https://learngitbranching.js.org/</a></p></li><li>å›¾è§£git:  <a href="https://my.oschina.net/xdev/blog/114383">https://my.oschina.net/xdev/blog/114383</a></li><li>git magic: <a href="http://www-cs-students.stanford.edu/~blynn/gitmagic/intl/zh_cn/index.html">http://www-cs-students.stanford.edu/~blynn/gitmagic/intl/zh_cn/index.html</a></li><li>github help: <a href="https://help.github.com/en">https://help.github.com/en</a></li><li>æœ¬åœ°æ­å»ºGitï¼š <a href="https://about.gitlab.com/">GitLab</a> å’Œã€€<a href="https://github.com/gogs/gogs">dashboard</a></li><li><a href="https://zhuanlan.zhihu.com/p/23478654">å›¾æ–‡è¯¦è§£å¦‚ä½•åˆ©ç”¨Git+Githubè¿›è¡Œå›¢é˜Ÿåä½œå¼€å‘</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Facenetç»†èŠ‚å‰–æ</title>
    <link href="/2018/04/13/Facenet/"/>
    <url>/2018/04/13/Facenet/</url>
    
    <content type="html"><![CDATA[<p>paper facenet &amp; mobilefacenet å®ç°ç»†èŠ‚å‰–æ</p><a id="more"></a><h3 id="äººè„¸è¯†åˆ«é¡¹ç›®-ç»†èŠ‚å‰–æ"><a href="#äººè„¸è¯†åˆ«é¡¹ç›®-ç»†èŠ‚å‰–æ" class="headerlink" title="äººè„¸è¯†åˆ«é¡¹ç›® ç»†èŠ‚å‰–æ"></a>äººè„¸è¯†åˆ«é¡¹ç›® ç»†èŠ‚å‰–æ</h3><h5 id="1-å›¾ç‰‡è¾“å…¥çš„å¤§å°æ˜¯å¤šå°‘ï¼Ÿæœ€åçš„-embedding-æ˜¯å¤šå°‘ï¼Ÿ-ä¸ºä»€ä¹ˆï¼Ÿ"><a href="#1-å›¾ç‰‡è¾“å…¥çš„å¤§å°æ˜¯å¤šå°‘ï¼Ÿæœ€åçš„-embedding-æ˜¯å¤šå°‘ï¼Ÿ-ä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. å›¾ç‰‡è¾“å…¥çš„å¤§å°æ˜¯å¤šå°‘ï¼Ÿæœ€åçš„ embedding æ˜¯å¤šå°‘ï¼Ÿ ä¸ºä»€ä¹ˆï¼Ÿ"></a>1. å›¾ç‰‡è¾“å…¥çš„å¤§å°æ˜¯å¤šå°‘ï¼Ÿæœ€åçš„ embedding æ˜¯å¤šå°‘ï¼Ÿ ä¸ºä»€ä¹ˆï¼Ÿ</h5><p>å›¾ç‰‡è¾“å…¥å¤§å°è®¾ç½®ä¸º 160x160ã€‚whyï¼Ÿ éšç€å›¾ç‰‡åˆ†è¾¨ç‡çš„å¢å¤§ï¼ŒéªŒè¯é›†çš„å‡†ç¡®ç‡ä¼šä¸Šå‡ï¼Œä½†æ˜¯å¯¹åº”çš„è¿ç®—é‡ä¹Ÿä¼šæ˜¾è‘—ä¸Šå‡ã€‚160 æ˜¯ä¸€ä¸ªç›¸å¯¹åˆé€‚çš„åˆ†è¾¨ç‡å¤§å°ã€‚</p><p>(facenet åŸè®ºæ–‡å°è¯•äº† 40x40, 80x80, 112x112, 160x160, 256x256)</p><p>embedding çš„å¤§å°ä¸º 128ï¼Œ å®éªŒæµ‹å¾—ï¼Œå½“è¶…è¿‡ 128 æ—¶å€™ï¼ŒéªŒè¯é›†çš„å‡†ç¡®ç‡å·²ç»æ²¡æœ‰ä¸Šå‡ï¼Œåè€Œæœ‰æ‰€ä¸‹é™ã€‚(64 -&gt; 128 -&gt; 256 -&gt; 512)ã€‚whyï¼Ÿ 128Då‘é‡æ‹¥æœ‰è¶³å¤Ÿçš„å®¹é‡hold ä½å¤§è§„æ¨¡çš„äººè„¸æ•°æ®é›†(ç™¾ä¸‡äººè„¸çº§åˆ«)ï¼Œ å¹¶ä¸”ç›¸å¯¹ç´§å‡‘ã€‚</p><h5 id="2-åŸºæœ¬åŸç†"><a href="#2-åŸºæœ¬åŸç†" class="headerlink" title="2. åŸºæœ¬åŸç†"></a>2. åŸºæœ¬åŸç†</h5><p>é€‰å–ä¸‰å…ƒç»„(anchor, pos, neg)ï¼Œå…¶ä¸­ï¼Œxå’Œpæ˜¯åŒä¸€ç±»ï¼Œxå’Œnæ˜¯ä¸åŒç±»ã€‚é‚£ä¹ˆå­¦ä¹ çš„è¿‡ç¨‹å°±æ˜¯å­¦åˆ°ä¸€ç§è¡¨ç¤ºï¼Œå¯¹äºå°½å¯èƒ½å¤šçš„ä¸‰å…ƒç»„ï¼Œä½¿å¾—anchorå’Œposçš„è·ç¦»ï¼Œå°äºanchorå’Œnegçš„è·ç¦»</p><h5 id="3-ä¸»å¹²ç½‘ç»œï¼š"><a href="#3-ä¸»å¹²ç½‘ç»œï¼š" class="headerlink" title="3. ä¸»å¹²ç½‘ç»œï¼š"></a>3. ä¸»å¹²ç½‘ç»œï¼š</h5><p>åŸå§‹è®ºæ–‡ä¸­ä½¿ç”¨çš„æ˜¯ googlenetã€githubä¸Šçš„facenetä½¿ç”¨çš„ inception resnet v1ã€mobilefacenet ä½¿ç”¨çš„æ˜¯ mobilenet v2</p><h6 id="1-GoogleNet"><a href="#1-GoogleNet" class="headerlink" title="(1) GoogleNet"></a>(1) GoogleNet</h6><p>åŸè®ºæ–‡ä¸­ä½¿ç”¨çš„æ˜¯ GoogleNetï¼Œ Googlenet çš„ä¸»è¦æ¶‰åŠåœ¨äºä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>Inception Moduleä¸­åŒ…å«3ç§ä¸åŒå°ºå¯¸çš„å·ç§¯å’Œ1ä¸ªæœ€å¤§æ± åŒ–ï¼Œå¢åŠ äº†ç½‘ç»œå¯¹ä¸åŒå°ºåº¦çš„é€‚åº”æ€§ã€‚</li></ul><p>ç¬¬ä¸€ä¸ªåˆ†æ”¯å¯¹è¾“å…¥è¿›è¡Œ 1x1å·ç§¯ï¼Œ<strong>1x1å·ç§¯å¯ä»¥è·¨é€šé“ç»„ç»‡ä¿¡æ¯ï¼Œæé«˜ç½‘ç»œçš„è¡¨è¾¾èƒ½åŠ›ï¼ŒåŒæ—¶å¯ä»¥å¯¹è¾“å‡ºé€šé“å‡ç»´å’Œé™ç»´</strong>ã€‚</p><p>ç¬¬äºŒä¸ªåˆ†æ”¯å…ˆä½¿ç”¨äº† 1x1 å·ç§¯ï¼Œç„¶åè¿æ¥ 3x3 å·ç§¯ï¼Œç›¸å½“äºè¿›è¡Œä¸¤æ¬¡ç‰¹å¾å˜æ¢ã€‚</p><p>ç¬¬ä¸‰ä¸ªåˆ†æ”¯å’Œç¬¬äºŒä¸ªåˆ†æ”¯ç±»ä¼¼ï¼Œå…ˆæ˜¯ä½¿ç”¨äº†1x1 çš„å·ç§¯ï¼Œç„¶åè¿æ¥ 5x5 çš„å·ç§¯ã€‚</p><p>æœ€åä¸€ä¸ªåˆ†æ”¯åˆ™æ˜¯3x3 æœ€å¤§æ± åŒ–åç›´æ¥ä½¿ç”¨1x1å·ç§¯ã€‚</p><p>Inception Module çš„4ä¸ªåˆ†æ”¯åœ¨æœ€åé€šè¿‡ä¸€ä¸ªèšåˆæ“ä½œåˆå¹¶ã€‚</p><ul><li>å»é™¤äº†æœ€åçš„å…¨è¿æ¥å±‚ï¼Œç”¨å…¨å±€å¹³å‡æ± åŒ–å±‚æ¥å–ä»£å®ƒã€‚</li></ul><h6 id="2-Mobilenet-v2"><a href="#2-Mobilenet-v2" class="headerlink" title="(2) Mobilenet v2"></a>(2) Mobilenet v2</h6><p>å¦ä¸€ç¯‡è®ºæ–‡åˆ™ä½¿ç”¨äº† mobilenetv2 (è¾“å…¥å˜æˆ112) ç»“æ„ä½œä¸ºä¸»è¦ç½‘ç»œï¼šä¸»è¦ä¿®æ”¹ç‚¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li><p>Inception ç»“æ„æ›¿æ¢ä¸º mobilenet v2 ç»“æ„ï¼š</p><p>mobilenet çš„ç»“æ„è¦ç‚¹ï¼šï¼ˆ1ï¼‰skip-connection è·³å±‚è¿æ¥ (2) å°†ä¼ ç»Ÿå·ç§¯åˆ†è§£ä¸ºé€é€šé“å·ç§¯(å…ˆè¿›è¡Œé€é€šé“å·ç§¯ä½†æ˜¯é€šé“ä¹‹é—´ä¸ç›¸åŠ ï¼Œç„¶åä½¿ç”¨1x1 å·ç§¯å¯¹é€šé“è¿›è¡Œæ•´åˆ), å¹¶åœ¨å‰é¢åŠ ä¸€ä¸ª1x1 çš„å·ç§¯è¿›è¡Œå‡ç»´ã€‚(3) å°†æœ€åçš„ ReLU æ›¿æ¢ä¸º Linear(éçº¿æ€§åœ¨é«˜ç»´æœ‰æº¢å‡ºï¼Œä½†æ˜¯åœ¨ä½ç»´ä¸å¦‚çº¿æ€§å¥½) </p></li><li><p>ç”¨å…¨å±€å¯åˆ†ç¦»å·ç§¯æ›¿ä»£åŸæœ‰çš„å…¨å±€æ± åŒ–å±‚ã€‚why? ç‰¹å¾å›¾ä¸Šçš„ä¸­å¿ƒç‚¹çš„æ„Ÿå—é‡å’Œè¾¹è§’çš„æ„Ÿå—é‡æ˜¯ä¸åŒçš„ï¼Œä¸­å¿ƒç‚¹çš„æ„Ÿå—é‡åŒ…æ‹¬äº†å®Œæ•´çš„å›¾ç‰‡ï¼Œè¾¹è§’ç‚¹çš„æ„ŸçŸ¥åŸŸå´åªæœ‰éƒ¨åˆ†çš„å›¾ç‰‡ï¼Œ ä¸åº”è¯¥è§†ä¸ºåŒç­‰é‡è¦ã€‚è¿™æ ·ä¼šå¯¼è‡´æ€§èƒ½çš„ä¸‹é™ã€‚</p></li><li><p>ä½¿ç”¨ arcface æ›¿æ¢æ‰ triplet æŸå¤±å‡½æ•°ã€‚ </p></li><li><p>å°ç»†èŠ‚ï¼šé€šé“æ‰©å¼ å€æ•°å˜å°(facenet æ˜¯ 1024ï¼Œ mobilenets åˆ™æ˜¯ 512)ï¼›ä½¿ç”¨preluä»£æ›¿reluï¼›ä½¿ç”¨batch Normalizationã€‚</p></li></ul><h5 id="4-é¢„å¤„ç†å·¥ä½œï¼š"><a href="#4-é¢„å¤„ç†å·¥ä½œï¼š" class="headerlink" title="4. é¢„å¤„ç†å·¥ä½œï¼š"></a>4. é¢„å¤„ç†å·¥ä½œï¼š</h5><p>(1) æ•°æ®é›†çš„æ•´ç†å’Œæ¸…æ´—(DDM æ™ºèƒ½çŒ«çœ¼[å¤§çº¦10Wå¼ ï¼Œ6åƒäººçš„æ ·å­-&gt; çŒ«çœ¼300å°ï¼Œæ¯å°20äºº]çš„çœŸå®æ•°æ® å’Œ CASIA äººè„¸æ•°æ®)</p><ul><li>ç±»é—´è¿‡æ»¤ï¼š æ¸…æ´—æ‰è·ç¦»ä¸ç±»ä¸­å¿ƒå°äº0.5 çš„è´Ÿæ ·æœ¬(å¯¹ä¸€ä¸ªç±»åˆ«ï¼Œå…ˆè®¡ç®—ç±»ä¸­å¿ƒï¼Œç„¶åç”¨æ‰€æœ‰æ ·æœ¬ï¼Œä¸å…¶è¿›è¡Œæ¯”è¾ƒ)</li><li><p>å›¾ç‰‡çš„è¿‡æ»¤ï¼šå°†ç»è¿‡äººè„¸æ£€æµ‹(MTCNN/FaceBoxes) è¿”å›çš„äººè„¸ç½®ä¿¡åº¦ å°äº 0.75 çš„å›¾ç‰‡ç›´æ¥è¿‡æ»¤æ‰</p></li><li><p>æŒ‰å›¾åƒæ•°é‡é˜ˆå€¼è¿›è¡Œæ•°æ®åˆ’åˆ†(äººè„¸ä½äº10å¼ çš„è¿‡æ»¤æ‰)</p></li><li>ç±»é—´è·ç¦»é—®é¢˜ï¼šæœ‰äº›å¯èƒ½æ˜¯åå­—é‡åˆçš„ï¼Œæ‰¾å‡ºæ¥åˆå¹¶åœ¨ä¸€èµ·</li></ul><p>(2) äººè„¸è¯†åˆ«å‰çš„å¤„ç†ï¼š</p><ul><li><p>äººè„¸å¯¹é½ï¼Ÿå¯ä»¥æœ‰ä¹Ÿå¯ä»¥æ²¡æœ‰ï¼Œå½±å“ä¸æ˜¯å¾ˆå¤§ how?( é€šè¿‡ä»¿å°„å˜æ¢å°†åŸæœ¬çš„äº”ä¸ªlandmarkç¼©æ”¾æ—‹è½¬åˆ°å›ºå®šçš„ä½ç½®)</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> skimage <span class="hljs-keyword">import</span> transform <span class="hljs-keyword">as</span> trans<span class="hljs-comment"># src</span>src = np.array([  [<span class="hljs-number">30.2946</span>, <span class="hljs-number">51.6963</span>],  [<span class="hljs-number">65.5318</span>, <span class="hljs-number">51.5014</span>],  [<span class="hljs-number">48.0252</span>, <span class="hljs-number">71.7366</span>],  [<span class="hljs-number">33.5493</span>, <span class="hljs-number">92.3655</span>],  [<span class="hljs-number">62.7299</span>, <span class="hljs-number">92.2041</span>] ], dtype=np.float32 )<span class="hljs-keyword">if</span> image_size[<span class="hljs-number">1</span>]==<span class="hljs-number">112</span>:  src[:,<span class="hljs-number">0</span>] += <span class="hljs-number">8.0</span>  <span class="hljs-comment"># dst</span>dst = landmark.astype(np.float32)tform = trans.SimilarityTransform()tform.estimate(dst, src)M = tform.params[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>,:]<span class="hljs-comment"># warpAffine</span>warped = cv2.warpAffine(img, M, (image_size[<span class="hljs-number">1</span>],image_size[<span class="hljs-number">0</span>]), borderValue = <span class="hljs-number">0.0</span>)</code></pre></li><li><p>æ¨¡ç³Šè¿‡æ»¤ï¼Ÿï¼ˆå°†æ£€æµ‹å‡ºæ¥çš„äººè„¸ä½¿ç”¨æ‹‰æ™®æ‹‰æ–¯åšå·ç§¯è¿ç®—ï¼Œç„¶åè®¡ç®—æ–¹å·®ï¼Œ å°†æ–¹å·®å°äº 400 è¿‡æ»¤æ‰)</p></li><li>äººè„¸ç½®ä¿¡åº¦ï¼Œè¿™é‡Œè®¾ç½®ç½®ä¿¡åº¦0.8ï¼Œäººè„¸ç½®ä¿¡åº¦å¤ªå°å¯èƒ½ä¸æ˜¯äººè„¸ï¼Œç›´æ¥è¿‡æ»¤æ‰ã€‚</li><li>å¯¹å›¾ç‰‡è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ï¼š(x-å‡å€¼)/æ ‡å‡†å·®</li></ul><h5 id="5-åå¤„ç†-å¦‚ä½•è¿›è¡Œåˆ†ç±»ï¼Ÿ"><a href="#5-åå¤„ç†-å¦‚ä½•è¿›è¡Œåˆ†ç±»ï¼Ÿ" class="headerlink" title="5. åå¤„ç†(å¦‚ä½•è¿›è¡Œåˆ†ç±»ï¼Ÿ)"></a>5. åå¤„ç†(å¦‚ä½•è¿›è¡Œåˆ†ç±»ï¼Ÿ)</h5><p>facenet ä½¿ç”¨æ¬§å¼è·ç¦»æ¥åº¦é‡æ˜¯å¦æ˜¯ä¸€ä¸ªäººã€‚ä½¿ç”¨åæŠ˜äº¤å‰éªŒè¯ï¼Œæˆ‘ä»¬è®¾å®šé˜ˆå€¼ä¸º 1.24ã€‚</p><p>mobilenet ä½¿ç”¨ç›¸ä¼¼æ€§ä½™å¼¦åº¦é‡ï¼šé˜ˆå€¼è®¾å®šä¸º 0.7ã€‚</p><p><img src="/2018/04/13/Facenet/3.png" alt="3"></p><h5 id="6-å‚æ•°è°ƒæ•´ï¼š-æ²¡æœ‰æ€ä¹ˆè°ƒæ•´å‚æ•°ï¼Œ-ä½¿ç”¨é»˜è®¤å‚æ•°ï¼Œæ›¿æ¢æ‰äº†æ•°æ®é›†è€Œå·²"><a href="#6-å‚æ•°è°ƒæ•´ï¼š-æ²¡æœ‰æ€ä¹ˆè°ƒæ•´å‚æ•°ï¼Œ-ä½¿ç”¨é»˜è®¤å‚æ•°ï¼Œæ›¿æ¢æ‰äº†æ•°æ®é›†è€Œå·²" class="headerlink" title="6. å‚æ•°è°ƒæ•´ï¼š(æ²¡æœ‰æ€ä¹ˆè°ƒæ•´å‚æ•°ï¼Œ ä½¿ç”¨é»˜è®¤å‚æ•°ï¼Œæ›¿æ¢æ‰äº†æ•°æ®é›†è€Œå·²)"></a>6. å‚æ•°è°ƒæ•´ï¼š(æ²¡æœ‰æ€ä¹ˆè°ƒæ•´å‚æ•°ï¼Œ ä½¿ç”¨é»˜è®¤å‚æ•°ï¼Œæ›¿æ¢æ‰äº†æ•°æ®é›†è€Œå·²)</h5><ul><li><p>ä¼˜åŒ–å™¨ï¼š<code>RMSProp</code></p><pre><code class="hljs apache"><span class="hljs-attribute">tf</span>.train.RMSPropOptimizer(learning_rate, decay=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>, momentum=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>, epsilon=<span class="hljs-number">1</span>.<span class="hljs-number">0</span>)</code></pre></li><li><p>åˆå§‹å­¦ä¹ ç‡ï¼š0.1</p></li><li><p>å­¦ä¹ ç‡ä¸‹é™æ–¹å¼ï¼šexponential_decay</p><pre><code class="hljs yaml"><span class="hljs-comment"># Learning rate schedule: Maps an epoch number to a learning rate</span><span class="hljs-attr">0:</span>  <span class="hljs-number">0.1</span>  <span class="hljs-comment"># åˆå§‹å­¦ä¹ ç‡</span><span class="hljs-attr">300:</span> <span class="hljs-number">0.01</span><span class="hljs-attr">400:</span> <span class="hljs-number">0.001</span><span class="hljs-attr">1000:</span> <span class="hljs-number">0.0001</span></code></pre></li><li><p>margin Î±=0.2</p></li></ul><h5 id="7-why-facenet-ï¼Ÿ"><a href="#7-why-facenet-ï¼Ÿ" class="headerlink" title="7. why facenet ï¼Ÿ"></a>7. why facenet ï¼Ÿ</h5><ul><li><p>softmaxï¥§ç›´æ¥ï¼Œ(ä¸‰å…ƒç»„ç›´æ¥ä¼˜åŒ–è·ç¦»)ï¼Œå› â½½è€Œæ€§èƒ½ä¹Ÿä¸ï¥§å¥½ã€‚ softmaxäº§â½£ç”Ÿçš„ç‰¹å¾è¡¨ç¤ºå‘é‡ï¥¾éƒ½å¾ˆâ¼¤å¤§ï¼Œâ¼€ä¸€èˆ¬è¶…è¿‡1000ç»´ã€‚ </p></li><li><p>faceNetå¹¶æ²¡æœ‰åƒDeepFaceå’ŒDeepIDé‚£æ ·éœ€è¦å¯¹â»¬ã€‚ </p></li><li><p>faceNetå¾—åˆ°æœ€ç»ˆè¡¨ç¤ºåä¸ï¥§â½¤ç”¨åƒDeepIDé‚£æ ·éœ€è¦å†è®­ç»ƒæ¨¡å‹è¿›â¾åˆ†ç±»ï¼Œç›´æ¥è®¡ç®—è·ç¦»å°±å¥½äº†ï¦ºï¼Œç®€å•â½½è€Œæœ‰æ•ˆã€‚ </p></li></ul><h5 id="8-æ¨¡å‹çš„å¤§å°ï¼š"><a href="#8-æ¨¡å‹çš„å¤§å°ï¼š" class="headerlink" title="8. æ¨¡å‹çš„å¤§å°ï¼š"></a>8. æ¨¡å‹çš„å¤§å°ï¼š</h5><p>çº¿ä¸Šæ¨¡å‹ï¼š model_size:  (Inception resnet v2ï¼š 186M)      Paramï¼š7.5M   </p><p>çº¿ä¸‹æ¨¡å‹ï¼š(æ‰‹æœºç«¯) model_size:  4.1M       param:  0.99M       </p><h5 id="8-è®­ç»ƒæŠ€å·§"><a href="#8-è®­ç»ƒæŠ€å·§" class="headerlink" title="8. è®­ç»ƒæŠ€å·§"></a>8. è®­ç»ƒæŠ€å·§</h5><ul><li>ä¸‰å…ƒç»„çš„é€‰æ‹©<pre><code>     åœ¨ä¸€ä¸ªminibatchä¸­ï¼Œæˆ‘ä»¬æ ¹æ®å½“æ—¶çš„ embeddingï¼Œé€‰æ‹©ä¸€æ¬¡ä¸‰å…ƒç»„ï¼Œåœ¨è¿™äº›ä¸‰å…ƒç»„ä¸Šè®¡ç®—triplet-loss,  å†å¯¹embeddingè¿›è¡Œæ›´æ–°ï¼Œä¸æ–­é‡å¤ï¼Œç›´åˆ°æ”¶æ•›æˆ–è®­ç»ƒåˆ°æŒ‡å®šè¿­ä»£æ¬¡æ•°ã€‚</code></pre></li></ul>]]></content>
    
    
    <categories>
      
      <category>Face</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Hexo_blog_issue</title>
    <link href="/2018/03/04/Hexo-blog-issue/"/>
    <url>/2018/03/04/Hexo-blog-issue/</url>
    
    <content type="html"><![CDATA[<p>Hexo éƒ¨ç½²ã€é…ç½®ã€ä¿®æ”¹ç­‰å¸¸è§é—®é¢˜è®°å½•</p><a id="more"></a><h4 id="1-å†™æ–‡ç« ã€å‘å¸ƒæ–‡ç« "><a href="#1-å†™æ–‡ç« ã€å‘å¸ƒæ–‡ç« " class="headerlink" title="1. å†™æ–‡ç« ã€å‘å¸ƒæ–‡ç« "></a>1. å†™æ–‡ç« ã€å‘å¸ƒæ–‡ç« </h4><pre><code class="hljs shell">hexo new post article_title    # æ–°å»ºä¸€ç¯‡æ–‡ç« <span class="hljs-meta">#</span><span class="bash"> ç¼–è¾‘ [root]\<span class="hljs-built_in">source</span>\_posts ä¸‹çš„markdownæ–‡ä»¶</span>hexo g   # ç”Ÿæˆé™æ€ç½‘é¡µhexo s   # æœ¬åœ°é¢„è§ˆæ•ˆæœhexo d   # ä¸Šä¼ åˆ°github</code></pre><p>æ–‡ç« å¼€å¤´çš„é…ç½®å¦‚ä¸‹æ‰€ç¤º</p><pre><code class="hljs markdown">title: æ ‡é¢˜catalog: æ˜¯å¦æ˜¾ç¤ºæ®µè½ç›®å½•date: æ–‡ç« æ—¥æœŸsubtitle: å­æ ‡é¢˜header-img: é¡¶éƒ¨èƒŒæ™¯å›¾ç‰‡top: æ˜¯å¦ç½®é¡¶tags: æ ‡ç­¾categories: åˆ†ç±»</code></pre><h4 id="2-æ·»åŠ å›¾ç‰‡"><a href="#2-æ·»åŠ å›¾ç‰‡" class="headerlink" title="2.  æ·»åŠ å›¾ç‰‡"></a>2.  æ·»åŠ å›¾ç‰‡</h4><ol><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ŒæŠŠä¸»é¡µé…ç½®æ–‡ä»¶ <strong>_config.yml</strong> é‡Œçš„ <strong>post_asset_folder</strong>:è¿™ä¸ªé€‰é¡¹è®¾ç½®ä¸º<strong>true</strong>ã€‚</p></li><li><p>å®‰è£…å¯ä»¥ä¸Šä¼ æœ¬åœ°å›¾ç‰‡çš„æ’ä»¶ï¼Œ <code>npm install hexo-asset-image --save</code>ã€‚æ­¤æ—¶è¿è¡Œ<code>hexo n &quot;xxxx&quot;</code>æ¥ç”Ÿæˆmdåšæ–‡æ—¶ï¼Œ<strong>/source/_posts</strong> æ–‡ä»¶å¤¹å†…é™¤äº† <strong>xxxx.md</strong> æ–‡ä»¶è¿˜æœ‰ä¸€ä¸ªåŒåçš„æ–‡ä»¶å¤¹ã€‚</p></li><li><p>å°†å›¾ç‰‡æ”¾åœ¨ <strong>xxxx</strong> è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œåœ¨xxxx.mdä¸­ä½¿ç”¨markdownçš„æ ¼å¼å¼•å…¥å›¾ç‰‡ï¼š</p><pre><code class="hljs markdown">![<span class="hljs-string">title</span>](<span class="hljs-link">xxxx/img_name.jpg</span>)</code></pre></li><li><p>ä¿®æ”¹ <code>/node_modules/hexo-asset-image/index.js</code> ï¼Œ æ›¿æ¢ä¸ºå¦‚ä¸‹ä»£ç :</p><pre><code class="hljs js"><span class="hljs-meta">&#x27;use strict&#x27;</span>;<span class="hljs-keyword">var</span> cheerio = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cheerio&#x27;</span>);<span class="hljs-comment">// http://stackoverflow.com/questions/14480345/how-to-get-the-nth-occurrence-in-a-string</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPosition</span>(<span class="hljs-params">str, m, i</span>) </span>&#123;  <span class="hljs-keyword">return</span> str.split(m, i).join(m).length;&#125;<span class="hljs-keyword">var</span> version = <span class="hljs-built_in">String</span>(hexo.version).split(<span class="hljs-string">&#x27;.&#x27;</span>);hexo.extend.filter.register(<span class="hljs-string">&#x27;after_post_render&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)</span>&#123;  <span class="hljs-keyword">var</span> config = hexo.config;  <span class="hljs-keyword">if</span>(config.post_asset_folder)&#123;    <span class="hljs-keyword">var</span> link = data.permalink;<span class="hljs-keyword">if</span>(version.length &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-built_in">Number</span>(version[<span class="hljs-number">0</span>]) == <span class="hljs-number">3</span>)   <span class="hljs-keyword">var</span> beginPos = getPosition(link, <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>;<span class="hljs-keyword">else</span>   <span class="hljs-keyword">var</span> beginPos = getPosition(link, <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-number">3</span>) + <span class="hljs-number">1</span>;<span class="hljs-comment">// In hexo 3.1.1, the permalink of &quot;about&quot; page is like &quot;.../about/index.html&quot;.</span><span class="hljs-keyword">var</span> endPos = link.lastIndexOf(<span class="hljs-string">&#x27;/&#x27;</span>) + <span class="hljs-number">1</span>;    link = link.substring(beginPos, endPos);    <span class="hljs-keyword">var</span> toprocess = [<span class="hljs-string">&#x27;excerpt&#x27;</span>, <span class="hljs-string">&#x27;more&#x27;</span>, <span class="hljs-string">&#x27;content&#x27;</span>];    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; toprocess.length; i++)&#123;      <span class="hljs-keyword">var</span> key = toprocess[i];       <span class="hljs-keyword">var</span> $ = cheerio.load(data[key], &#123;        ignoreWhitespace: <span class="hljs-literal">false</span>,        xmlMode: <span class="hljs-literal">false</span>,        lowerCaseTags: <span class="hljs-literal">false</span>,        decodeEntities: <span class="hljs-literal">false</span>      &#125;);      $(<span class="hljs-string">&#x27;img&#x27;</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">if</span> ($(<span class="hljs-built_in">this</span>).attr(<span class="hljs-string">&#x27;src&#x27;</span>))&#123;<span class="hljs-comment">// For windows style path, we replace &#x27;\&#x27; to &#x27;/&#x27;.</span><span class="hljs-keyword">var</span> src = $(<span class="hljs-built_in">this</span>).attr(<span class="hljs-string">&#x27;src&#x27;</span>).replace(<span class="hljs-string">&#x27;\\&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>);<span class="hljs-keyword">if</span>(!<span class="hljs-regexp">/http[s]*.*|\/\/.*/</span>.test(src) &amp;&amp;   !<span class="hljs-regexp">/^\s*\//</span>.test(src)) &#123;  <span class="hljs-comment">// For &quot;about&quot; page, the first part of &quot;src&quot; can&#x27;t be removed.</span>  <span class="hljs-comment">// In addition, to support multi-level local directory.</span>  <span class="hljs-keyword">var</span> linkArray = link.split(<span class="hljs-string">&#x27;/&#x27;</span>).filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">elem</span>)</span>&#123;<span class="hljs-keyword">return</span> elem != <span class="hljs-string">&#x27;&#x27;</span>;  &#125;);  <span class="hljs-keyword">var</span> srcArray = src.split(<span class="hljs-string">&#x27;/&#x27;</span>).filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">elem</span>)</span>&#123;<span class="hljs-keyword">return</span> elem != <span class="hljs-string">&#x27;&#x27;</span> &amp;&amp; elem != <span class="hljs-string">&#x27;.&#x27;</span>;  &#125;);  <span class="hljs-keyword">if</span>(srcArray.length &gt; <span class="hljs-number">1</span>)srcArray.shift();  src = srcArray.join(<span class="hljs-string">&#x27;/&#x27;</span>);  $(<span class="hljs-built_in">this</span>).attr(<span class="hljs-string">&#x27;src&#x27;</span>, config.root + link + src);  <span class="hljs-built_in">console</span>.info&amp;&amp;<span class="hljs-built_in">console</span>.info(<span class="hljs-string">&quot;update link as:--&gt;&quot;</span>+config.root + link + src);&#125;&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-built_in">console</span>.info&amp;&amp;<span class="hljs-built_in">console</span>.info(<span class="hljs-string">&quot;no src attr, skipped...&quot;</span>);<span class="hljs-built_in">console</span>.info&amp;&amp;<span class="hljs-built_in">console</span>.info($(<span class="hljs-built_in">this</span>));&#125;      &#125;);      data[key] = $.html();    &#125;  &#125;&#125;);</code></pre></li><li><p>æ£€æŸ¥ <code>_config.yml</code> æ–‡ä»¶ï¼Œ æ˜¯å¦ä¿®æ”¹äº†å¯¹åº”çš„ URLï¼š</p><pre><code class="hljs yaml"><span class="hljs-comment"># URL</span><span class="hljs-comment">## If your site is put in a subdirectory, set url as &#x27;http://example.com/child&#x27; and root as &#x27;/child/&#x27;</span><span class="hljs-attr">url:</span> <span class="hljs-string">https://polariszhao.github.io/</span>  <span class="hljs-comment"># ä¿®æ”¹ä¸ºå¯¹åº”çš„ URL</span></code></pre></li></ol><p><img src="/2018/03/04/Hexo-blog-issue/lena.bmp" alt="test_img"></p>]]></content>
    
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>issue</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
